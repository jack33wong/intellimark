
> ai-marking-backend@1.0.0 dev
> cross-env NODE_OPTIONS=--no-deprecation nodemon --exec tsx --tsconfig tsconfig.dev.json server.ts

âœ… Permissions configuration loaded from .env.local:
   - Analysis Plans: pro, ultra
   - Model Selection Plans: pro, ultra
âœ… Credit configuration loaded from .env.local (FAIL-FAST mode):
   - Conversion Rate: $0.01 per credit
   - Free Plan: 10 credits/month
   - Pro Plan: 200 credits/month
   - Ultra Plan: 600 credits/month
ğŸ’³ Stripe initialized in TEST mode
ğŸ“š Swagger UI available at /api-docs
ğŸ‘¤ [PLAN CHECK] User 9mBfvniXTuMtQU8f0OnLhUK6aOv2 is on plan: pro
ğŸ“¡ [MARKING] Processing POST /api/marking/process (hasRawBody: false)
ğŸš€ [MARKING] Controller started - Files: 1, Body Keys: model, aiMessageId
ğŸ” [CREDIT DEBUG] userId: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, isAuthenticated: true
ğŸ’³ [CREDIT CHECK] Starting credit check for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2
ğŸ’³ [CREDIT CHECK] Estimated cost: 0.0158132, files: 1, bytes: 108132
ğŸ’³ [CREDIT CHECK] Result: {"canProceed":true,"remaining":20.8}

ğŸ”„ ========== UNIFIED PIPELINE START ==========
ğŸ”„ ============================================

[1m[32mâœ… [INPUT VALIDATION][0m [1mCOMPLETED[0m in [1m0.0s[0m ([32m[1mVALIDATION[0m)
[INPUT TYPE] Detected: Single Image (1 files)
[1m[32mâœ… [PREPROCESSING][0m [1mCOMPLETED[0m in [1m0.1s[0m ([32m[1mIMAGE-PROCESSING[0m)
[MAPPER] Using model: gemini-2.0-flash
[MAPPER] Starting Map Pass for 1 pages...
âœ… [MAPPER] Map Pass complete in 1.79s. Mapped 1 pages.
[1m[32mâœ… [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m8.3s[0m ([32m[1mGEMINI-2.0-FLASH[0m)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”€ [PERFECT SPLIT] Building standalone structures with re-indexing
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ [MODE ROUTING] Pure marking mode

âœ… Perfect split complete - each mode has consecutive 0-based indices
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[1m[32mâœ… [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m8.3s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
ğŸ” [MODE DETECTION] Analysis (AFTER overrides):
  - All question-only: false
  - Has mixed content: false
  - Has any student work: true
  - Selected mode: Marking Mode
[1m[32mâœ… [OCR PROCESSING][0m [1mCOMPLETED[0m in [1m4.0s[0m ([32m[1mMATHPIX[0m)
[31m[HINT] âš ï¸ Hint Adherence Failed! Poor match density. Restarting...[0m
[DEBUG] smartEstimateMaxMarks processing text (len=46) for Q?
[DEBUG] smartEstimateMaxMarks processing text (len=64) for Q?
ğŸ“ [PIPELINE] Detected consensus paper: "General Question (No Past Paper Match)". Will use as hint for question-only pages.
[1m[32mâœ… [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m0.4s[0m ([32m[1mQUESTION-DETECTION[0m)

ğŸ“‹ [DETECTION AUDIT REPORT]
------------------------------------------------------------------------------------------------------------------------------------
| Q#   | Input Text (Fragment)                       | Match Result / Paper Title                         | Score | Status        |
------------------------------------------------------------------------------------------------------------------------------------
| 12   | Put these in order starting with the small... | Unknown General Generic Question N/A Q12           | 0.000 | [33mâš ï¸  WEAK MATCH[0m |
| 13   | Work out the value of \frac{5}{\sqrt{3}} -... | Unknown General Generic Question N/A Q13           | 0.000 | [33mâš ï¸  WEAK MATCH[0m |
------------------------------------------------------------------------------------------------------------------------------------


ğŸ“Š [QUESTION DETECTION STATISTICS]
   Total questions: 2
   Detected: 0/2
   Not detected: 2
   [HINT] Hint Used: "Global Search"
   [HINT] Matched Papers: 108
[SPATIAL SHIELD] Applying Hybrid Shield for Q12...
[SHIELD] ğŸ›¡ï¸ Analyzing Q12. Next Header "Q13" present in input? YES (Leak Potential)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 16 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q12...
[SHIELD] ğŸ›¡ï¸ Analyzing Q12. Next Header "Q13" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q13...
[SHIELD] ğŸ›¡ï¸ Analyzing Q13. Next Header "Q14" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 11 to 27. (Dropped 11 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q13...
[SHIELD] ğŸ›¡ï¸ Analyzing Q13. Next Header "Q14" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 16. (Dropped 0 blocks)
âœ… createMarkingTasksFromClassification completed, created 2 marking task(s)
[1m[32mğŸ”„ [AI MARKING][0m [1mSTARTING...[0m
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=true, Marks count=15

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q12[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **GENERIC MODE RULE:** Since the marking scheme is a generic pool, discover the total marks from the question text (e.g. "Total 4 marks") and only return annotations for those 4 marks. Do NOT skip a question. If the student wrote nothing, provide a cross (A0/M0) only for the discovered total marks.

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the discovered total marks from the student paper (e.g. 4 or 5). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 12



## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)

âš ï¸ NO OFFICIAL MARKING SCHEME AVAILABLE (GENERIC MODE).
1. You are the CHIEF EXAMINER.
2. GRADING STRATEGY:
   - Use M1, M2, M3... for sequential Method steps (correct approach).
   - Use A1, A2, A3... for sequential Accuracy steps (correct values).
   - Use B1, B2, B3... for Independent statements/reasons.
   - Use M0/A0/B0 ONLY to explicitly flag incorrect steps.
3. LIMITS:
   - Ignore the 'Total 20' ceiling. It is just a buffer.
   - Determine the actual value of the question yourself (e.g., if it's worth 4 marks, award 4 marks).
   - Do NOT award more marks than the question is logically worth.




## MARKING SCHEME

[GENERIC_GCSE_LOGIC]
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **SCAN**: Search OCR blocks for "(Total X marks)". Set `budget` = X. (Default 3).
> 2. **SOLVE**: Identify ALL valid marks (Method + Accuracy).
> 3. **CUT (The Guillotine):**
>    - You CANNOT output more annotations than the `budget`.
>    - **CONFLICT RULE:** If you have awarded full marks (e.g. 3/3), you MUST DELETE all error marks (M0/A0). A student cannot get full marks AND an error mark.
>    - **DELETION ORDER (Remove from bottom up):**
>         1. DELETE M0/A0/B0 (Errors) FIRST.
>         2. DELETE "M" marks (Intermediate steps) SECOND.
>         3. KEEP "A" marks (Final Answer) LAST.

[MARK POOL]
- M1-M5: [METHOD] Working steps (Delete these first if over budget).
- A1-A3: [ACCURACY] Final answers (Keep these).
- B1-B2: [INDEPENDENT] Statements.

> [PERMISSIONS]
> - **PARTIAL MATCHING:** You are allowed to match a [Student Line] to a [OCR Block] even if the block only contains *part* of the line (e.g. Student writes "5/sqrt(3) = ..." but OCR only sees the result "... = 5sqrt(3)/3").
> - **FUZZY TEXT:** Ignore typos like 'S' for '5' or '72' for '27' if the position aligns.



> [!IMPORTANT]
> This is a GENERIC marking pool. 
> - Discover the actual total marks from the student paper (e.g. "Total 4 marks").
> - ONLY return annotations for the marks actually identified/needed.
> - Do NOT generate filler annotations to "coverage" the entire M1-M8 pool.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] \frac{2}{3} x \sqrt{18} (ID: line_1)
[Line 2] \frac{156}{\sqrt{2}} (ID: line_2)
[Line 3] \frac{10}{\sqrt{5}} (ID: line_3)
[Line 4] \sqrt{28} (ID: line_4)
[Line 5] You must show your working. (ID: line_5)
[Line 6] \sqrt{8} (ID: line_6)
[Line 7] \frac{2}{3} \sqrt{18} (ID: line_7)
[Line 8] \frac{10}{\sqrt{5}} x \frac{\sqrt{5}}{\sqrt{5}} (ID: line_8)
[Line 9] 10 \sqrt{5} (ID: line_9)
[Line 10] 2\sqrt{7} (ID: line_10)
[Line 11] 2\sqrt{5} (ID: line_11)
[Line 12] Smallest 2\sqrt{5} (ID: line_12)
[Line 13] 2\sqrt{6} (ID: line_13)
[Line 14] Largest 2\sqrt{7} (ID: line_14)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_2_964]: "\( 2 \sqrt{3} \times \sqrt{2} \)"
[block_0_9_446]: "\text { Smallest }  \frac{2 \sqrt{3}}{2 \sqrt{6}} &"
[block_0_10_821]: "\hline \text { Largest } \frac{2 \sqrt{7}}{} & \text { (Total 3 marks) }"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=true, Marks count=15

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q13[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **GENERIC MODE RULE:** Since the marking scheme is a generic pool, discover the total marks from the question text (e.g. "Total 4 marks") and only return annotations for those 4 marks. Do NOT skip a question. If the student wrote nothing, provide a cross (A0/M0) only for the discovered total marks.

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the discovered total marks from the student paper (e.g. 4 or 5). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 13



## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)

âš ï¸ NO OFFICIAL MARKING SCHEME AVAILABLE (GENERIC MODE).
1. You are the CHIEF EXAMINER.
2. GRADING STRATEGY:
   - Use M1, M2, M3... for sequential Method steps (correct approach).
   - Use A1, A2, A3... for sequential Accuracy steps (correct values).
   - Use B1, B2, B3... for Independent statements/reasons.
   - Use M0/A0/B0 ONLY to explicitly flag incorrect steps.
3. LIMITS:
   - Ignore the 'Total 20' ceiling. It is just a buffer.
   - Determine the actual value of the question yourself (e.g., if it's worth 4 marks, award 4 marks).
   - Do NOT award more marks than the question is logically worth.




## MARKING SCHEME

[GENERIC_GCSE_LOGIC]
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **SCAN**: Search OCR blocks for "(Total X marks)". Set `budget` = X. (Default 3).
> 2. **SOLVE**: Identify ALL valid marks (Method + Accuracy).
> 3. **CUT (The Guillotine):**
>    - You CANNOT output more annotations than the `budget`.
>    - **CONFLICT RULE:** If you have awarded full marks (e.g. 3/3), you MUST DELETE all error marks (M0/A0). A student cannot get full marks AND an error mark.
>    - **DELETION ORDER (Remove from bottom up):**
>         1. DELETE M0/A0/B0 (Errors) FIRST.
>         2. DELETE "M" marks (Intermediate steps) SECOND.
>         3. KEEP "A" marks (Final Answer) LAST.

[MARK POOL]
- M1-M5: [METHOD] Working steps (Delete these first if over budget).
- A1-A3: [ACCURACY] Final answers (Keep these).
- B1-B2: [INDEPENDENT] Statements.

> [PERMISSIONS]
> - **PARTIAL MATCHING:** You are allowed to match a [Student Line] to a [OCR Block] even if the block only contains *part* of the line (e.g. Student writes "5/sqrt(3) = ..." but OCR only sees the result "... = 5sqrt(3)/3").
> - **FUZZY TEXT:** Ignore typos like 'S' for '5' or '72' for '27' if the position aligns.



> [!IMPORTANT]
> This is a GENERIC marking pool. 
> - Discover the actual total marks from the student paper (e.g. "Total 4 marks").
> - ONLY return annotations for the marks actually identified/needed.
> - Do NOT generate filler annotations to "coverage" the entire M1-M8 pool.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] \frac{5}{\sqrt{3}} \frac{\sqrt{3}}{\sqrt{3}} = \frac{5\sqrt{3}}{3} - \frac{\sqrt{27}}{6} \frac{\sqrt{27}}{2} (ID: line_1)
[Line 2] \frac{5\sqrt{3}}{3} - \frac{\sqrt{27}}{2} = \frac{10\sqrt{3}}{6} - \frac{9\sqrt{3}}{6} = \frac{1}{6}\sqrt{3} (ID: line_2)
[Line 3] \frac{1}{6}\sqrt{3} (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_12_499]: "Work out the value of \( \frac{5}{\sqrt{3}}-\sqrt{6 \frac{3}{4}} \frac{5}{\sqrt{3}} \sqrt{\frac{3}{7}} \frac{\sqrt{7}}{3}-\sqrt{\frac{67}{6}} \frac{\sqrt{27}}{7}"
[block_0_13_90]: "\frac{5 \sqrt{3}}{3}-\frac{\sqrt{72}}{2}=\frac{3 \sqrt{7}}{6} \frac{10 \sqrt{3}}{6} \frac{4 \sqrt{3}}{6} \sqrt{3} \)"
[block_0_20_381]: "Answer"
[block_0_22_755]: "\( \frac{1}{6} \sqrt{7} \)"
[block_0_23_285]: "(Total 4 marks)"
[block_0_24_284]: "Page 7 of 8"
[block_0_25_912]: "AQA GCSE Maths - Surds (H)"
[block_0_26_718]: "PhysicsAndMathsTutor.com"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ12[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m3/20[0m
  - Usage tokens: [33m5366[0m
  - Annotations:
    1. [32mtick[0m [34m[line_11][0m [A1] [34m"2sqrt{5}"[0m
      â†³ Reason: Correct value for 10/sqrt(5).
      â†³ Transcription: [35m"2sqrt{5}"[0m
      â†³ Classification: [35m"2\sqrt{5}"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[line_10][0m [A1] [34m"2sqrt{7}"[0m
      â†³ Reason: Correct value for sqrt(28).
      â†³ Transcription: [35m"2sqrt{7}"[0m
      â†³ Classification: [35m"2\sqrt{7}"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_12][0m [A1] [34m"Smallest 2sqrt{5}"[0m
      â†³ Reason: Correctly identifies the smallest value.
      â†³ Transcription: [35m"Smallest 2sqrt{5}"[0m
      â†³ Classification: [35m"Smallest 2\sqrt{5}"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 38px to 300px for Q12
[WIDTH FIX] Boosting tiny width 38px to 300px for Q12
[WIDTH FIX] Boosting tiny width 38px to 300px for Q12
[GUILLOTINE CHECK] Q12: isGeneric=true, hasAnnotations=true, hasScore=true, totalMarks=20
ğŸ¤– [AI RESPONSE] [31mQ13[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m3/20[0m
  - Usage tokens: [33m5628[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_12_499][0m [M1] [34m"frac{5}{sqrt{3}} frac{sqrt{3}}{sqrt{3}} = frac{5sqrt{3}}{3} - frac{sqrt{27}}{6} ..."[0m
      â†³ Reason: Correct rationalization of the first term.
      â†³ OCR Match: [35m"frac{5}{sqrt{3}} frac{sqrt{3}}{sqrt{3}} = frac{5sqrt{3}}{3} - frac{sqrt{27}}{6} frac{sqrt{27}}{2}"[0m
      â†³ Classification: [35m"Work out the value of \( \frac{5}{\sqrt{3}}-\sqrt{6 \frac{3}{4}} \frac{5}{\sqrt{3}} \sqrt{\frac{3}{7}} \frac{\sqrt{7}}{3}-\sqrt{\frac{67}{6}} \frac{\sqrt{27}}{7}"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_13_90][0m [M1] [34m"frac{5sqrt{3}}{3} - frac{sqrt{27}}{2} = frac{10sqrt{3}}{6} - frac{9sqrt{3}}{6} =..."[0m
      â†³ Reason: Correct simplification and combination of terms.
      â†³ OCR Match: [35m"frac{5sqrt{3}}{3} - frac{sqrt{27}}{2} = frac{10sqrt{3}}{6} - frac{9sqrt{3}}{6} = frac{1}{6}sqrt{3}"[0m
      â†³ Classification: [35m"\frac{5 \sqrt{3}}{3}-\frac{\sqrt{72}}{2}=\frac{3 \sqrt{7}}{6} \frac{10 \sqrt{3}}{6} \frac{4 \sqrt{3}}{6} \sqrt{3} \)"[0m
      â†³ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_22_755][0m [A1] [34m"frac{1}{6}sqrt{3}"[0m
      â†³ Reason: Correct final answer.
      â†³ OCR Match: [35m"frac{1}{6}sqrt{3}"[0m
      â†³ Classification: [35m"\( \frac{1}{6} \sqrt{7} \)"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q13: isGeneric=true, hasAnnotations=true, hasScore=true, totalMarks=20
[1m[32mâœ… [AI MARKING][0m [1mCOMPLETED[0m in [1m4.9s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
[1m[32mâœ… [MARKING][0m [1mCOMPLETED[0m in [1m4.9s[0m ([32m[1mAI-MARKING[0m)

ğŸ” [RESULT VERIFICATION] Checking what will be combined:
   ğŸ“Š Marking Results: 2 questions
   ğŸ“ Question Results: NO
   âœ… Both modes triggered: NO
[32mğŸ”„ [LOGICAL RE-INDEXING] Aligning logical indices with sorted physical order...[0m
[32mâœ… [LOGICAL RE-INDEXING] Re-indexed 2 questions and 1 pages.[0m
[32mâœ… [1m[FINAL PAGE ORDER][0m [32m[1] Page null ([37mQ12, Q13[32m)[0m
[1m[32mâœ… [OUTPUT GENERATION][0m [1mCOMPLETED[0m in [1m1.1s[0m ([32m[1mOUTPUT-GENERATION[0m)
[1m[32mâœ… [PERFORMANCE SUMMARY AI][0m [1mCOMPLETED[0m in [1m0.8s[0m ([32m[1mGEMINI-2.0-FLASH[0m)

ğŸ“Š [ANNOTATION SUMMARY]
----------------------------------------------------------------------
| Q#       | Score | Marks Awarded           | Match Status              |
|----------|-------|-------------------------|---------------------------|
| [32m12      [0m | 3/20  | A1, A1, A1              | M:0 V:0 U:3 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m13      [0m | 3/20  | M1, M1, A1              | M:0 V:0 U:0 S:3           |
|----------|-------|-------------------------|---------------------------|

=== PERFORMANCE SUMMARY ===
Total Processing Time: 20.2s
Model Used: gemini-2.0-flash
----------------------------
classification                      8.3s (41%)
marking                             4.9s (24%)
ocr_processing                      4.0s (20%)
output_generation                   1.1s (5%)
performance_summary                 0.8s (4%)
question_detection                  0.4s (2%)
database_persistence                0.2s (1%)
preprocessing                       0.1s (0%)
============================


ğŸ“Š [UsageTracker] Summary:
   Model: gemini-2.0-flash
   API Requests: 4 total
   Total Tokens: 14,132 (12,415 in + 1,717 out)
   Total Cost: $0.005653
   Mathpix OCR: 1 pages â†’ $0.004000

   Breakdown by Phase:
   â€¢ Mapper (Map Pass): 2,608 tokens (1 requests) â†’ $0.000275
   â€¢ Classification (Marking Pass): 11,074 tokens (2 requests) â†’ $0.001590
   â€¢ Performance Summary: 450 tokens (1 requests) â†’ $0.000063


ğŸ ========== UNIFIED PIPELINE END ==========
ğŸ ==========================================

âœ… [CONTROLLER] Pipeline completed, result exists: true, sessionId: sub-1768637790549
ğŸ’³ [CREDIT DEDUCT] Starting deduction for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, sessionId: sub-1768637790549
ğŸ’³ [CREDIT DEDUCT] Incremental cost from tracker: 0.0056531
ğŸ” [SUBJECT EXTRACTION] examPapers[0].subject = "General"
ğŸ’³ Deducted 0.57 credits from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2 (session: sub-1768637790549), remaining: 20.23
ğŸ’³ Deducted 0.0057 credits (session: sub-1768637790549) from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2
âœ… [SUBJECT MARKING RESULT] Persisted marking result for subject: General, session: sub-1768637790549
ğŸ‘¤ [PLAN CHECK] User 9mBfvniXTuMtQU8f0OnLhUK6aOv2 is on plan: pro
ğŸ“¡ [MARKING] Processing POST /api/marking/process (hasRawBody: false)
ğŸš€ [MARKING] Controller started - Files: 1, Body Keys: model, aiMessageId
ğŸ” [CREDIT DEBUG] userId: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, isAuthenticated: true
ğŸ’³ [CREDIT CHECK] Starting credit check for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2
ğŸ’³ [CREDIT CHECK] Estimated cost: 0.0095441, files: 1, bytes: 45441
ğŸ’³ [CREDIT CHECK] Result: {"canProceed":true,"remaining":20.23}

ğŸ”„ ========== UNIFIED PIPELINE START ==========
ğŸ”„ ============================================

[1m[32mâœ… [INPUT VALIDATION][0m [1mCOMPLETED[0m in [1m0.0s[0m ([32m[1mVALIDATION[0m)
[INPUT TYPE] Detected: Single Image (1 files)
[1m[32mâœ… [PREPROCESSING][0m [1mCOMPLETED[0m in [1m0.1s[0m ([32m[1mIMAGE-PROCESSING[0m)
[MAPPER] Using model: gemini-2.0-flash
[MAPPER] Starting Map Pass for 1 pages...
âœ… [MAPPER] Map Pass complete in 1.42s. Mapped 1 pages.
[1m[32mâœ… [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m6.5s[0m ([32m[1mGEMINI-2.0-FLASH[0m)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”€ [PERFECT SPLIT] Building standalone structures with re-indexing
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ [MODE ROUTING] Pure marking mode

âœ… Perfect split complete - each mode has consecutive 0-based indices
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[1m[32mâœ… [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m6.5s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
ğŸ” [MODE DETECTION] Analysis (AFTER overrides):
  - All question-only: false
  - Has mixed content: false
  - Has any student work: true
  - Selected mode: Marking Mode
[1m[32mâœ… [OCR PROCESSING][0m [1mCOMPLETED[0m in [1m1.1s[0m ([32m[1mMATHPIX[0m)
ğŸ“ [PIPELINE] Detected consensus paper: "OCR - J560/06 - June 2023, Higher Tier". Will use as hint for question-only pages.
[1m[32mâœ… [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m0.5s[0m ([32m[1mQUESTION-DETECTION[0m)

ğŸ“‹ [DETECTION AUDIT REPORT]
------------------------------------------------------------------------------------------------------------------------------------
| Q#   | Input Text (Fragment)                       | Match Result / Paper Title                         | Score | Status        |
------------------------------------------------------------------------------------------------------------------------------------
| 9    | On Heidi's bookcase, the ratio of fiction ... | OCR GCSE (9-1) J560/06 June 2023 Q9                | 1.000 | [32mâœ… SUCCESS[0m      |
------------------------------------------------------------------------------------------------------------------------------------


ğŸ“Š [QUESTION DETECTION STATISTICS]
   Total questions: 1
   Detected: 1/1
   Not detected: 0
   [HINT] Hint Used: "Global Search"
   [HINT] Matched Papers: 108
[SPATIAL SHIELD] Applying Hybrid Shield for Q9...
[SHIELD] ğŸ›¡ï¸ Analyzing Q9. Next Header "Q10" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 13. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q9...
[SHIELD] ğŸ›¡ï¸ Analyzing Q9. Next Header "Q10" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 13. (Dropped 0 blocks)
âœ… createMarkingTasksFromClassification completed, created 1 marking task(s)
[1m[32mğŸ”„ [AI MARKING][0m [1mSTARTING...[0m
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=1

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q9[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 9

## QUESTION TEXT
On Heidi's bookcase, the ratio of fiction to non-fiction books is 2: 3. Heidi removes 2 fiction books from the bookcase. The ratio of fiction to non-fiction books is then 5:8. How many books are left on the bookcase in total?




## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- B3: 32: 48 and 30:48 identified ([OCR Decoupled from original 4-mark blob])
- M2: 16k: 24k and 15k: 24k ([OCR Decoupled from original 4-mark blob])
- M1: 16k: 24k ([OCR Decoupled from original 4-mark blob])
- M2: $\frac{2}{3}-\frac{5}{8}$ oe implied by $\frac{1}{24}$ ([OCR Decoupled from original 4-mark blob])
- M3: multiples of 13 reaching at least 78 and multiples of 5 reaching at least 80 ([OCR Decoupled from original 4-mark blob])
- M2: listing multiples of 13 and 5 reaching at least 39 and 40 ([OCR Decoupled from original 4-mark blob])
- M1: listing at least three multiples of 13 and 5 ([OCR Decoupled from original 4-mark blob])
- B3: $\frac{32}{80}$ $\frac{48}{80}$ and $\frac{30}{78}$ $\frac{48}{78}$ identified ([OCR Decoupled from original 4-mark blob])
- M2: $\frac{16}{40}:\frac{24}{40}$ and $\frac{15}{39}:\frac{24}{39}$ ([OCR Decoupled from original 4-mark blob])
- M1: $\frac{16}{40}$ : $\frac{24}{40}$ ([OCR Decoupled from original 4-mark blob])
- M2: correct unsimplified equation(s) to find original ([OCR Decoupled from original 4-mark blob])
- A1: correct solution(s) of the equation(s), no FT ([OCR Decoupled from original 4-mark blob])
- M1: one correct equation involving two variables eg using tas new total M2: $\frac{3}{5}(t+2)=\frac{8}{13}t$ oe ([OCR Decoupled from original 4-mark blob])
- SC1: answer 30, 32, 48 ([OCR Decoupled from original 4-mark blob])

FINAL ANSWER: 78



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] Let F=2x and N=3x (ID: line_1)
[Line 2] \frac{2x-2}{3x} = \frac{5}{8} (ID: line_2)
[Line 3] 8(2x-2) = 5(3x) (ID: line_3)
[Line 4] 16x-16 =15x (ID: line_4)
[Line 5] x=16 (ID: line_5)
[Line 6] Total books left: (2x-2)+3x=5x-2 (ID: line_6)
[Line 7] 5(16)-2=80-2 (ID: line_7)
[Line 8] =78 (ID: line_8)
[Line 9] 78 (ID: line_9)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_792]: "10"
[block_0_1_141]: "Hew many boxks are left m the bockeane in total?"
[block_0_2_959]: "Let \( F=2 x \) and \( N=3 x \)"
[block_0_3_970]: "\frac{2 x-2}{3 x}  =\frac{5}{8}"
[block_0_4_643]: "8(2 x-2)  =5(3 x)"
[block_0_5_664]: "16 x-16  =15 x"
[block_0_6_684]: "x  =16"
[block_0_7_347]: "Total books lefe: \( (2 x-2)+3 x=5 x-2 \)"
[block_0_8_373]: "5(16)-2  =80-2"
[block_0_9_443]: " =78"
[block_0_10_8]: "78"
[block_0_11_707]: "books [4"
[block_0_12_192]: "COCR 3262"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ9[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m5762[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [M1] [34m"Let F = 2x and N = 3x"[0m
      â†³ Reason: One correct equation involving two variables.
      â†³ Transcription: [35m"Let F = 2x and N = 3x"[0m
      â†³ Classification: [35m"Let F=2x and N=3x"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[line_2][0m [M2] [34m"frac{2x-2}{3x} = frac{5}{8}"[0m
      â†³ Reason: Correct unsimplified equation to find original.
      â†³ Transcription: [35m"frac{2x-2}{3x} = frac{5}{8}"[0m
      â†³ Classification: [35m"\frac{2x-2}{3x} = \frac{5}{8}"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_5][0m [A1] [34m"x = 16"[0m
      â†³ Reason: Correct solution of the equation.
      â†³ Transcription: [35m"x = 16"[0m
      â†³ Classification: [35m"x=16"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 263px to 300px for Q9
[WIDTH FIX] Boosting tiny width 189px to 300px for Q9
[WIDTH FIX] Boosting tiny width 91px to 300px for Q9
[GUILLOTINE CHECK] Q9: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=4
[1m[32mâœ… [AI MARKING][0m [1mCOMPLETED[0m in [1m3.9s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
[1m[32mâœ… [MARKING][0m [1mCOMPLETED[0m in [1m3.9s[0m ([32m[1mAI-MARKING[0m)

ğŸ” [RESULT VERIFICATION] Checking what will be combined:
   ğŸ“Š Marking Results: 1 questions
   ğŸ“ Question Results: NO
   âœ… Both modes triggered: NO
[32mğŸ”„ [LOGICAL RE-INDEXING] Aligning logical indices with sorted physical order...[0m
[32mâœ… [LOGICAL RE-INDEXING] Re-indexed 1 questions and 1 pages.[0m
[32mâœ… [1m[FINAL PAGE ORDER][0m [32m[1] Page null ([37mQ9[32m)[0m
[1m[32mâœ… [OUTPUT GENERATION][0m [1mCOMPLETED[0m in [1m0.7s[0m ([32m[1mOUTPUT-GENERATION[0m)
[1m[32mâœ… [PERFORMANCE SUMMARY AI][0m [1mCOMPLETED[0m in [1m0.9s[0m ([32m[1mGEMINI-2.0-FLASH[0m)

ğŸ“Š [ANNOTATION SUMMARY]
----------------------------------------------------------------------
| Q#       | Score | Marks Awarded           | Match Status              |
|----------|-------|-------------------------|---------------------------|
| [32m9       [0m | 4/4   | M1, M2, A1              | M:0 V:0 U:3 S:0           |
|----------|-------|-------------------------|---------------------------|

=== PERFORMANCE SUMMARY ===
Total Processing Time: 14.3s
Model Used: gemini-2.0-flash
----------------------------
classification                      6.5s (45%)
marking                             3.9s (27%)
ocr_processing                      1.1s (7%)
performance_summary                 0.9s (6%)
output_generation                   0.7s (5%)
question_detection                  0.5s (4%)
database_persistence                0.2s (1%)
preprocessing                       0.1s (1%)
============================


ğŸ“Š [UsageTracker] Summary:
   Model: gemini-2.0-flash
   API Requests: 3 total
   Total Tokens: 8,566 (7,654 in + 912 out)
   Total Cost: $0.004858
   Mathpix OCR: 1 pages â†’ $0.004000

   Breakdown by Phase:
   â€¢ Mapper (Map Pass): 2,601 tokens (1 requests) â†’ $0.000272
   â€¢ Classification (Marking Pass): 5,563 tokens (1 requests) â†’ $0.000807
   â€¢ Performance Summary: 402 tokens (1 requests) â†’ $0.000051


ğŸ ========== UNIFIED PIPELINE END ==========
ğŸ ==========================================

âœ… [CONTROLLER] Pipeline completed, result exists: true, sessionId: sub-1768638517986
ğŸ’³ [CREDIT DEDUCT] Starting deduction for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, sessionId: sub-1768638517986
ğŸ’³ [CREDIT DEDUCT] Incremental cost from tracker: 0.0048578
ğŸ” [SUBJECT EXTRACTION] examPapers[0].subject = "Mathematics"
ğŸ’³ Deducted 0.49 credits from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2 (session: sub-1768638517986), remaining: 19.74
ğŸ’³ Deducted 0.0049 credits (session: sub-1768638517986) from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2
âœ… [SUBJECT MARKING RESULT] Persisted marking result for subject: Mathematics, session: sub-1768638517986
ğŸ‘¤ [PLAN CHECK] User 9mBfvniXTuMtQU8f0OnLhUK6aOv2 is on plan: pro
ğŸ“¡ [MARKING] Processing POST /api/marking/process (hasRawBody: false)
ğŸš€ [MARKING] Controller started - Files: 21, Body Keys: model, aiMessageId
ğŸ” [CREDIT DEBUG] userId: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, isAuthenticated: true
ğŸ’³ [CREDIT CHECK] Starting credit check for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2
ğŸ’³ [CREDIT CHECK] Estimated cost: 0.9444994000000001, files: 21, bytes: 8394994
ğŸ’³ [CREDIT CHECK] Result: {"canProceed":true,"warning":"âš ï¸ Low credits: Need 94.45, have 19.74. Upgrade your plan for more credits. This operation will proceed.","remaining":19.74}
ğŸ’³ Credit warning for user 9mBfvniXTuMtQU8f0OnLhUK6aOv2: âš ï¸ Low credits: Need 94.45, have 19.74. Upgrade your plan for more credits. This operation will proceed.

ğŸ”„ ========== UNIFIED PIPELINE START ==========
ğŸ”„ ============================================

[1m[32mâœ… [INPUT VALIDATION][0m [1mCOMPLETED[0m in [1m0.0s[0m ([32m[1mVALIDATION[0m)
[INPUT TYPE] Detected: Multiple Images (21 files)
[1m[32mâœ… [PREPROCESSING][0m [1mCOMPLETED[0m in [1m4.7s[0m ([32m[1mIMAGE-PROCESSING[0m)
[MAPPER] Using model: gemini-2.0-flash
[MAPPER] Starting Map Pass for 21 pages...
âœ… [MAPPER] Map Pass complete in 7.28s. Mapped 21 pages.
[1m[32mâœ… [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m27.8s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
ğŸš€ [OVERRIDE] 90% Rule Triggered: 22/22 pages have student work. Overriding all questionOnly pages to questionAnswer for consistency.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”€ [PERFECT SPLIT] Building standalone structures with re-indexing
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ [MODE ROUTING] Pure marking mode

âœ… Perfect split complete - each mode has consecutive 0-based indices
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[1m[32mâœ… [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m27.8s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
ğŸ” [MODE DETECTION] Analysis (AFTER overrides):
  - All question-only: false
  - Has mixed content: false
  - Has any student work: true
  - Selected mode: Marking Mode
[PIPELINE DEBUG] Page 1 OCR Data Check:
   - Total Blocks: 7
   - Sample HW Block Check: {"text":"63  =3^{2} \\times 11","hasCoords":true,"coords":{"x":893,"y":926,"width":546,"height":147}}
[1m[32mâœ… [OCR PROCESSING][0m [1mCOMPLETED[0m in [1m6.0s[0m ([32m[1mMATHPIX[0m)
[32m[HINT] ğŸ›ï¸ Consensus Reached! Forcing to "Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier"[0m
   â””â”€ Rescued Group Q3 -> Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier
   â””â”€ Rescued Group Q6 -> Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier
   â””â”€ Rescued Group Q9 -> Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier
   â””â”€ Rescued Group Q11 -> Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier
   â””â”€ Rescued Group Q16 -> Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier
ğŸ“ [PIPELINE] Detected consensus paper: "Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier". Will use as hint for question-only pages.
[1m[32mâœ… [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m8.4s[0m ([32m[1mQUESTION-DETECTION[0m)

ğŸ“‹ [DETECTION AUDIT REPORT]
------------------------------------------------------------------------------------------------------------------------------------
| Q#   | Input Text (Fragment)                       | Match Result / Paper Title                         | Score | Status        |
------------------------------------------------------------------------------------------------------------------------------------
| 1    | Find the highest common factor (HCF) of 63... | Edexcel GCSE 1MA1/3H June 2024 Q1                  | 0.950 | [32mâœ… SUCCESS[0m      |
| 2ai  | Write 5.3 x 10' as an ordinary number.        | Edexcel GCSE 1MA1/3H June 2024 Q2                  | 0.887 | [32mâœ… SUCCESS[0m      |
| 2aii | Write 7.4 x 10 as an ordinary number.         | Edexcel GCSE 1MA1/3H June 2024 Q2                  | 0.887 | [32mâœ… SUCCESS[0m      |
| 2b   | Calculate the value of 9.7 x 10+ 2.45 Ã— 10... | Edexcel GCSE 1MA1/3H June 2024 Q2                  | 0.887 | [32mâœ… SUCCESS[0m      |
| 3a   | Explain why Rana's side elevation is not c... | Edexcel GCSE 1MA1/3H June 2024 Q3                  | 0.615 | [33mâš ï¸  RESCUED[0m    |
| 3b   | On the centimetre grid below, draw a plan ... | Edexcel GCSE 1MA1/3H June 2024 Q3                  | 0.615 | [33mâš ï¸  RESCUED[0m    |
| 4    | A company has 25000 workers. The number of... | Edexcel GCSE 1MA1/3H June 2024 Q4                  | 1.000 | [32mâœ… SUCCESS[0m      |
| 5    | Habib has two identical tins. He puts 600 ... | Edexcel GCSE 1MA1/3H June 2024 Q5                  | 0.912 | [32mâœ… SUCCESS[0m      |
| 6a   | Complete the probability tree diagram.        | Edexcel GCSE 1MA1/3H June 2024 Q6                  | 0.615 | [33mâš ï¸  RESCUED[0m    |
| 6b   | Tim throws coin A once and he throws coin ... | Edexcel GCSE 1MA1/3H June 2024 Q6                  | 0.615 | [33mâš ï¸  RESCUED[0m    |
| 7    | A paddling pool is in the shape of a cylin... | Edexcel GCSE 1MA1/3H June 2024 Q7                  | 0.935 | [32mâœ… SUCCESS[0m      |
| 8    | a = \begin{pmatrix} 3 \\ 2 \end{pmatrix} b... | Edexcel GCSE 1MA1/3H June 2024 Q8                  | 0.826 | [32mâœ… SUCCESS[0m      |
| 9    | The diagram shows a cube and a square-base... | Edexcel GCSE 1MA1/3H June 2024 Q9                  | 0.750 | [33mâš ï¸  RESCUED[0m    |
| 10   | There are only red counters and yellow cou... | Edexcel GCSE 1MA1/3H June 2024 Q10                 | 1.000 | [32mâœ… SUCCESS[0m      |
| 11a  | On the grid, draw a box plot to show the i... | Edexcel GCSE 1MA1/3H June 2024 Q11                 | 0.422 | [33mâš ï¸  RESCUED[0m    |
| 11b  | Compare the distribution of the speeds on ... | Edexcel GCSE 1MA1/3H June 2024 Q11                 | 0.422 | [33mâš ï¸  RESCUED[0m    |
| 12   | The diagram shows triangle T drawn on a gr... | Edexcel GCSE 1MA1/3H June 2024 Q12                 | 0.833 | [32mâœ… SUCCESS[0m      |
| 13   | There are 30 students in a class. A teache... | Edexcel GCSE 1MA1/3H June 2024 Q13                 | 1.000 | [32mâœ… SUCCESS[0m      |
| 14   | At the start of 2022 Kim invested some mon... | Edexcel GCSE 1MA1/3H June 2024 Q14                 | 1.000 | [32mâœ… SUCCESS[0m      |
| 15a  | Simplify fully \frac{(a-3)^2}{5(a-3)}         | Edexcel GCSE 1MA1/3H June 2024 Q15                 | 0.940 | [32mâœ… SUCCESS[0m      |
| 15b  | Factorise 3k^2 + 11k - 4                      | Edexcel GCSE 1MA1/3H June 2024 Q15                 | 0.940 | [32mâœ… SUCCESS[0m      |
| 15c  | Simplify fully \frac{4-x^2}{x^2+3x} \div \... | Edexcel GCSE 1MA1/3H June 2024 Q15                 | 0.940 | [32mâœ… SUCCESS[0m      |
| 16a  | Find f(-3)                                    | Edexcel GCSE 1MA1/3H June 2024 Q16                 | 0.646 | [33mâš ï¸  RESCUED[0m    |
| 16b  | Find fg(1)                                    | Edexcel GCSE 1MA1/3H June 2024 Q16                 | 0.646 | [33mâš ï¸  RESCUED[0m    |
| 16c  | Find gÂ¹(4)                                    | Edexcel GCSE 1MA1/3H June 2024 Q16                 | 0.646 | [33mâš ï¸  RESCUED[0m    |
| 17   | A ball is thrown upwards and reaches a max... | Edexcel GCSE 1MA1/3H June 2024 Q17                 | 0.886 | [32mâœ… SUCCESS[0m      |
| 18   | ABCD is a quadrilateral. The area of trian... | Edexcel GCSE 1MA1/3H June 2024 Q18                 | 0.816 | [32mâœ… SUCCESS[0m      |
| 19   | R = \\frac{P}{Q} P = 5.88 x 10" correct to... | Edexcel GCSE 1MA1/3H June 2024 Q19                 | 0.930 | [32mâœ… SUCCESS[0m      |
| 20a  | Find the value of x.                          | Edexcel GCSE 1MA1/3H June 2024 Q20                 | 0.801 | [32mâœ… SUCCESS[0m      |
| 20b  | y-4, y + 2 and 3y + 1 are three consecutiv... | Edexcel GCSE 1MA1/3H June 2024 Q20                 | 0.801 | [32mâœ… SUCCESS[0m      |
| 21   | The diagram shows a circle, radius r cm an... | Edexcel GCSE 1MA1/3H June 2024 Q21                 | 1.000 | [32mâœ… SUCCESS[0m      |
------------------------------------------------------------------------------------------------------------------------------------


ğŸ“Š [QUESTION DETECTION STATISTICS]
   Total questions: 31
   Detected: 21/31
   Not detected: 10
   [HINT] Hint Used: "Global Search"
   [HINT] Matched Papers: 108
[DRAWING] Q3: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q3: Will pass image to Marking AI
[DRAWING] Q6: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q6: Will pass image to Marking AI
[DRAWING] Q8: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q8: Will pass image to Marking AI
[DRAWING] Q11: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q11: Will pass image to Marking AI
[DRAWING] Q12: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q12: Will pass image to Marking AI

ğŸ” [EVIDENCE LOG] Q20 Classification Lines:
[SPATIAL SHIELD] Applying Hybrid Shield for Q1...
[SHIELD] ğŸ›¡ï¸ Analyzing Q1. Next Header "Q2" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 7. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q1...
[SHIELD] ğŸ›¡ï¸ Analyzing Q1. Next Header "Q2" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 7. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q2...
[SHIELD] ğŸ›¡ï¸ Analyzing Q2. Next Header "Q3" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q2...
[SHIELD] ğŸ›¡ï¸ Analyzing Q2. Next Header "Q3" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q3...
[SHIELD] ğŸ›¡ï¸ Analyzing Q3. Next Header "Q4" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 25. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q3...
[SHIELD] ğŸ›¡ï¸ Analyzing Q3. Next Header "Q4" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 25. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q4...
[SHIELD] ğŸ›¡ï¸ Analyzing Q4. Next Header "Q5" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q4...
[SHIELD] ğŸ›¡ï¸ Analyzing Q4. Next Header "Q5" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q5...
[SHIELD] ğŸ›¡ï¸ Analyzing Q5. Next Header "Q6" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 15. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q5...
[SHIELD] ğŸ›¡ï¸ Analyzing Q5. Next Header "Q6" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 15. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q6...
[SHIELD] ğŸ›¡ï¸ Analyzing Q6. Next Header "Q7" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 12. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q6...
[SHIELD] ğŸ›¡ï¸ Analyzing Q6. Next Header "Q7" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 12. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q7...
[SHIELD] ğŸ›¡ï¸ Analyzing Q7. Next Header "Q8" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 14. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q7...
[SHIELD] ğŸ›¡ï¸ Analyzing Q7. Next Header "Q8" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 14. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q8...
[SHIELD] ğŸ›¡ï¸ Analyzing Q8. Next Header "Q9" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 4. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q8...
[SHIELD] ğŸ›¡ï¸ Analyzing Q8. Next Header "Q9" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 4. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q9...
[SHIELD] ğŸ›¡ï¸ Analyzing Q9. Next Header "Q10" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 7. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q9...
[SHIELD] ğŸ›¡ï¸ Analyzing Q9. Next Header "Q10" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 7. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q10...
[SHIELD] ğŸ›¡ï¸ Analyzing Q10. Next Header "Q11" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 13. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q10...
[SHIELD] ğŸ›¡ï¸ Analyzing Q10. Next Header "Q11" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 13. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q11...
[SHIELD] ğŸ›¡ï¸ Analyzing Q11. Next Header "Q12" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 26. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q11...
[SHIELD] ğŸ›¡ï¸ Analyzing Q11. Next Header "Q12" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 26. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q12...
[SHIELD] ğŸ›¡ï¸ Analyzing Q12. Next Header "Q13" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 4. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q12...
[SHIELD] ğŸ›¡ï¸ Analyzing Q12. Next Header "Q13" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 4. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q13...
[SHIELD] ğŸ›¡ï¸ Analyzing Q13. Next Header "Q14" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 26. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q13...
[SHIELD] ğŸ›¡ï¸ Analyzing Q13. Next Header "Q14" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 26. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q14...
[SHIELD] ğŸ›¡ï¸ Analyzing Q14. Next Header "Q15" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 26. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q14...
[SHIELD] ğŸ›¡ï¸ Analyzing Q14. Next Header "Q15" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 26. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q15...
[SHIELD] ğŸ›¡ï¸ Analyzing Q15. Next Header "Q16" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q15...
[SHIELD] ğŸ›¡ï¸ Analyzing Q15. Next Header "Q16" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q16...
[SHIELD] ğŸ›¡ï¸ Analyzing Q16. Next Header "Q17" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 16. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q16...
[SHIELD] ğŸ›¡ï¸ Analyzing Q16. Next Header "Q17" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 16. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q17...
[SHIELD] ğŸ›¡ï¸ Analyzing Q17. Next Header "Q18" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q17...
[SHIELD] ğŸ›¡ï¸ Analyzing Q17. Next Header "Q18" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q18...
[SHIELD] ğŸ›¡ï¸ Analyzing Q18. Next Header "Q19" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q18...
[SHIELD] ğŸ›¡ï¸ Analyzing Q18. Next Header "Q19" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 11. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q19...
[SHIELD] ğŸ›¡ï¸ Analyzing Q19. Next Header "Q20" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 10. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q19...
[SHIELD] ğŸ›¡ï¸ Analyzing Q19. Next Header "Q20" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 10. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q20...
[SHIELD] ğŸ›¡ï¸ Analyzing Q20. Next Header "Q21" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 20. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q20...
[SHIELD] ğŸ›¡ï¸ Analyzing Q20. Next Header "Q21" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 20. (Dropped 0 blocks)
[SPATIAL SHIELD] Applying Hybrid Shield for Q21...
[SHIELD] ğŸ›¡ï¸ Analyzing Q21. Next Header "Q22" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 15. (Dropped 0 blocks)
[SHIELD] ğŸ·ï¸ CORRECTED: "3<\pi<2 \sqrt{3..." -> LANDMARK (Printed)
[SPATIAL SHIELD] Applying Hybrid Shield for Q21...
[SHIELD] ğŸ›¡ï¸ Analyzing Q21. Next Header "Q22" present in input? NO (Clean)
[SHIELD] âœ‚ï¸ Slicing: Keeping blocks from index 0 to 15. (Dropped 0 blocks)
âœ… createMarkingTasksFromClassification completed, created 21 marking task(s)
[1m[32mğŸ”„ [AI MARKING][0m [1mSTARTING...[0m
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q2[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 2

## QUESTION TEXT
Write $5.3 \times 10^{4}$ as an ordinary number. Write $7.4 \times 10^{-5}$ as an ordinary number. Calculate the value of $9.7 \times 10^{6} + 2.45 \times 10^{7}$. Give your answer in standard form.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[2ai]
- B1: cao

[2aii]
- B1: cao

[2b]
- M1: for $9700000 + 24500000 (= 34200000)$ or $3.42 \times 10^n (n \ne 7)$ oe or $3.4 \times 10^7$ or correct answer in incorrect form eg $34.2 \times 10^6$ or both in a form ready for addition, eg $9.7 \times 10^6 + 24.5 \times 10^6$
- A1: cao



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION AI STUDENT WORK]
[Line 1] 53000 (ID: line_1)

[SUB-QUESTION AII STUDENT WORK]
[Line 2] 0.000074 (ID: line_2)

[SUB-QUESTION B STUDENT WORK]
[Line 3] 3.42Ã—10^6 (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_457]: "2 (a) (i) Write \( 5.3 \times 10^{4} \) as an ordinary number."
[block_0_1_730]: "53000"
[block_0_2_164]: "(ii) Write \( 7.4 \times 10^{-5} \) as an ordinary number."
[block_0_3_414]: "0.000014"
[block_0_4_301]: "(1)"
[block_0_5_357]: "(b) Calculate the value of \( 9.7 \times 10^{6}+2.45 \times 10^{7} \)"
[block_0_6_563]: "Give your answer in standard form."
[block_0_7_608]: "\( 3.42 \times 10^{-6} \)"
[block_0_8_286]: "(2)"
[block_0_9_907]: "3"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q3[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 3

## QUESTION TEXT
The diagram shows a solid triangular prism. [Diagram shows a prism with a triangular cross-section base 6cm and height 4cm. The length of the prism is 7cm. The slant height of the triangular face is 4cm.] Rana is trying to draw the side elevation of the solid prism from the direction of the arrow. Here is her answer on a centimetre grid. [Rana's drawing shows a rectangle 6cm wide by 4cm high.] Explain why Rana's side elevation is not correct. On the centimetre grid below, draw a plan of the solid prism.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[3a]
- C1: for explanation

[3b]
- M1: for a 7 cm by 6 cm rectangle or for a 7 cm by n cm or m cm by 6 cm rectangle and dividing line which is parallel to the 7 cm or the m cm side
- A1: for a fully correct plan



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] The height of prism is not 4cm (ID: line_1)

[SUB-QUESTION B STUDENT WORK]
[Line 2] [DRAWING] (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_382]: "3 The diagram shows a solid triangular prism."
[block_0_12_671]: "VJYV SIHI NI JIIYM ION OC"
[block_0_11_988]: "VALV SIHI NI JITYM ION OC"
[block_0_4_78]: "(a) Explain why Rana's side elevation is not correct."
[block_0_6_906]: "The height of prim i) not 4 cm"
[block_0_9_231]: "(1)"
[block_0_10_184]: "VJYV SIHL NI BIIIAM ION OC"
[block_0_13_906]: "4"
[block_0_0_351]: "(b) On the centimetre grid below, draw a plan of the solid prism."
[block_0_1_448]: "(2)"
[block_0_2_652]: "4 A company has 25000 workers."
[block_0_3_328]: "The number of workers increases at a rate of \( 6 \% \) per year for 3 years."
[block_0_4_915]: "Calculate the total number of workers at the end of the 3 years."
[block_0_7_24]: "25000 \times 1.06^{3}"
[block_0_5_208]: "DO NOT WRITEIN THIS AREA"
[block_0_6_702]: "DO NOT WRITEIN THIS AREA"
[block_0_8_869]: "29775"
[block_0_9_745]: "5"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q4[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 4

## QUESTION TEXT
A company has 25000 workers. The number of workers increases at a rate of 6% per year for 3 years. Calculate the total number of workers at the end of the 3 years.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- P1: for evidence of using a correct first step eg $25000 \times 0.06 (= 1500)$ or $25000 \times 1.06 (= 26500)$
- P1: for evidence of a "compound interest" process eg "26500" $\times$ 0.06 (= 1590) or "26500" $\times$ 1.06 (= 28090) or $25000 \times 1.06^t$ ($t \ge 2$)
- P1: for a complete process eg $25000 \times 1.06^3 (= 29775.4)$
- A1: for 29775 or 29 776 or 29 780 or 29 800

FINAL ANSWER: 29775



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 25000 x 1.06^3 (ID: line_1)
[Line 2] 29775 (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_351]: "(b) On the centimetre grid below, draw a plan of the solid prism."
[block_0_1_448]: "(2)"
[block_0_2_652]: "4 A company has 25000 workers."
[block_0_7_24]: "25000 \times 1.06^{3}"
[block_0_5_208]: "DO NOT WRITEIN THIS AREA"
[block_0_6_702]: "DO NOT WRITEIN THIS AREA"
[block_0_8_869]: "29775"
[block_0_9_745]: "5"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=2

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q1[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 1

## QUESTION TEXT
Find the highest common factor (HCF) of 63 and 105


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 2]
- M1: for a complete factor tree for 63 or 105 with no more than one arithmetic
error
or for listing at least 4 correct factors (with no more than 1 incorrect) of
63 or 105, could be in factor pairs
or for the prime factors of 63 (3, 3, 7) or 105 (3, 5, 7)
- A1: 21

FINAL ANSWER: 21



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 63=3\times^2\times 11 (ID: line_1)
[Line 2] 105=3x5x7 (ID: line_2)
[Line 3] 3 (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_431]: "Answer ALL questions."
[block_0_1_178]: "Write your answers in the spaces provided."
[block_0_2_933]: "You must write down all the stages in your working."
[block_0_4_765]: "63  =3^{2} \times 11"
[block_0_5_663]: "105  =3 \times 5 \times 7"
[block_0_6_730]: "QU. 3"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q5[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 5

## QUESTION TEXT
Habib has two identical tins. He puts 600 grams of flour into one of the tins. The flour fills the tin completely. The density of the flour is $0.6~g/cm^{3}$. Habib puts 600 grams of salt into the other tin. The salt does not fill the tin completely. The volume of the space in the tin that is not filled with salt is $700~cm^{3}$. Work out the density of the salt. You must show all your working.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- P1: for process to find volume of tin eg $600 \div 0.6 (= 1000)$
- P1: for process to find volume of salt eg "1000" $- 700 (= 300)$
- P1: for a process to find density of the salt eg $600 \div$ "300" or $0.6 \times$ ("1000" $\div$ "300") or $600 \div$ [volume]
- A1: 2

FINAL ANSWER: 2



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] Volume of tin= \frac{600}{0.6} (ID: line_1)
[Line 2] = 1000 cmÂ³ (ID: line_2)
[Line 3] 1000-700=300 (ID: line_3)
[Line 4] 600/300=2g/cmÂ³ (ID: line_4)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_357]: "5 Habib has two identical tins."
[block_0_3_712]: "The density of the flour is \( 0.6 \mathrm{~g} / \mathrm{cm}^{3} \)"
[block_0_6_755]: "The volume of the space in the tin that is not filled with salt is \( 700 \mathrm{~cm}^{3} \)"
[block_0_7_848]: "Work out the density of the sali."
[block_0_9_95]: "\text { Volume of Gin }  =\frac{600}{0.6}"
[block_0_10_435]: " =100 \mathrm{~cm}^{3}"
[block_0_11_298]: "1000-700  =300"
[block_0_12_84]: "600 / 300=2 \mathrm{~g} / \mathrm{cm}^{3}"
[block_0_13_250]: "2 \mathrm{~g} / \mathrm{cm}^{3}"
[block_0_14_63]: "6"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ1[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m1/2[0m
  - Usage tokens: [33m5675[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_4_765][0m [M1] [34m"63 = 3times^2times 11"[0m
      â†³ Reason: Correct prime factors of 63 with one error.
      â†³ OCR Match: [35m"63 = 3times^2times 11"[0m
      â†³ Classification: [35m"63  =3^{2} \times 11"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [31mcross[0m [34m[line_3][0m [A0] [34m"3"[0m
      â†³ Reason: Incorrect final answer.
      â†³ Transcription: [35m"3"[0m
      â†³ Classification: [35m"3"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 124px to 300px for Q1
[GUILLOTINE CHECK] Q1: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=2
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q6[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 6

## QUESTION TEXT
Tim has two biased coins, coin A and coin B. He is going to throw both coins. The probability that coin A will land on heads is 0.6. The probability that coin B will land on heads is 0.55. Complete the probability tree diagram. Tim throws coin A once and he throws coin B once. Work out the probability that both coins land on heads.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[6a]
- B1: for 0.4 in correct position
- B1: for the correct probabilities for coin B in the correct place on the branches

[6b]
- M1: for a correct method, eg $0.6 \times 0.55$ only
- A1: for 0.33 oe



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] [DRAWING] (ID: line_1)

[SUB-QUESTION A STUDENT WORK]
[Line 2] 0.45 (ID: line_2)
[Line 3] 0.55 (ID: line_3)
[Line 4] 0.4 (ID: line_4)

[SUB-QUESTION B STUDENT WORK]
[Line 5] 0.33 (ID: line_5)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_276]: "6 Tim has two biased coins, coin A and coin B."
[block_0_4_682]: "(a) Complete the probability tree diagram."
[block_0_5_921]: "(2)"
[block_0_6_742]: "Tim throws coin \( \mathbf{A} \) once and he throws coin \( \mathbf{B} \) once."
[block_0_7_635]: "(b) Work out the probability that both coins land on heads."
[block_0_9_820]: "0.33"
[block_0_10_403]: "(2)"
[block_0_11_949]: "7"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ2[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m2/4[0m
  - Usage tokens: [33m6054[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_1_730][0m [B1] [34m"53000"[0m
      â†³ Reason: Correct ordinary number.
      â†³ OCR Match: [35m"53000"[0m
      â†³ Classification: [35m"53000"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_3_414][0m [B1] [34m"0.000074"[0m
      â†³ Reason: Correct ordinary number.
      â†³ OCR Match: [35m"0.000074"[0m
      â†³ Classification: [35m"0.000014"[0m
      â†³ Status: [32m"MATCHED"[0m
    3. [31mcross[0m [34m[block_0_7_608][0m [M1 A0] [34m"3.42Ã—10^6"[0m
      â†³ Reason: Incorrect power of 10. | Incorrect final answer.
      â†³ OCR Match: [35m"3.42Ã—10^6"[0m
      â†³ Classification: [35m"\( 3.42 \times 10^{-6} \)"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q2: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=4
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q7[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 7

## QUESTION TEXT
A paddling pool is in the shape of a cylinder. The pool has radius 100 cm. The pool has depth 30 cm. The pool is empty. It is then filled with water at a rate of $250~cm^{3}$ per second. Work out the number of minutes it takes to fill the pool completely. Give your answer correct to the nearest minute. You must show all your working.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- P1: for process to find volume, eg $\pi \times 100^2 \times 30 (= 300000\pi$ or 942477(.796...))
- P1: for process to find time in seconds, eg "942477(.796...)" $\div 250 (= 1200\pi$ or 3769(.911...)) or [volume] $\div 250$ or for converting rate to minutes, eg $250 \times 60 (= 15000)$
- P1: for complete process eg "3769(.911...)" $\div 60 (= 20\pi)$ or "942477(.796...)" $\div$ "15000" $(= 20\pi)$
- A1: for answer in the range 62 to 63

FINAL ANSWER: 63



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] volume = \\pi x100^2 x 30 = 30000\\pi (ID: line_1)
[Line 2] time = \\frac{30000\\pi}{250} (ID: line_2)
[Line 3] = 120\\pi seconds (ID: line_3)
[Line 4] = 62.8 minute (ID: line_4)
[Line 5] 63 (ID: line_5)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_318]: "7 A paddling pool is in the shape of a cylinder."
[block_0_4_862]: "It is then filled with water at a rate of \( 250 \mathrm{~cm}^{3} \) per second."
[block_0_8_901]: "\text { rolume }  =\pi \times 100^{2} \times 30=300000 \pi"
[block_0_9_264]: "\text { lime }  =\frac{300000 \pi}{250}"
[block_0_10_409]: " =120 \pi \text { seconds }"
[block_0_11_885]: " =62.8 \text { minute }"
[block_0_12_812]: "63 minitutes"
[block_0_13_53]: "8"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ3[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6076[0m
     [36mThe student drew a rectangle with a dividing line.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_6_906][0m [C1] [34m"The height of prism is not 4cm"[0m
      â†³ Reason: The student correctly identifies that the height of the prism is not 4cm.
      â†³ OCR Match: [35m"The height of prism is not 4cm"[0m
      â†³ Classification: [35m"The height of prim i) not 4 cm"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[line_2][0m [M1 A1] [34m"[DRAWING]"[0m
      â†³ Reason: [DRAWING] Rectangle 7cm by 6cm drawn. | [DRAWING] Correct dividing line is drawn.
      â†³ Transcription: [35m"[DRAWING]"[0m
      â†³ Classification: [35m"[DRAWING]"[0m
      â†³ Status: [32m"VISUAL"[0m
[GUILLOTINE CHECK] Q3: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=3
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q8[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 8

## QUESTION TEXT
$a=\binom{3}{2}$ $b=\binom{-1}{4}$. On the grid below, draw and label the vector $2a+b$.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- M1: for $2 \times 3 + -1 (= 5)$ or $2 \times 2 + 4 (= 8)$ seen as a calculation or for $\binom{2 \times 3}{2 \times 2} + \binom{-1}{4}$ or for $\binom{5}{b}$ or $\binom{a}{8}$ or for $\binom{3}{2}$ drawn or $\binom{6}{4}$ drawn or $\binom{-1}{4}$ drawn (May be in the correct position in a column vector or coordinate.)
- M1: for $\binom{5}{8}$ or for $\binom{5}{8}$ drawn with no arrow or incorrect arrow or for $\binom{5}{b}$ drawn with arrow or $\binom{a}{8}$ drawn with arrow, where $b \ne 8$ and $a \ne 5$
- A1: Vector $\binom{5}{8}$ drawn

FINAL ANSWER: Vector $\binom{5}{8}$ drawn



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 2a+b (ID: line_1)
[Line 2] ÑˆĞ°ÑˆÑ‹ (ID: line_2)
[Line 3] [DRAWING] (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_541]: "\( 8 \quad \mathrm{a}=\binom{3}{2} \quad \mathrm{~b}=\binom{-1}{4} \)"
[block_0_1_773]: "On the grid below, draw and label the vector \( 2 \mathrm{a}+\mathrm{b} \)"
[block_0_2_470]: "DO NOT WRITEIN THIS AREA"
[block_0_3_938]: "9"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ4[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m5982[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_7_24][0m [P1 P1 P1] [34m"25000 x 1.06^3"[0m
      â†³ Reason: Correct first step of complete process. | Evidence of a compound interest process. | Complete process shown.
      â†³ OCR Match: [35m"25000 x 1.06^3"[0m
      â†³ Classification: [35m"25000 x 1.06^3"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_8_869][0m [A1] [34m"29775"[0m
      â†³ Reason: Correct answer.
      â†³ OCR Match: [35m"29775"[0m
      â†³ Classification: [35m"29775"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q4: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=4
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q9[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 9

## QUESTION TEXT
The diagram shows a cube and a square-based pyramid. [A cube with side length 6cm. A square-based pyramid with base side length 8cm and vertical height h cm.] The volume of the cube is equal to the volume of the pyramid. Work out the perpendicular height, h cm, of the pyramid.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- P1: for process to find volume of at least one of the cube or the pyramid, eg $6 \times 6 \times 6 (= 216)$ oe or $k \times 8 \times 8 \times h (= \frac{64}{3}h)$ oe
- P1: for process to form an equation, eg $6 \times 6 \times 6 = k \times 8 \times 8 \times h$ or "216" $= \frac{64}{3}h$ or for process to find h eg "216" $\div 8^2 \div k$
- A1: for 10.125 oe mixed number

FINAL ANSWER: 10.125



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 6^3 = 8^2 h \times \frac{1}{3} (ID: line_1)
[Line 2] h = \frac{81}{8} (ID: line_2)
[Line 3] \frac{81}{8} (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_525]: "9 The diagram shows a cube and a square-based pyramid."
[block_0_3_428]: "b^{3}=8^{2} h \times 1 / 3"
[block_0_4_469]: "h=\frac{81}{8}"
[block_0_5_871]: "\frac{81}{8} \mathrm{~cm}"
[block_0_6_631]: "10"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ5[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6153[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_9_95][0m [P1] [34m"Volume of tin = frac{600}{0.6}"[0m
      â†³ Reason: Correct process to find volume of tin.
      â†³ OCR Match: [35m"Volume of tin = frac{600}{0.6}"[0m
      â†³ Classification: [35m"Volume of tin= \frac{600}{0.6}"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_10_435][0m [P1] [34m"= 1000 cmÂ³"[0m
      â†³ Reason: Correct volume of tin calculated.
      â†³ OCR Match: [35m"= 1000 cmÂ³"[0m
      â†³ Classification: [35m" =100 \mathrm{~cm}^{3}"[0m
      â†³ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_11_298][0m [P1] [34m"1000-700 = 300"[0m
      â†³ Reason: Correct process to find volume of salt.
      â†³ OCR Match: [35m"1000-700 = 300"[0m
      â†³ Classification: [35m"1000-700  =300"[0m
      â†³ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_12_84][0m [A1] [34m"600/300 = 2g/cmÂ³"[0m
      â†³ Reason: Correct density of salt calculated.
      â†³ OCR Match: [35m"600/300 = 2g/cmÂ³"[0m
      â†³ Classification: [35m"600 / 300=2 \mathrm{~g} / \mathrm{cm}^{3}"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q5: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=4
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q10[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 10

## QUESTION TEXT
There are only red counters and yellow counters in bag A. number of red counters : number of yellow counters = 3 : 5. There are only green counters and blue counters in bag B. The number of counters in bag B is half the number of counters in bag A. Given that there are x red counters in bag A, use algebra to show that the total number of counters in bag A and bag B is 4x.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- M1: for method to find the number of yellow counters in bag A, eg $x \div 3 \times 5 (= \frac{5x}{3})$ or for method to find the total number of counters in bag A eg $x \div 3 \times 8 (= \frac{8x}{3})$ or for starting to work with ratio using algebra eg 3y, 5y
- M1: (dep) for method to find the total number of counters in bag B, eg $(x + \frac{5x}{3}) \div 2 (= \frac{4x}{3})$ or $\frac{8x}{3} \div 2 (= \frac{4x}{3})$ or $(3y + 5y) \div 2 (= 4y)$
- C1: for complete method showing that total number of counters in bag A and bag B is 4x, eg $\frac{8x}{3} + \frac{4x}{3} = 4x$ or $3y + 5y + 4y = 12y$ and $12y \div 3y \times x = 4x$

FINAL ANSWER: Result shown



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] x red \Rightarrow \frac{5}{3}x yellow (ID: line_1)
[Line 2] = \frac{8}{3}x counters in A (ID: line_2)
[Line 3] = \frac{4}{3}x counters in B (ID: line_3)
[Line 4] = \frac{4}{3}x + \frac{8}{3}x total counters (ID: line_4)
[Line 5] = 4x counters (ID: line_5)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_655]: "10 There are only red counters and yellow counters in bag A."
[block_0_6_949]: "\( x \) red \( \Rightarrow 3 / 3 x \) yollow"
[block_0_7_559]: "\( =8 / 3 x \) couters in \( A \)"
[block_0_8_847]: "\( =\frac{4}{3} x \) anites in \( B \)"
[block_0_9_225]: "\( =\frac{4}{3} x+\frac{8}{3} x \) totel carater"
[block_0_10_995]: "\( =4 x \) conters"
[block_0_11_611]: "11"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ6[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m5907[0m
     [36mProbability tree diagram with probabilities for coin A and coin B.[0m
  - Annotations:
    1. [32mtick[0m [34m[line_4][0m [B1] [34m"0.4"[0m
      â†³ Reason: Correct probability (0.4) in the correct position.
      â†³ Transcription: [35m"0.4"[0m
      â†³ Classification: [35m"0.4"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[line_3][0m [B1] [34m"0.55"[0m
      â†³ Reason: Correct probabilities for coin B in the correct place.
      â†³ Transcription: [35m"0.55"[0m
      â†³ Classification: [35m"0.55"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[block_0_9_820][0m [M1 A1] [34m"0.33"[0m
      â†³ Reason: Correct method: 0.6 x 0.55. | Correct answer: 0.33.
      â†³ OCR Match: [35m"0.33"[0m
      â†³ Classification: [35m"0.33"[0m
      â†³ Status: [32m"MATCHED"[0m
[WIDTH FIX] Boosting tiny width 149px to 300px for Q6
[WIDTH FIX] Boosting tiny width 149px to 300px for Q6
[GUILLOTINE CHECK] Q6: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=4
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q11[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 11

## QUESTION TEXT
Mina records the speeds, in mph, of some cars on a road on Friday. She uses her results to work out the information in this table. [Lowest speed: 25, Lower quartile: 35, Median: 40, Interquartile range: 12, Range: 37]. On the grid, draw a box plot to show the information in the table. Mina also records the speeds of some cars on the same road on Sunday. She uses her results to draw this box plot. [Box plot for Sunday is shown]. Compare the distribution of the speeds on Friday with the distribution of the speeds on Sunday.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[11a]
- M1: for method to find UQ (47) or greatest value (62) from the table
- M1: for showing a box and at least 3 correctly plotted values from 25, 35, 40, 47, 62
- A1: for a fully correct box plot

[11b]
- C1: ft a correct comparison of medians from figures, eg the median speed for Sunday was greater than the median speed for Friday or the speed on Friday is generally lower as the median is lower
- C1: ft for a correct comparison of spread, eg the (interquartile) range of the speeds for Friday is smaller than the (interquartile) range of the speeds for Sunday, the (interquartile) range on Sunday is larger than the (interquartile) range on Friday. Comparisons for this mark can relate to the range or the IQR



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] [DRAWING] (ID: line_1)

[SUB-QUESTION A STUDENT WORK]
[Line 2] [DRAWING] (ID: line_2)

[SUB-QUESTION B STUDENT WORK]
[Line 3] The medion is higher on Sunday compore to Fridoy. (ID: line_3)
[Line 4] Mas 42>40. (ID: line_4)
[Line 5] The ronge die is also higher on Sunday as (ID: line_5)
[Line 6] 44>37. (ID: line_6)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_927]: "11 Mina records the speeds, in mph, of some cars on a road on Friday."
[block_0_2_290]: "\begin{tabular}{|l|c|} \cline { 2 - 2 } \multicolumn{1}{c|}{} & Speed (mph)"
[block_0_3_860]: "\hline Lowest speed & 25"
[block_0_4_879]: "\hline Lower quartile & 35"
[block_0_5_804]: "\hline Median & 40"
[block_0_6_984]: "\hline Interquartile range & 12"
[block_0_7_85]: "\hline Range & 37"
[block_0_9_923]: "(a) On the grid, draw a box plot to show the information in the table."
[block_0_10_715]: "(3)"
[block_0_11_922]: "Mina also records the speeds of some cars on the same road on Sunday."
[block_0_12_659]: "She uses her results to draw this box plot."
[block_0_13_75]: "(b) Compare the distribution of the speeds on Friday with the distribution of the speeds"
[block_0_14_546]: "on Sunday."
[block_0_16_279]: "- The medion is higher on compore to Fridoy."
[block_0_18_748]: "a) \( 42>40 \)."
[block_0_20_275]: "- The ronge the is also higher on Sundoy as"
[block_0_22_419]: "\( 44>37 \)."
[block_0_24_899]: "(2)"
[block_0_25_919]: "12"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ8[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m2/3[0m
  - Usage tokens: [33m5849[0m
     [36mA vector is drawn on the grid.[0m
  - Annotations:
    1. [32mtick[0m [34m[line_3][0m [M1 M1] [34m"[DRAWING]"[0m
      â†³ Reason: [DRAWING] Vector is drawn, but not necessarily correct.
      â†³ Transcription: [35m"[DRAWING]"[0m
      â†³ Classification: [35m"[DRAWING]"[0m
      â†³ Status: [32m"VISUAL"[0m
    2. [31mcross[0m [34m[line_3][0m [A0] [34m"[DRAWING]"[0m
      â†³ Reason: [DRAWING] Vector is not (5, 8).
      â†³ Transcription: [35m"[DRAWING]"[0m
      â†³ Classification: [35m"[DRAWING]"[0m
      â†³ Status: [32m"VISUAL"[0m
[GUILLOTINE CHECK] Q8: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=3
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=2

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q12[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 12

## QUESTION TEXT
The diagram shows triangle T drawn on a grid. [Triangle T vertices at (1,2), (1,3), (3,2)]. Enlarge triangle T by scale factor -2 with centre of enlargement (0,0).


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 2]
- B2: for correct enlargement (-2, -4), (-2, -6), (-6, -4)
- (B1: for correct size and orientation but incorrect position or 2 out of 3 vertices correctly placed)

FINAL ANSWER: Correct enlargement



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] [DRAWING] (ID: line_1)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_258]: "12 The diagram shows triangle T drawn on a grid."
[block_0_1_837]: "Enlarge triangle \( \mathbf{T} \) by scale factor \( -\mathbf{2} \) with centre of enlargement \( (0,0) \)"
[block_0_3_569]: "13"
[block_0_2_698]: "1"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ9[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m5798[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_3_428][0m [P1] [34m"6^3 = 8^2 h times frac{1}{3}"[0m
      â†³ Reason: Correct process to find volume of cube and pyramid.
      â†³ OCR Match: [35m"6^3 = 8^2 h times frac{1}{3}"[0m
      â†³ Classification: [35m"6^3 = 8^2 h \times \frac{1}{3}"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_4_469][0m [P1 A1] [34m"h = frac{81}{8}"[0m
      â†³ Reason: Correct process to form an equation. | Correct answer.
      â†³ OCR Match: [35m"h = frac{81}{8}"[0m
      â†³ Classification: [35m"h=\frac{81}{8}"[0m
      â†³ Status: [32m"MATCHED"[0m
ğŸ¤– [AI RESPONSE] [31mQ10[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6053[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_6_949][0m [M1] [34m"x red Rightarrow frac{5}{3}x yellow"[0m
      â†³ Reason: Correct method to find the number of yellow counters in bag A.
      â†³ OCR Match: [35m"x red Rightarrow frac{5}{3}x yellow"[0m
      â†³ Classification: [35m"x red \Rightarrow \frac{5}{3}x yellow"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_8_847][0m [M1] [34m"= frac{4}{3} x anites in B"[0m
      â†³ Reason: Correct method to find the total number of counters in bag B.
      â†³ OCR Match: [35m"= frac{4}{3} x anites in B"[0m
      â†³ Classification: [35m"= \frac{4}{3} x counters in B"[0m
      â†³ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_10_995][0m [C1] [34m"= 4 x conters"[0m
      â†³ Reason: Complete method showing that total number of counters in bag A and bag B is 4x.
      â†³ OCR Match: [35m"= 4 x conters"[0m
      â†³ Classification: [35m"= 4x counters"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q9: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=3
[GUILLOTINE CHECK] Q10: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=3
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=2

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q13[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 13

## QUESTION TEXT
There are 30 students in a class. A teacher is going to choose at random 2 of the students. Work out the number of different pairs of students that the teacher can choose.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 2]
- M1: for start to method of finding the number of pairs, eg $30 \times 29 (= 870)$ oe or $\frac{30 \times 29}{2}$ or clear intention to sum the integers from 1 to 29 eg $29 + 28 + ... + 2 + 1$
- A1: 435

FINAL ANSWER: 435



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] \frac{30x29}{2} (ID: line_1)
[Line 2] 435 (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_352]: "13 There are 30 students in a class."
[block_0_3_985]: "\frac{30 \times 29}{2}"
[block_0_5_908]: "435"
[block_0_6_204]: "14 At the start of 2022 Kim invested some money in a savings account."
[block_0_7_419]: "The account paid \( 3.5 \% \) compound interest each year."
[block_0_8_494]: "At the end of 2022"
[block_0_9_18]: "interest was added to the account then Kim took \( Â£ 750 \) from the account."
[block_0_10_987]: "At the end of 2023"
[block_0_11_296]: "interest was added to the account then Kim took \( Â£ 1000 \) from the account."
[block_0_12_132]: "There was then \( Â£ 2937.14 \) in the account."
[block_0_13_442]: "Work out how much money Kim invested at the start of 2022"
[block_0_14_668]: "You must show all your working."
[block_0_15_7]: "2937.14+1000"
[block_0_16_850]: "=3937.14"
[block_0_17_389]: "3937.14=x \times 1.039"
[block_0_18_369]: "3804"
[block_0_19_444]: "x=3804 \text { at end of } 2022"
[block_0_20_788]: "3804"
[block_0_21_243]: "+750=y \times 1,039"
[block_0_22_497]: "y=\text { promors }"
[block_0_23_298]: "4400"
[block_0_24_740]: "\text { Â£ }"
[block_0_25_896]: "14"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q14[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 14

## QUESTION TEXT
At the start of 2022 Kim invested some money in a savings account. The account paid 3.5% compound interest each year. At the end of 2022 interest was added to the account then Kim took Â£750 from the account. At the end of 2023 interest was added to the account then Kim took Â£1000 from the account. There was then Â£2937.14 in the account. Work out how much money Kim invested at the start of 2022. You must show all your working.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- P1: for start to processes needed to find the investment, eg $2937.14 + 1000 (= 3937.14)$ OR starts to work with algebra, eg $P \times 1.035 - 750$
- P1: for process to find amount of money at the beginning of 2023 after the first withdrawal, eg "3937.14" $\div 1.035 (= 3804)$ or $[value] \div 1.035$ OR writes down complete equation, eg $(P \times 1.035 - 750) \times 1.035 - 1000 = 2937.14$ to find $1.035P - 750$
- P1: for complete process, eg $("3804" + 750) \div 1.035$ OR for a start to the process to solve the equation eg $1.035P - 750 = 3804$ or $P \times 1.035 - 750 = \frac{2937.14 + 1000}{1.035}$ or for a start to the process to solve the complete equation eg $1.035^2P - 776.25 = 2937.14 + 1000$ or $1.035^2P - 1000 = 2937.14 + 776.25$ or $1.035^2P = 2937.14 + 776.25 + 1000$
- A1: 4400

FINAL ANSWER: 4400



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 2937.14 +1000 (ID: line_1)
[Line 2] = 3937.14 (ID: line_2)
[Line 3] 3037.14= x \\times 1.035 (ID: line_3)
[Line 4] x =  at end of 2022 (ID: line_4)
[Line 5]  +750 = y \\times 1.035 (ID: line_5)
[Line 6] y=  (ID: line_6)
[Line 7] 4400 (ID: line_7)
[Line 8] Â£ 4400 (ID: line_8)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_352]: "13 There are 30 students in a class."
[block_0_1_678]: "A teacher is going to choose at random 2 of the students."
[block_0_2_594]: "Work out the number of different pairs of students that the teacher can choose."
[block_0_3_985]: "\frac{30 \times 29}{2}"
[block_0_5_908]: "435"
[block_0_6_204]: "14 At the start of 2022 Kim invested some money in a savings account."
[block_0_15_7]: "2937.14+1000"
[block_0_16_850]: "=3937.14"
[block_0_17_389]: "3937.14=x \times 1.039"
[block_0_18_369]: "3804"
[block_0_19_444]: "x=3804 \text { at end of } 2022"
[block_0_20_788]: "3804"
[block_0_21_243]: "+750=y \times 1,039"
[block_0_22_497]: "y=\text { promors }"
[block_0_23_298]: "4400"
[block_0_24_740]: "\text { Â£ }"
[block_0_25_896]: "14"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ7[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6201[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_8_901][0m [P1] [34m"volume = pi x100^2 x 30 = 30000pi"[0m
      â†³ Reason: Correct volume formula and substitution.
      â†³ OCR Match: [35m"volume = pi x100^2 x 30 = 30000pi"[0m
      â†³ Classification: [35m"volume  =\pi \times 100^{2} \times 30=300000 \pi"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_9_264][0m [P1] [34m"time = frac{30000pi}{250}"[0m
      â†³ Reason: Correct process to find time in seconds.
      â†³ OCR Match: [35m"time = frac{30000pi}{250}"[0m
      â†³ Classification: [35m"lime  =\frac{300000 \pi}{250}"[0m
      â†³ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_10_409][0m [P1] [34m"= 120pi seconds"[0m
      â†³ Reason: Correct complete process.
      â†³ OCR Match: [35m"= 120pi seconds"[0m
      â†³ Classification: [35m" =120 \pi \text { seconds }"[0m
      â†³ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_12_812][0m [A1] [34m"63"[0m
      â†³ Reason: Answer in the range 62 to 63.
      â†³ OCR Match: [35m"63"[0m
      â†³ Classification: [35m"63 minitutes"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q7: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=4
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q15[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 15

## QUESTION TEXT
Simplify fully $\frac{(a-3)^{2}}{5(a-3)}$ Factorise $3k^{2}+11k-4$ Simplify fully $\frac{4-x^{2}}{x^{2}+3x} \div \frac{x+2}{x+3}$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[15a]
- B1: for $\frac{a-3}{5}$ oe

[15b]
- M1: for $(3k \pm 1)(k \pm 4)$ oe or for brackets which when expanded give 2 out of 3 terms correct
- A1: cao

[15c]
- M1: for factorisation eg $(4-x^2=)(2-x)(2+x)$ and $(x^2+3x=)x(x+3)$ or for inversion and multiplication (condone incorrect factorising) eg $\frac{4-x^2}{x^2+3x} \times \frac{x+3}{x+2}$ oe
- M1: for factorisation of both quadratics and inversion and multiplication, eg $\frac{(2-x)(2+x)}{x(x+3)} \times \frac{x+3}{x+2}$ allow sign errors in one bracket
- A1: for $\frac{2-x}{x}$ or $\frac{2}{x}-1$



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] \frac{a-3}{5} (ID: line_1)

[SUB-QUESTION B STUDENT WORK]
[Line 2] (3k-1)(k+4) (ID: line_2)

[SUB-QUESTION C STUDENT WORK]
[Line 3] = \frac{2-x(x2+x)}{x(3+L)} \times \frac{x+3}{x+2} (ID: line_3)
[Line 4] \frac{2-x}{x} (ID: line_4)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_506]: "15 (a) Simplify fully \( \frac{(a-3)^{2}}{5(a-3)} \)"
[block_0_1_937]: "\frac{d \cdot 3}{s}"
[block_0_2_49]: "(1)"
[block_0_3_774]: "(b) Factorise \( \mathbf{3} \boldsymbol{k}^{\mathbf{2}}+\mathbf{1 1} \boldsymbol{k}-\mathbf{4} \)"
[block_0_4_754]: "\( (3 k-1)(k+4) \)"
[block_0_6_279]: "(c) Simplify fully \( \frac{4-x^{2}}{x^{2}+3 x} \div \frac{x+2}{x+3} \)"
[block_0_5_483]: "(2)"
[block_0_7_977]: "=\frac{(2-x)(2+x)}{x(3+x)} \times \frac{x+7}{x+2}"
[block_0_8_100]: "\frac{2-x}{x}"
[block_0_9_474]: "(3)"
[block_0_10_775]: "15"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ12[0m - Clean response received:
  - Annotations count: [35m1[0m
  - Student score: [32m2/2[0m
  - Usage tokens: [33m5370[0m
     [36mTriangle T enlarged by a scale factor of -2 with vertices at (-2, -4), (-2, -6), and (-6, -4).[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [B2] [34m"[DRAWING]"[0m
      â†³ Reason: [DRAWING] Correct enlargement with vertices at (-2, -4), (-2, -6), and (-6, -4).
      â†³ Transcription: [35m"[DRAWING]"[0m
      â†³ Classification: [35m"[DRAWING]"[0m
      â†³ Status: [32m"VISUAL"[0m
[GUILLOTINE CHECK] Q12: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=2
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q16[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 16

## QUESTION TEXT
The functions f and g are given by $f(x)=\frac{12}{x+1}$ and $g(x)=5-3x$ Find $f(-3)$ Find $fg(1)$ Find $g^{-1}(4)$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[16a]
- B1: cao

[16b]
- M1: for $g(1) = 5 - 3 \times 1 (= 2)$ and a clear intention to find $f("2")$ or for $\frac{12}{5-3 \times 1+1}$ or for stating fg, eg $\frac{12}{5-3x+1}$ oe
- A1: cao

[16c]
- M1: for $g^{-1}$ as $\frac{5-x}{3}$ oe or for $5-3x=4$ or $g(\frac{1}{3}) = 5-1 = 4$
- A1: for $\frac{1}{3}$ oe eg 0.33(3...)



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] -6 (ID: line_1)

[SUB-QUESTION B STUDENT WORK]
[Line 2] 4 (ID: line_2)

[SUB-QUESTION C STUDENT WORK]
[Line 3] \frac{1}{3} (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_1_610]: "\mathrm{f}(x)=\frac{12}{x+1} \text { and } \mathrm{g}(x)=5-3 x"
[block_0_2_659]: "(a) Find \( f(-3) \)"
[block_0_4_368]: "-6"
[block_0_5_692]: "(1)"
[block_0_6_318]: "(b) Find \( \mathrm{fg}(\mathrm{l}) \)"
[block_0_9_603]: "4"
[block_0_8_852]: "4"
[block_0_10_121]: "(2)"
[block_0_11_146]: "(c) Find \( g^{-1}(4) \)"
[block_0_13_838]: "1 / 3"
[block_0_14_493]: "(2)"
[block_0_15_713]: "16"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ13[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m2/2[0m
  - Usage tokens: [33m5962[0m
     [36mThe student provides the correct calculation and answer.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_3_985][0m [M1] [34m"frac{30x29}{2}"[0m
      â†³ Reason: Correct method to find the number of pairs.
      â†³ OCR Match: [35m"frac{30x29}{2}"[0m
      â†³ Classification: [35m"\frac{30x29}{2}"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_5_908][0m [A1] [34m"435"[0m
      â†³ Reason: Correct answer.
      â†³ OCR Match: [35m"435"[0m
      â†³ Classification: [35m"435"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q13: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=2
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q17[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 17

## QUESTION TEXT
A ball is thrown upwards and reaches a maximum height. The ball then falls and bounces repeatedly. After the nth bounce, the ball reaches a height of $h_{n}$. After the next bounce, the ball reaches a height given by $h_{n+1}=0.55h_{n}$. After the 1st bounce, the ball reaches a height of 8 metres. What height does the ball reach after the 4th bounce?


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- M1: for method to find height after 2nd bounce, eg $0.55 \times 8 (= 4.4)$
- M1: for method to find height after 3rd bounce, eg $0.55 \times "4.4" (= 2.4(2))$ or for method to find height after 4th bounce, eg $0.55^3 \times 8$ or for method to find height after 5th bounce, eg $0.55^4 \times 8 (= 0.73(205))$
- A1: for 1.331, accept 1.33, 1.3 oe mixed number

FINAL ANSWER: 1.331



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 8x0.55^3 (ID: line_1)
[Line 2] 1.331 (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_63]: "17 A ball is thrown upwards and reaches a maximum height."
[block_0_2_183]: "After the \( n \)th bounce, the ball reaches a height of \( h_{n} \)"
[block_0_3_516]: "After the next bounce, the ball reaches a height given by \( h_{n+1}=0.55 h_{n} \)"
[block_0_4_573]: "After the 1st bounce, the ball reaches a height of 8 metres."
[block_0_6_451]: "8 \times 0.99^{3}"
[block_0_7_108]: "1.33"
[block_0_9_19]: "17"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ14[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6661[0m
  - Annotations:
    1. [32mtick[0m [34m[line_2][0m [P1] [34m"= 3937.14"[0m
      â†³ Reason: Correct addition of 2937.14 and 1000.
      â†³ Transcription: [35m"= 3937.14"[0m
      â†³ Classification: [35m"= 3937.14"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[line_3][0m [P1] [34m"3037.14 = x times 1.035"[0m
      â†³ Reason: Incorrect value of 3037.14, but correct process of multiplying by 1.035.
      â†³ Transcription: [35m"3037.14 = x times 1.035"[0m
      â†³ Classification: [35m"3037.14= x \times 1.035"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_5][0m [P1] [34m"+750 = y times 1.035"[0m
      â†³ Reason: Correct process of adding 750 and multiplying by 1.035.
      â†³ Transcription: [35m"+750 = y times 1.035"[0m
      â†³ Classification: [35m"+750 = y \times 1.035"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    4. [32mtick[0m [34m[line_7][0m [A1] [34m"4400"[0m
      â†³ Reason: Correct final answer.
      â†³ Transcription: [35m"4400"[0m
      â†³ Classification: [35m"4400"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 249px to 300px for Q14
[GUILLOTINE CHECK] Q14: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=4
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=5

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q18[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 18

## QUESTION TEXT
ABCD is a quadrilateral. [Triangle ABC with angle BAC = 35 degrees, Angle ACB = 48 degrees, side AB = 17cm. Triangle ACD attached to AC with angle CAD = 57 degrees]. The area of triangle ABC is $54~cm^{2}$. Calculate the area of triangle ACD. Give your answer correct to 3 significant figures.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 5]
- P1: for start of process to find length of AC, eg $\frac{1}{2} \times 17 \times AC \times \sin 35 = 54$ or $(AC = ) 54 \div (\frac{1}{2} \times 17 \times \sin 35) (\approx 11.076...)$
- P1: for start of process to find AD or CD, eg $\frac{AD}{\sin 48} = \frac{"11.076"}{\sin 57}$ or $\frac{AD}{\sin 48} = \frac{[AC]}{\sin 57}$ oe or $\frac{CD}{\sin "75"} = \frac{"11.076"}{\sin 57}$ or $\frac{CD}{\sin "75"} = \frac{[AC]}{\sin 57}$ oe
- P1: for complete process to find AD or CD $(AD=) \frac{"11.076"}{\sin 57} \times \sin 48 (= 9.81...)$ or $(AD=) \frac{[AC]}{\sin 57} \times \sin 48$ or $(CD=) \frac{"11.076"}{\sin 57} \times \sin "75" (= 12.7...)$ or $(CD=) \frac{[AC]}{\sin 57} \times \sin "75"
- P1: for process to find area of triangle ACD, $\frac{1}{2} \times "11.076" \times "12.7" \times \sin 48$ or $\frac{1}{2} \times [AC] \times [CD] \times \sin 48$ or $\frac{1}{2} \times "11.076" \times "9.81" \times \sin "75"$ or $\frac{1}{2} \times [AC] \times [AD] \times \sin "75"$ or $\frac{1}{2} \times "9.81" \times "12.7" \times \sin 57$ or $\frac{1}{2} \times [AD] \times [CD] \times \sin 57$
- A1: for answer in the range 52.4 to 52.52

FINAL ANSWER: 52.5



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 54= \\frac{1}{2}x17x ACx sin 35 (ID: line_1)
[Line 2] AC = 11.08 (ID: line_2)
[Line 3] AD = \\frac{11.08}{sin 57} x sin (48) (ID: line_3)
[Line 4] = 9.81 (ID: line_4)
[Line 5] Area= \\frac{1}{2}x 9.81 x 11.08 x sin (180-48-57) (ID: line_5)
[Line 6] = 52.5 (ID: line_6)
[Line 7] 52.5 (ID: line_7)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_822]: "\( 18 A B C D \) is a quadrilateral."
[block_0_1_19]: "The area of triangle \( A B C \) is \( 54 \mathrm{~cm}^{2} \)"
[block_0_4_724]: "\rho_{4}  =\frac{1}{2} \times 17 \times A(\times \sin 35"
[block_0_5_744]: "H C  =11.08"
[block_0_6_869]: "A D  =\frac{1.108}{\sin 51} \times \sin (48)"
[block_0_7_937]: " =9.81"
[block_0_8_795]: "\text { Area }  =18 \times 1.08 \times \sin (180.48 .57)"
[block_0_9_936]: " =52.5"
[block_0_10_185]: "18"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ11[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m5/5[0m
  - Usage tokens: [33m6701[0m
     [36mThe student has drawn a box plot.[0m
  - Annotations:
    1. [32mtick[0m [34m[line_2][0m [M1 M1 A1] [34m"[DRAWING]"[0m
      â†³ Reason: [DRAWING] Method to find UQ (47) or greatest value (62) from the table is implied. | [DRAWING] Box plot shows at least 3 correctly plotted values from 25, 35, 40, 47, 62. | [DRAWING] Fully correct box plot is drawn.
      â†³ Transcription: [35m"[DRAWING]"[0m
      â†³ Classification: [35m"[DRAWING]"[0m
      â†³ Status: [32m"VISUAL"[0m
    2. [32mtick[0m [34m[line_3][0m [C1] [34m"The medion is higher on Sunday compore to Fridoy."[0m
      â†³ Reason: Correct comparison of medians from figures. The median speed for Sunday was greater than Friday.
      â†³ Transcription: [35m"The medion is higher on Sunday compore to Fridoy."[0m
      â†³ Classification: [35m"The medion is higher on Sunday compore to Fridoy."[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_5][0m [C1] [34m"The ronge die is also higher on Sunday as"[0m
      â†³ Reason: Correct comparison of spread. The range of the speeds for Friday is smaller than Sunday.
      â†³ Transcription: [35m"The ronge die is also higher on Sunday as"[0m
      â†³ Classification: [35m"The ronge die is also higher on Sunday as"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[GUILLOTINE CHECK] Q11: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=5
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q19[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 19

## QUESTION TEXT
$R=\frac{P}{Q}$. $P=5.88\times10^{8}$ correct to 3 significant figures. $Q=3.6\times10^{5}$ correct to 2 significant figures. Work out the lower bound for R. Give your answer as an ordinary number correct to the nearest integer. You must show all your working.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- B1: for $5.875 \times 10^8$ or $5.885 \times 10^8$ or $3.55 \times 10^5$ or $3.65 \times 10^5$ or the digits 5875 or 5885 or 355 or 365
- M1: for method to find lower bound $\frac{[LB]}{[UB]}$ eg $(5.875 \times 10^8) \div (3.65 \times 10^5)$ oe
- A1: for answer in range 1609 - 1610 from correct working

FINAL ANSWER: 1610



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] LMB of P= 5.875x10^8, UB of Q = 365x10^8 (ID: line_1)
[Line 2] R= \\frac{5.8875x10^8}{3.65x10^5} (ID: line_2)
[Line 3] = 1609.59 (ID: line_3)
[Line 4] 1610 (ID: line_4)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_507]: "\( 19 R=\frac{P}{Q} \)"
[block_0_1_910]: "\( P=5.88 \times 10^{8} \) correct to 3 significant figures."
[block_0_2_178]: "\( Q=3.6 \times 10^{5} \) correct to 2 significant figures."
[block_0_5_789]: "L U B & \text { ot } P=5.875 \times 10^{8}, U B \text { of } Q=3\left(5 \times 10^{\rho}\right."
[block_0_6_958]: "R  =\frac{9.1875 \times 10^{8}}{3.65 \times 10^{9}}"
[block_0_7_791]: " =1609.99"
[block_0_8_989]: "1610"
[block_0_9_90]: "19"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ17[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m5826[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_0_63][0m [M1] [34m"8x0.55^3"[0m
      â†³ Reason: Correct method to find height after 4th bounce.
      â†³ OCR Match: [35m"8x0.55^3"[0m
      â†³ Classification: [35m"8x0.55^3"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_7_108][0m [M1 A1] [34m"1.331"[0m
      â†³ Reason: Correct method to find height after 3rd bounce. | Correct answer.
      â†³ OCR Match: [35m"1.331"[0m
      â†³ Classification: [35m"1.331"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q17: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=3
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q20[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 20

## QUESTION TEXT
$x-4$, $x+2$ and $3x+1$ are three consecutive terms of an arithmetic sequence. Find the value of x. $y-4$, $y+2$ and $3y+1$ are three consecutive terms of a geometric sequence. Find the possible values of y.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[20a]
- P1: for process to find the common difference between the first and second and the common difference between the third and second term eg $(3x+1) - (x+2) (= 2x-1)$ and $(x+2) - (x-4) (= 6)$ or for process to write a correct equation in x, eg $(3x+1) - (x+2) = (x+2) - (x-4)$ or $2x-1 = 6$ oe
- A1: for 3.5 oe eg $\frac{7}{2}$

[20b]
- P1: for process to write a correct equation in terms of the common ratio and y eg $r(y-4) = y+2$ or $r(y+2) = 3y+1$
- P1: for process to write a correct equation in y eg $\frac{3y+1}{y+2} = \frac{y+2}{y-4}$ oe
- P1: for process to write a correct equation without fractions eg $(3y+1)(y-4) = (y+2)(y+2)$ oe
- P1: for process of writing a correct simplified equation eg $2y^2 - 15y - 8 (= 0)$
- A1: cao



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] 3x+1-(x+2)=x+2-(x-4) (ID: line_1)
[Line 2] 4x-3=x+4 (ID: line_2)
[Line 3] -7=-2x (ID: line_3)
[Line 4] x = \frac{7}{2} (ID: line_4)

[SUB-QUESTION B STUDENT WORK]
[Line 5] \frac{3y+1}{y+2} = \frac{y+2}{y-4} (ID: line_5)
[Line 6] (3y+1)(y-4) = (y+2)^2 (ID: line_6)
[Line 7] 3y^2-11y-4=y^2+4y+4 (ID: line_7)
[Line 8] 2y^2-15y-8=0 (ID: line_8)
[Line 9] Y=8,-0.5 (ID: line_9)
[Line 10] 8,-0.5 (ID: line_10)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_1_787]: "(a) Find the value of \( x \)."
[block_0_2_34]: "3 x+1-(x+7)  =8 x+2-(x-4)"
[block_0_3_866]: "4 x-3  =8^{2} x+4"
[block_0_4_560]: "-7  =-2 x"
[block_0_5_953]: "WHS 1 anc"
[block_0_6_703]: "x=\frac{7}{2}"
[block_0_7_296]: ","
[block_0_8_279]: "(2)"
[block_0_10_197]: "(b) Find the possible values of \( y \)."
[block_0_11_56]: "\frac{3 y+1}{y+2}  =\frac{y+2}{y-4}"
[block_0_12_419]: "(3 y+4)[y-4]  =[y+2]^{2}"
[block_0_13_531]: "3 y^{2}-11(y-4  =y^{2}+4 y+4"
[block_0_14_501]: "2 y^{2}-15 y-8  =0"
[block_0_15_445]: "y  =8,-0.5"
[block_0_17_549]: "8,-0.5"
[block_0_18_878]: "(5)"
[block_0_19_798]: "20"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ15[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m6/6[0m
  - Usage tokens: [33m6551[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [B1] [34m"frac{a-3}{5}"[0m
      â†³ Reason: Correct simplification.
      â†³ Transcription: [35m"frac{a-3}{5}"[0m
      â†³ Classification: [35m"\frac{a-3}{5}"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[line_2][0m [M1 A1] [34m"(3k-1)(k+4)"[0m
      â†³ Reason: Correct factors. | Correct answer.
      â†³ Transcription: [35m"(3k-1)(k+4)"[0m
      â†³ Classification: [35m"(3k-1)(k+4)"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_3][0m [M1 M1] [34m"= frac{2-x(x2+x)}{x(3+L)} times frac{x+3}{x+2}"[0m
      â†³ Reason: Correct factorisation and inversion. | Correct factorisation of both quadratics and inversion.
      â†³ Transcription: [35m"= frac{2-x(x2+x)}{x(3+L)} times frac{x+3}{x+2}"[0m
      â†³ Classification: [35m"= \frac{2-x(x2+x)}{x(3+L)} \times \frac{x+3}{x+2}"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    4. [32mtick[0m [34m[line_4][0m [A1] [34m"frac{2-x}{x}"[0m
      â†³ Reason: Correct simplification.
      â†³ Transcription: [35m"frac{2-x}{x}"[0m
      â†³ Classification: [35m"\frac{2-x}{x}"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 249px to 300px for Q15
[WIDTH FIX] Boosting tiny width 250px to 300px for Q15
[GUILLOTINE CHECK] Q15: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=6
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[34m[AI MARKING] Q21[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Messy OCR" Bridge):**
    * **Objective:** Map [CLEAN Student Work] to [RAW OCR BLOCK].
    * **PERMISSION:** You are explicitly allowed to `MATCH` if the logic aligns, even if the text format differs.
    * **MANDATORY EQUIVALENCES (YOU MUST MATCH THESE):**
        * **The "Rationalization" Rule:** Treat `1/sqrt(a)` as identical to `sqrt(a)/a`. (e.g., Match Student `5/sqrt(3)` to OCR `5sqrt(3)/3`).
        * **The "Typo" Rule:** Treat `S` as `5`, `O` as `0`, `Z` as `2`.
    * **STRICT SANITY CHECK:** DO NOT match if the base numbers are completely unrelated (e.g. `2/3` vs `5/sqrt(3)` is a **REJECT**).

---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### ğŸš« FORBIDDEN BLOCKS (IGNORE IMMEDIATELY)
Even if listed under "POTENTIAL STUDENT WORK", you must **NEVER** map to a block if it contains:
* **Question Totals:** text like `(Total 3 marks)` or `(Total 4 marks)`.
* **Table Headers:** words like `Smallest`, `Largest`, `Answer`.
* *Reason:* These are printed landmarks. If you match to these, the student gets a tick on the printed question, which is wrong.

### ğŸ¥‡ PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**â›” SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ğŸ¥ˆ PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ğŸ¥‰ PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**â€”Focus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**â€”State the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## ğŸ’¾ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer // e.g. 4
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 21

## QUESTION TEXT
The diagram shows a circle, radius r cm and two regular hexagons. [A larger hexagon ABCDEF circumscribes the circle (sides are tangents). A smaller hexagon PQRSTU is inscribed in the circle (sides are chords)]. Each side of the larger hexagon ABCDEF is a tangent to the circle. Each side of the smaller hexagon PQRSTU is a chord of the circle. By considering perimeters, show that $3 < \pi < 2\sqrt{3}$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- P1: for process to find the length of half a side or a side or the perimeter of the smaller hexagon PQRSTU, eg $r \sin 30 (= \frac{r}{2})$ oe or $2r \sin 30 (= r)$ oe or $6 \times 2r \sin 30 (= 6r)$ oe
- P1: for process to find the length of half a side or a side or the perimeter of the larger hexagon ABCDEF eg Length of half side = $r \tan 30$ or $\frac{r}{\tan 60} (= \frac{\sqrt{3}r}{3})$ oe or Length of side = $2r \tan 30$ or $\frac{2r}{\tan 60}$ or $\frac{r}{\cos 30}$ or $\frac{r}{\sin 60}$ or $\frac{2\sqrt{3}r}{3}$ oe or Length of perimeter = $6 \times 2r \tan 30$ or $6 \times \frac{2r}{\tan 60}$ oe
- P1: (dep P2) for process of forming a correct inequality, eg using half lengths eg $\frac{r}{2} < \frac{2\pi r}{12} < r \tan 30$ oe or using lengths eg $r < \frac{2\pi r}{6} < 2r \tan 30$ oe or using perimeters eg $6 \times r < 2\pi r < 6 \times 2r \tan 30$ oe
- C1: (dep P2) correct algebra leading to given result, $3 < \pi < 2\sqrt{3}$

FINAL ANSWER: Result shown



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] perimeter: smull hexagon <circle <large lhexagon (ID: line_1)
[Line 2] perimeter of small hexagus = 6r (ID: line_2)
[Line 3] of circle =2\\pi r (ID: line_3)
[Line 4] of large hexugun= \\frac{6r}{cos(30)} (ID: line_4)
[Line 5] =4\\sqrt{3} r (ID: line_5)
[Line 6] 6r<2\\pi r<4\\sqrt{3}r (ID: line_6)
[Line 7] 3 <\\pi <2\\sqrt{3} (ID: line_7)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### ğŸ“ POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_536]: "21 The diagram shows a circle, radius \( r \mathrm{~cm} \) and two regular hexagons."
[block_0_5_723]: "perimeter: smull hexagos < circle< large liexagoy"
[block_0_6_621]: "perimeter of smoll hexagou \( =6 r \)"
[block_0_8_572]: "of lorge hexysua \( =\frac{62}{60} \)"
[block_0_7_664]: "of circle \( =2 \pi r \)"
[block_0_9_983]: "=4 \sqrt{3} r"
[block_0_10_37]: "6 r<2 \pi r<4 \sqrt{3}<"
[block_0_12_393]: "\hline"
[block_0_13_694]: "TOTAL FOR PAPER IS 80 MARKS"
[block_0_14_574]: "21"[0m
[1m[34mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”[0m

ğŸ¤– [AI RESPONSE] [31mQ16[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m5/5[0m
  - Usage tokens: [33m6138[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_4_368][0m [B1] [34m"-6"[0m
      â†³ Reason: Correct answer for f(-3).
      â†³ OCR Match: [35m"-6"[0m
      â†³ Classification: [35m"-6"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_9_603][0m [M1 A1] [34m"4"[0m
      â†³ Reason: Correct method for finding fg(1). | Correct answer for fg(1).
      â†³ OCR Match: [35m"4"[0m
      â†³ Classification: [35m"4"[0m
      â†³ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_13_838][0m [M1 A1] [34m"1 / 3"[0m
      â†³ Reason: Correct method for finding g^{-1}(4). | Correct answer for g^{-1}(4).
      â†³ OCR Match: [35m"1 / 3"[0m
      â†³ Classification: [35m"\frac{1}{3}"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q16: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=5
ğŸ¤– [AI RESPONSE] [31mQ19[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6097[0m
     [36mThe student provides calculations to find the lower bound of R.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_5_789][0m [B1] [34m"L U B text { ot } P = 5.875 times 10^{8}, U B text { of } Q = 3left(5 times 10^{..."[0m
      â†³ Reason: Correct lower bound of P is identified.
      â†³ OCR Match: [35m"L U B text { ot } P = 5.875 times 10^{8}, U B text { of } Q = 3left(5 times 10^{rho}right."[0m
      â†³ Classification: [35m"LMB of P= 5.875x10^8, UB of Q = 365x10^8"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_6_958][0m [M1] [34m"R = frac{9.1875 times 10^{8}}{3.65 times 10^{9}}"[0m
      â†³ Reason: Correct method to find lower bound is shown.
      â†³ OCR Match: [35m"R = frac{9.1875 times 10^{8}}{3.65 times 10^{9}}"[0m
      â†³ Classification: [35m"R= \frac{5.8875x10^8}{3.65x10^5}"[0m
      â†³ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_7_791][0m [A1] [34m"= 1609.99"[0m
      â†³ Reason: Correct answer is obtained from correct working.
      â†³ OCR Match: [35m"= 1609.99"[0m
      â†³ Classification: [35m"= 1609.59"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q19: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=3
ğŸ¤– [AI RESPONSE] [31mQ18[0m - Clean response received:
  - Annotations count: [35m5[0m
  - Student score: [32m5/5[0m
  - Usage tokens: [33m6716[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [P1] [34m"54 = frac{1}{2}x17x ACx sin 35"[0m
      â†³ Reason: Correct start of process to find length of AC.
      â†³ Transcription: [35m"54 = frac{1}{2}x17x ACx sin 35"[0m
      â†³ Classification: [35m"54= \frac{1}{2}x17x ACx sin 35"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[line_2][0m [P1] [34m"AC = 11.08"[0m
      â†³ Reason: Correct value of AC.
      â†³ Transcription: [35m"AC = 11.08"[0m
      â†³ Classification: [35m"AC = 11.08"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_3][0m [P1] [34m"AD = frac{11.08}{sin 57} x sin (48)"[0m
      â†³ Reason: Correct start of process to find AD.
      â†³ Transcription: [35m"AD = frac{11.08}{sin 57} x sin (48)"[0m
      â†³ Classification: [35m"AD = \frac{11.08}{sin 57} x sin (48)"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    4. [32mtick[0m [34m[line_4][0m [P1] [34m"= 9.81"[0m
      â†³ Reason: Correct value of AD.
      â†³ Transcription: [35m"= 9.81"[0m
      â†³ Classification: [35m"= 9.81"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    5. [32mtick[0m [34m[line_7][0m [A1] [34m"52.5"[0m
      â†³ Reason: Correct final answer.
      â†³ Transcription: [35m"52.5"[0m
      â†³ Classification: [35m"52.5"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 248px to 300px for Q18
[GUILLOTINE CHECK] Q18: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=5
ğŸ¤– [AI RESPONSE] [31mQ21[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6420[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_6_621][0m [P1] [34m"perimeter of small hexagus = 6r"[0m
      â†³ Reason: Correct perimeter of the smaller hexagon.
      â†³ OCR Match: [35m"perimeter of small hexagus = 6r"[0m
      â†³ Classification: [35m"perimeter of smoll hexagou \( =6 r \)"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_7_664][0m [P1] [34m"of circle = 2pi r"[0m
      â†³ Reason: Correct perimeter of the circle.
      â†³ OCR Match: [35m"of circle = 2pi r"[0m
      â†³ Classification: [35m"of circle \( =2 \pi r \)"[0m
      â†³ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[line_4][0m [P1] [34m"of large hexugun = frac{6r}{cos(30)}"[0m
      â†³ Reason: Correct perimeter of the larger hexagon.
      â†³ Transcription: [35m"of large hexugun = frac{6r}{cos(30)}"[0m
      â†³ Classification: [35m"of large hexugun= \frac{6r}{cos(30)}"[0m
      â†³ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    4. [32mtick[0m [34m[block_0_10_37][0m [C1] [34m"6r<2pi r<4sqrt{3}<"[0m
      â†³ Reason: Correct inequality leading to the result.
      â†³ OCR Match: [35m"6r<2pi r<4sqrt{3}<"[0m
      â†³ Classification: [35m"6 r<2 \pi r<4 \sqrt{3}<"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q21: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=4
ğŸ¤– [AI RESPONSE] [31mQ20[0m - Clean response received:
  - Annotations count: [35m5[0m
  - Student score: [32m5/7[0m
  - Usage tokens: [33m6707[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_2_34][0m [P1] [34m"3x+1-(x+2) = x+2-(x-4)"[0m
      â†³ Reason: Correct equation in x.
      â†³ OCR Match: [35m"3x+1-(x+2) = x+2-(x-4)"[0m
      â†³ Classification: [35m"3x+1-(x+2)=x+2-(x-4)"[0m
      â†³ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_6_703][0m [A1] [34m"x = frac{7}{2}"[0m
      â†³ Reason: Correct answer.
      â†³ OCR Match: [35m"x = frac{7}{2}"[0m
      â†³ Classification: [35m"x = \frac{7}{2}"[0m
      â†³ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_11_56][0m [P1] [34m"frac{3y+1}{y+2} = frac{y+2}{y-4}"[0m
      â†³ Reason: Correct equation in y.
      â†³ OCR Match: [35m"frac{3y+1}{y+2} = frac{y+2}{y-4}"[0m
      â†³ Classification: [35m"\frac{3 y+1}{y+2}  =\frac{y+2}{y-4}"[0m
      â†³ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_14_501][0m [P1] [34m"2y^2-15y-8 = 0"[0m
      â†³ Reason: Correct simplified equation.
      â†³ OCR Match: [35m"2y^2-15y-8 = 0"[0m
      â†³ Classification: [35m"2 y^{2}-15 y-8  =0"[0m
      â†³ Status: [32m"MATCHED"[0m
    5. [32mtick[0m [34m[block_0_15_445][0m [A1] [34m"Y = 8,-0.5"[0m
      â†³ Reason: Correct answer.
      â†³ OCR Match: [35m"Y = 8,-0.5"[0m
      â†³ Classification: [35m"y  =8,-0.5"[0m
      â†³ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q20: isGeneric=false, hasAnnotations=true, hasScore=true, totalMarks=7
[1m[32mâœ… [AI MARKING][0m [1mCOMPLETED[0m in [1m18.2s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
[1m[32mâœ… [MARKING][0m [1mCOMPLETED[0m in [1m18.2s[0m ([32m[1mAI-MARKING[0m)

ğŸ” [RESULT VERIFICATION] Checking what will be combined:
   ğŸ“Š Marking Results: 21 questions
   ğŸ“ Question Results: NO
   âœ… Both modes triggered: NO
[32mğŸ”„ [LOGICAL RE-INDEXING] Aligning logical indices with sorted physical order...[0m
[32mâœ… [LOGICAL RE-INDEXING] Re-indexed 21 questions and 21 pages.[0m
[32mâœ… [1m[FINAL PAGE ORDER][0m [32m[1] Page 0 ([37mFRONT PAGE[32m) -> [2] Page 1 ([37mQ1[32m) -> [3] Page 2 ([37mQ2ai[32m) -> [4] Page 3 ([37mQ3a[32m) -> [5] Page 4 ([37mQ3b, Q4[32m) -> [6] Page 5 ([37mQ5[32m) -> [7] Page 6 ([37mQ6a[32m) -> [8] Page 7 ([37mQ7[32m) -> [9] Page 8 ([37mQ8[32m) -> [10] Page 9 ([37mQ9[32m) -> [11] Page 10 ([37mQ10[32m) -> [12] Page 11 ([37mQ11a[32m) -> [13] Page 12 ([37mQ12[32m) -> [14] Page 13 ([37mQ13, Q14[32m) -> [15] Page 14 ([37mQ15a[32m) -> [16] Page 15 ([37mQ16a[32m) -> [17] Page 16 ([37mQ17[32m) -> [18] Page 17 ([37mQ18[32m) -> [19] Page 18 ([37mQ19[32m) -> [20] Page 19 ([37mQ20a[32m) -> [21] Page 20 ([37mQ21[32m)[0m
[1m[32mâœ… [OUTPUT GENERATION][0m [1mCOMPLETED[0m in [1m6.4s[0m ([32m[1mOUTPUT-GENERATION[0m)
[1m[32mâœ… [PERFORMANCE SUMMARY AI][0m [1mCOMPLETED[0m in [1m0.8s[0m ([32m[1mGEMINI-2.0-FLASH[0m)

ğŸ“Š [ANNOTATION SUMMARY]
----------------------------------------------------------------------
| Q#       | Score | Marks Awarded           | Match Status              |
|----------|-------|-------------------------|---------------------------|
| [32m1       [0m | 1/2   | M1, A0                  | M:0 V:0 U:1 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m2       [0m | 2/4   | B1, B1, M1 A0           | M:0 V:0 U:0 S:3           |
| [90m  ai    [0m | 1     | B1                      | M:0 V:0 U:0 S:1           |
| [90m  aii   [0m | 1     | B1                      | M:0 V:0 U:0 S:1           |
| [90m  b     [0m | 1     | M1 A0                   | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m3       [0m | 3/3   | C1, M1 A1               | M:0 V:1 U:0 S:1           |
| [90m  a     [0m | 1     | C1                      | M:0 V:0 U:0 S:1           |
| [90m  b     [0m | 1     | M1 A1                   | M:0 V:1 U:0 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m4       [0m | 4/4   | P1 P1 P1, A1            | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m5       [0m | 4/4   | P1, P1, P1, A1          | M:0 V:0 U:0 S:4           |
|----------|-------|-------------------------|---------------------------|
| [32m6       [0m | 4/4   | M1 A1, B1, B1           | M:0 V:0 U:2 S:1           |
| [90m  a     [0m | 2     | B1, B1                  | M:0 V:0 U:2 S:0           |
| [90m  b     [0m | 1     | M1 A1                   | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m7       [0m | 4/4   | P1, P1, P1, A1          | M:0 V:0 U:0 S:4           |
|----------|-------|-------------------------|---------------------------|
| [32m8       [0m | 2/3   | M1 M1, A0               | M:0 V:2 U:0 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m9       [0m | 3/3   | P1, P1 A1               | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m10      [0m | 3/3   | M1, M1, C1              | M:0 V:0 U:0 S:3           |
|----------|-------|-------------------------|---------------------------|
| [32m11      [0m | 5/5   | M1 M1 A1, C1, C1        | M:0 V:1 U:2 S:0           |
| [90m  a     [0m | 1     | M1 M1 A1                | M:0 V:1 U:0 S:0           |
| [90m  b     [0m | 2     | C1, C1                  | M:0 V:0 U:2 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m12      [0m | 2/2   | B2                      | M:0 V:1 U:0 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m13      [0m | 2/2   | M1, A1                  | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m14      [0m | 4/4   | P1, P1, P1, A1          | M:0 V:0 U:3 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m15      [0m | 6/6   | B1, M1 A1, M1 M1, A1    | M:0 V:0 U:4 S:0           |
| [90m  a     [0m | 1     | B1                      | M:0 V:0 U:1 S:0           |
| [90m  b     [0m | 1     | M1 A1                   | M:0 V:0 U:1 S:0           |
| [90m  c     [0m | 2     | M1 M1, A1               | M:0 V:0 U:2 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m16      [0m | 5/5   | B1, M1 A1, M1 A1        | M:0 V:0 U:0 S:3           |
| [90m  a     [0m | 1     | B1                      | M:0 V:0 U:0 S:1           |
| [90m  b     [0m | 1     | M1 A1                   | M:0 V:0 U:0 S:1           |
| [90m  c     [0m | 1     | M1 A1                   | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m17      [0m | 3/3   | M1, M1 A1               | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m18      [0m | 5/5   | P1, P1, P1, P1, A1      | M:0 V:0 U:5 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m19      [0m | 3/3   | B1, M1, A1              | M:0 V:0 U:0 S:3           |
|----------|-------|-------------------------|---------------------------|
| [32m20      [0m | 5/7   | P1, A1, P1, P1, A1      | M:0 V:0 U:0 S:5           |
| [90m  a     [0m | 2     | P1, A1                  | M:0 V:0 U:0 S:2           |
| [90m  b     [0m | 3     | P1, P1, A1              | M:0 V:0 U:0 S:3           |
|----------|-------|-------------------------|---------------------------|
| [32m21      [0m | 4/4   | P1, P1, C1, P1          | M:0 V:0 U:1 S:3           |
|----------|-------|-------------------------|---------------------------|

=== PERFORMANCE SUMMARY ===
Total Processing Time: 73.8s
Model Used: gemini-2.0-flash
----------------------------
classification                      27.8s (38%)
marking                             18.2s (25%)
question_detection                  8.4s (11%)
output_generation                   6.4s (9%)
ocr_processing                      6.0s (8%)
preprocessing                       4.7s (6%)
performance_summary                 0.8s (1%)
database_persistence                0.3s (0%)
============================


ğŸ“Š [UsageTracker] Summary:
   Model: gemini-2.0-flash
   API Requests: 23 total
   Total Tokens: 148,887 (137,712 in + 11,175 out)
   Total Cost: $0.101312
   Mathpix OCR: 21 pages â†’ $0.084000

   Breakdown by Phase:
   â€¢ Mapper (Map Pass): 7,067 tokens (1 requests) â†’ $0.000929
   â€¢ Classification (Marking Pass): 139,507 tokens (21 requests) â†’ $0.017060
   â€¢ Performance Summary: 2,313 tokens (1 requests) â†’ $0.000252


ğŸ ========== UNIFIED PIPELINE END ==========
ğŸ ==========================================

âœ… [CONTROLLER] Pipeline completed, result exists: true, sessionId: sub-1768638601410
ğŸ’³ [CREDIT DEDUCT] Starting deduction for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, sessionId: sub-1768638601410
ğŸ’³ [CREDIT DEDUCT] Incremental cost from tracker: 0.10131190000000001
ğŸ” [SUBJECT EXTRACTION] examPapers[0].subject = "Mathematics"
ğŸ’³ Deducted 10.13 credits from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2 (session: sub-1768638601410), remaining: 9.61
ğŸ’³ Deducted 0.1013 credits (session: sub-1768638601410) from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2
âœ… [SUBJECT MARKING RESULT] Persisted marking result for subject: Mathematics, session: sub-1768638601410
