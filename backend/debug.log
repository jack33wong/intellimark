
> ai-marking-backend@1.0.0 dev
> cross-env NODE_OPTIONS=--no-deprecation nodemon --exec tsx --tsconfig tsconfig.dev.json server.ts

üë§ [PLAN CHECK] User 9mBfvniXTuMtQU8f0OnLhUK6aOv2 is on plan: ultra
üì° [MARKING] Processing POST /api/marking/process (hasRawBody: false)
üöÄ [MARKING] Controller started - Files: 3, Body Keys: model, aiMessageId
üîç [CREDIT DEBUG] userId: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, isAuthenticated: true
üí≥ [CREDIT CHECK] Starting credit check for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2
üí≥ [CREDIT CHECK] Estimated cost: 0.15630170000000002, files: 3, bytes: 1413017
üí≥ [CREDIT CHECK] Result: {"canProceed":true,"remaining":570.27}

üîÑ ========== UNIFIED PIPELINE START ==========
üîÑ ============================================

[1m[32m‚úÖ [INPUT VALIDATION][0m [1mCOMPLETED[0m in [1m0.0s[0m ([32m[1mVALIDATION[0m)
[INPUT TYPE] Detected: Multiple Images (3 files)
[1m[32m‚úÖ [PREPROCESSING][0m [1mCOMPLETED[0m in [1m0.4s[0m ([32m[1mIMAGE-PROCESSING[0m)
[MAPPER] Using model: gemini-2.0-flash
[MAPPER] Starting Map Pass for 3 pages...
   üì¶ [MAPPER-BUCKET] Processing pages 0 to 2...

üîç [MAPPER AUDIT] Batch of 3 images:
   ‚úÖ Mapped Local[0] -> Global[0] | Content: 11c, 11d
   ‚úÖ Mapped Local[1] -> Global[1] | Content: 21
   ‚úÖ Mapped Local[2] -> Global[2] | Content: 11a, 11b
‚úÖ [MAPPER] Map Pass complete in 2.33s. Mapped 3 pages.
[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m9.0s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
üöÄ [OVERRIDE] 50% Rule Triggered: 3/3 pages have student work. Overriding all questionOnly pages to questionAnswer for consistency.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîÄ [PERFECT SPLIT] Building standalone structures with re-indexing
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üéØ [MODE ROUTING] Pure marking mode

‚úÖ Perfect split complete - each mode has consecutive 0-based indices
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m9.0s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
üîç [MODE DETECTION] Analysis (AFTER overrides):
  - All question-only: false
  - Has mixed content: false
  - Has any student work: true
  - Selected mode: Marking Mode
[1m[32m‚úÖ [OCR PROCESSING][0m [1mCOMPLETED[0m in [1m1.8s[0m ([32m[1mMATHPIX[0m)

üîç [DETECTION CONTEXT]
   Strategy: Global Search
   Pool Size: 108 papers, 2709 total question candidates
------------------------------------------------------------------------------------------------------------------------------------

üìã [DETECTION AUDIT REPORT]
------------------------------------------------------------------------------------------------------------------------------------
| Q#   | Input Text (Fragment)                       | Match Result / Paper Title                         | Score | Status        |
------------------------------------------------------------------------------------------------------------------------------------
| 11   | The frequency table gives information abou... | Edexcel GCSE 1MA1/2H June 2024 Q11                 | 0.994 | [32m‚úÖ SUCCESS[0m      |
| 11c  | Use your graph to find an estimate for the... | Edexcel GCSE 1MA1/2H June 2024 Q11                 | 0.994 | [32m‚úÖ SUCCESS[0m      |
| 11d  | Use your graph to find an estimate for the... | Edexcel GCSE 1MA1/2H June 2024 Q11                 | 0.994 | [32m‚úÖ SUCCESS[0m      |
| 11a  | Complete the cumulative frequency table.      | Edexcel GCSE 1MA1/2H June 2024 Q11                 | 0.994 | [32m‚úÖ SUCCESS[0m      |
| 11b  | On the grid opposite, draw a cumulative fr... | Edexcel GCSE 1MA1/2H June 2024 Q11                 | 0.994 | [32m‚úÖ SUCCESS[0m      |
| 21   | The graph of y = g(x) is shown on the grid... | Edexcel GCSE 1MA1/2H June 2024 Q21                 | 1.000 | [32m‚úÖ SUCCESS[0m      |
------------------------------------------------------------------------------------------------------------------------------------


üìä [QUESTION DETECTION STATISTICS]
   Total questions: 6
   Detected: 6/6
   Not detected: 0
   [HINT] Hint Used: "Global Search"
   [HINT] Matched Papers: 108
[1m[32m‚úÖ [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m1.2s[0m ([32m[1mQUESTION-DETECTION[0m)

üîÑ [RE-INDEXING] üõ°Ô∏è Aligning physical pages...
üïµÔ∏è [PROBE] Q11 | sourceImageIndex: 0 | text: The frequency table gives info...
   ‚öñÔ∏è [PAGE-WEIGHT] Page 0: Weights=[11:11, 11c:11.03, 11d:11.04] -> Selected: 11.03
   ‚öñÔ∏è [PAGE-WEIGHT] Page 1: Weights=[21:21] -> Selected: 21
   ‚öñÔ∏è [PAGE-WEIGHT] Page 2: Weights=[11:11, 11a:11.01, 11b:11.02] -> Selected: 11.01
üîç [RE-INDEX DEBUG] Sorting Decision Matrix:
-----------------------------------------------------------------------------------------
| OrigIdx | Filename             | IsMeta | MinQ   | Detected Qs                        |
-----------------------------------------------------------------------------------------
| 0       | new doc 2025-11-23 1 | false  | 11.03  | 11, 11c, 11d                       |
| 1       | new doc 2025-11-23 1 | false  | 21     | 21                                 |
| 2       | new doc 2025-11-23 1 | false  | 11.01  | 11, 11a, 11b                       |
-----------------------------------------------------------------------------------------

üöÄ [SORT-RESULT] Final Logical Order:
-----------------------------------------------------------------------------------------
| Seq 0 | OrigIdx 2 | isMeta: false | minQ: 11.01 |
| Seq 1 | OrigIdx 0 | isMeta: false | minQ: 11.03 |
| Seq 2 | OrigIdx 1 | isMeta: false | minQ: 21 |
-----------------------------------------------------------------------------------------
‚úÖ [RE-INDEXING] Completed. Pages have been straightened into Logical Order.
‚úÖ [RE-INDEXING] Deep Pointer Update Complete. Lines now point to new physical pages.

üîÑ [OCR RE-ID] Regenerating Global Block IDs to match new Page Indices...
‚úÖ [OCR RE-ID] Completed. Blocks are now synchronized with physical pages.
‚úÖ [DIMENSIONS REBUILD] Map refreshed for 3 re-indexed pages.
[1m[32m‚úÖ [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m1.2s[0m ([32m[1mQUESTION-DETECTION[0m)
[1m[32m‚úÖ [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m1.2s[0m ([32m[1mQUESTION-DETECTION[0m)
üîç [DIMENSIONS DEBUG] Pages: 3
üîç [DIMENSIONS DEBUG] Map Size: 3
üõ°Ô∏è [UNIT-SYNC] Q11 Source: undefined | Raw Y: 69.93 | Forced Unit: percentage
üõ°Ô∏è [UNIT-SYNC] Q11 Source: undefined | Raw Y: 69.93 | Forced Unit: percentage
üõ°Ô∏è [UNIT-SYNC] Q11 Source: undefined | Raw Y: 70.23 | Forced Unit: percentage
üõ°Ô∏è [UNIT-SYNC] Q11 Source: undefined | Raw Y: 84.33 | Forced Unit: percentage
üõ°Ô∏è [UNIT-SYNC] Q11 Source: undefined | Raw Y: 84.33 | Forced Unit: percentage
üõ°Ô∏è [UNIT-SYNC] Q11 Source: undefined | Raw Y: 45.93 | Forced Unit: percentage
üõ°Ô∏è [UNIT-SYNC] Q11 Source: undefined | Raw Y: 52.23 | Forced Unit: percentage
üõ°Ô∏è [UNIT-SYNC] Q11 Source: undefined | Raw Y: 58.53 | Forced Unit: percentage
üõ°Ô∏è [UNIT-SYNC] Q11 Source: undefined | Raw Y: 64.83 | Forced Unit: percentage
üõ°Ô∏è [UNIT-SYNC] Q11 Source: undefined | Raw Y: 71.13 | Forced Unit: percentage

üì¶ [ZONE-EVIDENCE] FINAL UPSTREAM ZONES:
   ‚úÖ 21     | P2 | Y:  187 (8.1%) to 2159 | X: 98 (Margin: 5.9%) | W: 1452
   ‚úÖ 11a    | P0 | Y:  128 (6.0%) to 1253 | X: 90 (Margin: 5.9%) | W: 1336
   ‚úÖ 11b    | P0 | Y: 1253 (58.4%) to 2016 | X: 90 (Margin: 5.9%) | W: 1336
   ‚úÖ 11b    | P1 | Y:  138 (6.0%) to 1279 | X: 97 (Margin: 6.0%) | W: 1430
   ‚úÖ 11c    | P1 | Y: 1279 (55.6%) to 1592 | X: 97 (Margin: 6.0%) | W: 1430
   ‚úÖ 11d    | P1 | Y: 1592 (69.2%) to 2162 | X: 97 (Margin: 6.0%) | W: 1430
-------------------------------------------

[1m[32müîÑ [AI MARKING][0m [1mSTARTING...[0m
üïµÔ∏è [COORDS-IDENTITY] Q21 OCR Pool Sample (Block 0): {"line_id":"visual_drawing_21_2","relative_line_id":"visual_drawing_21_2","pageIndex":2,"globalBlockId":"drawing_21_2","text":"[DRAWING]","lineId":"visual_drawing_21_2","cleanedText":"[DRAWING]","bbox":[0,0,100,50],"ocrSource":"classification","isHandwritten":true,"unit":"percentage","subQuestionLabel":"main","_source":"CLASSIFICATION","hasLineData":false,"isSplitBlock":false}
üïµÔ∏è [COORDS-IDENTITY] Q21 OCR Pool (6 blocks):
   - ID: p2_ocr_0     | Coords: [183,187,622,44]          | Text: "21 The graph of \( y=\mathrm{g" | S:false L:true
   - ID: p2_ocr_1     | Coords: [230,1274,586,48]         | Text: "On the grid, draw the graph of" | S:false L:true
   - ID: p2_ocr_2     | Coords: [676,1787,355,41]         | Text: "Turn over for Question 22" | S:false L:true
   - ID: p2_ocr_3     | Coords: [1460,2095,43,32]         | Text: "23" | S:false L:true
   - ID: p2_ocr_4     | Coords: [1363,2138,174,38]        | Text: "Turn over -" | S:false L:true
üéØ [ZONE-MATCH] Target: 21 | Key: 21 (Normalized: 21) | MATCHED!
üéØ [ZONE-MATCH] Target: 21 | Key: 21 (Normalized: 21) | MATCHED!
üõ°Ô∏è [11b-FIX] Q21 | IntentY: 1148 | Floor: 1469 | ResultY: 803
üõ°Ô∏è [DESIGN-RESCUE] Q21 | Status: VISUAL | IntentY: 1148px -> SnappedY: 803px
üõ°Ô∏è [ENRICH-AUTHORITY] 21 | Status: VISUAL | Snapped: [494, 803]px
üéØ [ZONE-MATCH] Target: 21 | Key: 21 (Normalized: 21) | MATCHED!
üéØ [ZONE-MATCH] Target: 21 | Key: 21 (Normalized: 21) | MATCHED!
üõ°Ô∏è [11b-FIX] Q21 | IntentY: 1148 | Floor: 1469 | ResultY: 803
üõ°Ô∏è [DESIGN-RESCUE] Q21 | Status: VISUAL | IntentY: 1148px -> SnappedY: 803px
üõ°Ô∏è [ENRICH-AUTHORITY] 21 | Status: VISUAL | Snapped: [577, 803]px
üéØ [ZONE-MATCH] Target: 21 | Key: 21 (Normalized: 21) | MATCHED!
üéØ [ZONE-MATCH] Target: 21 | Key: 21 (Normalized: 21) | MATCHED!
 üíé [BUDGET-CHECK] Q21: Max Marks = 2. Items to Process: 2
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_q11_line_6 -> p0_q11_line_6 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_q11_line_6 -> p0_q11_line_6 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_ocr_15 -> p0_ocr_15 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_q11_line_7 -> p0_q11_line_7 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_q11_line_7 -> p0_q11_line_7 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_ocr_18 -> p0_ocr_18 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_q11_line_8 -> p0_q11_line_8 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_q11_line_8 -> p0_q11_line_8 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_ocr_21 -> p0_ocr_21 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_q11_line_9 -> p0_q11_line_9 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_q11_line_9 -> p0_q11_line_9 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_ocr_24 -> p0_ocr_24 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_q11_line_10 -> p0_q11_line_10 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_q11_line_10 -> p0_q11_line_10 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_ocr_27 -> p0_ocr_27 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_visual_drawing_11_12 -> p0_visual_drawing_11_12 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_visual_drawing_11_12 -> p0_visual_drawing_11_12 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_visual_drawing_11_12 -> p0_visual_drawing_11_12 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p1_visual_drawing_11_12 -> p0_visual_drawing_11_12 (Rel: 1, Phys: 0)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_q11_line_1 -> p1_q11_line_1 (Rel: 0, Phys: 1)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_q11_line_1 -> p1_q11_line_1 (Rel: 0, Phys: 1)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_ocr_2 -> p1_ocr_2 (Rel: 0, Phys: 1)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_q11_line_2 -> p1_q11_line_2 (Rel: 0, Phys: 1)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_q11_line_2 -> p1_q11_line_2 (Rel: 0, Phys: 1)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_ocr_3 -> p1_ocr_3 (Rel: 0, Phys: 1)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_q11_line_4 -> p1_q11_line_4 (Rel: 0, Phys: 1)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_q11_line_4 -> p1_q11_line_4 (Rel: 0, Phys: 1)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_ocr_8 -> p1_ocr_8 (Rel: 0, Phys: 1)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_q11_line_5 -> p1_q11_line_5 (Rel: 0, Phys: 1)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_q11_line_5 -> p1_q11_line_5 (Rel: 0, Phys: 1)
 ‚úÖ [ADAPTER-RESTORE] Mapped ID p0_ocr_9 -> p1_ocr_9 (Rel: 0, Phys: 1)
 üõ°Ô∏è [TRUTH-EXTRACT] Found ground truth P0 from ID: "p0_q11_line_6"
 üõ°Ô∏è [TRUTH-EXTRACT] Found ground truth P0 from ID: "p0_q11_line_7"
 üõ°Ô∏è [TRUTH-EXTRACT] Found ground truth P0 from ID: "p0_q11_line_8"
 üõ°Ô∏è [TRUTH-EXTRACT] Found ground truth P0 from ID: "p0_q11_line_9"
 üõ°Ô∏è [TRUTH-EXTRACT] Found ground truth P0 from ID: "p0_q11_line_10"
 üõ°Ô∏è [TRUTH-EXTRACT] Found ground truth P0 from ID: "p0_visual_drawing_11_12"
 üõ°Ô∏è [TRUTH-EXTRACT] Found ground truth P0 from ID: "p0_visual_drawing_11_12"
 üõ°Ô∏è [TRUTH-EXTRACT] Found ground truth P1 from ID: "p1_q11_line_1"
 üõ°Ô∏è [TRUTH-EXTRACT] Found ground truth P1 from ID: "p1_q11_line_2"
 üõ°Ô∏è [TRUTH-EXTRACT] Found ground truth P1 from ID: "p1_q11_line_4"
 üõ°Ô∏è [TRUTH-EXTRACT] Found ground truth P1 from ID: "p1_q11_line_5"
 üïµÔ∏è [LINKER-INPUT-DEBUG-FINAL] p0_ocr_0 Content: "11 The frequency table gives information about the weights of 60 parcels. [PRINTED_INSTRUCTION [Q11]]"
 üïµÔ∏è [LINKER-INPUT-DEBUG-FINAL] p0_ocr_0 Has Tag? true
üïµÔ∏è [COORDS-IDENTITY] Q11 OCR Pool Sample (Block 0): {"line_id":"p0_q11_line_6","relative_line_id":"p0_q11_line_6","pageIndex":0,"globalBlockId":"p0_q11_line_6","text":"7","lineId":"p0_q11_line_6","cleanedText":"7","bbox":[49.58,45.93,2.5,3.83],"ocrSource":"classification","isHandwritten":true,"unit":"percentage","subQuestionLabel":"a","_source":"CLASSIFICATION","hasLineData":false,"isSplitBlock":false}
üïµÔ∏è [COORDS-IDENTITY] Q11 OCR Pool (66 blocks):
   - ID: p0_q11_line_6 | Coords: [49.58,45.93,2.5,3.83]    | Text: "7" | S:false L:false
   - ID: p0_q11_line_7 | Coords: [49.58,52.23,4.58,4.03]   | Text: "28" | S:false L:false
   - ID: p0_q11_line_8 | Coords: [49.58,58.53,4.58,4.03]   | Text: "43" | S:false L:false
   - ID: p0_q11_line_9 | Coords: [49.58,64.83,4.58,4.03]   | Text: "54" | S:false L:false
   - ID: p0_q11_line_10 | Coords: [49.58,71.13,4.58,4.03]   | Text: "60" | S:false L:false
   - ID: p1_q11_line_1 | Coords: [32.53,69.93,13.06,4.03]  | Text: "6.4-3" | S:false L:false
   - ID: p1_q11_line_2 | Coords: [73.06,69.93,7.06,4.03]   | Text: "3.4" | S:false L:false
   - ID: p1_q11_line_3 | Coords: [83.06,70.23,3.53,3.43]   | Text: "kg" | S:false L:false
   - ID: p1_q11_line_4 | Coords: [53.53,84.33,12.06,4.03]  | Text: "60-51" | S:false L:false
   - ID: p1_q11_line_5 | Coords: [73.53,84.33,3.06,4.03]   | Text: "9" | S:false L:false
   - ID: p1_ocr_2     | Coords: [888,1358,143,69]         | Text: "6.4-3" | S:false L:true
   - ID: p1_ocr_3     | Coords: [1197,1439,117,79]        | Text: "3.4" | S:false L:true
   - ID: p1_ocr_8     | Coords: [1055,1662,431,87]        | Text: "60-51" | S:true L:false
   - ID: p1_ocr_9     | Coords: [1055,1749,431,87]        | Text: "9" | S:true L:false
   - ID: p0_ocr_15    | Coords: [825,841,35,48]           | Text: "7" | S:false L:true
   - ID: p0_ocr_18    | Coords: [811,912,66,56]           | Text: "28" | S:false L:true
   - ID: p0_ocr_21    | Coords: [801,977,78,63]           | Text: "43" | S:false L:true
   - ID: p0_ocr_24    | Coords: [803,1044,76,56]          | Text: "54" | S:false L:true
   - ID: p0_ocr_27    | Coords: [810,1108,69,53]          | Text: "60" | S:false L:true
   - ID: p1_ocr_0     | Coords: [86,917,38,335]           | Text: "OT WRITE IN THIS AREA" | S:false L:true
   - ID: p1_ocr_1     | Coords: [219,1279,811,42]         | Text: "(c) Use your graph to find an " | S:false L:true
   - ID: p1_ocr_2     | Coords: [888,1358,143,69]         | Text: "6.4-3" | S:false L:true
   - ID: p1_ocr_3     | Coords: [1197,1439,117,79]        | Text: "3.4" | S:false L:true
   - ID: p1_ocr_4     | Coords: [1438,1491,43,44]         | Text: "kg" | S:false L:true
   - ID: p1_ocr_5     | Coords: [1322,1535,47,35]         | Text: "(2)" | S:false L:true
   - ID: p1_ocr_6     | Coords: [219,1592,1048,38]        | Text: "(d) Use your graph to find an " | S:false L:true
   - ID: p1_ocr_7     | Coords: [273,1628,239,38]         | Text: "greater than 7.4 kg ." | S:false L:true
   - ID: p1_ocr_8     | Coords: [1055,1662,431,87]        | Text: "60-51" | S:true L:false
   - ID: p1_ocr_9     | Coords: [1055,1749,431,87]        | Text: "9" | S:true L:false
   - ID: p1_ocr_10    | Coords: [1326,1836,43,40]         | Text: "(2)" | S:false L:true
   - ID: p1_ocr_11    | Coords: [1427,2095,36,33]         | Text: "13" | S:false L:true
   - ID: p1_ocr_12    | Coords: [1326,2138,171,36]        | Text: "Turn over -" | S:false L:true
   - ID: p0_ocr_0     | Coords: [131,154,879,42]          | Text: "11 The frequency table gives i" | S:false L:true
   - ID: p0_ocr_1     | Coords: [506,223,491,60.285714285714285] | Text: "\begin{tabular}{|c|c|}
\hline " | S:true L:false
   - ID: p0_ocr_2     | Coords: [506,283.2857142857143,491,60.285714285714285] | Text: "\hline \( 0<w \leqslant 2 \) &" | S:true L:false
   - ID: p0_ocr_3     | Coords: [506,343.57142857142856,491,60.285714285714285] | Text: "\hline \( 2<w \leqslant 4 \) &" | S:true L:false
   - ID: p0_ocr_4     | Coords: [506,403.8571428571429,491,60.285714285714285] | Text: "\hline \( 4<w \leqslant 6 \) &" | S:true L:false
   - ID: p0_ocr_5     | Coords: [506,464.1428571428571,491,60.285714285714285] | Text: "\hline \( 6<w \leqslant 8 \) &" | S:true L:false
   - ID: p0_ocr_6     | Coords: [506,524.4285714285714,491,60.285714285714285] | Text: "\hline \( 8<w \leqslant 10 \) " | S:true L:false
   - ID: p0_ocr_7     | Coords: [506,584.7142857142858,491,60.285714285714285] | Text: "\hline
\end{tabular}" | S:true L:false
   - ID: p0_ocr_8     | Coords: [171,687,544,42]          | Text: "(a) Complete the cumulative fr" | S:false L:true
   - ID: p0_ocr_9     | Coords: [456,757,584,59.857142857142854] | Text: "\begin{tabular}{|l|l|}
\hline " | S:true L:false
   - ID: p0_ocr_10    | Coords: [492,784,174,35]          | Text: "Weight ( \( w \mathrm{~kg} \) " | S:false L:true
   - ID: p0_ocr_11    | Coords: [729,784,278,35]          | Text: "Cumulative frequency" | S:false L:true
   - ID: p0_ocr_12    | Coords: [456,816.8571428571429,584,59.857142857142854] | Text: "\hline \( 0<w \leqslant 2 \) &" | S:true L:false
   - ID: p0_ocr_13    | Coords: [456,876.7142857142857,584,59.857142857142854] | Text: "\hline \( 0<w \leqslant 4 \) &" | S:true L:false
   - ID: p0_ocr_14    | Coords: [516,855,130,32]          | Text: "\( 0<w \leqslant 2 \)" | S:false L:true
   - ID: p0_ocr_15    | Coords: [825,841,35,48]           | Text: "7" | S:false L:true
   - ID: p0_ocr_16    | Coords: [456,936.5714285714286,584,59.857142857142854] | Text: "\hline \( 0<w \leqslant 6 \) &" | S:true L:false
   - ID: p0_ocr_17    | Coords: [516,922,130,33]          | Text: "\( 0<w \leqslant 4 \)" | S:false L:true
   - ID: p0_ocr_18    | Coords: [811,912,66,56]           | Text: "28" | S:false L:true
   - ID: p0_ocr_19    | Coords: [456,996.4285714285714,584,59.857142857142854] | Text: "\hline \( 0<w \leqslant 8 \) &" | S:true L:false
   - ID: p0_ocr_20    | Coords: [516,990,130,32]          | Text: "\( 0<w \leqslant 6 \)" | S:false L:true
   - ID: p0_ocr_21    | Coords: [801,977,78,63]           | Text: "43" | S:false L:true
   - ID: p0_ocr_22    | Coords: [456,1056.2857142857142,584,59.857142857142854] | Text: "\hline \( 0<w \leqslant 10 \) " | S:true L:false
   - ID: p0_ocr_23    | Coords: [516,1058,130,32]         | Text: "\( 0<w \leqslant 8 \)" | S:false L:true
   - ID: p0_ocr_24    | Coords: [803,1044,76,56]          | Text: "54" | S:false L:true
   - ID: p0_ocr_25    | Coords: [456,1116.142857142857,584,59.857142857142854] | Text: "\hline
\end{tabular}" | S:true L:false
   - ID: p0_ocr_26    | Coords: [516,1125,143,32]         | Text: "\( 0<w \leqslant 10 \)" | S:false L:true
   - ID: p0_ocr_27    | Coords: [810,1108,69,53]          | Text: "60" | S:false L:true
   - ID: p0_ocr_28    | Coords: [1219,1196,41,35]         | Text: "(1)" | S:false L:true
   - ID: p0_ocr_29    | Coords: [174,1253,886,38]         | Text: "(b) On the grid opposite, draw" | S:false L:true
   - ID: p0_ocr_30    | Coords: [1216,1286,44,34]         | Text: "(2)" | S:false L:true
   - ID: p0_ocr_31    | Coords: [136,1935,45,31]          | Text: "12" | S:false L:true
üéØ [ZONE-MATCH] Target: 11a | Key: 11a (Normalized: 11a) | MATCHED!
üõ°Ô∏è [11b-FIX] Q11a | IntentY: 0 | Floor: 1253 | ResultY: 184
üõ°Ô∏è [DESIGN-RESCUE] Q11a | Status: MATCHED | IntentY: 0px -> SnappedY: 841px
üõ°Ô∏è [ENRICH-AUTHORITY] 11a | Status: MATCHED | Snapped: [825, 841]px
üéØ [ZONE-MATCH] Target: 11a | Key: 11a (Normalized: 11a) | MATCHED!
üõ°Ô∏è [11b-FIX] Q11a | IntentY: 0 | Floor: 1253 | ResultY: 184
üõ°Ô∏è [DESIGN-RESCUE] Q11a | Status: MATCHED | IntentY: 0px -> SnappedY: 912px
üõ°Ô∏è [ENRICH-AUTHORITY] 11a | Status: MATCHED | Snapped: [811, 912]px
üéØ [ZONE-MATCH] Target: 11a | Key: 11a (Normalized: 11a) | MATCHED!
üõ°Ô∏è [11b-FIX] Q11a | IntentY: 0 | Floor: 1253 | ResultY: 184
üõ°Ô∏è [DESIGN-RESCUE] Q11a | Status: MATCHED | IntentY: 0px -> SnappedY: 977px
üõ°Ô∏è [ENRICH-AUTHORITY] 11a | Status: MATCHED | Snapped: [801, 977]px
üéØ [ZONE-MATCH] Target: 11a | Key: 11a (Normalized: 11a) | MATCHED!
üõ°Ô∏è [11b-FIX] Q11a | IntentY: 0 | Floor: 1253 | ResultY: 184
üõ°Ô∏è [DESIGN-RESCUE] Q11a | Status: MATCHED | IntentY: 0px -> SnappedY: 1044px
üõ°Ô∏è [ENRICH-AUTHORITY] 11a | Status: MATCHED | Snapped: [803, 1044]px
üéØ [ZONE-MATCH] Target: 11a | Key: 11a (Normalized: 11a) | MATCHED!
üõ°Ô∏è [11b-FIX] Q11a | IntentY: 0 | Floor: 1253 | ResultY: 184
üõ°Ô∏è [DESIGN-RESCUE] Q11a | Status: MATCHED | IntentY: 0px -> SnappedY: 1108px
üõ°Ô∏è [ENRICH-AUTHORITY] 11a | Status: MATCHED | Snapped: [810, 1108]px
üéØ [ZONE-MATCH] Target: 11b | Key: 11b (Normalized: 11b) | MATCHED!
üéØ [ZONE-MATCH] Target: 11b | Key: 11b (Normalized: 11b) | MATCHED!
üõ°Ô∏è [11b-FIX] Q11b | IntentY: 1072 | Floor: 1802 | ResultY: 1291
üõ°Ô∏è [DESIGN-RESCUE] Q11b | Status: VISUAL | IntentY: 1072px -> SnappedY: 1291px
üõ°Ô∏è [ENRICH-AUTHORITY] 11b | Status: VISUAL | Snapped: [682, 1291]px
üéØ [ZONE-MATCH] Target: 11b | Key: 11b (Normalized: 11b) | MATCHED!
üéØ [ZONE-MATCH] Target: 11b | Key: 11b (Normalized: 11b) | MATCHED!
üõ°Ô∏è [11b-FIX] Q11b | IntentY: 1072 | Floor: 1802 | ResultY: 1291
üõ°Ô∏è [DESIGN-RESCUE] Q11b | Status: VISUAL | IntentY: 1072px -> SnappedY: 1291px
üõ°Ô∏è [ENRICH-AUTHORITY] 11b | Status: VISUAL | Snapped: [758, 1291]px
üéØ [ZONE-MATCH] Target: 11c | Key: 11c (Normalized: 11c) | MATCHED!
üõ°Ô∏è [11b-FIX] Q11c | IntentY: 0 | Floor: 1592 | ResultY: 1295
üõ°Ô∏è [DESIGN-RESCUE] Q11c | Status: MATCHED | IntentY: 0px -> SnappedY: 1358px
üõ°Ô∏è [ENRICH-AUTHORITY] 11c | Status: MATCHED | Snapped: [888, 1358]px
üéØ [ZONE-MATCH] Target: 11c | Key: 11c (Normalized: 11c) | MATCHED!
üõ°Ô∏è [11b-FIX] Q11c | IntentY: 0 | Floor: 1592 | ResultY: 1295
üõ°Ô∏è [DESIGN-RESCUE] Q11c | Status: MATCHED | IntentY: 0px -> SnappedY: 1439px
üõ°Ô∏è [ENRICH-AUTHORITY] 11c | Status: MATCHED | Snapped: [1197, 1439]px
üéØ [ZONE-MATCH] Target: 11d | Key: 11d (Normalized: 11d) | MATCHED!
üõ°Ô∏è [11b-FIX] Q11d | IntentY: 0 | Floor: 2162 | ResultY: 1621
üõ°Ô∏è [DESIGN-RESCUE] Q11d | Status: MATCHED | IntentY: 0px -> SnappedY: 1662px
üõ°Ô∏è [ENRICH-AUTHORITY] 11d | Status: MATCHED | Snapped: [1055, 1662]px
üéØ [ZONE-MATCH] Target: 11d | Key: 11d (Normalized: 11d) | MATCHED!
üõ°Ô∏è [11b-FIX] Q11d | IntentY: 0 | Floor: 2162 | ResultY: 1621
üõ°Ô∏è [DESIGN-RESCUE] Q11d | Status: MATCHED | IntentY: 0px -> SnappedY: 1749px
üõ°Ô∏è [ENRICH-AUTHORITY] 11d | Status: MATCHED | Snapped: [1055, 1749]px
üéØ [ZONE-MATCH] Target: 11b | Key: 11b (Normalized: 11b) | MATCHED!
üéØ [ZONE-MATCH] Target: 11b | Key: 11b (Normalized: 11b) | MATCHED!
 üíé [BUDGET-CHECK] Q11a: Max Marks = 99. Items to Process: 5
 üíé [BUDGET-CHECK] Q11c: Max Marks = 99. Items to Process: 2
 üíé [BUDGET-CHECK] Q11d: Max Marks = 99. Items to Process: 2
 üíé [BUDGET-CHECK] Q11b: Max Marks = 99. Items to Process: 2
[GUILLOTINE] Q11a exceeded budget! Kept 1/5, Budget 1.
[1m[32m‚úÖ [AI MARKING][0m [1mCOMPLETED[0m in [1m11.1s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
[1m[32m‚úÖ [MARKING][0m [1mCOMPLETED[0m in [1m11.1s[0m ([32m[1mAI-MARKING[0m)

üîç [RESULT VERIFICATION] Checking what will be combined:
   üìä Marking Results: 2 questions
   üìù Question Results: NO
   ‚úÖ Both modes triggered: NO
üé® [BURN-SYNC] Scale Locked at 1.000 (Absolute Pixel Mode)
üé® [BURN-AUTHORITY] Drawing B1 | SnappedY: 841 | Scale: 1:1 (Centralized)
üé® [BURN-SYNC] Scale Locked at 1.000 (Absolute Pixel Mode)
üé® [BURN-AUTHORITY] Drawing C0 | SnappedY: 892.9000000000001 | Scale: 1:1 (Centralized)
üé® [BURN-SYNC] Scale Locked at 1.000 (Absolute Pixel Mode)
üé® [BURN-AUTHORITY] Drawing A1 | SnappedY: 1439 | Scale: 1:1 (Centralized)

‚úÖ [OUTPUT SERVICE] Final Page Order (Verified Content):
---------------------------------------------------------------------------------
| Seq | Index | Original Filename      | Content (Questions)                  |
---------------------------------------------------------------------------------
| [0] |  0    | new doc 2025-11-23 11. | 11a, 11b                             |
| [1] |  1    | new doc 2025-11-23 11. | 11b, 11c, 11d                        |
| [2] |  2    | new doc 2025-11-23 11. | 21                                   |
---------------------------------------------------------------------------------

[1m[32m‚úÖ [OUTPUT GENERATION][0m [1mCOMPLETED[0m in [1m2.2s[0m ([32m[1mOUTPUT-GENERATION[0m)
[V2 CLEAN FIX] üèóÔ∏è Building UI Structure directly from 2 Engine Results...
[V2 CLEAN FIX] ‚úÖ UI Structure ready (Strings preserved)
[1m[32m‚úÖ [PERFORMANCE SUMMARY AI][0m [1mCOMPLETED[0m in [1m0.8s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
[V2 CLEAN FIX] üèóÔ∏è Building UI Structure directly from 2 Engine Results...
[V2 CLEAN FIX] ‚úÖ UI Structure ready (Strings preserved)

üìä [ANNOTATION SUMMARY]
-----------------------------------------------------------------------------------------
| Q#       | Score | Marks Awarded           | Match Status (AI -> Final)             |
|----------|-------|-------------------------|----------------------------------------|
| [32m11      [0m | 7/7   | B1, A1, M1, A1, M1, A1, M1 | AI:5/7 ‚Üí M:3 S:2 U:0                   |
| [90m  a     [0m | 1     | B1                      | AI:1/1 ‚Üí M:1 S:0 U:0                   |
| [90m  b     [0m | 2     | A1, M1                  | AI:0/2 ‚Üí M:0 S:0 U:0                   |
| [90m  c     [0m | 2     | A1, M1                  | AI:2/2 ‚Üí M:2 S:0 U:0                   |
| [90m  d     [0m | 2     | A1, M1                  | AI:2/2 ‚Üí M:0 S:2 U:0                   |
|----------|-------|-------------------------|----------------------------------------|
| [32m21      [0m | 0/2   | C0, C0                  | AI:0/2 ‚Üí M:0 S:0 U:0                   |
|----------|-------|-------------------------|----------------------------------------|

=== PERFORMANCE SUMMARY ===
Total Processing Time: 27.7s
Model Used: gemini-2.0-flash
----------------------------
marking                             11.1s (40%)
classification                      9.0s (32%)
output_generation                   2.2s (8%)
ocr_processing                      1.8s (7%)
question_detection                  1.2s (4%)
performance_summary                 0.8s (3%)
preprocessing                       0.4s (1%)
database_persistence                0.2s (1%)
============================


üìä [UsageTracker] Summary:
   Model: gemini-2.0-flash
   API Requests: 6 total
   Total Tokens: 24,916 (21,278 in + 3,638 out)
   Total Cost: $0.015344
   Mathpix OCR: 3 pages ‚Üí $0.012000

   Breakdown by Phase:
   ‚Ä¢ Mapper (Map Pass): 1,876 tokens (1 requests) ‚Üí $0.000239
   ‚Ä¢ Classification (Marking Pass): 10,217 tokens (2 requests) ‚Üí $0.001406
   ‚Ä¢ Marking: 12,284 tokens (2 requests) ‚Üí $0.001869
   ‚Ä¢ Performance Summary: 539 tokens (1 requests) ‚Üí $0.000069


üèÅ ========== UNIFIED PIPELINE END ==========
üèÅ ==========================================

‚úÖ [CONTROLLER] Pipeline completed, result exists: true, sessionId: sub-1770571496331
üí≥ [CREDIT DEDUCT] Starting deduction for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, sessionId: sub-1770571496331
üí≥ [CREDIT DEDUCT] Incremental cost from tracker: 0.015343800000000001
üîç [SUBJECT EXTRACTION] examPapers[0].subject = "Mathematics"
üí≥ Deducted 1.53 credits from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2 (session: sub-1770571496331), remaining: 568.74
üí≥ Deducted 0.0153 credits (session: sub-1770571496331) from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2
‚úÖ [SUBJECT MARKING RESULT] Persisted marking result for subject: Mathematics, session: sub-1770571496331
