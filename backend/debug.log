
> ai-marking-backend@1.0.0 dev
> cross-env NODE_OPTIONS=--no-deprecation nodemon --exec tsx --tsconfig tsconfig.dev.json server.ts

‚úÖ Permissions configuration loaded from .env.local:
   - Analysis Plans: pro, ultra
   - Model Selection Plans: pro, ultra
‚úÖ Credit configuration loaded from .env.local (FAIL-FAST mode):
   - Conversion Rate: $0.01 per credit
   - Free Plan: 10 credits/month
   - Pro Plan: 200 credits/month
   - Ultra Plan: 600 credits/month
üí≥ Stripe initialized in TEST mode
üìö Swagger UI available at /api-docs
üë§ [PLAN CHECK] User 9mBfvniXTuMtQU8f0OnLhUK6aOv2 is on plan: ultra
üì° [MARKING] Processing POST /api/marking/process (hasRawBody: false)
üöÄ [MARKING] Controller started - Files: 1, Body Keys: model, aiMessageId
üîç [CREDIT DEBUG] userId: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, isAuthenticated: true
üí≥ [CREDIT CHECK] Starting credit check for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2
üí≥ [CREDIT CHECK] Estimated cost: 0.0449631, files: 1, bytes: 399631
üí≥ [CREDIT CHECK] Result: {"canProceed":true,"remaining":588.69}

üîÑ ========== UNIFIED PIPELINE START ==========
üîÑ ============================================

[1m[32m‚úÖ [INPUT VALIDATION][0m [1mCOMPLETED[0m in [1m0.0s[0m ([32m[1mVALIDATION[0m)
[INPUT TYPE] Detected: Single Image (1 files)
[1m[32m‚úÖ [PREPROCESSING][0m [1mCOMPLETED[0m in [1m0.4s[0m ([32m[1mIMAGE-PROCESSING[0m)
[MAPPER] Using model: gemini-2.0-flash
[MAPPER] Starting Map Pass for 1 pages...
‚úÖ [MAPPER] Map Pass complete in 1.74s. Mapped 1 pages.

[36m[CLASSIFICATION DEBUG] Q6 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "6",
          "text": "Tim has two biased coins, coin A and coin B.\nHe is going to throw both coins.\nThe probability that coin A will land on heads is 0.6\nThe probability that coin B will land on heads is 0.55",
          "hasStudentDrawing": true,
          "studentDrawingPosition": {
            "x": 26,
            "y": 29,
            "width": 50,
            "height": 35
          },
          "studentWorkLines": [],
          "subQuestions": [
            {
              "part": "a",
              "text": "Complete the probability tree diagram.",
              "hasStudentDrawing": true,
              "studentDrawingPosition": {
                "x": 26,
                "y": 29,
                "width": 50,
                "height": 35
              },
              "studentWorkLines": [
                {
                  "text": "0.4",
                  "position": {
                    "x": 32,
                    "y": 44,
                    "width": 5,
                    "height": 4
                  }
                },
                {
                  "text": "0.55",
                  "position": {
                    "x": 49,
                    "y": 40,
                    "width": 7,
                    "height": 4
                  }
                },
                {
                  "text": "0.45",
                  "position": {
                    "x": 49,
                    "y": 53,
                    "width": 7,
                    "height": 4
                  }
                },
                {
                  "text": "0.55",
                  "position": {
                    "x": 49,
                    "y": 40,
                    "width": 7,
                    "height": 4
                  }
                },
                {
                  "text": "0.45",
                  "position": {
                    "x": 49,
                    "y": 53,
                    "width": 7,
                    "height": 4
                  }
                }
              ]
            },
            {
              "part": "b",
              "text": "Tim throws coin A once and he throws coin B once.\nWork out the probability that both coins land on heads.",
              "studentWorkLines": [
                {
                  "text": "0.33",
                  "position": {
                    "x": 69,
                    "y": 76,
                    "width": 7,
                    "height": 5
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    }
  ]
}
[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m6.6s[0m ([32m[1mGEMINI-2.0-FLASH[0m)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîÄ [PERFECT SPLIT] Building standalone structures with re-indexing
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üéØ [MODE ROUTING] Pure marking mode

‚úÖ Perfect split complete - each mode has consecutive 0-based indices
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m6.6s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
üîç [MODE DETECTION] Analysis (AFTER overrides):
  - All question-only: false
  - Has mixed content: false
  - Has any student work: true
  - Selected mode: Marking Mode
[1m[32m‚úÖ [OCR PROCESSING][0m [1mCOMPLETED[0m in [1m2.5s[0m ([32m[1mMATHPIX[0m)
[DETECTION] Q6 -> Global search (Pool: 108 papers, 2709 candidates)
[31m[HINT] ‚ö†Ô∏è Hint Adherence Failed! Poor match density. Restarting...[0m
[DETECTION] Q6 -> Global search (Pool: 108 papers, 2709 candidates)
[DEBUG] smartEstimateMaxMarks processing text (len=38) for Q?
üìç [PIPELINE] Detected consensus paper: "General Question (No Past Paper Match)". Will use as hint for question-only pages.
[1m[32m‚úÖ [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m0.3s[0m ([32m[1mQUESTION-DETECTION[0m)

üîç [DETECTION CONTEXT]
   Strategy: Global Search
   Pool Size: 108 papers, 2709 total question candidates
------------------------------------------------------------------------------------------------------------------------------------

üìã [DETECTION AUDIT REPORT]
------------------------------------------------------------------------------------------------------------------------------------
| Q#   | Input Text (Fragment)                       | Match Result / Paper Title                         | Score | Status        |
------------------------------------------------------------------------------------------------------------------------------------
| 6a   | Complete the probability tree diagram.        | Unknown General Generic Question N/A Q6a           | 0.000 | [33m‚ö†Ô∏è  WEAK MATCH[0m |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.580] 1MA1/3H Q6                     | Txt:0.62 Num:0.00 Str:1.00 Sem:PASS
      ‚óã [0.479] 1MA1/3H Q6                     | Txt:0.40 Num:0.00 Str:1.00 Sem:PASS
      ‚óã [0.465] 1MA1/2F Q6                     | Txt:0.37 Num:0.00 Str:1.00 Sem:PASS
| 6b   | Tim throws coin A once and he throws coin ... | Unknown General Generic Question N/A Q6a           | 0.000 | [33m‚ö†Ô∏è  WEAK MATCH[0m |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.580] 1MA1/3H Q6                     | Txt:0.62 Num:0.00 Str:1.00 Sem:PASS
      ‚óã [0.479] 1MA1/3H Q6                     | Txt:0.40 Num:0.00 Str:1.00 Sem:PASS
      ‚óã [0.465] 1MA1/2F Q6                     | Txt:0.37 Num:0.00 Str:1.00 Sem:PASS
------------------------------------------------------------------------------------------------------------------------------------


üìä [QUESTION DETECTION STATISTICS]
   Total questions: 2
   Detected: 0/2
   Not detected: 2
   [HINT] Hint Used: "Global Search"
   [HINT] Matched Papers: 108
[DRAWING] Q6: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q6: Will pass image to Marking AI
[SPATIAL SHIELD] Applying Hybrid Shield for Q6...
[SHIELD] üõ°Ô∏è Analyzing Q6. Next Header "Q7" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q6...
[SHIELD] üõ°Ô∏è Analyzing Q6. Next Header "Q7" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
‚úÖ createMarkingTasksFromClassification completed, created 1 marking task(s)
[1m[32müîÑ [AI MARKING][0m [1mSTARTING...[0m
[MARKING DEBUG] Q6 has 11 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_881, block_0_1_37, block_0_2_98, block_0_3_528, block_0_4_116, block_0_5_753, block_0_6_116, block_0_7_466, block_0_9_57, block_0_10_330, block_0_11_875
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=true, Marks count=15

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q6[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **GENERIC MODE RULE:** Since the marking scheme is a generic pool, discover the total marks from the question text (e.g. "Total 4 marks") and only return annotations for those 4 marks. Do NOT skip a question. If the student wrote nothing, provide a cross (A0/M0) only for the discovered total marks.

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the discovered total marks from the student paper (e.g. 4 or 5). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 6



## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)

‚ö†Ô∏è NO OFFICIAL MARKING SCHEME AVAILABLE (GENERIC MODE).
1. You are the CHIEF EXAMINER.
2. GRADING STRATEGY:
   - Use M1, M2, M3... for sequential Method steps (correct approach).
   - Use A1, A2, A3... for sequential Accuracy steps (correct values).
   - Use B1, B2, B3... for Independent statements/reasons.
   - Use M0/A0/B0 ONLY to explicitly flag incorrect steps.
3. LIMITS:
   - Ignore the 'Total 20' ceiling. It is just a buffer.
   - Determine the actual value of the question yourself (e.g., if it's worth 4 marks, award 4 marks).
   - Do NOT award more marks than the question is logically worth.




## MARKING SCHEME

[GENERIC_GCSE_LOGIC]
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **GET BUDGET (HIERARCHY):**
>    A. **HARD SEARCH:** Look for text "(Total X marks)". If found, Budget = X. (Set `meta.isTotalEstimated` = false).
>    B. **SOFT ESTIMATE (Fallback):** If NOT found, estimate based on complexity:
>       - Simple 1-step calc = 1 Mark.
>       - Standard multi-step (Method + Answer) = 2-3 Marks.
>       - Complex/Quadratics/Proofs = 4-5 Marks.
>       - (Set `meta.isTotalEstimated` = true).
>    C. **SAFETY FLOOR:** The Budget can NEVER be lower than the number of correct steps you find. (e.g. If you see 4 correct steps, the Budget is at least 4).

> 2. **SOLVE**: Identify ALL valid marks (Method + Accuracy).

> 3. **CUT (The Guillotine):**
>    - You CANNOT output more annotations than the `budget`.
>    - **CONFLICT RULE:** If you have awarded full marks (e.g. 3/3), you MUST DELETE all error marks (M0/A0).
>    - **DELETION ORDER (Remove from bottom up):**
>         1. DELETE M0/A0/B0 (Errors) FIRST.
>         2. DELETE "M" marks (Intermediate steps) SECOND.
>         3. KEEP "A" marks (Final Answer) LAST.

> [MISSING TOTAL HANDLING]
> If you cannot find the "(Total X marks)" text in the OCR blocks:
> 1. Do NOT default to 3.
> 2. Count the valid steps you found (e.g., you found M1, M1, A1 = 3 steps).
> 3. Set `question_total_marks` equal to `awardedMarks` (via Safety Floor).
> 4. Set `isTotalEstimated` to true.

[MARK POOL]
- M1-M5: [METHOD] Working steps (Delete these first if over budget).
- A1-A3: [ACCURACY] Final answers (Keep these).
- B1-B2: [INDEPENDENT] Statements.

> [PERMISSIONS]
> - **PARTIAL MATCHING:** You are allowed to match a [Student Line] to a [OCR Block] even if the block only contains *part* of the line (e.g. Student writes "5/sqrt(3) = ..." but OCR only sees the result "... = 5sqrt(3)/3").
> - **FUZZY TEXT:** Ignore typos like 'S' for '5' or '72' for '27' if the position aligns.



> [!IMPORTANT]
> This is a GENERIC marking pool. 
> - Discover the actual total marks from the student paper (e.g. "Total 4 marks").
> - ONLY return annotations for the marks actually identified/needed.
> - Do NOT generate filler annotations to "coverage" the entire M1-M8 pool.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] [DRAWING] (ID: line_1)

[SUB-QUESTION A STUDENT WORK]
[Line 2] 0.4 (ID: line_2)
[Line 3] 0.55 (ID: line_3)
[Line 4] 0.45 (ID: line_4)

[SUB-QUESTION B STUDENT WORK]
[Line 5] 0.33 (ID: line_5)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_881]: "6 Tim has two biased coins, coin A and coin B."
[block_0_1_37]: "He is going to throw both coins."
[block_0_2_98]: "The probability that coin A will land on heads is 0.6"
[block_0_3_528]: "The probability that coin B will land on heads is 0.55"
[block_0_4_116]: "(a) Complete the probability tree diagram."
[block_0_5_753]: "(2)"
[block_0_6_116]: "Tim throws coin \( \mathbf{A} \) once and he throws coin \( \mathbf{B} \) once."
[block_0_7_466]: "(b) Work out the probability that both coins land on heads."
[block_0_9_57]: "0.33"
[block_0_10_330]: "(2)"
[block_0_11_875]: "7"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q6] ü•á Trusting AI Total: 4 (Reason: System Default Override)
ü§ñ [AI RESPONSE] [31mQ6[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6261[0m
     [36mProbability tree diagram with branches for coin A and coin B.[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [M1] [34m"[DRAWING]"[0m
      ‚Ü≥ Reason: [DRAWING] Tree diagram is drawn with correct branches.
      ‚Ü≥ Transcription: [35m"[DRAWING]"[0m
      ‚Ü≥ Classification: [35m"[DRAWING]"[0m
      ‚Ü≥ Status: [32m"VISUAL"[0m
    2. [32mtick[0m [34m[line_2][0m [A1] [34m"0.4"[0m
      ‚Ü≥ Reason: Correct probability for tails on coin A.
      ‚Ü≥ Transcription: [35m"0.4"[0m
      ‚Ü≥ Classification: [35m"0.4"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_3][0m [A1] [34m"0.55"[0m
      ‚Ü≥ Reason: Correct probability for heads on coin B.
      ‚Ü≥ Transcription: [35m"0.55"[0m
      ‚Ü≥ Classification: [35m"0.55"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    4. [32mtick[0m [34m[block_0_9_57][0m [A1] [34m"0.33"[0m
      ‚Ü≥ Reason: Correct probability calculated for both coins landing on heads.
      ‚Ü≥ OCR Match: [35m"0.33"[0m
      ‚Ü≥ Classification: [35m"0.33"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[WIDTH FIX] Boosting tiny width 124px to 300px for Q6
[WIDTH FIX] Boosting tiny width 174px to 300px for Q6
[GUILLOTINE CHECK] Q6: isGeneric=true, hasAnnotations=true, hasScore=true, SchemeTotal=20, ResultTotal=4
[1m[32m‚úÖ [AI MARKING][0m [1mCOMPLETED[0m in [1m4.3s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
[1m[32m‚úÖ [MARKING][0m [1mCOMPLETED[0m in [1m4.3s[0m ([32m[1mAI-MARKING[0m)

üîç [RESULT VERIFICATION] Checking what will be combined:
   üìä Marking Results: 1 questions
   üìù Question Results: NO
   ‚úÖ Both modes triggered: NO
[TOTAL TRAP] Q6: Scheme=20, AI=4, IsDefault=true -> FINAL=4
[TOTAL TRAP] Grand Total Possible Score: 4
[32müîÑ [LOGICAL RE-INDEXING] Aligning logical indices with sorted physical order...[0m
[32m‚úÖ [LOGICAL RE-INDEXING] Re-indexed 1 questions and 1 pages.[0m
[32m‚úÖ [1m[FINAL PAGE ORDER][0m [32m[1] Page 6 ([37mQ6a[32m)[0m
[1m[32m‚úÖ [OUTPUT GENERATION][0m [1mCOMPLETED[0m in [1m1.7s[0m ([32m[1mOUTPUT-GENERATION[0m)
[SYNC FIX] üîÑ Synchronizing UI Structure (Schema Defaults) with Engine Results (Actuals)...
[SYNC FIX] üèÅ Updated Grand Total from 20 -> 0
[1m[32m‚úÖ [PERFORMANCE SUMMARY AI][0m [1mCOMPLETED[0m in [1m0.8s[0m ([32m[1mGEMINI-2.0-FLASH[0m)

üìä [ANNOTATION SUMMARY]
----------------------------------------------------------------------
| Q#       | Score | Marks Awarded           | Match Status              |
|----------|-------|-------------------------|---------------------------|
| [32m6       [0m | 4/4   | A1, M1, A1, A1          | M:0 V:1 U:2 S:1           |
| [90m  a     [0m | 3     | M1, A1, A1              | M:0 V:1 U:2 S:0           |
| [90m  b     [0m | 1     | A1                      | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|

=== PERFORMANCE SUMMARY ===
Total Processing Time: 17.4s
Model Used: gemini-2.0-flash
----------------------------
classification                      6.6s (38%)
marking                             4.3s (25%)
ocr_processing                      2.5s (14%)
output_generation                   1.7s (10%)
performance_summary                 0.8s (4%)
preprocessing                       0.4s (2%)
question_detection                  0.3s (1%)
database_persistence                0.2s (1%)
============================


üìä [UsageTracker] Summary:
   Model: gemini-2.0-flash
   API Requests: 3 total
   Total Tokens: 11,546 (10,747 in + 799 out)
   Total Cost: $0.004962
   Mathpix OCR: 1 pages ‚Üí $0.004000

   Breakdown by Phase:
   ‚Ä¢ Mapper (Map Pass): 4,161 tokens (1 requests) ‚Üí $0.000432
   ‚Ä¢ Classification (Marking Pass): 6,988 tokens (1 requests) ‚Üí $0.000910
   ‚Ä¢ Performance Summary: 397 tokens (1 requests) ‚Üí $0.000053


üèÅ ========== UNIFIED PIPELINE END ==========
üèÅ ==========================================

‚úÖ [CONTROLLER] Pipeline completed, result exists: true, sessionId: sub-1768663289772
üí≥ [CREDIT DEDUCT] Starting deduction for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, sessionId: sub-1768663289772
üí≥ [CREDIT DEDUCT] Incremental cost from tracker: 0.0049623
üîç [SUBJECT EXTRACTION] examPapers[0].subject = "General"
üí≥ Deducted 0.50 credits from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2 (session: sub-1768663289772), remaining: 588.19
üí≥ Deducted 0.0050 credits (session: sub-1768663289772) from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2
‚úÖ [SUBJECT MARKING RESULT] Persisted marking result for subject: General, session: sub-1768663289772
üë§ [PLAN CHECK] User 9mBfvniXTuMtQU8f0OnLhUK6aOv2 is on plan: ultra
üì° [MARKING] Processing POST /api/marking/process (hasRawBody: false)
üöÄ [MARKING] Controller started - Files: 21, Body Keys: model, aiMessageId
üîç [CREDIT DEBUG] userId: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, isAuthenticated: true
üí≥ [CREDIT CHECK] Starting credit check for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2
üí≥ [CREDIT CHECK] Estimated cost: 0.9444994000000001, files: 21, bytes: 8394994
üí≥ [CREDIT CHECK] Result: {"canProceed":true,"remaining":588.19}

üîÑ ========== UNIFIED PIPELINE START ==========
üîÑ ============================================

[1m[32m‚úÖ [INPUT VALIDATION][0m [1mCOMPLETED[0m in [1m0.0s[0m ([32m[1mVALIDATION[0m)
[INPUT TYPE] Detected: Multiple Images (21 files)
[1m[32m‚úÖ [PREPROCESSING][0m [1mCOMPLETED[0m in [1m4.7s[0m ([32m[1mIMAGE-PROCESSING[0m)
[MAPPER] Using model: gemini-2.0-flash
[MAPPER] Starting Map Pass for 21 pages...
‚úÖ [MAPPER] Map Pass complete in 7.39s. Mapped 21 pages.

[36m[CLASSIFICATION DEBUG] Q4 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "4",
          "text": "A company has 25000 workers.\nThe number of workers increases at a rate of 6% per year for 3 years.\nCalculate the total number of workers at the end of the 3 years.",
          "hasStudentDrawing": false,
          "studentWorkLines": [
            {
              "text": "25000 x 1.06^3",
              "position": {
                "x": 30.83,
                "y": 57.08,
                "width": 30.0,
                "height": 6.0
              }
            },
            {
              "text": "29775",
              "position": {
                "x": 50.0,
                "y": 80.0,
                "width": 15.0,
                "height": 5.0
              }
            }
          ],
          "subQuestions": []
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q1 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "1",
          "text": "Find the highest common factor (HCF) of 63 and 105",
          "studentWorkLines": [
            {
              "text": "63=3\\times^2\\times 11",
              "position": {
                "x": 17,
                "y": 28,
                "width": 35,
                "height": 10
              }
            },
            {
              "text": "105=3x5x7",
              "position": {
                "x": 17,
                "y": 39,
                "width": 30,
                "height": 8
              }
            },
            {
              "text": "3",
              "position": {
                "x": 69,
                "y": 40,
                "width": 5,
                "height": 8
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q3 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "3",
          "text": "The diagram shows a solid triangular prism.\nRana is trying to draw the side elevation of the solid prism from the direction of the arrow.\nHere is her answer on a centimetre grid.",
          "hasStudentDrawing": false,
          "studentWorkLines": [],
          "subQuestions": [
            {
              "part": "a",
              "text": "Explain why Rana's side elevation is not correct.",
              "studentWorkLines": [
                {
                  "text": "The height of prism is not 4cm",
                  "position": {
                    "x": 11.64,
                    "y": 69.81,
                    "width": 41.94,
                    "height": 3.4
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    },
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "3",
          "text": null,
          "hasStudentDrawing": true,
          "studentDrawingPosition": {
            "x": 14.03,
            "y": 20.96,
            "width": 35.82,
            "height": 22.88
          },
          "studentWorkLines": [],
          "subQuestions": [
            {
              "part": "b",
              "text": "On the centimetre grid below, draw a plan of the solid prism.",
              "studentWorkLines": [],
              "hasStudentDrawing": true
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q2 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "2",
          "subQuestions": [
            {
              "part": "ai",
              "text": "Write 5.3 x 10' as an ordinary number.",
              "studentWorkLines": [
                {
                  "text": "53000",
                  "position": {
                    "x": 57.29,
                    "y": 17.96,
                    "width": 10.2,
                    "height": 4.07
                  }
                }
              ],
              "hasStudentDrawing": false
            },
            {
              "part": "aii",
              "text": "Write 7.4 x 10 as an ordinary number.",
              "studentWorkLines": [
                {
                  "text": "0.000074",
                  "position": {
                    "x": 57.29,
                    "y": 35.55,
                    "width": 14.06,
                    "height": 4.07
                  }
                }
              ],
              "hasStudentDrawing": false
            },
            {
              "part": "b",
              "text": "Calculate the value of 9.7 x 10+ 2.45 √ó 10'\nGive your answer in standard form.",
              "studentWorkLines": [
                {
                  "text": "3.42√ó10",
                  "position": {
                    "x": 57.29,
                    "y": 62.22,
                    "width": 13.02,
                    "height": 4.07
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q5 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "5",
          "text": "Habib has two identical tins.\nHe puts 600 grams of flour into one of the tins.\nThe flour fills the tin completely.\nThe density of the flour is 0.6 g/cm¬≥\nHabib puts 600 grams of salt into the other tin.\nThe salt does not fill the tin completely.\nThe volume of the space in the tin that is not filled with salt is 700 cm¬≥\nWork out the density of the salt.\nYou must show all your working.",
          "studentWorkLines": [
            {
              "text": "Volume of tin= \\\\frac{600}{0.6}",
              "position": {
                "x": 10,
                "y": 28,
                "width": 40,
                "height": 10
              }
            },
            {
              "text": "= 1000cm¬≥",
              "position": {
                "x": 10,
                "y": 45,
                "width": 25,
                "height": 8
              }
            },
            {
              "text": "1000-700=300",
              "position": {
                "x": 10,
                "y": 58,
                "width": 35,
                "height": 8
              }
            },
            {
              "text": "600/300=2g/cm¬≥",
              "position": {
                "x": 10,
                "y": 72,
                "width": 40,
                "height": 8
              }
            }
          ],
          "subQuestions": []
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q8 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "8",
          "text": "a = \\begin{pmatrix} 3 \\\\ 2 \\end{pmatrix} b = \\begin{pmatrix} -1 \\\\ 4 \\end{pmatrix}\nOn the grid below, draw and label the vector 2a + b",
          "hasStudentDrawing": true,
          "studentDrawingPosition": {
            "x": 24,
            "y": 25,
            "width": 50,
            "height": 40
          },
          "studentWorkLines": [
            {
              "text": "2a+b",
              "position": {
                "x": 40,
                "y": 42,
                "width": 10,
                "height": 5
              }
            },
            {
              "text": "—à–∞—à—ã",
              "position": {
                "x": 45,
                "y": 60,
                "width": 10,
                "height": 5
              }
            }
          ],
          "subQuestions": []
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q9 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "9",
          "text": "The diagram shows a cube and a square-based pyramid.\nThe volume of the cube is equal to the volume of the pyramid.\nWork out the perpendicular height, hcm, of the pyramid.",
          "studentWorkLines": [
            {
              "text": "6^3=8^2h \\times \\frac{1}{3}",
              "position": {
                "x": 27,
                "y": 36,
                "width": 40,
                "height": 10
              }
            },
            {
              "text": "h=\\frac{81}{8}",
              "position": {
                "x": 27,
                "y": 50,
                "width": 20,
                "height": 8
              }
            },
            {
              "text": "\\frac{81}{8}",
              "position": {
                "x": 58,
                "y": 63,
                "width": 10,
                "height": 8
              }
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q7 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "7",
          "text": "A paddling pool is in the shape of a cylinder.\nThe pool has radius 100cm.\nThe pool has depth 30cm.\nThe pool is empty.\nIt is then filled with water at a rate of 250cm' per second.\nWork out the number of minutes it takes to fill the pool completely.\nGive your answer correct to the nearest minute.\nYou must show all your working.",
          "studentWorkLines": [
            {
              "text": "volume = \\\\pi x100^2 x 30 = 30000\\\\pi",
              "position": {
                "x": 12,
                "y": 44,
                "width": 65,
                "height": 10
              }
            },
            {
              "text": "time = \\\\frac{30000\\\\pi}{250}",
              "position": {
                "x": 12,
                "y": 57,
                "width": 40,
                "height": 10
              }
            },
            {
              "text": "= 120\\\\pi seconds",
              "position": {
                "x": 12,
                "y": 70,
                "width": 35,
                "height": 10
              }
            },
            {
              "text": "= 62.8 minute",
              "position": {
                "x": 12,
                "y": 82,
                "width": 30,
                "height": 10
              }
            },
            {
              "text": "63",
              "position": {
                "x": 58,
                "y": 82,
                "width": 10,
                "height": 10
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q6 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "6",
          "text": "Tim has two biased coins, coin A and coin B.\nHe is going to throw both coins.\nThe probability that coin A will land on heads is 0.6\nThe probability that coin B will land on heads is 0.55",
          "hasStudentDrawing": true,
          "studentDrawingPosition": {
            "x": 28,
            "y": 29,
            "width": 45,
            "height": 35
          },
          "studentWorkLines": [],
          "subQuestions": [
            {
              "part": "a",
              "text": "Complete the probability tree diagram.",
              "studentWorkLines": [
                {
                  "text": "0.45",
                  "position": {
                    "x": 47.5,
                    "y": 39.5,
                    "width": 6.0,
                    "height": 3.0
                  }
                },
                {
                  "text": "0.55",
                  "position": {
                    "x": 57.5,
                    "y": 49.5,
                    "width": 6.0,
                    "height": 3.0
                  }
                },
                {
                  "text": "0.45",
                  "position": {
                    "x": 57.5,
                    "y": 59.5,
                    "width": 6.0,
                    "height": 3.0
                  }
                },
                {
                  "text": "0.4",
                  "position": {
                    "x": 30.5,
                    "y": 49.5,
                    "width": 4.0,
                    "height": 3.0
                  }
                }
              ],
              "hasStudentDrawing": true
            },
            {
              "part": "b",
              "text": "Tim throws coin A once and he throws coin B once.\nWork out the probability that both coins land on heads.",
              "studentWorkLines": [
                {
                  "text": "0.33",
                  "position": {
                    "x": 69.0,
                    "y": 74.0,
                    "width": 6.0,
                    "height": 4.0
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q10 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "10",
          "text": "There are only red counters and yellow counters in bag A.\nnumber of red counters: number of yellow counters=3:5\nThere are only green counters and blue counters in bag B.\nThe number of counters in bag B is half the number of counters in bag A.\nGiven that there are a red counters in bag A,\nuse algebra to show that the total number of counters in bag A and bag B is 4x",
          "studentWorkLines": [
            {
              "text": "x red \\Rightarrow \\frac{5}{3}x yellow",
              "position": {
                "x": 25.0,
                "y": 27.0,
                "width": 40.0,
                "height": 6.0
              }
            },
            {
              "text": "= \\frac{8}{3}x counters in A",
              "position": {
                "x": 25.0,
                "y": 34.0,
                "width": 40.0,
                "height": 6.0
              }
            },
            {
              "text": "= \\frac{4}{3}x counters in B",
              "position": {
                "x": 25.0,
                "y": 41.0,
                "width": 40.0,
                "height": 6.0
              }
            },
            {
              "text": "= \\frac{4}{3}x + \\frac{8}{3}x total counters",
              "position": {
                "x": 25.0,
                "y": 48.0,
                "width": 50.0,
                "height": 6.0
              }
            },
            {
              "text": "= 4x counters",
              "position": {
                "x": 25.0,
                "y": 55.0,
                "width": 25.0,
                "height": 6.0
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q12 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "12",
          "text": "The diagram shows triangle T drawn on a grid.\nEnlarge triangle T by scale factor -2 with centre of enlargement (0, 0)",
          "hasStudentDrawing": true,
          "studentDrawingPosition": {
            "x": 10,
            "y": 12,
            "width": 70,
            "height": 70
          },
          "studentWorkLines": [],
          "subQuestions": []
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q13 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "13",
          "text": "There are 30 students in a class.\nA teacher is going to choose at random 2 of the students.\nWork out the number of different pairs of students that the teacher can choose.",
          "studentWorkLines": [
            {
              "text": "\\frac{30x29}{2}",
              "position": {
                "x": 34.17,
                "y": 27.08,
                "width": 14.58,
                "height": 10.08
              }
            },
            {
              "text": "435",
              "position": {
                "x": 60.83,
                "y": 38.96,
                "width": 7.5,
                "height": 5.08
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q11 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "11",
          "text": "Mina records the speeds, in mph, of some cars on a road on Friday.\nShe uses her results to work out the information in this table.",
          "hasStudentDrawing": false,
          "studentWorkLines": [],
          "subQuestions": [
            {
              "part": "a",
              "text": "On the grid, draw a box plot to show the information in the table.",
              "hasStudentDrawing": true,
              "studentDrawingPosition": {
                "x": 10,
                "y": 28,
                "width": 80,
                "height": 15
              },
              "studentWorkLines": []
            },
            {
              "part": "b",
              "text": "Compare the distribution of the speeds on Friday with the distribution of the speeds on Sunday.",
              "studentWorkLines": [
                {
                  "text": "The medion is higher on Sunday compore to Fridoy.",
                  "position": {
                    "x": 10,
                    "y": 74,
                    "width": 80,
                    "height": 6
                  }
                },
                {
                  "text": "Mas 42>40.",
                  "position": {
                    "x": 10,
                    "y": 81,
                    "width": 25,
                    "height": 6
                  }
                },
                {
                  "text": "The ronge die is also higher on Sunday as",
                  "position": {
                    "x": 10,
                    "y": 88,
                    "width": 75,
                    "height": 6
                  }
                },
                {
                  "text": "44>37.",
                  "position": {
                    "x": 10,
                    "y": 95,
                    "width": 15,
                    "height": 6
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q15 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "15",
          "subQuestions": [
            {
              "part": "a",
              "text": "Simplify fully \\frac{(a-3)^2}{5(a-3)}",
              "studentWorkLines": [
                {
                  "text": "\\frac{a-3}{5}",
                  "position": {
                    "x": 54.16,
                    "y": 23.01,
                    "width": 10.04,
                    "height": 6.0
                  }
                }
              ]
            },
            {
              "part": "b",
              "text": "Factorise 3k^2 + 11k - 4",
              "studentWorkLines": [
                {
                  "text": "(3k-1)(k+4)",
                  "position": {
                    "x": 60.83,
                    "y": 39.81,
                    "width": 17.08,
                    "height": 5.0
                  }
                }
              ]
            },
            {
              "part": "c",
              "text": "Simplify fully \\frac{4-x^2}{x^2+3x} \\div \\frac{x+2}{x+3}",
              "studentWorkLines": [
                {
                  "text": "= \\frac{2-x(x2+x)}{x(3+L)} \\times \\frac{x+3}{x+2}",
                  "position": {
                    "x": 30.83,
                    "y": 52.81,
                    "width": 30.08,
                    "height": 10.0
                  }
                },
                {
                  "text": "\\frac{2-x}{x}",
                  "position": {
                    "x": 60.83,
                    "y": 73.81,
                    "width": 10.08,
                    "height": 5.0
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q16 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "16",
          "text": "The functions f and g are given by",
          "subQuestions": [
            {
              "part": "a",
              "text": "Find f(-3)",
              "studentWorkLines": [
                {
                  "text": "-6",
                  "position": {
                    "x": 62.22,
                    "y": 26.87,
                    "width": 4.03,
                    "height": 5.06
                  }
                }
              ]
            },
            {
              "part": "b",
              "text": "Find fg(1)",
              "studentWorkLines": [
                {
                  "text": "4",
                  "position": {
                    "x": 69.03,
                    "y": 49.88,
                    "width": 3.01,
                    "height": 5.06
                  }
                }
              ]
            },
            {
              "part": "c",
              "text": "Find g¬π(4)",
              "studentWorkLines": [
                {
                  "text": "\\frac{1}{3}",
                  "position": {
                    "x": 70.12,
                    "y": 73.01,
                    "width": 4.82,
                    "height": 7.05
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q14 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "14",
          "text": "At the start of 2022 Kim invested some money in a savings account.\nThe account paid 3.5% compound interest each year.\nAt the end of 2022\ninterest was added to the account then Kim took ¬£750 from the account.\nAt the end of 2023\ninterest was added to the account then Kim took ¬£1000 from the account.\nThere was then ¬£2937.14 in the account.\nWork out how much money Kim invested at the start of 2022\nYou must show all your working.",
          "studentWorkLines": [
            {
              "text": "2937.14 +1000",
              "position": {
                "x": 32.29,
                "y": 52.5,
                "width": 23.02,
                "height": 4.08
              }
            },
            {
              "text": "= 3937.14",
              "position": {
                "x": 32.29,
                "y": 58.05,
                "width": 20.05,
                "height": 4.08
              }
            },
            {
              "text": "3037.14= x \\\\times 1.035",
              "position": {
                "x": 32.29,
                "y": 65.14,
                "width": 32.29,
                "height": 4.08
              }
            },
            {
              "text": "x =  at end of 2022",
              "position": {
                "x": 45.31,
                "y": 70.69,
                "width": 40.05,
                "height": 4.08
              }
            },
            {
              "text": " +750 = y \\\\times 1.035",
              "position": {
                "x": 45.31,
                "y": 76.24,
                "width": 30.05,
                "height": 4.08
              }
            },
            {
              "text": "y= ",
              "position": {
                "x": 45.31,
                "y": 81.79,
                "width": 15.05,
                "height": 4.08
              }
            },
            {
              "text": "4400",
              "position": {
                "x": 55.21,
                "y": 85.87,
                "width": 10.05,
                "height": 4.08
              }
            },
            {
              "text": "¬£ 4400",
              "position": {
                "x": 75.0,
                "y": 88.9,
                "width": 15.05,
                "height": 4.08
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q17 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "17",
          "text": "A ball is thrown upwards and reaches a maximum height.\nThe ball then falls and bounces repeatedly.\nAfter the nth bounce, the ball reaches a height of h\nAfter the next bounce, the ball reaches a height given by h‚ÇÅ = 0.55h,\nAfter the Ist bounce, the ball reaches a height of 8 metres.\nWhat height does the ball reach after the 4th bounce?",
          "studentWorkLines": [
            {
              "text": "8x0.55^3",
              "position": {
                "x": 30.62,
                "y": 30.21,
                "width": 20.0,
                "height": 7.0
              }
            },
            {
              "text": "1.331",
              "position": {
                "x": 52.08,
                "y": 52.29,
                "width": 10.0,
                "height": 5.0
              }
            }
          ],
          "subQuestions": []
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q18 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "18",
          "text": "ABCD is a quadrilateral.\nThe area of triangle ABC is 54 cm¬≤\nCalculate the area of triangle ACD.\nGive your answer correct to 3 significant figures.",
          "studentWorkLines": [
            {
              "text": "54= \\\\frac{1}{2}x17x ACx sin 35",
              "position": {
                "x": 24.5,
                "y": 40.9,
                "width": 44.2,
                "height": 4.1
              }
            },
            {
              "text": "AC = 11.08",
              "position": {
                "x": 24.5,
                "y": 47.3,
                "width": 23.0,
                "height": 4.1
              }
            },
            {
              "text": "AD = \\\\frac{11.08}{sin 57} x sin (48)",
              "position": {
                "x": 24.5,
                "y": 53.7,
                "width": 40.0,
                "height": 4.1
              }
            },
            {
              "text": "= 9.81",
              "position": {
                "x": 24.5,
                "y": 60.1,
                "width": 17.0,
                "height": 4.1
              }
            },
            {
              "text": "Area= \\\\frac{1}{2}x 9.81 x 11.08 x sin (180-48-57)",
              "position": {
                "x": 24.5,
                "y": 68.0,
                "width": 57.0,
                "height": 4.1
              }
            },
            {
              "text": "= 52.5",
              "position": {
                "x": 24.5,
                "y": 74.4,
                "width": 15.0,
                "height": 4.1
              }
            },
            {
              "text": "52.5",
              "position": {
                "x": 69.5,
                "y": 80.8,
                "width": 10.0,
                "height": 4.1
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q19 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "19",
          "text": "R = \\\\frac{P}{Q}\nP = 5.88 x 10\" correct to 3 significant figures.\nQ = 3.6 x 10' correct to 2 significant figures.\nWork out the lower bound for R.\nGive your answer as an ordinary number correct to the nearest integer.\nYou must show all your working.",
          "studentWorkLines": [
            {
              "text": "LMB of P= 5.875x10^8, UB of Q = 365x10^8",
              "position": {
                "x": 21.6,
                "y": 24.1,
                "width": 60.0,
                "height": 5.0
              }
            },
            {
              "text": "R= \\\\frac{5.8875x10^8}{3.65x10^5}",
              "position": {
                "x": 21.6,
                "y": 33.0,
                "width": 35.0,
                "height": 7.0
              }
            },
            {
              "text": "= 1609.59",
              "position": {
                "x": 21.6,
                "y": 42.0,
                "width": 20.0,
                "height": 5.0
              }
            },
            {
              "text": "1610",
              "position": {
                "x": 59.0,
                "y": 52.0,
                "width": 10.0,
                "height": 5.0
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q21 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "21",
          "text": "The diagram shows a circle, radius r cm and two regular hexagons.\nEach side of the larger hexagon ABCDEF is a tangent to the circle.\nEach side of the smaller hexagon PQRSTU is a chord of the circle.\nBy considering perimeters, show that\n3 < \\\\pi < 2\\\\sqrt{3}",
          "studentWorkLines": [
            {
              "text": "perimeter: smull hexagon <circle <large lhexagon",
              "position": {
                "x": 25.0,
                "y": 49.0,
                "width": 50.0,
                "height": 5.0
              }
            },
            {
              "text": "perimeter of small hexagus = 6r",
              "position": {
                "x": 25.0,
                "y": 56.0,
                "width": 40.0,
                "height": 5.0
              }
            },
            {
              "text": "of circle =2\\\\pi r",
              "position": {
                "x": 25.0,
                "y": 62.0,
                "width": 25.0,
                "height": 5.0
              }
            },
            {
              "text": "of large hexugun= \\\\frac{6r}{cos(30)}",
              "position": {
                "x": 25.0,
                "y": 67.0,
                "width": 45.0,
                "height": 5.0
              }
            },
            {
              "text": "=4\\\\sqrt{3} r",
              "position": {
                "x": 45.0,
                "y": 73.0,
                "width": 15.0,
                "height": 5.0
              }
            },
            {
              "text": "6r<2\\\\pi r<4\\\\sqrt{3}r",
              "position": {
                "x": 25.0,
                "y": 78.0,
                "width": 40.0,
                "height": 5.0
              }
            },
            {
              "text": "3 < \\\\pi < 2\\\\sqrt{3}",
              "position": {
                "x": 25.0,
                "y": 84.0,
                "width": 25.0,
                "height": 5.0
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q20 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "20",
          "text": "x 4, x + 2 and 3x + 1 are three consecutive terms of an arithmetic sequence.",
          "subQuestions": [
            {
              "part": "a",
              "text": "Find the value of x.",
              "studentWorkLines": [
                {
                  "text": "3x+1-(x+2)=x+2-(x-4)",
                  "position": {
                    "x": 24.5,
                    "y": 15.6,
                    "width": 40.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "4x-3=x+4",
                  "position": {
                    "x": 24.5,
                    "y": 21.2,
                    "width": 20.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "-7=-2x",
                  "position": {
                    "x": 24.5,
                    "y": 26.8,
                    "width": 12.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "x = \\frac{7}{2}",
                  "position": {
                    "x": 62.0,
                    "y": 32.0,
                    "width": 10.0,
                    "height": 6.0
                  }
                }
              ],
              "hasStudentDrawing": false
            },
            {
              "part": "b",
              "text": "y-4, y + 2 and 3y + 1 are three consecutive terms of a geometric sequence.\nFind the possible values of y.",
              "studentWorkLines": [
                {
                  "text": "\\frac{3y+1}{y+2} = \\frac{y+2}{y-4}",
                  "position": {
                    "x": 24.5,
                    "y": 49.5,
                    "width": 20.0,
                    "height": 7.0
                  }
                },
                {
                  "text": "(3y+1)(y-4) = (y+2)^2",
                  "position": {
                    "x": 24.5,
                    "y": 60.0,
                    "width": 35.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "3y^2-11y-4=y^2+4y+4",
                  "position": {
                    "x": 24.5,
                    "y": 65.5,
                    "width": 40.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "2y^2-15y-8=0",
                  "position": {
                    "x": 24.5,
                    "y": 71.0,
                    "width": 25.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "Y=8,-0.5",
                  "position": {
                    "x": 40.0,
                    "y": 76.5,
                    "width": 15.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "8,-0.5",
                  "position": {
                    "x": 69.0,
                    "y": 83.0,
                    "width": 15.0,
                    "height": 4.0
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}
[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m28.1s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
üöÄ [OVERRIDE] 90% Rule Triggered: 22/22 pages have student work. Overriding all questionOnly pages to questionAnswer for consistency.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîÄ [PERFECT SPLIT] Building standalone structures with re-indexing
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üéØ [MODE ROUTING] Pure marking mode

‚úÖ Perfect split complete - each mode has consecutive 0-based indices
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m28.1s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
üîç [MODE DETECTION] Analysis (AFTER overrides):
  - All question-only: false
  - Has mixed content: false
  - Has any student work: true
  - Selected mode: Marking Mode
[PIPELINE DEBUG] Page 1 OCR Data Check:
   - Total Blocks: 7
   - Sample HW Block Check: {"text":"63  =3^{2} \\times 11","hasCoords":true,"coords":{"x":893,"y":926,"width":546,"height":147}}
[1m[32m‚úÖ [OCR PROCESSING][0m [1mCOMPLETED[0m in [1m9.4s[0m ([32m[1mMATHPIX[0m)
[DETECTION] Q1 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q2 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q3 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q4 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q5 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q6 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q7 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q8 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q9 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q10 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q11 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q12 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q13 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q14 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q15 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q16 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q17 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q18 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q19 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q20 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q21 -> Global search (Pool: 108 papers, 2709 candidates)
[32m[HINT] üèõÔ∏è Consensus Reached! Forcing to "Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier"[0m
[DETECTION] Q3a -> Using paper hint: "Pearson Edexcel 1MA1/3H June 2024 Higher Tier" (Pool: 1 papers, 21 candidates)
   ‚îî‚îÄ Rescued Group Q3 -> Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier
[DETECTION] Q6a -> Using paper hint: "Pearson Edexcel 1MA1/3H June 2024 Higher Tier" (Pool: 1 papers, 21 candidates)
   ‚îî‚îÄ Rescued Group Q6 -> Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier
[DETECTION] Q9 -> Using paper hint: "Pearson Edexcel 1MA1/3H June 2024 Higher Tier" (Pool: 1 papers, 21 candidates)
   ‚îî‚îÄ Rescued Group Q9 -> Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier
[DETECTION] Q11a -> Using paper hint: "Pearson Edexcel 1MA1/3H June 2024 Higher Tier" (Pool: 1 papers, 21 candidates)
   ‚îî‚îÄ Rescued Group Q11 -> Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier
[DETECTION] Q16a -> Using paper hint: "Pearson Edexcel 1MA1/3H June 2024 Higher Tier" (Pool: 1 papers, 21 candidates)
   ‚îî‚îÄ Rescued Group Q16 -> Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier
üìç [PIPELINE] Detected consensus paper: "Pearson Edexcel - 1MA1/3H - June 2024, Higher Tier". Will use as hint for question-only pages.
[1m[32m‚úÖ [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m6.7s[0m ([32m[1mQUESTION-DETECTION[0m)

üîç [DETECTION CONTEXT]
   Strategy: Global Search
   Pool Size: 108 papers, 2709 total question candidates
------------------------------------------------------------------------------------------------------------------------------------

üìã [DETECTION AUDIT REPORT]
------------------------------------------------------------------------------------------------------------------------------------
| Q#   | Input Text (Fragment)                       | Match Result / Paper Title                         | Score | Status        |
------------------------------------------------------------------------------------------------------------------------------------
| 1    | Find the highest common factor (HCF) of 63... | Edexcel GCSE 1MA1/3H June 2024 Q1                  | 0.950 | [32m‚úÖ SUCCESS[0m      |
| 2ai  | Write 5.3 x 10' as an ordinary number.        | Edexcel GCSE 1MA1/3H June 2024 Q2                  | 0.887 | [32m‚úÖ SUCCESS[0m      |
| 2aii | Write 7.4 x 10 as an ordinary number.         | Edexcel GCSE 1MA1/3H June 2024 Q2                  | 0.887 | [32m‚úÖ SUCCESS[0m      |
| 2b   | Calculate the value of 9.7 x 10+ 2.45 √ó 10... | Edexcel GCSE 1MA1/3H June 2024 Q2                  | 0.887 | [32m‚úÖ SUCCESS[0m      |
| 3a   | Explain why Rana's side elevation is not c... | Edexcel GCSE 1MA1/3H June 2024 Q3                  | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/3H Q3                     | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 3b   | On the centimetre grid below, draw a plan ... | Edexcel GCSE 1MA1/3H June 2024 Q3                  | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/3H Q3                     | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 4    | A company has 25000 workers. The number of... | Edexcel GCSE 1MA1/3H June 2024 Q4                  | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 5    | Habib has two identical tins. He puts 600 ... | Edexcel GCSE 1MA1/3H June 2024 Q5                  | 0.912 | [32m‚úÖ SUCCESS[0m      |
| 6a   | Complete the probability tree diagram.        | Edexcel GCSE 1MA1/3H June 2024 Q6                  | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/3H Q6                     | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 6b   | Tim throws coin A once and he throws coin ... | Edexcel GCSE 1MA1/3H June 2024 Q6                  | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/3H Q6                     | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 7    | A paddling pool is in the shape of a cylin... | Edexcel GCSE 1MA1/3H June 2024 Q7                  | 0.935 | [32m‚úÖ SUCCESS[0m      |
| 8    | a = \begin{pmatrix} 3 \\ 2 \end{pmatrix} b... | Edexcel GCSE 1MA1/3H June 2024 Q8                  | 0.826 | [32m‚úÖ SUCCESS[0m      |
| 9    | The diagram shows a cube and a square-base... | Edexcel GCSE 1MA1/3H June 2024 Q9                  | 0.750 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      [32m‚óã[0m [0.750] 1MA1/3H Q9                     | Txt:1.00 Num:0.00 Str:1.00 Sem:PASS
| 10   | There are only red counters and yellow cou... | Edexcel GCSE 1MA1/3H June 2024 Q10                 | 0.997 | [32m‚úÖ SUCCESS[0m      |
| 11a  | On the grid, draw a box plot to show the i... | Edexcel GCSE 1MA1/3H June 2024 Q11                 | 0.422 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.422] 1MA1/3H Q11                    | Txt:0.27 Num:0.00 Str:1.00 Sem:PASS
| 11b  | Compare the distribution of the speeds on ... | Edexcel GCSE 1MA1/3H June 2024 Q11                 | 0.422 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.422] 1MA1/3H Q11                    | Txt:0.27 Num:0.00 Str:1.00 Sem:PASS
| 12   | The diagram shows triangle T drawn on a gr... | Edexcel GCSE 1MA1/3H June 2024 Q12                 | 0.833 | [32m‚úÖ SUCCESS[0m      |
| 13   | There are 30 students in a class. A teache... | Edexcel GCSE 1MA1/3H June 2024 Q13                 | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 14   | At the start of 2022 Kim invested some mon... | Edexcel GCSE 1MA1/3H June 2024 Q14                 | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 15a  | Simplify fully \frac{(a-3)^2}{5(a-3)}         | Edexcel GCSE 1MA1/3H June 2024 Q15                 | 0.940 | [32m‚úÖ SUCCESS[0m      |
| 15b  | Factorise 3k^2 + 11k - 4                      | Edexcel GCSE 1MA1/3H June 2024 Q15                 | 0.940 | [32m‚úÖ SUCCESS[0m      |
| 15c  | Simplify fully \frac{4-x^2}{x^2+3x} \div \... | Edexcel GCSE 1MA1/3H June 2024 Q15                 | 0.940 | [32m‚úÖ SUCCESS[0m      |
| 16a  | Find f(-3)                                    | Edexcel GCSE 1MA1/3H June 2024 Q16                 | 0.646 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.646] 1MA1/3H Q16                    | Txt:0.70 Num:0.13 Str:1.00 Sem:PASS
| 16b  | Find fg(1)                                    | Edexcel GCSE 1MA1/3H June 2024 Q16                 | 0.646 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.646] 1MA1/3H Q16                    | Txt:0.70 Num:0.13 Str:1.00 Sem:PASS
| 16c  | Find g¬π(4)                                    | Edexcel GCSE 1MA1/3H June 2024 Q16                 | 0.646 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.646] 1MA1/3H Q16                    | Txt:0.70 Num:0.13 Str:1.00 Sem:PASS
| 17   | A ball is thrown upwards and reaches a max... | Edexcel GCSE 1MA1/3H June 2024 Q17                 | 0.886 | [32m‚úÖ SUCCESS[0m      |
| 18   | ABCD is a quadrilateral. The area of trian... | Edexcel GCSE 1MA1/3H June 2024 Q18                 | 0.816 | [32m‚úÖ SUCCESS[0m      |
| 19   | R = \\frac{P}{Q} P = 5.88 x 10" correct to... | Edexcel GCSE 1MA1/3H June 2024 Q19                 | 0.930 | [32m‚úÖ SUCCESS[0m      |
| 20a  | Find the value of x.                          | Edexcel GCSE 1MA1/3H June 2024 Q20                 | 0.801 | [32m‚úÖ SUCCESS[0m      |
| 20b  | y-4, y + 2 and 3y + 1 are three consecutiv... | Edexcel GCSE 1MA1/3H June 2024 Q20                 | 0.801 | [32m‚úÖ SUCCESS[0m      |
| 21   | The diagram shows a circle, radius r cm an... | Edexcel GCSE 1MA1/3H June 2024 Q21                 | 1.000 | [32m‚úÖ SUCCESS[0m      |
------------------------------------------------------------------------------------------------------------------------------------


üìä [QUESTION DETECTION STATISTICS]
   Total questions: 31
   Detected: 21/31
   Not detected: 10
   [HINT] Hint Used: "Global Search"
   [HINT] Matched Papers: 108
[DRAWING] Q3: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q3: Will pass image to Marking AI
[DRAWING] Q6: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q6: Will pass image to Marking AI
[DRAWING] Q8: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q8: Will pass image to Marking AI
[DRAWING] Q11: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q11: Will pass image to Marking AI
[DRAWING] Q12: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q12: Will pass image to Marking AI

üîç [EVIDENCE LOG] Q20 Classification Lines:
[SPATIAL SHIELD] Applying Hybrid Shield for Q1...
[SHIELD] üõ°Ô∏è Analyzing Q1. Next Header "Q2" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q1...
[SHIELD] üõ°Ô∏è Analyzing Q1. Next Header "Q2" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q2...
[SHIELD] üõ°Ô∏è Analyzing Q2. Next Header "Q3" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q2...
[SHIELD] üõ°Ô∏è Analyzing Q2. Next Header "Q3" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q3...
[SHIELD] üõ°Ô∏è Analyzing Q3. Next Header "Q4" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q3...
[SHIELD] üõ°Ô∏è Analyzing Q3. Next Header "Q4" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q4...
[SHIELD] üõ°Ô∏è Analyzing Q4. Next Header "Q5" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q4...
[SHIELD] üõ°Ô∏è Analyzing Q4. Next Header "Q5" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q5...
[SHIELD] üõ°Ô∏è Analyzing Q5. Next Header "Q6" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q5...
[SHIELD] üõ°Ô∏è Analyzing Q5. Next Header "Q6" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q6...
[SHIELD] üõ°Ô∏è Analyzing Q6. Next Header "Q7" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q6...
[SHIELD] üõ°Ô∏è Analyzing Q6. Next Header "Q7" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q7...
[SHIELD] üõ°Ô∏è Analyzing Q7. Next Header "Q8" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q7...
[SHIELD] üõ°Ô∏è Analyzing Q7. Next Header "Q8" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q8...
[SHIELD] üõ°Ô∏è Analyzing Q8. Next Header "Q9" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q8...
[SHIELD] üõ°Ô∏è Analyzing Q8. Next Header "Q9" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q9...
[SHIELD] üõ°Ô∏è Analyzing Q9. Next Header "Q10" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q9...
[SHIELD] üõ°Ô∏è Analyzing Q9. Next Header "Q10" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q10...
[SHIELD] üõ°Ô∏è Analyzing Q10. Next Header "Q11" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q10...
[SHIELD] üõ°Ô∏è Analyzing Q10. Next Header "Q11" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q11...
[SHIELD] üõ°Ô∏è Analyzing Q11. Next Header "Q12" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q11...
[SHIELD] üõ°Ô∏è Analyzing Q11. Next Header "Q12" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q12...
[SHIELD] üõ°Ô∏è Analyzing Q12. Next Header "Q13" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q12...
[SHIELD] üõ°Ô∏è Analyzing Q12. Next Header "Q13" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q13...
[SHIELD] üõ°Ô∏è Analyzing Q13. Next Header "Q14" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q13...
[SHIELD] üõ°Ô∏è Analyzing Q13. Next Header "Q14" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q14...
[SHIELD] üõ°Ô∏è Analyzing Q14. Next Header "Q15" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q14...
[SHIELD] üõ°Ô∏è Analyzing Q14. Next Header "Q15" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q15...
[SHIELD] üõ°Ô∏è Analyzing Q15. Next Header "Q16" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q15...
[SHIELD] üõ°Ô∏è Analyzing Q15. Next Header "Q16" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q16...
[SHIELD] üõ°Ô∏è Analyzing Q16. Next Header "Q17" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q16...
[SHIELD] üõ°Ô∏è Analyzing Q16. Next Header "Q17" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q17...
[SHIELD] üõ°Ô∏è Analyzing Q17. Next Header "Q18" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q17...
[SHIELD] üõ°Ô∏è Analyzing Q17. Next Header "Q18" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q18...
[SHIELD] üõ°Ô∏è Analyzing Q18. Next Header "Q19" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q18...
[SHIELD] üõ°Ô∏è Analyzing Q18. Next Header "Q19" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q19...
[SHIELD] üõ°Ô∏è Analyzing Q19. Next Header "Q20" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q19...
[SHIELD] üõ°Ô∏è Analyzing Q19. Next Header "Q20" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q20...
[SHIELD] üõ°Ô∏è Analyzing Q20. Next Header "Q21" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q20...
[SHIELD] üõ°Ô∏è Analyzing Q20. Next Header "Q21" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q21...
[SHIELD] üõ°Ô∏è Analyzing Q21. Next Header "Q22" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SHIELD] üè∑Ô∏è CORRECTED: "3<\pi<2 \sqrt{3..." -> LANDMARK (Printed)
[SPATIAL SHIELD] Applying Hybrid Shield for Q21...
[SHIELD] üõ°Ô∏è Analyzing Q21. Next Header "Q22" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
‚úÖ createMarkingTasksFromClassification completed, created 21 marking task(s)
[1m[32müîÑ [AI MARKING][0m [1mSTARTING...[0m
[MARKING DEBUG] Q1 has 7 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_455, block_0_1_853, block_0_2_96, block_0_3_7, block_0_4_591, block_0_5_655, block_0_6_118
[MARKING DEBUG] Q2 has 10 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_406, block_0_1_996, block_0_2_770, block_0_3_284, block_0_4_534, block_0_5_727, block_0_6_38, block_0_7_640, block_0_8_19, block_0_9_937
[MARKING DEBUG] Q3 has 21 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_972, block_0_1_873, block_0_2_182, block_0_12_990, block_0_3_903, block_0_11_630, block_0_4_441, block_0_6_951, block_0_9_350, block_0_10_515, block_0_13_685, block_0_0_715, block_0_1_901, block_0_2_766, block_0_3_391, block_0_4_333, block_0_7_222, block_0_5_82, block_0_6_560, block_0_8_600, block_0_9_616
[MARKING DEBUG] Q4 has 10 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_715, block_0_1_901, block_0_2_766, block_0_3_391, block_0_4_333, block_0_7_222, block_0_5_82, block_0_6_560, block_0_8_600, block_0_9_616
[MARKING DEBUG] Q5 has 15 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_44, block_0_1_264, block_0_2_606, block_0_3_461, block_0_4_153, block_0_5_549, block_0_6_419, block_0_7_229, block_0_8_52, block_0_9_933, block_0_10_606, block_0_11_271, block_0_12_541, block_0_13_865, block_0_14_684
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q2[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 2

## QUESTION TEXT
Write $5.3 \times 10^{4}$ as an ordinary number. Write $7.4 \times 10^{-5}$ as an ordinary number. Calculate the value of $9.7 \times 10^{6} + 2.45 \times 10^{7}$. Give your answer in standard form.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[2ai]
- B1: cao

[2aii]
- B1: cao

[2b]
- M1: for $9700000 + 24500000 (= 34200000)$ or $3.42 \times 10^n (n \ne 7)$ oe or $3.4 \times 10^7$ or correct answer in incorrect form eg $34.2 \times 10^6$ or both in a form ready for addition, eg $9.7 \times 10^6 + 24.5 \times 10^6$
- A1: cao



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION AI STUDENT WORK]
[Line 1] 53000 (ID: line_1)

[SUB-QUESTION AII STUDENT WORK]
[Line 2] 0.000074 (ID: line_2)

[SUB-QUESTION B STUDENT WORK]
[Line 3] 3.42√ó10 (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_406]: "2 (a) (i) Write \( 5.3 \times 10^{4} \) as an ordinary number."
[block_0_1_996]: "53000"
[block_0_2_770]: "(ii) Write \( 7.4 \times 10^{-5} \) as an ordinary number."
[block_0_3_284]: "0.000014"
[block_0_4_534]: "(1)"
[block_0_5_727]: "(b) Calculate the value of \( 9.7 \times 10^{6}+2.45 \times 10^{7} \)"
[block_0_6_38]: "Give your answer in standard form."
[block_0_7_640]: "\( 3.42 \times 10^{-6} \)"
[block_0_8_19]: "(2)"
[block_0_9_937]: "3"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q3[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 3

## QUESTION TEXT
The diagram shows a solid triangular prism. [Diagram shows a prism with a triangular cross-section base 6cm and height 4cm. The length of the prism is 7cm. The slant height of the triangular face is 4cm.] Rana is trying to draw the side elevation of the solid prism from the direction of the arrow. Here is her answer on a centimetre grid. [Rana's drawing shows a rectangle 6cm wide by 4cm high.] Explain why Rana's side elevation is not correct. On the centimetre grid below, draw a plan of the solid prism.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[3a]
- C1: for explanation

[3b]
- M1: for a 7 cm by 6 cm rectangle or for a 7 cm by n cm or m cm by 6 cm rectangle and dividing line which is parallel to the 7 cm or the m cm side
- A1: for a fully correct plan



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] The height of prism is not 4cm (ID: line_1)

[SUB-QUESTION B STUDENT WORK]
[Line 2] [DRAWING] (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_972]: "3 The diagram shows a solid triangular prism."
[block_0_1_873]: "Rana is trying to draw the side elevation of the solid prism from the direction of"
[block_0_2_182]: "the arrow."
[block_0_12_990]: "VJYV SIHI NI JIIYM ION OC"
[block_0_3_903]: "Here is her answer on a centimetre grid."
[block_0_11_630]: "VALV SIHI NI JITYM ION OC"
[block_0_4_441]: "(a) Explain why Rana's side elevation is not correct."
[block_0_6_951]: "The height of prim i) not 4 cm"
[block_0_9_350]: "(1)"
[block_0_10_515]: "VJYV SIHL NI BIIIAM ION OC"
[block_0_13_685]: "4"
[block_0_0_715]: "(b) On the centimetre grid below, draw a plan of the solid prism."
[block_0_1_901]: "(2)"
[block_0_2_766]: "4 A company has 25000 workers."
[block_0_3_391]: "The number of workers increases at a rate of \( 6 \% \) per year for 3 years."
[block_0_4_333]: "Calculate the total number of workers at the end of the 3 years."
[block_0_7_222]: "25000 \times 1.06^{3}"
[block_0_5_82]: "DO NOT WRITEIN THIS AREA"
[block_0_6_560]: "DO NOT WRITEIN THIS AREA"
[block_0_8_600]: "29775"
[block_0_9_616]: "5"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q4[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 4

## QUESTION TEXT
A company has 25000 workers. The number of workers increases at a rate of 6% per year for 3 years. Calculate the total number of workers at the end of the 3 years.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- P1: for evidence of using a correct first step eg $25000 \times 0.06 (= 1500)$ or $25000 \times 1.06 (= 26500)$
- P1: for evidence of a "compound interest" process eg "26500" $\times$ 0.06 (= 1590) or "26500" $\times$ 1.06 (= 28090) or $25000 \times 1.06^t$ ($t \ge 2$)
- P1: for a complete process eg $25000 \times 1.06^3 (= 29775.4)$
- A1: for 29775 or 29 776 or 29 780 or 29 800

FINAL ANSWER: 29775



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 25000 x 1.06^3 (ID: line_1)
[Line 2] 29775 (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_715]: "(b) On the centimetre grid below, draw a plan of the solid prism."
[block_0_1_901]: "(2)"
[block_0_2_766]: "4 A company has 25000 workers."
[block_0_3_391]: "The number of workers increases at a rate of \( 6 \% \) per year for 3 years."
[block_0_4_333]: "Calculate the total number of workers at the end of the 3 years."
[block_0_7_222]: "25000 \times 1.06^{3}"
[block_0_5_82]: "DO NOT WRITEIN THIS AREA"
[block_0_6_560]: "DO NOT WRITEIN THIS AREA"
[block_0_8_600]: "29775"
[block_0_9_616]: "5"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=2

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q1[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 1

## QUESTION TEXT
Find the highest common factor (HCF) of 63 and 105


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 2]
- M1: for a complete factor tree for 63 or 105 with no more than one arithmetic
error
or for listing at least 4 correct factors (with no more than 1 incorrect) of
63 or 105, could be in factor pairs
or for the prime factors of 63 (3, 3, 7) or 105 (3, 5, 7)
- A1: 21

FINAL ANSWER: 21



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 63=3\times^2\times 11 (ID: line_1)
[Line 2] 105=3x5x7 (ID: line_2)
[Line 3] 3 (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_455]: "Answer ALL questions."
[block_0_1_853]: "Write your answers in the spaces provided."
[block_0_2_96]: "You must write down all the stages in your working."
[block_0_3_7]: "1 Find the highest common factor (HCF) of 63 and 105"
[block_0_4_591]: "63  =3^{2} \times 11"
[block_0_5_655]: "105  =3 \times 5 \times 7"
[block_0_6_118]: "QU. 3"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q5[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 5

## QUESTION TEXT
Habib has two identical tins. He puts 600 grams of flour into one of the tins. The flour fills the tin completely. The density of the flour is $0.6~g/cm^{3}$. Habib puts 600 grams of salt into the other tin. The salt does not fill the tin completely. The volume of the space in the tin that is not filled with salt is $700~cm^{3}$. Work out the density of the salt. You must show all your working.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- P1: for process to find volume of tin eg $600 \div 0.6 (= 1000)$
- P1: for process to find volume of salt eg "1000" $- 700 (= 300)$
- P1: for a process to find density of the salt eg $600 \div$ "300" or $0.6 \times$ ("1000" $\div$ "300") or $600 \div$ [volume]
- A1: 2

FINAL ANSWER: 2



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] Volume of tin= \\frac{600}{0.6} (ID: line_1)
[Line 2] = 1000cm¬≥ (ID: line_2)
[Line 3] 1000-700=300 (ID: line_3)
[Line 4] 600/300=2g/cm¬≥ (ID: line_4)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_44]: "5 Habib has two identical tins."
[block_0_1_264]: "He puts 600 grams of flour into one of the tins."
[block_0_2_606]: "The flour fills the tin completely."
[block_0_3_461]: "The density of the flour is \( 0.6 \mathrm{~g} / \mathrm{cm}^{3} \)"
[block_0_4_153]: "Habib puts 600 grams of salt into the other tin"
[block_0_5_549]: "The salt does not fill the tin completely."
[block_0_6_419]: "The volume of the space in the tin that is not filled with salt is \( 700 \mathrm{~cm}^{3} \)"
[block_0_7_229]: "Work out the density of the sali."
[block_0_8_52]: "You must show all your working."
[block_0_9_933]: "\text { Volume of Gin }  =\frac{600}{0.6}"
[block_0_10_606]: " =100 \mathrm{~cm}^{3}"
[block_0_11_271]: "1000-700  =300"
[block_0_12_541]: "600 / 300=2 \mathrm{~g} / \mathrm{cm}^{3}"
[block_0_13_865]: "2 \mathrm{~g} / \mathrm{cm}^{3}"
[block_0_14_684]: "6"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q3] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ3[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6783[0m
     [36mRana's side elevation is a rectangle. The plan view is a rectangle with a dividing line.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_6_951][0m [C1] [34m"The height of prim i) not 4 cm"[0m
      ‚Ü≥ Reason: The student correctly identifies that the height of the prism is not 4cm.
      ‚Ü≥ OCR Match: [35m"The height of prim i) not 4 cm"[0m
      ‚Ü≥ Classification: [35m"The height of prism is not 4cm"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[line_2][0m [M1 A1] [34m"[DRAWING]"[0m
      ‚Ü≥ Reason: [DRAWING] A 7 cm by 6 cm rectangle is drawn. | [DRAWING] Correct plan drawn with dividing line.
      ‚Ü≥ Transcription: [35m"[DRAWING]"[0m
      ‚Ü≥ Classification: [35m"[DRAWING]"[0m
      ‚Ü≥ Status: [32m"VISUAL"[0m
[GUILLOTINE CHECK] Q3: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q6 has 11 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_67, block_0_1_363, block_0_2_693, block_0_3_896, block_0_4_242, block_0_5_63, block_0_6_355, block_0_7_277, block_0_9_523, block_0_10_780, block_0_11_337
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q6[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 6

## QUESTION TEXT
Tim has two biased coins, coin A and coin B. He is going to throw both coins. The probability that coin A will land on heads is 0.6. The probability that coin B will land on heads is 0.55. Complete the probability tree diagram. Tim throws coin A once and he throws coin B once. Work out the probability that both coins land on heads.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[6a]
- B1: for 0.4 in correct position
- B1: for the correct probabilities for coin B in the correct place on the branches

[6b]
- M1: for a correct method, eg $0.6 \times 0.55$ only
- A1: for 0.33 oe



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] [DRAWING] (ID: line_1)

[SUB-QUESTION A STUDENT WORK]
[Line 2] 0.45 (ID: line_2)
[Line 3] 0.55 (ID: line_3)
[Line 4] 0.4 (ID: line_4)

[SUB-QUESTION B STUDENT WORK]
[Line 5] 0.33 (ID: line_5)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_67]: "6 Tim has two biased coins, coin A and coin B."
[block_0_1_363]: "He is going to throw both coins."
[block_0_2_693]: "The probability that coin A will land on heads is 0.6"
[block_0_3_896]: "The probability that coin B will land on heads is 0.55"
[block_0_4_242]: "(a) Complete the probability tree diagram."
[block_0_5_63]: "(2)"
[block_0_6_355]: "Tim throws coin \( \mathbf{A} \) once and he throws coin \( \mathbf{B} \) once."
[block_0_7_277]: "(b) Work out the probability that both coins land on heads."
[block_0_9_523]: "0.33"
[block_0_10_780]: "(2)"
[block_0_11_337]: "7"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q1] ü•á Trusting AI Total: 2 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ1[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m1/2[0m
  - Usage tokens: [33m6335[0m
     [36mStudent shows prime factorisation of 63 and 105.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_4_591][0m [M1] [34m"63 = 3^{2} times 11"[0m
      ‚Ü≥ Reason: Correct prime factors of 63 with one error (11 instead of 7).
      ‚Ü≥ OCR Match: [35m"63 = 3^{2} times 11"[0m
      ‚Ü≥ Classification: [35m"63=3\times^2\times 11"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [31mcross[0m [34m[line_3][0m [A0] [34m"3"[0m
      ‚Ü≥ Reason: Incorrect final answer. HCF is not 3.
      ‚Ü≥ Transcription: [35m"3"[0m
      ‚Ü≥ Classification: [35m"3"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 124px to 300px for Q1
[GUILLOTINE CHECK] Q1: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=2, ResultTotal=2
[MARKING DEBUG] Q7 has 14 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_414, block_0_1_593, block_0_2_229, block_0_3_287, block_0_4_91, block_0_5_410, block_0_6_379, block_0_7_533, block_0_8_52, block_0_9_79, block_0_10_533, block_0_11_720, block_0_12_53, block_0_13_651
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q7[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 7

## QUESTION TEXT
A paddling pool is in the shape of a cylinder. The pool has radius 100 cm. The pool has depth 30 cm. The pool is empty. It is then filled with water at a rate of $250~cm^{3}$ per second. Work out the number of minutes it takes to fill the pool completely. Give your answer correct to the nearest minute. You must show all your working.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- P1: for process to find volume, eg $\pi \times 100^2 \times 30 (= 300000\pi$ or 942477(.796...))
- P1: for process to find time in seconds, eg "942477(.796...)" $\div 250 (= 1200\pi$ or 3769(.911...)) or [volume] $\div 250$ or for converting rate to minutes, eg $250 \times 60 (= 15000)$
- P1: for complete process eg "3769(.911...)" $\div 60 (= 20\pi)$ or "942477(.796...)" $\div$ "15000" $(= 20\pi)$
- A1: for answer in the range 62 to 63

FINAL ANSWER: 63



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] volume = \\pi x100^2 x 30 = 30000\\pi (ID: line_1)
[Line 2] time = \\frac{30000\\pi}{250} (ID: line_2)
[Line 3] = 120\\pi seconds (ID: line_3)
[Line 4] = 62.8 minute (ID: line_4)
[Line 5] 63 (ID: line_5)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_414]: "7 A paddling pool is in the shape of a cylinder."
[block_0_1_593]: "The pool has radius 100 cm ."
[block_0_2_229]: "The pool has depth 30 cm ."
[block_0_3_287]: "The pool is empty."
[block_0_4_91]: "It is then filled with water at a rate of \( 250 \mathrm{~cm}^{3} \) per second."
[block_0_5_410]: "Work out the number of minutes it takes to fill the pool completely."
[block_0_6_379]: "Give your answer correct to the nearest minute."
[block_0_7_533]: "You must show all your working."
[block_0_8_52]: "\text { rolume }  =\pi \times 100^{2} \times 30=300000 \pi"
[block_0_9_79]: "\text { lime }  =\frac{300000 \pi}{250}"
[block_0_10_533]: " =120 \pi \text { seconds }"
[block_0_11_720]: " =62.8 \text { minute }"
[block_0_12_53]: "63 minitutes"
[block_0_13_651]: "8"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q4] ü•á Trusting AI Total: 4 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ4[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6666[0m
     [36mThe student provided the correct calculation and final answer.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_7_222][0m [P1 P1 P1] [34m"25000 times 1.06^{3}"[0m
      ‚Ü≥ Reason: Complete process for compound interest calculation. | Evidence of a compound interest process. | Correct first step using 1.06^3.
      ‚Ü≥ OCR Match: [35m"25000 times 1.06^{3}"[0m
      ‚Ü≥ Classification: [35m"25000 x 1.06^3"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_8_600][0m [A1] [34m"29775"[0m
      ‚Ü≥ Reason: Correct final answer.
      ‚Ü≥ OCR Match: [35m"29775"[0m
      ‚Ü≥ Classification: [35m"29775"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q4: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[MARKING DEBUG] Q8 has 4 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_987, block_0_1_152, block_0_2_318, block_0_3_968
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q8[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 8

## QUESTION TEXT
$a=\binom{3}{2}$ $b=\binom{-1}{4}$. On the grid below, draw and label the vector $2a+b$.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- M1: for $2 \times 3 + -1 (= 5)$ or $2 \times 2 + 4 (= 8)$ seen as a calculation or for $\binom{2 \times 3}{2 \times 2} + \binom{-1}{4}$ or for $\binom{5}{b}$ or $\binom{a}{8}$ or for $\binom{3}{2}$ drawn or $\binom{6}{4}$ drawn or $\binom{-1}{4}$ drawn (May be in the correct position in a column vector or coordinate.)
- M1: for $\binom{5}{8}$ or for $\binom{5}{8}$ drawn with no arrow or incorrect arrow or for $\binom{5}{b}$ drawn with arrow or $\binom{a}{8}$ drawn with arrow, where $b \ne 8$ and $a \ne 5$
- A1: Vector $\binom{5}{8}$ drawn

FINAL ANSWER: Vector $\binom{5}{8}$ drawn



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 2a+b (ID: line_1)
[Line 2] —à–∞—à—ã (ID: line_2)
[Line 3] [DRAWING] (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_987]: "\( 8 \quad \mathrm{a}=\binom{3}{2} \quad \mathrm{~b}=\binom{-1}{4} \)"
[block_0_1_152]: "On the grid below, draw and label the vector \( 2 \mathrm{a}+\mathrm{b} \)"
[block_0_2_318]: "DO NOT WRITEIN THIS AREA"
[block_0_3_968]: "9"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q2] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ2[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m2/3[0m
  - Usage tokens: [33m6634[0m
     [36mN/A[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_1_996][0m [B1] [34m"53000"[0m
      ‚Ü≥ Reason: Correct ordinary number.
      ‚Ü≥ OCR Match: [35m"53000"[0m
      ‚Ü≥ Classification: [35m"53000"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[line_2][0m [B1] [34m"0.000074"[0m
      ‚Ü≥ Reason: Correct ordinary number.
      ‚Ü≥ Transcription: [35m"0.000074"[0m
      ‚Ü≥ Classification: [35m"0.000074"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [31mcross[0m [34m[block_0_7_640][0m [M1 A1] [34m"3.42times 10^{-6}"[0m
      ‚Ü≥ Reason: Incorrect power of 10. | Incorrect final answer.
      ‚Ü≥ OCR Match: [35m"3.42times 10^{-6}"[0m
      ‚Ü≥ Classification: [35m"3.42√ó10"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[BUDGET Q5] ü•á Trusting AI Total: 4 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ5[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6870[0m
     [36mNo drawing present.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_9_933][0m [P1] [34m"frac{600}{0.6}"[0m
      ‚Ü≥ Reason: Correct process to find volume of tin.
      ‚Ü≥ OCR Match: [35m"frac{600}{0.6}"[0m
      ‚Ü≥ Classification: [35m"Volume of tin= \frac{600}{0.6}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_10_606][0m [P1] [34m"= 100 mathrm{~cm}^{3}"[0m
      ‚Ü≥ Reason: Correct process to find volume of salt.
      ‚Ü≥ OCR Match: [35m"= 100 mathrm{~cm}^{3}"[0m
      ‚Ü≥ Classification: [35m"= 1000cm¬≥"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_11_271][0m [P1] [34m"1000-700 = 300"[0m
      ‚Ü≥ Reason: Correct process to find density of the salt.
      ‚Ü≥ OCR Match: [35m"1000-700 = 300"[0m
      ‚Ü≥ Classification: [35m"1000-700=300"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_12_541][0m [A1] [34m"600 / 300 = 2 mathrm{~g} / mathrm{cm}^{3}"[0m
      ‚Ü≥ Reason: Correct final answer.
      ‚Ü≥ OCR Match: [35m"600 / 300 = 2 mathrm{~g} / mathrm{cm}^{3}"[0m
      ‚Ü≥ Classification: [35m"600/300=2g/cm¬≥"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q2: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[GUILLOTINE CHECK] Q5: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[MARKING DEBUG] Q9 has 7 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_964, block_0_1_545, block_0_2_551, block_0_3_622, block_0_4_885, block_0_5_663, block_0_6_909
[MARKING DEBUG] Q10 has 12 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_202, block_0_1_948, block_0_2_883, block_0_3_991, block_0_4_741, block_0_5_742, block_0_6_166, block_0_7_757, block_0_8_892, block_0_9_51, block_0_10_239, block_0_11_247
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q9[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 9

## QUESTION TEXT
The diagram shows a cube and a square-based pyramid. [A cube with side length 6cm. A square-based pyramid with base side length 8cm and vertical height h cm.] The volume of the cube is equal to the volume of the pyramid. Work out the perpendicular height, h cm, of the pyramid.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- P1: for process to find volume of at least one of the cube or the pyramid, eg $6 \times 6 \times 6 (= 216)$ oe or $k \times 8 \times 8 \times h (= \frac{64}{3}h)$ oe
- P1: for process to form an equation, eg $6 \times 6 \times 6 = k \times 8 \times 8 \times h$ or "216" $= \frac{64}{3}h$ or for process to find h eg "216" $\div 8^2 \div k$
- A1: for 10.125 oe mixed number

FINAL ANSWER: 10.125



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 6^3=8^2h \times \frac{1}{3} (ID: line_1)
[Line 2] h=\frac{81}{8} (ID: line_2)
[Line 3] \frac{81}{8} (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_964]: "9 The diagram shows a cube and a square-based pyramid."
[block_0_1_545]: "The volume of the cube is equal to the volume of the pyramid."
[block_0_2_551]: "Work out the perpendicular height, hcm, of the pyramid."
[block_0_3_622]: "b^{3}=8^{2} h \times 1 / 3"
[block_0_4_885]: "h=\frac{81}{8}"
[block_0_5_663]: "\frac{81}{8} \mathrm{~cm}"
[block_0_6_909]: "10"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q10[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 10

## QUESTION TEXT
There are only red counters and yellow counters in bag A. number of red counters : number of yellow counters = 3 : 5. There are only green counters and blue counters in bag B. The number of counters in bag B is half the number of counters in bag A. Given that there are x red counters in bag A, use algebra to show that the total number of counters in bag A and bag B is 4x.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- M1: for method to find the number of yellow counters in bag A, eg $x \div 3 \times 5 (= \frac{5x}{3})$ or for method to find the total number of counters in bag A eg $x \div 3 \times 8 (= \frac{8x}{3})$ or for starting to work with ratio using algebra eg 3y, 5y
- M1: (dep) for method to find the total number of counters in bag B, eg $(x + \frac{5x}{3}) \div 2 (= \frac{4x}{3})$ or $\frac{8x}{3} \div 2 (= \frac{4x}{3})$ or $(3y + 5y) \div 2 (= 4y)$
- C1: for complete method showing that total number of counters in bag A and bag B is 4x, eg $\frac{8x}{3} + \frac{4x}{3} = 4x$ or $3y + 5y + 4y = 12y$ and $12y \div 3y \times x = 4x$

FINAL ANSWER: Result shown



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] x red \Rightarrow \frac{5}{3}x yellow (ID: line_1)
[Line 2] = \frac{8}{3}x counters in A (ID: line_2)
[Line 3] = \frac{4}{3}x counters in B (ID: line_3)
[Line 4] = \frac{4}{3}x + \frac{8}{3}x total counters (ID: line_4)
[Line 5] = 4x counters (ID: line_5)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_202]: "10 There are only red counters and yellow counters in bag A."
[block_0_1_948]: "number of red counters : number of yellow counters \( =3: 5 \)"
[block_0_2_883]: "There are only green counters and blue counters in bag B."
[block_0_3_991]: "The number of counters in bag \( B \) is half the number of counters in bag \( A \)."
[block_0_4_741]: "Given that there are \( x \) red counters in bag A,"
[block_0_5_742]: "use algebra to show that the total number of counters in bag \( A \) and bag \( B \) is \( 4 x \)"
[block_0_6_166]: "\( x \) red \( \Rightarrow 3 / 3 x \) yollow"
[block_0_7_757]: "\( =8 / 3 x \) couters in \( A \)"
[block_0_8_892]: "\( =\frac{4}{3} x \) anites in \( B \)"
[block_0_9_51]: "\( =\frac{4}{3} x+\frac{8}{3} x \) totel carater"
[block_0_10_239]: "\( =4 x \) conters"
[block_0_11_247]: "11"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q10] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ10[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6820[0m
     [36mThe student uses algebra to show that the total number of counters in bag A and bag B is 4x.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_6_166][0m [M1] [34m"x red Rightarrow 3/3 x yollow"[0m
      ‚Ü≥ Reason: Finds the number of yellow counters in bag A, but has an error.
      ‚Ü≥ OCR Match: [35m"x red Rightarrow 3/3 x yollow"[0m
      ‚Ü≥ Classification: [35m"x red \Rightarrow \frac{5}{3}x yellow"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_8_892][0m [M1] [34m"= frac{4}{3} x anites in B"[0m
      ‚Ü≥ Reason: Finds the total number of counters in bag B.
      ‚Ü≥ OCR Match: [35m"= frac{4}{3} x anites in B"[0m
      ‚Ü≥ Classification: [35m"= \frac{4}{3}x counters in B"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_10_239][0m [C1] [34m"= 4 x conters"[0m
      ‚Ü≥ Reason: Shows that the total number of counters in bag A and bag B is 4x.
      ‚Ü≥ OCR Match: [35m"= 4 x conters"[0m
      ‚Ü≥ Classification: [35m"= 4x counters"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q10: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q11 has 32 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_691, block_0_1_136, block_0_2_705, block_0_3_628, block_0_4_776, block_0_5_506, block_0_6_432, block_0_7_74, block_0_9_16, block_0_10_285, block_0_11_510, block_0_12_555, block_0_13_319, block_0_14_833, block_0_16_395, block_0_17_175, block_0_19_71, block_0_21_37, block_0_22_480, block_0_24_290, block_0_26_165, block_0_27_729, block_0_28_32, block_0_30_918, block_0_32_770, block_0_33_227, block_0_34_340, block_0_35_876, block_0_37_561, block_0_38_642, block_0_40_968, block_0_41_251
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q11[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 11

## QUESTION TEXT
Mina records the speeds, in mph, of some cars on a road on Friday. She uses her results to work out the information in this table. [Lowest speed: 25, Lower quartile: 35, Median: 40, Interquartile range: 12, Range: 37]. On the grid, draw a box plot to show the information in the table. Mina also records the speeds of some cars on the same road on Sunday. She uses her results to draw this box plot. [Box plot for Sunday is shown]. Compare the distribution of the speeds on Friday with the distribution of the speeds on Sunday.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[11a]
- M1: for method to find UQ (47) or greatest value (62) from the table
- M1: for showing a box and at least 3 correctly plotted values from 25, 35, 40, 47, 62
- A1: for a fully correct box plot

[11b]
- C1: ft a correct comparison of medians from figures, eg the median speed for Sunday was greater than the median speed for Friday or the speed on Friday is generally lower as the median is lower
- C1: ft for a correct comparison of spread, eg the (interquartile) range of the speeds for Friday is smaller than the (interquartile) range of the speeds for Sunday, the (interquartile) range on Sunday is larger than the (interquartile) range on Friday. Comparisons for this mark can relate to the range or the IQR



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] [DRAWING] (ID: line_1)

[SUB-QUESTION B STUDENT WORK]
[Line 2] The medion is higher on Sunday compore to Fridoy. (ID: line_2)
[Line 3] Mas 42>40. (ID: line_3)
[Line 4] The ronge die is also higher on Sunday as (ID: line_4)
[Line 5] 44>37. (ID: line_5)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_691]: "11 Mina records the speeds, in mph, of some cars on a road on Friday."
[block_0_1_136]: "She uses her results to work out the information in this table."
[block_0_2_705]: "\begin{tabular}{|l|c|} \cline { 2 - 2 } \multicolumn{1}{c|}{} & Speed (mph)"
[block_0_3_628]: "\hline Lowest speed & 25"
[block_0_4_776]: "\hline Lower quartile & 35"
[block_0_5_506]: "\hline Median & 40"
[block_0_6_432]: "\hline Interquartile range & 12"
[block_0_7_74]: "\hline Range & 37"
[block_0_9_16]: "(a) On the grid, draw a box plot to show the information in the table."
[block_0_10_285]: "(3)"
[block_0_11_510]: "Mina also records the speeds of some cars on the same road on Sunday."
[block_0_12_555]: "She uses her results to draw this box plot."
[block_0_13_319]: "(b) Compare the distribution of the speeds on Friday with the distribution of the speeds"
[block_0_14_833]: "on Sunday."
[block_0_16_395]: "- The medion is higher on"
[block_0_17_175]: "compose to Fridoy."
[block_0_19_71]: "a)"
[block_0_21_37]: "42"
[block_0_22_480]: "42>40."
[block_0_24_290]: "- The"
[block_0_26_165]: "ronge"
[block_0_27_729]: "OVE"
[block_0_28_32]: "i)"
[block_0_30_918]: "also"
[block_0_32_770]: "higher"
[block_0_33_227]: "00"
[block_0_34_340]: "Sundoy"
[block_0_35_876]: "as"
[block_0_37_561]: "\( 44>37 \)."
[block_0_38_642]: "."
[block_0_40_968]: "(2)"
[block_0_41_251]: "12"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q8] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ8[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m0/3[0m
  - Usage tokens: [33m6417[0m
     [36mThe student has drawn a vector on the grid.[0m
  - Annotations:
    1. [31mcross[0m [34m[line_1][0m [M0] [34m"2a+b"[0m
      ‚Ü≥ Reason: No calculation of 2 * a + b is shown.
      ‚Ü≥ Transcription: [35m"2a+b"[0m
      ‚Ü≥ Classification: [35m"2a+b"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [31mcross[0m [34m[line_3][0m [M0 A0] [34m"[DRAWING]"[0m
      ‚Ü≥ Reason: [DRAWING] Vector is not (5, 8).
      ‚Ü≥ Transcription: [35m"[DRAWING]"[0m
      ‚Ü≥ Classification: [35m"[DRAWING]"[0m
      ‚Ü≥ Status: [32m"VISUAL"[0m
[WIDTH FIX] Boosting tiny width 248px to 300px for Q8
[GUILLOTINE CHECK] Q8: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q12 has 4 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_368, block_0_1_329, block_0_3_318, block_0_2_889
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=2

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q12[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 12

## QUESTION TEXT
The diagram shows triangle T drawn on a grid. [Triangle T vertices at (1,2), (1,3), (3,2)]. Enlarge triangle T by scale factor -2 with centre of enlargement (0,0).


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 2]
- B2: for correct enlargement (-2, -4), (-2, -6), (-6, -4)
- (B1: for correct size and orientation but incorrect position or 2 out of 3 vertices correctly placed)

FINAL ANSWER: Correct enlargement



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] [DRAWING] (ID: line_1)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_368]: "12 The diagram shows triangle T drawn on a grid."
[block_0_1_329]: "Enlarge triangle \( \mathbf{T} \) by scale factor \( -\mathbf{2} \) with centre of enlargement \( (0,0) \)"
[block_0_3_318]: "13"
[block_0_2_889]: "1"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q6] ü•á Trusting AI Total: 4 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ6[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6576[0m
     [36mProbability tree diagram completed with probabilities.[0m
  - Annotations:
    1. [32mtick[0m [34m[line_4][0m [B1] [34m"0.4"[0m
      ‚Ü≥ Reason: Correct probability of 0.4 in the correct position.
      ‚Ü≥ Transcription: [35m"0.4"[0m
      ‚Ü≥ Classification: [35m"0.4"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[line_3][0m [B1] [34m"0.55"[0m
      ‚Ü≥ Reason: Correct probabilities for coin B in the correct place.
      ‚Ü≥ Transcription: [35m"0.55"[0m
      ‚Ü≥ Classification: [35m"0.55"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[block_0_9_523][0m [M1 A1] [34m"0.33"[0m
      ‚Ü≥ Reason: Correct method: 0.6 x 0.55. | Correct answer of 0.33.
      ‚Ü≥ OCR Match: [35m"0.33"[0m
      ‚Ü≥ Classification: [35m"0.33"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[WIDTH FIX] Boosting tiny width 149px to 300px for Q6
[WIDTH FIX] Boosting tiny width 149px to 300px for Q6
[GUILLOTINE CHECK] Q6: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[MARKING DEBUG] Q13 has 22 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_365, block_0_1_46, block_0_2_272, block_0_3_191, block_0_5_164, block_0_6_708, block_0_7_997, block_0_8_203, block_0_9_637, block_0_10_920, block_0_11_617, block_0_12_366, block_0_13_619, block_0_14_16, block_0_15_88, block_0_16_138, block_0_17_917, block_0_18_385, block_0_19_14, block_0_20_454, block_0_21_455, block_0_22_146
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=2

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q13[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 13

## QUESTION TEXT
There are 30 students in a class. A teacher is going to choose at random 2 of the students. Work out the number of different pairs of students that the teacher can choose.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 2]
- M1: for start to method of finding the number of pairs, eg $30 \times 29 (= 870)$ oe or $\frac{30 \times 29}{2}$ or clear intention to sum the integers from 1 to 29 eg $29 + 28 + ... + 2 + 1$
- A1: 435

FINAL ANSWER: 435



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] \frac{30x29}{2} (ID: line_1)
[Line 2] 435 (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_365]: "13 There are 30 students in a class."
[block_0_1_46]: "A teacher is going to choose at random 2 of the students."
[block_0_2_272]: "Work out the number of different pairs of students that the teacher can choose."
[block_0_3_191]: "\frac{30 \times 29}{2}"
[block_0_5_164]: "435"
[block_0_6_708]: "14 At the start of 2022 Kim invested some money in a savings account."
[block_0_7_997]: "The account paid \( 3.5 \% \) compound interest each year."
[block_0_8_203]: "At the end of 2022"
[block_0_9_637]: "interest was added to the account then Kim took \( ¬£ 750 \) from the account."
[block_0_10_920]: "At the end of 2023"
[block_0_11_617]: "interest was added to the account then Kim took \( ¬£ 1000 \) from the account."
[block_0_12_366]: "There was then \( ¬£ 2937.14 \) in the account."
[block_0_13_619]: "Work out how much money Kim invested at the start of 2022"
[block_0_14_16]: "You must show all your working."
[block_0_15_88]: "2937.14+1000 &"
[block_0_16_138]: "=39 & 37.14"
[block_0_17_917]: "3437.14  =x \times 1.039"
[block_0_18_385]: "x  =2804"
[block_0_19_14]: "3804 \quad 4750  =y \times 1.039"
[block_0_20_454]: "y  =\frac{1048908}{4400}"
[block_0_21_455]: "&"
[block_0_22_146]: "14"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q9] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ9[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6484[0m
     [36mThe student provides calculations for the volume of a cube and a square-based pyramid and attempts to equate them to solve for h.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_3_622][0m [P1] [34m"b^{3} = 8^{2} h times 1 / 3"[0m
      ‚Ü≥ Reason: Correctly equates the volume of the cube to the volume of the pyramid.
      ‚Ü≥ OCR Match: [35m"b^{3} = 8^{2} h times 1 / 3"[0m
      ‚Ü≥ Classification: [35m"6^3=8^2h \times \frac{1}{3}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_4_885][0m [P1] [34m"h = frac{81}{8}"[0m
      ‚Ü≥ Reason: Correct process to find h.
      ‚Ü≥ OCR Match: [35m"h = frac{81}{8}"[0m
      ‚Ü≥ Classification: [35m"h=\frac{81}{8}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_5_663][0m [A1] [34m"frac{81}{8} mathrm{~cm}"[0m
      ‚Ü≥ Reason: Correct answer of 81/8.
      ‚Ü≥ OCR Match: [35m"frac{81}{8} mathrm{~cm}"[0m
      ‚Ü≥ Classification: [35m"\frac{81}{8} \mathrm{~cm}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q9: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q14 has 22 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_365, block_0_1_46, block_0_2_272, block_0_3_191, block_0_5_164, block_0_6_708, block_0_7_997, block_0_8_203, block_0_9_637, block_0_10_920, block_0_11_617, block_0_12_366, block_0_13_619, block_0_14_16, block_0_15_88, block_0_16_138, block_0_17_917, block_0_18_385, block_0_19_14, block_0_20_454, block_0_21_455, block_0_22_146
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q14[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 14

## QUESTION TEXT
At the start of 2022 Kim invested some money in a savings account. The account paid 3.5% compound interest each year. At the end of 2022 interest was added to the account then Kim took ¬£750 from the account. At the end of 2023 interest was added to the account then Kim took ¬£1000 from the account. There was then ¬£2937.14 in the account. Work out how much money Kim invested at the start of 2022. You must show all your working.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- P1: for start to processes needed to find the investment, eg $2937.14 + 1000 (= 3937.14)$ OR starts to work with algebra, eg $P \times 1.035 - 750$
- P1: for process to find amount of money at the beginning of 2023 after the first withdrawal, eg "3937.14" $\div 1.035 (= 3804)$ or $[value] \div 1.035$ OR writes down complete equation, eg $(P \times 1.035 - 750) \times 1.035 - 1000 = 2937.14$ to find $1.035P - 750$
- P1: for complete process, eg $("3804" + 750) \div 1.035$ OR for a start to the process to solve the equation eg $1.035P - 750 = 3804$ or $P \times 1.035 - 750 = \frac{2937.14 + 1000}{1.035}$ or for a start to the process to solve the complete equation eg $1.035^2P - 776.25 = 2937.14 + 1000$ or $1.035^2P - 1000 = 2937.14 + 776.25$ or $1.035^2P = 2937.14 + 776.25 + 1000$
- A1: 4400

FINAL ANSWER: 4400



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 2937.14 +1000 (ID: line_1)
[Line 2] = 3937.14 (ID: line_2)
[Line 3] 3037.14= x \\times 1.035 (ID: line_3)
[Line 4] x =  at end of 2022 (ID: line_4)
[Line 5]  +750 = y \\times 1.035 (ID: line_5)
[Line 6] y=  (ID: line_6)
[Line 7] 4400 (ID: line_7)
[Line 8] ¬£ 4400 (ID: line_8)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_365]: "13 There are 30 students in a class."
[block_0_1_46]: "A teacher is going to choose at random 2 of the students."
[block_0_2_272]: "Work out the number of different pairs of students that the teacher can choose."
[block_0_3_191]: "\frac{30 \times 29}{2}"
[block_0_5_164]: "435"
[block_0_6_708]: "14 At the start of 2022 Kim invested some money in a savings account."
[block_0_7_997]: "The account paid \( 3.5 \% \) compound interest each year."
[block_0_8_203]: "At the end of 2022"
[block_0_9_637]: "interest was added to the account then Kim took \( ¬£ 750 \) from the account."
[block_0_10_920]: "At the end of 2023"
[block_0_11_617]: "interest was added to the account then Kim took \( ¬£ 1000 \) from the account."
[block_0_12_366]: "There was then \( ¬£ 2937.14 \) in the account."
[block_0_13_619]: "Work out how much money Kim invested at the start of 2022"
[block_0_14_16]: "You must show all your working."
[block_0_15_88]: "2937.14+1000 &"
[block_0_16_138]: "=39 & 37.14"
[block_0_17_917]: "3437.14  =x \times 1.039"
[block_0_18_385]: "x  =2804"
[block_0_19_14]: "3804 \quad 4750  =y \times 1.039"
[block_0_20_454]: "y  =\frac{1048908}{4400}"
[block_0_21_455]: "&"
[block_0_22_146]: "14"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q7] ü•á Trusting AI Total: 4 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ7[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6950[0m
     [36mThe student calculates the volume of the cylinder, then divides by the rate to find the time in seconds, and converts to minutes, rounding to the nearest minute.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_8_52][0m [P1] [34m"pi x100^2 x 30 = 300000pi"[0m
      ‚Ü≥ Reason: Correct process to find the volume of the cylinder.
      ‚Ü≥ OCR Match: [35m"pi x100^2 x 30 = 300000pi"[0m
      ‚Ü≥ Classification: [35m"volume = \pi x100^2 x 30 = 30000\pi"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_9_79][0m [P1] [34m"frac{300000 pi}{250}"[0m
      ‚Ü≥ Reason: Correct process to find the time in seconds.
      ‚Ü≥ OCR Match: [35m"frac{300000 pi}{250}"[0m
      ‚Ü≥ Classification: [35m"time = \frac{30000\pi}{250}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_10_533][0m [P1] [34m"= 120 pi seconds"[0m
      ‚Ü≥ Reason: Correct process to convert seconds to minutes.
      ‚Ü≥ OCR Match: [35m"= 120 pi seconds"[0m
      ‚Ü≥ Classification: [35m"= 120\pi seconds"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_12_53][0m [A1] [34m"63 minitutes"[0m
      ‚Ü≥ Reason: Correct answer in the range 62 to 63.
      ‚Ü≥ OCR Match: [35m"63 minitutes"[0m
      ‚Ü≥ Classification: [35m"63"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q7: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[MARKING DEBUG] Q15 has 11 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_324, block_0_1_377, block_0_2_926, block_0_3_313, block_0_4_663, block_0_6_840, block_0_5_870, block_0_7_396, block_0_8_513, block_0_9_978, block_0_10_42
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q15[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 15

## QUESTION TEXT
Simplify fully $\frac{(a-3)^{2}}{5(a-3)}$ Factorise $3k^{2}+11k-4$ Simplify fully $\frac{4-x^{2}}{x^{2}+3x} \div \frac{x+2}{x+3}$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[15a]
- B1: for $\frac{a-3}{5}$ oe

[15b]
- M1: for $(3k \pm 1)(k \pm 4)$ oe or for brackets which when expanded give 2 out of 3 terms correct
- A1: cao

[15c]
- M1: for factorisation eg $(4-x^2=)(2-x)(2+x)$ and $(x^2+3x=)x(x+3)$ or for inversion and multiplication (condone incorrect factorising) eg $\frac{4-x^2}{x^2+3x} \times \frac{x+3}{x+2}$ oe
- M1: for factorisation of both quadratics and inversion and multiplication, eg $\frac{(2-x)(2+x)}{x(x+3)} \times \frac{x+3}{x+2}$ allow sign errors in one bracket
- A1: for $\frac{2-x}{x}$ or $\frac{2}{x}-1$



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] \frac{a-3}{5} (ID: line_1)

[SUB-QUESTION B STUDENT WORK]
[Line 2] (3k-1)(k+4) (ID: line_2)

[SUB-QUESTION C STUDENT WORK]
[Line 3] = \frac{2-x(x2+x)}{x(3+L)} \times \frac{x+3}{x+2} (ID: line_3)
[Line 4] \frac{2-x}{x} (ID: line_4)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_324]: "15 (a) Simplify fully \( \frac{(a-3)^{2}}{5(a-3)} \)"
[block_0_1_377]: "\frac{d \cdot 3}{s}"
[block_0_2_926]: "(1)"
[block_0_3_313]: "(b) Factorise \( \mathbf{3} \boldsymbol{k}^{\mathbf{2}}+\mathbf{1 1} \boldsymbol{k}-\mathbf{4} \)"
[block_0_4_663]: "\( (3 k-1)(k+4) \)"
[block_0_6_840]: "(c) Simplify fully \( \frac{4-x^{2}}{x^{2}+3 x} \div \frac{x+2}{x+3} \)"
[block_0_5_870]: "(2)"
[block_0_7_396]: "=\frac{(2-x)(2+x)}{x(3+x)} \times \frac{x+7}{x+2}"
[block_0_8_513]: "\frac{2-x}{x}"
[block_0_9_978]: "(3)"
[block_0_10_42]: "15"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q12] ü•á Trusting AI Total: 2 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ12[0m - Clean response received:
  - Annotations count: [35m1[0m
  - Student score: [32m2/2[0m
  - Usage tokens: [33m5977[0m
     [36mTriangle T enlarged by a scale factor of -2 with center of enlargement (0,0). Vertices at (-2, -4), (-2, -6), and (-6, -4).[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [B2] [34m"[DRAWING]"[0m
      ‚Ü≥ Reason: [DRAWING] Correct enlargement with vertices at (-2, -4), (-2, -6), and (-6, -4).
      ‚Ü≥ Transcription: [35m"[DRAWING]"[0m
      ‚Ü≥ Classification: [35m"[DRAWING]"[0m
      ‚Ü≥ Status: [32m"VISUAL"[0m
[GUILLOTINE CHECK] Q12: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=2, ResultTotal=2
[MARKING DEBUG] Q16 has 13 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_192, block_0_1_746, block_0_2_611, block_0_4_489, block_0_5_577, block_0_6_237, block_0_9_69, block_0_8_693, block_0_10_564, block_0_11_964, block_0_13_396, block_0_14_781, block_0_15_866
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q16[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 16

## QUESTION TEXT
The functions f and g are given by $f(x)=\frac{12}{x+1}$ and $g(x)=5-3x$ Find $f(-3)$ Find $fg(1)$ Find $g^{-1}(4)$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[16a]
- B1: cao

[16b]
- M1: for $g(1) = 5 - 3 \times 1 (= 2)$ and a clear intention to find $f("2")$ or for $\frac{12}{5-3 \times 1+1}$ or for stating fg, eg $\frac{12}{5-3x+1}$ oe
- A1: cao

[16c]
- M1: for $g^{-1}$ as $\frac{5-x}{3}$ oe or for $5-3x=4$ or $g(\frac{1}{3}) = 5-1 = 4$
- A1: for $\frac{1}{3}$ oe eg 0.33(3...)



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] -6 (ID: line_1)

[SUB-QUESTION B STUDENT WORK]
[Line 2] 4 (ID: line_2)

[SUB-QUESTION C STUDENT WORK]
[Line 3] \frac{1}{3} (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_192]: "16 The functions f and g are given by"
[block_0_1_746]: "\mathrm{f}(x)=\frac{12}{x+1} \text { and } \mathrm{g}(x)=5-3 x"
[block_0_2_611]: "(a) Find \( f(-3) \)"
[block_0_4_489]: "-6"
[block_0_5_577]: "(1)"
[block_0_6_237]: "(b) Find \( \mathrm{fg}(\mathrm{l}) \)"
[block_0_9_69]: "4"
[block_0_8_693]: "4"
[block_0_10_564]: "(2)"
[block_0_11_964]: "(c) Find \( g^{-1}(4) \)"
[block_0_13_396]: "1 / 3"
[block_0_14_781]: "(2)"
[block_0_15_866]: "16"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q13] ü•á Trusting AI Total: 2 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ13[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m2/2[0m
  - Usage tokens: [33m6570[0m
     [36mThe student provides the correct calculation and answer.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_3_191][0m [M1] [34m"frac{30 times 29}{2}"[0m
      ‚Ü≥ Reason: Correct method to find the number of pairs.
      ‚Ü≥ OCR Match: [35m"frac{30 times 29}{2}"[0m
      ‚Ü≥ Classification: [35m"\frac{30x29}{2}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_5_164][0m [A1] [34m"435"[0m
      ‚Ü≥ Reason: Correct final answer.
      ‚Ü≥ OCR Match: [35m"435"[0m
      ‚Ü≥ Classification: [35m"435"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q13: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=2, ResultTotal=2
[MARKING DEBUG] Q17 has 10 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_365, block_0_1_987, block_0_2_889, block_0_3_147, block_0_4_764, block_0_5_139, block_0_6_717, block_0_7_770, block_0_8_74, block_0_9_291
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q17[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 17

## QUESTION TEXT
A ball is thrown upwards and reaches a maximum height. The ball then falls and bounces repeatedly. After the nth bounce, the ball reaches a height of $h_{n}$. After the next bounce, the ball reaches a height given by $h_{n+1}=0.55h_{n}$. After the 1st bounce, the ball reaches a height of 8 metres. What height does the ball reach after the 4th bounce?


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- M1: for method to find height after 2nd bounce, eg $0.55 \times 8 (= 4.4)$
- M1: for method to find height after 3rd bounce, eg $0.55 \times "4.4" (= 2.4(2))$ or for method to find height after 4th bounce, eg $0.55^3 \times 8$ or for method to find height after 5th bounce, eg $0.55^4 \times 8 (= 0.73(205))$
- A1: for 1.331, accept 1.33, 1.3 oe mixed number

FINAL ANSWER: 1.331



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 8x0.55^3 (ID: line_1)
[Line 2] 1.331 (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_365]: "17 A ball is thrown upwards and reaches a maximum height."
[block_0_1_987]: "The ball then falls and bounces repeatedly."
[block_0_2_889]: "After the \( n \)th bounce, the ball reaches a height of \( h_{n} \)"
[block_0_3_147]: "After the next bounce, the ball reaches a height given by \( h_{n+1}=0.55 h_{n} \)"
[block_0_4_764]: "After the 1st bounce, the ball reaches a height of 8 metres."
[block_0_5_139]: "What height does the ball reach after the 4th bounce?"
[block_0_6_717]: "8 \times 0.99^{3}"
[block_0_7_770]: "1.33"
[block_0_8_74]: "metres"
[block_0_9_291]: "17"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q11] ü•á Trusting AI Total: 5 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ11[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m2/5[0m
  - Usage tokens: [33m7340[0m
     [36mThe student has attempted to draw a box plot.[0m
  - Annotations:
    1. [31mcross[0m [34m[line_1][0m [M0 A0] [34m"[DRAWING]"[0m
      ‚Ü≥ Reason: [DRAWING] Box plot is missing or incorrect. No correct values plotted.
      ‚Ü≥ Transcription: [35m"[DRAWING]"[0m
      ‚Ü≥ Classification: [35m"[DRAWING]"[0m
      ‚Ü≥ Status: [32m"VISUAL"[0m
    2. [32mtick[0m [34m[line_2][0m [C1] [34m"The medion is higher on Sunday compore to Fridoy."[0m
      ‚Ü≥ Reason: Correct comparison of medians: Sunday's median is higher than Friday's.
      ‚Ü≥ Transcription: [35m"The medion is higher on Sunday compore to Fridoy."[0m
      ‚Ü≥ Classification: [35m"The medion is higher on Sunday compore to Fridoy."[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_4][0m [C1] [34m"The ronge die is also higher on Sunday as"[0m
      ‚Ü≥ Reason: Correct comparison of ranges: Sunday's range is higher than Friday's.
      ‚Ü≥ Transcription: [35m"The ronge die is also higher on Sunday as"[0m
      ‚Ü≥ Classification: [35m"The ronge die is also higher on Sunday as"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[GUILLOTINE CHECK] Q11: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=5, ResultTotal=5
[MARKING DEBUG] Q18 has 11 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_273, block_0_1_105, block_0_2_265, block_0_3_242, block_0_4_374, block_0_5_546, block_0_6_125, block_0_7_205, block_0_8_494, block_0_9_280, block_0_10_574
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=5

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q18[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 18

## QUESTION TEXT
ABCD is a quadrilateral. [Triangle ABC with angle BAC = 35 degrees, Angle ACB = 48 degrees, side AB = 17cm. Triangle ACD attached to AC with angle CAD = 57 degrees]. The area of triangle ABC is $54~cm^{2}$. Calculate the area of triangle ACD. Give your answer correct to 3 significant figures.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 5]
- P1: for start of process to find length of AC, eg $\frac{1}{2} \times 17 \times AC \times \sin 35 = 54$ or $(AC = ) 54 \div (\frac{1}{2} \times 17 \times \sin 35) (\approx 11.076...)$
- P1: for start of process to find AD or CD, eg $\frac{AD}{\sin 48} = \frac{"11.076"}{\sin 57}$ or $\frac{AD}{\sin 48} = \frac{[AC]}{\sin 57}$ oe or $\frac{CD}{\sin "75"} = \frac{"11.076"}{\sin 57}$ or $\frac{CD}{\sin "75"} = \frac{[AC]}{\sin 57}$ oe
- P1: for complete process to find AD or CD $(AD=) \frac{"11.076"}{\sin 57} \times \sin 48 (= 9.81...)$ or $(AD=) \frac{[AC]}{\sin 57} \times \sin 48$ or $(CD=) \frac{"11.076"}{\sin 57} \times \sin "75" (= 12.7...)$ or $(CD=) \frac{[AC]}{\sin 57} \times \sin "75"
- P1: for process to find area of triangle ACD, $\frac{1}{2} \times "11.076" \times "12.7" \times \sin 48$ or $\frac{1}{2} \times [AC] \times [CD] \times \sin 48$ or $\frac{1}{2} \times "11.076" \times "9.81" \times \sin "75"$ or $\frac{1}{2} \times [AC] \times [AD] \times \sin "75"$ or $\frac{1}{2} \times "9.81" \times "12.7" \times \sin 57$ or $\frac{1}{2} \times [AD] \times [CD] \times \sin 57$
- A1: for answer in the range 52.4 to 52.52

FINAL ANSWER: 52.5



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 54= \\frac{1}{2}x17x ACx sin 35 (ID: line_1)
[Line 2] AC = 11.08 (ID: line_2)
[Line 3] AD = \\frac{11.08}{sin 57} x sin (48) (ID: line_3)
[Line 4] = 9.81 (ID: line_4)
[Line 5] Area= \\frac{1}{2}x 9.81 x 11.08 x sin (180-48-57) (ID: line_5)
[Line 6] = 52.5 (ID: line_6)
[Line 7] 52.5 (ID: line_7)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_273]: "\( 18 A B C D \) is a quadrilateral."
[block_0_1_105]: "The area of triangle \( A B C \) is \( 54 \mathrm{~cm}^{2} \)"
[block_0_2_265]: "Calculate the area of triangle \( A C D \)."
[block_0_3_242]: "Give your answer correct to 3 significant figures."
[block_0_4_374]: "\rho_{4}  =\frac{1}{2} \times 17 \times A(\times \sin 35"
[block_0_5_546]: "H C  =11.08"
[block_0_6_125]: "A D  =\frac{1.108}{\sin 51} \times \sin (48)"
[block_0_7_205]: " =9.81"
[block_0_8_494]: "\text { Area }  =18 \times 1.08 \times \sin (180.48 .57)"
[block_0_9_280]: " =52.5"
[block_0_10_574]: "18"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q14] ü•á Trusting AI Total: 4 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ14[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m7450[0m
     [36mThe student shows calculations to find the initial investment amount.[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [P1] [34m"2937.14 +1000"[0m
      ‚Ü≥ Reason: Adds 1000 to 2937.14, starting the process to find the initial investment.
      ‚Ü≥ Transcription: [35m"2937.14 +1000"[0m
      ‚Ü≥ Classification: [35m"2937.14 +1000"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[line_2][0m [P1] [34m"= 3937.14"[0m
      ‚Ü≥ Reason: Correctly calculates 2937.14 + 1000 = 3937.14.
      ‚Ü≥ Transcription: [35m"= 3937.14"[0m
      ‚Ü≥ Classification: [35m"= 3937.14"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_5][0m [P1] [34m"+750 = y times 1.035"[0m
      ‚Ü≥ Reason: Correctly sets up the equation to find the amount before the first withdrawal.
      ‚Ü≥ Transcription: [35m"+750 = y times 1.035"[0m
      ‚Ü≥ Classification: [35m"+750 = y \times 1.035"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    4. [32mtick[0m [34m[line_7][0m [A1] [34m"4400"[0m
      ‚Ü≥ Reason: Correct final answer of 4400.
      ‚Ü≥ Transcription: [35m"4400"[0m
      ‚Ü≥ Classification: [35m"4400"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 249px to 300px for Q14
[GUILLOTINE CHECK] Q14: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[MARKING DEBUG] Q19 has 10 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_853, block_0_1_815, block_0_2_829, block_0_3_968, block_0_4_570, block_0_5_313, block_0_6_396, block_0_7_267, block_0_8_742, block_0_9_594
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q19[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 19

## QUESTION TEXT
$R=\frac{P}{Q}$. $P=5.88\times10^{8}$ correct to 3 significant figures. $Q=3.6\times10^{5}$ correct to 2 significant figures. Work out the lower bound for R. Give your answer as an ordinary number correct to the nearest integer. You must show all your working.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- B1: for $5.875 \times 10^8$ or $5.885 \times 10^8$ or $3.55 \times 10^5$ or $3.65 \times 10^5$ or the digits 5875 or 5885 or 355 or 365
- M1: for method to find lower bound $\frac{[LB]}{[UB]}$ eg $(5.875 \times 10^8) \div (3.65 \times 10^5)$ oe
- A1: for answer in range 1609 - 1610 from correct working

FINAL ANSWER: 1610



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] LMB of P= 5.875x10^8, UB of Q = 365x10^8 (ID: line_1)
[Line 2] R= \\frac{5.8875x10^8}{3.65x10^5} (ID: line_2)
[Line 3] = 1609.59 (ID: line_3)
[Line 4] 1610 (ID: line_4)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_853]: "\( 19 R=\frac{P}{Q} \)"
[block_0_1_815]: "\( P=5.88 \times 10^{8} \) correct to 3 significant figures."
[block_0_2_829]: "\( Q=3.6 \times 10^{5} \) correct to 2 significant figures."
[block_0_3_968]: "Work out the lower bound for \( R \)."
[block_0_4_570]: "Give your answer as an ordinary number correct to the nearest integer."
[block_0_5_313]: "L U B & \text { ot } P=5.875 \times 10^{8}, U B \text { of } Q=3\left(5 \times 10^{\rho}\right."
[block_0_6_396]: "R  =\frac{9.1875 \times 10^{8}}{3.65 \times 10^{9}}"
[block_0_7_267]: " =1609.99"
[block_0_8_742]: "1610"
[block_0_9_594]: "19"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q17] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ17[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6507[0m
     [36mThe student provides the calculation and the final answer.[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [M1 M1] [34m"8x0.55^3"[0m
      ‚Ü≥ Reason: Correct method to find height after 4th bounce, 8 \times 0.55^3. | Correct method to find height after 3rd bounce.
      ‚Ü≥ Transcription: [35m"8x0.55^3"[0m
      ‚Ü≥ Classification: [35m"8x0.55^3"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[line_2][0m [A1] [34m"1.331"[0m
      ‚Ü≥ Reason: Correct answer 1.331.
      ‚Ü≥ Transcription: [35m"1.331"[0m
      ‚Ü≥ Classification: [35m"1.331"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 248px to 300px for Q17
[GUILLOTINE CHECK] Q17: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q20 has 19 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_948, block_0_1_33, block_0_2_484, block_0_3_213, block_0_4_339, block_0_5_576, block_0_6_144, block_0_7_721, block_0_8_51, block_0_9_162, block_0_10_227, block_0_11_109, block_0_12_122, block_0_13_109, block_0_14_909, block_0_15_352, block_0_17_523, block_0_18_364, block_0_19_153
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q20[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 20

## QUESTION TEXT
$x-4$, $x+2$ and $3x+1$ are three consecutive terms of an arithmetic sequence. Find the value of x. $y-4$, $y+2$ and $3y+1$ are three consecutive terms of a geometric sequence. Find the possible values of y.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[20a]
- P1: for process to find the common difference between the first and second and the common difference between the third and second term eg $(3x+1) - (x+2) (= 2x-1)$ and $(x+2) - (x-4) (= 6)$ or for process to write a correct equation in x, eg $(3x+1) - (x+2) = (x+2) - (x-4)$ or $2x-1 = 6$ oe
- A1: for 3.5 oe eg $\frac{7}{2}$

[20b]
- P1: for process to write a correct equation in terms of the common ratio and y eg $r(y-4) = y+2$ or $r(y+2) = 3y+1$
- P1: for process to write a correct equation in y eg $\frac{3y+1}{y+2} = \frac{y+2}{y-4}$ oe
- P1: for process to write a correct equation without fractions eg $(3y+1)(y-4) = (y+2)(y+2)$ oe
- P1: for process of writing a correct simplified equation eg $2y^2 - 15y - 8 (= 0)$
- A1: cao



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] 3x+1-(x+2)=x+2-(x-4) (ID: line_1)
[Line 2] 4x-3=x+4 (ID: line_2)
[Line 3] -7=-2x (ID: line_3)
[Line 4] x = \frac{7}{2} (ID: line_4)

[SUB-QUESTION B STUDENT WORK]
[Line 5] \frac{3y+1}{y+2} = \frac{y+2}{y-4} (ID: line_5)
[Line 6] (3y+1)(y-4) = (y+2)^2 (ID: line_6)
[Line 7] 3y^2-11y-4=y^2+4y+4 (ID: line_7)
[Line 8] 2y^2-15y-8=0 (ID: line_8)
[Line 9] Y=8,-0.5 (ID: line_9)
[Line 10] 8,-0.5 (ID: line_10)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_948]: "\( 20 x-4, x+2 \) and \( 3 x+1 \) are three consecutive terms of an arithmetic sequence."
[block_0_1_33]: "(a) Find the value of \( x \)."
[block_0_2_484]: "3 x+1-(x+7)  =8 x+2-(x-4)"
[block_0_3_213]: "4 x-3  =8^{2} x+4"
[block_0_4_339]: "-7  =-2 x"
[block_0_5_576]: "WHS 1 anc"
[block_0_6_144]: "x=\frac{7}{2}"
[block_0_7_721]: ","
[block_0_8_51]: "(2)"
[block_0_9_162]: "\( y-4, y+2 \) and \( 3 y+1 \) are three consecutive terms of a geometric sequence."
[block_0_10_227]: "(b) Find the possible values of \( y \)."
[block_0_11_109]: "\frac{3 y+1}{y+2}  =\frac{y+2}{y-4}"
[block_0_12_122]: "(3 y+4)[y-4]  =[y+2]^{2}"
[block_0_13_109]: "3 y^{2}-11(y-4  =y^{2}+4 y+4"
[block_0_14_909]: "2 y^{2}-15 y-8  =0"
[block_0_15_352]: "y  =8,-0.5"
[block_0_17_523]: "8,-0.5"
[block_0_18_364]: "(5)"
[block_0_19_153]: "20"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q15] ü•á Trusting AI Total: 6 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ15[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m6/6[0m
  - Usage tokens: [33m7254[0m
     [36mN/A[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_1_377][0m [B1] [34m"frac{d cdot 3}{s}"[0m
      ‚Ü≥ Reason: Correct simplification of (a-3)^2 / 5(a-3) to (a-3)/5.
      ‚Ü≥ OCR Match: [35m"frac{d cdot 3}{s}"[0m
      ‚Ü≥ Classification: [35m"\frac{a-3}{5}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_4_663][0m [M1 A1] [34m"( (3 k-1)(k+4) )"[0m
      ‚Ü≥ Reason: Correct factorization of the quadratic expression, matching the form (3k +/- 1)(k +/- 4). | Correct factors (3k-1)(k+4).
      ‚Ü≥ OCR Match: [35m"( (3 k-1)(k+4) )"[0m
      ‚Ü≥ Classification: [35m"(3k-1)(k+4)"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_7_396][0m [M1 M1] [34m"= frac{(2-x)(2+x)}{x(3+x)} times frac{x+7}{x+2}"[0m
      ‚Ü≥ Reason: Correct factorization and inversion/multiplication. | Correct factorization of both quadratics and inversion and multiplication.
      ‚Ü≥ OCR Match: [35m"= frac{(2-x)(2+x)}{x(3+x)} times frac{x+7}{x+2}"[0m
      ‚Ü≥ Classification: [35m"= \frac{2-x(x2+x)}{x(3+L)} \times \frac{x+3}{x+2}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_8_513][0m [A1] [34m"frac{2-x}{x}"[0m
      ‚Ü≥ Reason: Correct simplification to (2-x)/x.
      ‚Ü≥ OCR Match: [35m"frac{2-x}{x}"[0m
      ‚Ü≥ Classification: [35m"\frac{2-x}{x}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q15: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=6, ResultTotal=6
[MARKING DEBUG] Q21 has 15 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_650, block_0_1_153, block_0_2_575, block_0_3_491, block_0_4_721, block_0_5_260, block_0_6_168, block_0_8_802, block_0_7_107, block_0_9_14, block_0_10_286, block_0_11_722, block_0_12_977, block_0_13_225, block_0_14_666
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q21[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 21

## QUESTION TEXT
The diagram shows a circle, radius r cm and two regular hexagons. [A larger hexagon ABCDEF circumscribes the circle (sides are tangents). A smaller hexagon PQRSTU is inscribed in the circle (sides are chords)]. Each side of the larger hexagon ABCDEF is a tangent to the circle. Each side of the smaller hexagon PQRSTU is a chord of the circle. By considering perimeters, show that $3 < \pi < 2\sqrt{3}$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** These notes offer general guidance, but the specific notes for examiners appertaining to individual questions take precedence.

### General Principles
- All candidates must receive the same treatment. Examiners must mark the last candidate in exactly the same way as they mark the first.
- Where some judgement is required, mark schemes will provide the principles by which marks will be awarded; exemplification/indicative content will not be exhaustive.
- All the marks on the mark scheme are designed to be awarded; mark schemes should be applied positively.
- Examiners should also be prepared to award zero marks if the candidate's response is not worthy of credit according to the mark scheme.

### Marking Procedure
- If there is a wrong answer (or no answer) indicated on the answer line always check the working in the body of the script (and on any diagrams), and award any marks appropriate from the mark scheme.
- Questions where working is not required: In general, the correct answer should be given full marks.
- Questions that specifically require working: In general, candidates who do not show working on this type of question will get no marks - full details will be given in the mark scheme for each individual question.
- Crossed out work should be marked unless the candidate has replaced it with an alternative response.
- If there is a choice of methods shown, mark the method that leads to the answer given on the answer line. If no answer appears on the answer line, mark both methods then award the lower number of marks.
- If it is clear from the working that the "correct" answer has been obtained from incorrect working, award 0 marks.

### Follow Through Marks
- Follow through marks which involve a single stage calculation can be awarded without working as you can check the answer, but if ambiguous do not award.
- Follow through marks which involve more than one stage of calculation can only be awarded on sight of the relevant working, even if it appears obvious that there is only one way you could get the answer given.

### Treatment of Answers
- It is appropriate to ignore subsequent work when the additional work does not change the answer in a way that is inappropriate for the question or its context (eg an incorrectly cancelled fraction when the unsimplified fraction would gain full marks).
- It is not appropriate to ignore subsequent work when the additional work essentially makes the answer incorrect (eg. incorrect algebraic simplification).
- Probability answers must be given as a fraction, percentage or decimal.
- If a candidate gives a decimal equivalent to a probability, this should be written to at least 2 decimal places (unless tenths).
- Incorrect notation should lose the accuracy marks, but be awarded any implied method marks.
- Unless otherwise stated, when an answer is given as a range (eg 3.5 - 4.2) then this is inclusive of the end points (eg 3.5, 4.2) and all numbers within the range.

### Abbreviations
- **M**: method mark awarded for a correct method or partial method
- **P**: process mark awarded for a correct process as part of a problem solving question
- **A**: accuracy mark (awarded after a correct method or process; if no method or process is seen then full marks for the question are implied)
- **C**: communication mark awarded for a fully correct statement(s) with no contradiction or ambiguity
- **B**: unconditional accuracy mark (no method needed)
- **oe**: or equivalent
- **cao**: correct answer only
- **ft**: follow through (when appropriate as per mark scheme)
- **SC**: special case
- **dep**: dependent (on a previous mark)
- **indep**: independent
- **awrt**: answer which rounds to
- **isw**: ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- P1: for process to find the length of half a side or a side or the perimeter of the smaller hexagon PQRSTU, eg $r \sin 30 (= \frac{r}{2})$ oe or $2r \sin 30 (= r)$ oe or $6 \times 2r \sin 30 (= 6r)$ oe
- P1: for process to find the length of half a side or a side or the perimeter of the larger hexagon ABCDEF eg Length of half side = $r \tan 30$ or $\frac{r}{\tan 60} (= \frac{\sqrt{3}r}{3})$ oe or Length of side = $2r \tan 30$ or $\frac{2r}{\tan 60}$ or $\frac{r}{\cos 30}$ or $\frac{r}{\sin 60}$ or $\frac{2\sqrt{3}r}{3}$ oe or Length of perimeter = $6 \times 2r \tan 30$ or $6 \times \frac{2r}{\tan 60}$ oe
- P1: (dep P2) for process of forming a correct inequality, eg using half lengths eg $\frac{r}{2} < \frac{2\pi r}{12} < r \tan 30$ oe or using lengths eg $r < \frac{2\pi r}{6} < 2r \tan 30$ oe or using perimeters eg $6 \times r < 2\pi r < 6 \times 2r \tan 30$ oe
- C1: (dep P2) correct algebra leading to given result, $3 < \pi < 2\sqrt{3}$

FINAL ANSWER: Result shown



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] perimeter: smull hexagon <circle <large lhexagon (ID: line_1)
[Line 2] perimeter of small hexagus = 6r (ID: line_2)
[Line 3] of circle =2\\pi r (ID: line_3)
[Line 4] of large hexugun= \\frac{6r}{cos(30)} (ID: line_4)
[Line 5] =4\\sqrt{3} r (ID: line_5)
[Line 6] 6r<2\\pi r<4\\sqrt{3}r (ID: line_6)
[Line 7] 3 < \\pi < 2\\sqrt{3} (ID: line_7)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_650]: "21 The diagram shows a circle, radius \( r \mathrm{~cm} \) and two regular hexagons."
[block_0_1_153]: "Each side of the larger hexagon \( A B C D E F \) is a tangent to the circle."
[block_0_2_575]: "Each side of the smaller hexagon \( P Q R S T U \) is a chord of the circle."
[block_0_3_491]: "By considering perimeters, show that"
[block_0_4_721]: "3<\pi<2 \sqrt{3}"
[block_0_5_260]: "perimeter: smull hexagos < circle< large liexagoy"
[block_0_6_168]: "perimeter of smoll hexagou \( =6 r \)"
[block_0_8_802]: "of lorge hexysua \( =\frac{62}{60} \)"
[block_0_7_107]: "of circle \( =2 \pi r \)"
[block_0_9_14]: "=4 \sqrt{3} r"
[block_0_10_286]: "6 r<2 \pi r<4 \sqrt{3}<"
[block_0_11_722]: "3<\pi<2 \sqrt{3}"
[block_0_12_977]: "\hline"
[block_0_13_225]: "TOTAL FOR PAPER IS 80 MARKS"
[block_0_14_666]: "21"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q16] ü•á Trusting AI Total: 6 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ16[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m5/6[0m
  - Usage tokens: [33m6963[0m
     [36mN/A[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_4_489][0m [B1] [34m"-6"[0m
      ‚Ü≥ Reason: Correct answer.
      ‚Ü≥ OCR Match: [35m"-6"[0m
      ‚Ü≥ Classification: [35m"-6"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [31mcross[0m [34m[line_1][0m [M0 A0] [34m"-6"[0m
      ‚Ü≥ Reason: Incorrect method. | Incorrect answer.
      ‚Ü≥ Transcription: [35m"-6"[0m
      ‚Ü≥ Classification: [35m"-6"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[block_0_8_693][0m [M1 A1] [34m"4"[0m
      ‚Ü≥ Reason: Correct method. | Correct answer.
      ‚Ü≥ OCR Match: [35m"4"[0m
      ‚Ü≥ Classification: [35m"4"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_13_396][0m [M1 A1] [34m"1 / 3"[0m
      ‚Ü≥ Reason: Correct method. | Correct answer.
      ‚Ü≥ OCR Match: [35m"1 / 3"[0m
      ‚Ü≥ Classification: [35m"1 / 3"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[WIDTH FIX] Boosting tiny width 100px to 300px for Q16
[GUILLOTINE CHECK] Q16: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=5, ResultTotal=5
[BUDGET Q19] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ19[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6755[0m
     [36mThe student calculates the lower bound of R by dividing the lower bound of P by the upper bound of Q, and rounds the result to the nearest integer.[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [B1] [34m"LMB of P = 5.875x10^8, UB of Q = 365x10^8"[0m
      ‚Ü≥ Reason: Lower bound of P is correct. Upper bound of Q is incorrect (should be 3.65 x 10^5).
      ‚Ü≥ Transcription: [35m"LMB of P = 5.875x10^8, UB of Q = 365x10^8"[0m
      ‚Ü≥ Classification: [35m"LMB of P= 5.875x10^8, UB of Q = 365x10^8"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[line_2][0m [M1] [34m"R = frac{5.8875x10^8}{3.65x10^5}"[0m
      ‚Ü≥ Reason: Correct method to find lower bound using student's values.
      ‚Ü≥ Transcription: [35m"R = frac{5.8875x10^8}{3.65x10^5}"[0m
      ‚Ü≥ Classification: [35m"R= \frac{5.8875x10^8}{3.65x10^5}"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_3][0m [A1] [34m"= 1609.59"[0m
      ‚Ü≥ Reason: Answer is in the range 1609 - 1610 from correct working.
      ‚Ü≥ Transcription: [35m"= 1609.59"[0m
      ‚Ü≥ Classification: [35m"= 1609.59"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[GUILLOTINE CHECK] Q19: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[BUDGET Q18] ü•á Trusting AI Total: 5 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ18[0m - Clean response received:
  - Annotations count: [35m5[0m
  - Student score: [32m5/5[0m
  - Usage tokens: [33m7403[0m
     [36mThe student provides calculations to find the area of triangle ACD.[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [P1] [34m"54 = frac{1}{2}x17x ACx sin 35"[0m
      ‚Ü≥ Reason: Correct start of process to find length of AC.
      ‚Ü≥ Transcription: [35m"54 = frac{1}{2}x17x ACx sin 35"[0m
      ‚Ü≥ Classification: [35m"54= \frac{1}{2}x17x ACx sin 35"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[block_0_5_546][0m [P1] [34m"H C = 11.08"[0m
      ‚Ü≥ Reason: Correct AC value found.
      ‚Ü≥ OCR Match: [35m"H C = 11.08"[0m
      ‚Ü≥ Classification: [35m"H C  =11.08"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_6_125][0m [P1] [34m"A D = frac{1.108}{sin 51} times sin (48)"[0m
      ‚Ü≥ Reason: Correct start of process to find AD.
      ‚Ü≥ OCR Match: [35m"A D = frac{1.108}{sin 51} times sin (48)"[0m
      ‚Ü≥ Classification: [35m"A D  =\frac{1.108}{\sin 51} \times \sin (48)"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_7_205][0m [P1] [34m"= 9.81"[0m
      ‚Ü≥ Reason: Correct AD value found.
      ‚Ü≥ OCR Match: [35m"= 9.81"[0m
      ‚Ü≥ Classification: [35m" =9.81"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    5. [32mtick[0m [34m[block_0_9_280][0m [A1] [34m"= 52.5"[0m
      ‚Ü≥ Reason: Correct area of triangle ACD.
      ‚Ü≥ OCR Match: [35m"= 52.5"[0m
      ‚Ü≥ Classification: [35m" =52.5"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q18: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=5, ResultTotal=5

üîç [RAW AI JSON] Q21:
{
  "meta": {
    "question_total_marks": 4,
    "raw_correct_steps_found": 0,
    "steps_dropped_to_fit_budget": 0,
    "isTotalEstimated": false
  },
  "visualObservation": "The student attempts to show the relationship between the perimeters of two hexagons and a circle to prove the inequality.",
  "annotations": [
    {
      "line_id": "block_0_6_168",
      "action": "tick",
      "text": "P1",
      "student_text": "perimeter of smoll hexagou  =6 r",
      "classification_text": "perimete...

[BUDGET Q21] ü•á Trusting AI Total: 4 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ21[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m7175[0m
     [36mThe student attempts to show the relationship between the perimeters of two hexagons and a circle to prove the inequality.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_6_168][0m [P1] [34m"perimeter of smoll hexagou = 6 r"[0m
      ‚Ü≥ Reason: Correct perimeter of the smaller hexagon.
      ‚Ü≥ OCR Match: [35m"perimeter of smoll hexagou = 6 r"[0m
      ‚Ü≥ Classification: [35m"perimeter of small hexagus = 6r"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_9_14][0m [P1] [34m"= 4 sqrt{3} r"[0m
      ‚Ü≥ Reason: Correct perimeter of the larger hexagon.
      ‚Ü≥ OCR Match: [35m"= 4 sqrt{3} r"[0m
      ‚Ü≥ Classification: [35m"=4\\sqrt{3} r"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_10_286][0m [P1] [34m"6 r<2 pi r<4 sqrt{3}<"[0m
      ‚Ü≥ Reason: Correct inequality formed using the perimeters.
      ‚Ü≥ OCR Match: [35m"6 r<2 pi r<4 sqrt{3}<"[0m
      ‚Ü≥ Classification: [35m"6r<2\\pi r<4\\sqrt{3}r"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_11_722][0m [C1] [34m"3<pi<2 sqrt{3}"[0m
      ‚Ü≥ Reason: Correct algebra leading to the given result.
      ‚Ü≥ OCR Match: [35m"3<pi<2 sqrt{3}"[0m
      ‚Ü≥ Classification: [35m"3<\\pi<2 \sqrt{3}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[‚ö†Ô∏è MIXED CONTENT] AI matched a Printed Block (block_0_11_722). Allowing it as per Show Everything strategy.
[GUILLOTINE CHECK] Q21: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[BUDGET Q20] ü•á Trusting AI Total: 6 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ20[0m - Clean response received:
  - Annotations count: [35m6[0m
  - Student score: [32m6/6[0m
  - Usage tokens: [33m7544[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_2_484][0m [P1] [34m"3 x+1-(x+7) = 8 x+2-(x-4)"[0m
      ‚Ü≥ Reason: Correct equation in x.
      ‚Ü≥ OCR Match: [35m"3 x+1-(x+7) = 8 x+2-(x-4)"[0m
      ‚Ü≥ Classification: [35m"3x+1-(x+2)=x+2-(x-4)"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_6_144][0m [A1] [34m"x = frac{7}{2}"[0m
      ‚Ü≥ Reason: Correct answer.
      ‚Ü≥ OCR Match: [35m"x = frac{7}{2}"[0m
      ‚Ü≥ Classification: [35m"x = \frac{7}{2}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_11_109][0m [P1] [34m"frac{3 y+1}{y+2} = frac{y+2}{y-4}"[0m
      ‚Ü≥ Reason: Correct equation in y.
      ‚Ü≥ OCR Match: [35m"frac{3 y+1}{y+2} = frac{y+2}{y-4}"[0m
      ‚Ü≥ Classification: [35m"\frac{3y+1}{y+2} = \frac{y+2}{y-4}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_12_122][0m [P1] [34m"(3 y+4)[y-4] = [y+2]^{2}"[0m
      ‚Ü≥ Reason: Correct equation without fractions.
      ‚Ü≥ OCR Match: [35m"(3 y+4)[y-4] = [y+2]^{2}"[0m
      ‚Ü≥ Classification: [35m"(3y+1)(y-4) = (y+2)^2"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    5. [32mtick[0m [34m[block_0_14_909][0m [P1] [34m"2 y^{2}-15 y-8 = 0"[0m
      ‚Ü≥ Reason: Correct simplified equation.
      ‚Ü≥ OCR Match: [35m"2 y^{2}-15 y-8 = 0"[0m
      ‚Ü≥ Classification: [35m"2y^2-15y-8=0"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    6. [32mtick[0m [34m[block_0_15_352][0m [A1] [34m"y = 8,-0.5"[0m
      ‚Ü≥ Reason: Correct answer.
      ‚Ü≥ OCR Match: [35m"y = 8,-0.5"[0m
      ‚Ü≥ Classification: [35m"Y=8,-0.5"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q20: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=7, ResultTotal=7
[1m[32m‚úÖ [AI MARKING][0m [1mCOMPLETED[0m in [1m20.4s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
[1m[32m‚úÖ [MARKING][0m [1mCOMPLETED[0m in [1m20.4s[0m ([32m[1mAI-MARKING[0m)

üîç [RESULT VERIFICATION] Checking what will be combined:
   üìä Marking Results: 21 questions
   üìù Question Results: NO
   ‚úÖ Both modes triggered: NO
[TOTAL TRAP] Q1: Scheme=2, AI=2, IsDefault=false -> FINAL=2
[TOTAL TRAP] Q2: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Q3: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q4: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Q5: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Q6: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Q7: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Q8: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q9: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q10: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q11: Scheme=5, AI=5, IsDefault=false -> FINAL=5
[TOTAL TRAP] Q12: Scheme=2, AI=2, IsDefault=false -> FINAL=2
[TOTAL TRAP] Q13: Scheme=2, AI=2, IsDefault=false -> FINAL=2
[TOTAL TRAP] Q14: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Q15: Scheme=6, AI=6, IsDefault=false -> FINAL=6
[TOTAL TRAP] Q16: Scheme=5, AI=5, IsDefault=false -> FINAL=5
[TOTAL TRAP] Q17: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q18: Scheme=5, AI=5, IsDefault=false -> FINAL=5
[TOTAL TRAP] Q19: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q20: Scheme=7, AI=7, IsDefault=false -> FINAL=7
[TOTAL TRAP] Q21: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Grand Total Possible Score: 80
[32müîÑ [LOGICAL RE-INDEXING] Aligning logical indices with sorted physical order...[0m
[32m‚úÖ [LOGICAL RE-INDEXING] Re-indexed 21 questions and 21 pages.[0m
[32m‚úÖ [1m[FINAL PAGE ORDER][0m [32m[1] Page 0 ([37mFRONT PAGE[32m) -> [2] Page 1 ([37mQ1[32m) -> [3] Page 2 ([37mQ2ai[32m) -> [4] Page 3 ([37mQ3a[32m) -> [5] Page 4 ([37mQ3b, Q4[32m) -> [6] Page 5 ([37mQ5[32m) -> [7] Page 6 ([37mQ6a[32m) -> [8] Page 7 ([37mQ7[32m) -> [9] Page 8 ([37mQ8[32m) -> [10] Page 9 ([37mQ9[32m) -> [11] Page 10 ([37mQ10[32m) -> [12] Page 11 ([37mQ11a[32m) -> [13] Page 12 ([37mQ12[32m) -> [14] Page 13 ([37mQ13, Q14[32m) -> [15] Page 14 ([37mQ15a[32m) -> [16] Page 15 ([37mQ16a[32m) -> [17] Page 16 ([37mQ17[32m) -> [18] Page 17 ([37mQ18[32m) -> [19] Page 18 ([37mQ19[32m) -> [20] Page 19 ([37mQ20a[32m) -> [21] Page 20 ([37mQ21[32m)[0m
[1m[32m‚úÖ [OUTPUT GENERATION][0m [1mCOMPLETED[0m in [1m5.7s[0m ([32m[1mOUTPUT-GENERATION[0m)
[SYNC FIX] üîÑ Synchronizing UI Structure (Schema Defaults) with Engine Results (Actuals)...
[SYNC FIX] ‚úÖ Q1: Updated Total Available Marks from undefined (Schema) -> 2 (Engine)
[SYNC FIX] ‚úÖ Q2: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] ‚úÖ Q3: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q4: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] ‚úÖ Q5: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] ‚úÖ Q6: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] ‚úÖ Q7: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] ‚úÖ Q8: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q9: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q10: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q11: Updated Total Available Marks from undefined (Schema) -> 5 (Engine)
[SYNC FIX] ‚úÖ Q12: Updated Total Available Marks from undefined (Schema) -> 2 (Engine)
[SYNC FIX] ‚úÖ Q13: Updated Total Available Marks from undefined (Schema) -> 2 (Engine)
[SYNC FIX] ‚úÖ Q14: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] ‚úÖ Q15: Updated Total Available Marks from undefined (Schema) -> 6 (Engine)
[SYNC FIX] ‚úÖ Q16: Updated Total Available Marks from undefined (Schema) -> 5 (Engine)
[SYNC FIX] ‚úÖ Q17: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q18: Updated Total Available Marks from undefined (Schema) -> 5 (Engine)
[SYNC FIX] ‚úÖ Q19: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q20: Updated Total Available Marks from undefined (Schema) -> 7 (Engine)
[SYNC FIX] ‚úÖ Q21: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] üèÅ Updated Grand Total from 80 -> 80
[1m[32m‚úÖ [PERFORMANCE SUMMARY AI][0m [1mCOMPLETED[0m in [1m1.0s[0m ([32m[1mGEMINI-2.0-FLASH[0m)

üìä [ANNOTATION SUMMARY]
----------------------------------------------------------------------
| Q#       | Score | Marks Awarded           | Match Status              |
|----------|-------|-------------------------|---------------------------|
| [32m1       [0m | 1/2   | M1, A0                  | M:0 V:0 U:1 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m2       [0m | 2/4   | B1, M1 A1, B1           | M:0 V:0 U:1 S:2           |
| [90m  ai    [0m | 1     | B1                      | M:0 V:0 U:0 S:1           |
| [90m  aii   [0m | 1     | B1                      | M:0 V:0 U:1 S:0           |
| [90m  b     [0m | 1     | M1 A1                   | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m3       [0m | 3/3   | C1, M1 A1               | M:0 V:1 U:0 S:1           |
| [90m  a     [0m | 1     | C1                      | M:0 V:0 U:0 S:1           |
| [90m  b     [0m | 1     | M1 A1                   | M:0 V:1 U:0 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m4       [0m | 4/4   | P1 P1 P1, A1            | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m5       [0m | 4/4   | P1, P1, P1, A1          | M:0 V:0 U:0 S:4           |
|----------|-------|-------------------------|---------------------------|
| [32m6       [0m | 4/4   | M1 A1, B1, B1           | M:0 V:0 U:2 S:1           |
| [90m  a     [0m | 2     | B1, B1                  | M:0 V:0 U:2 S:0           |
| [90m  b     [0m | 1     | M1 A1                   | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m7       [0m | 4/4   | P1, P1, P1, A1          | M:0 V:0 U:0 S:4           |
|----------|-------|-------------------------|---------------------------|
| [32m8       [0m | 0/3   | M0, M0 A0               | M:0 V:1 U:1 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m9       [0m | 3/3   | P1, P1, A1              | M:0 V:0 U:0 S:3           |
|----------|-------|-------------------------|---------------------------|
| [32m10      [0m | 3/3   | M1, M1, C1              | M:0 V:0 U:0 S:3           |
|----------|-------|-------------------------|---------------------------|
| [32m11      [0m | 2/5   | M0 A0, C1, C1           | M:0 V:1 U:2 S:0           |
| [90m  a     [0m | 0     | M0 A0                   | M:0 V:1 U:0 S:0           |
| [90m  b     [0m | 2     | C1, C1                  | M:0 V:0 U:2 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m12      [0m | 2/2   | B2                      | M:0 V:1 U:0 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m13      [0m | 2/2   | M1, A1                  | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m14      [0m | 4/4   | P1, P1, P1, A1          | M:0 V:0 U:4 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m15      [0m | 6/6   | B1, M1 A1, M1 M1, A1    | M:0 V:0 U:0 S:4           |
| [90m  a     [0m | 1     | B1                      | M:0 V:0 U:0 S:1           |
| [90m  b     [0m | 1     | M1 A1                   | M:0 V:0 U:0 S:1           |
| [90m  c     [0m | 2     | M1 M1, A1               | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m16      [0m | 5/5   | B1, M1 A1, M1 A1, M0 A0 | M:0 V:0 U:1 S:3           |
| [90m  a     [0m | 1     | B1                      | M:0 V:0 U:0 S:1           |
| [90m  b     [0m | 1     | M1 A1, M0 A0            | M:0 V:0 U:1 S:1           |
| [90m  c     [0m | 1     | M1 A1                   | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m17      [0m | 3/3   | M1 M1, A1               | M:0 V:0 U:2 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m18      [0m | 5/5   | P1, P1, P1, A1, P1      | M:0 V:0 U:1 S:4           |
|----------|-------|-------------------------|---------------------------|
| [32m19      [0m | 3/3   | B1, M1, A1              | M:0 V:0 U:3 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m20      [0m | 6/7   | P1, A1, P1, P1, P1, A1  | M:0 V:0 U:0 S:6           |
| [90m  a     [0m | 2     | P1, A1                  | M:0 V:0 U:0 S:2           |
| [90m  b     [0m | 4     | P1, P1, P1, A1          | M:0 V:0 U:0 S:4           |
|----------|-------|-------------------------|---------------------------|
| [32m21      [0m | 4/4   | P1, P1, P1, C1          | M:0 V:0 U:0 S:4           |
|----------|-------|-------------------------|---------------------------|

=== PERFORMANCE SUMMARY ===
Total Processing Time: 77.7s
Model Used: gemini-2.0-flash
----------------------------
classification                      28.1s (36%)
marking                             20.4s (26%)
ocr_processing                      9.4s (12%)
question_detection                  6.7s (9%)
output_generation                   5.7s (7%)
preprocessing                       4.7s (6%)
performance_summary                 1.0s (1%)
database_persistence                0.3s (0%)
============================


üìä [UsageTracker] Summary:
   Model: gemini-2.0-flash
   API Requests: 23 total
   Total Tokens: 148,937 (137,814 in + 11,123 out)
   Total Cost: $0.101301
   Mathpix OCR: 21 pages ‚Üí $0.084000

   Breakdown by Phase:
   ‚Ä¢ Mapper (Map Pass): 7,067 tokens (1 requests) ‚Üí $0.000929
   ‚Ä¢ Classification (Marking Pass): 139,425 tokens (21 requests) ‚Üí $0.017027
   ‚Ä¢ Performance Summary: 2,445 tokens (1 requests) ‚Üí $0.000274


üèÅ ========== UNIFIED PIPELINE END ==========
üèÅ ==========================================

‚úÖ [CONTROLLER] Pipeline completed, result exists: true, sessionId: sub-1768663438126
üí≥ [CREDIT DEDUCT] Starting deduction for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, sessionId: sub-1768663438126
üí≥ [CREDIT DEDUCT] Incremental cost from tracker: 0.10130130000000001
üîç [SUBJECT EXTRACTION] examPapers[0].subject = "Mathematics"
üí≥ Deducted 10.13 credits from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2 (session: sub-1768663438126), remaining: 578.06
üí≥ Deducted 0.1013 credits (session: sub-1768663438126) from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2
‚úÖ [SUBJECT MARKING RESULT] Persisted marking result for subject: Mathematics, session: sub-1768663438126
üë§ [PLAN CHECK] User 9mBfvniXTuMtQU8f0OnLhUK6aOv2 is on plan: ultra
üì° [MARKING] Processing POST /api/marking/process (hasRawBody: false)
üöÄ [MARKING] Controller started - Files: 23, Body Keys: model, aiMessageId
üîç [CREDIT DEBUG] userId: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, isAuthenticated: true
üí≥ [CREDIT CHECK] Starting credit check for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2
üí≥ [CREDIT CHECK] Estimated cost: 2.1597578000000004, files: 23, bytes: 20447578
üí≥ [CREDIT CHECK] Result: {"canProceed":true,"remaining":578.06}

üîÑ ========== UNIFIED PIPELINE START ==========
üîÑ ============================================

[1m[32m‚úÖ [INPUT VALIDATION][0m [1mCOMPLETED[0m in [1m0.0s[0m ([32m[1mVALIDATION[0m)
[INPUT TYPE] Detected: Multiple Images (23 files)
[1m[32m‚úÖ [PREPROCESSING][0m [1mCOMPLETED[0m in [1m3.0s[0m ([32m[1mIMAGE-PROCESSING[0m)
[MAPPER] Using model: gemini-2.0-flash
[MAPPER] Starting Map Pass for 23 pages...
‚úÖ [MAPPER] Map Pass complete in 6.47s. Mapped 23 pages.

[36m[CLASSIFICATION DEBUG] Q16 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "16",
          "text": "There are only n orange sweets and 1 white sweet in a bag.\nSaira takes at random a sweet from the bag and eats the sweet.\nShe then takes at random another sweet from the bag and eats this sweet.\nShow that the probability that Saira eats two orange sweets is \\frac{n-1}{n+1}",
          "studentWorkLines": [
            {
              "text": "\\frac{n}{n+1} \\times \\frac{n-1}{n} = \\frac{n-1}{n+1}",
              "position": {
                "x": 24.24,
                "y": 18.89,
                "width": 40.0,
                "height": 7.0
              }
            },
            {
              "text": "P ot taking 1 oronge = \\frac{n}{n+1}",
              "position": {
                "x": 24.24,
                "y": 27.03,
                "width": 40.0,
                "height": 7.0
              }
            },
            {
              "text": "P ot toking orange again = \\frac{n-1}{n}",
              "position": {
                "x": 24.24,
                "y": 33.33,
                "width": 40.0,
                "height": 7.0
              }
            },
            {
              "text": "\\Rightarrow \\frac{n}{n+1} \\times \\frac{n-1}{n} = \\frac{n-1}{n+1}",
              "position": {
                "x": 24.24,
                "y": 40.74,
                "width": 40.0,
                "height": 7.0
              }
            }
          ],
          "subQuestions": []
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q18 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "18",
          "text": "Show that 0.15 + 0.227 can be written in the form \\frac{m}{66} where m is an integer.",
          "studentWorkLines": [
            {
              "text": "0.1\\dot{5}+0.\\dot{2}2\\dot{7}",
              "position": {
                "x": 24.2,
                "y": 24.4,
                "width": 22.0,
                "height": 6.0
              }
            },
            {
              "text": "= 0.37\\cancel{1}\\cancel{2}8",
              "position": {
                "x": 24.2,
                "y": 31.3,
                "width": 23.0,
                "height": 6.0
              }
            },
            {
              "text": "x= 0.378",
              "position": {
                "x": 24.2,
                "y": 38.3,
                "width": 16.0,
                "height": 6.0
              }
            },
            {
              "text": "100x-x = 037.878 -0.378",
              "position": {
                "x": 24.2,
                "y": 45.3,
                "width": 40.0,
                "height": 6.0
              }
            },
            {
              "text": "99x = 37.5",
              "position": {
                "x": 24.2,
                "y": 52.3,
                "width": 18.0,
                "height": 6.0
              }
            },
            {
              "text": "x= \\frac{25}{66}",
              "position": {
                "x": 24.2,
                "y": 59.3,
                "width": 12.0,
                "height": 6.0
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q22 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "22",
          "subQuestions": [
            {
              "part": "a",
              "text": "Sketch the graph of y = sinx¬∞ for 0 ‚â§ x ‚â§ 360",
              "hasStudentDrawing": true,
              "hasStudentWork": true,
              "studentDrawingPosition": {
                "x": 10,
                "y": 10,
                "width": 70,
                "height": 35
              },
              "studentWorkLines": [
                {
                  "text": "-1",
                  "position": {
                    "x": 10,
                    "y": 28,
                    "width": 2,
                    "height": 3
                  }
                },
                {
                  "text": "330",
                  "position": {
                    "x": 60,
                    "y": 30,
                    "width": 5,
                    "height": 3
                  }
                }
              ]
            },
            {
              "part": "b",
              "text": "Solve the equation 2 sinx = -1 for 0 ‚â§ x ‚â§ 360",
              "studentWorkLines": [
                {
                  "text": "2sinx=-1",
                  "position": {
                    "x": 25,
                    "y": 50,
                    "width": 20,
                    "height": 5
                  }
                },
                {
                  "text": "sinx=-\\frac{1}{2}",
                  "position": {
                    "x": 25,
                    "y": 55,
                    "width": 20,
                    "height": 5
                  }
                },
                {
                  "text": "x_{1}=330",
                  "position": {
                    "x": 25,
                    "y": 63,
                    "width": 15,
                    "height": 5
                  }
                },
                {
                  "text": "x_{2}=210",
                  "position": {
                    "x": 25,
                    "y": 68,
                    "width": 15,
                    "height": 5
                  }
                },
                {
                  "text": "x_{1}=330",
                  "position": {
                    "x": 45,
                    "y": 68,
                    "width": 15,
                    "height": 5
                  }
                },
                {
                  "text": "x_{2}=210",
                  "position": {
                    "x": 45,
                    "y": 73,
                    "width": 15,
                    "height": 5
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q17 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "17",
          "subQuestions": [
            {
              "part": "a",
              "text": "Rationalise the denominator of \\frac{1}{\\sqrt{7}}",
              "studentWorkLines": [
                {
                  "text": "\\frac{\\sqrt{7}}{7}",
                  "position": {
                    "x": 54.03,
                    "y": 47.92,
                    "width": 7.03,
                    "height": 5.0
                  }
                }
              ],
              "hasStudentDrawing": false
            },
            {
              "part": "b",
              "text": "Simplify fully \\sqrt{80}-\\sqrt{5}",
              "studentWorkLines": [
                {
                  "text": "3\\sqrt{5}",
                  "position": {
                    "x": 54.03,
                    "y": 74.83,
                    "width": 7.03,
                    "height": 5.0
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q23 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "23",
          "text": "C is a circle with centre (0, 0)\nL is a straight line.\nThe circle C and the line L intersect at the points P and Q.\nThe coordinates of P are (5, 10)\nThe x coordinate of Q is -2\nL has a positive gradient and crosses the y-axis at the point (0, k)\nFind the value of k.",
          "studentWorkLines": [
            {
              "text": "y=mx+c",
              "position": {
                "x": 20.8,
                "y": 31.2,
                "width": 20.033,
                "height": 4.068
              }
            },
            {
              "text": "\\sqrt{5^2+10^2} = \\sqrt{125}",
              "position": {
                "x": 47.533,
                "y": 31.2,
                "width": 24.833,
                "height": 4.068
              }
            },
            {
              "text": "(-2)^2+(\\lambda)^2 = \\sqrt{125}^2",
              "position": {
                "x": 34.8,
                "y": 38.533,
                "width": 37.6,
                "height": 4.067
              }
            },
            {
              "text": "4+\\lambda^2=125",
              "position": {
                "x": 47.533,
                "y": 45.867,
                "width": 18.2,
                "height": 4.067
              }
            },
            {
              "text": "\\lambda^2=121",
              "position": {
                "x": 47.533,
                "y": 50.867,
                "width": 14.867,
                "height": 4.067
              }
            },
            {
              "text": "\\lambda = \\pm 11",
              "position": {
                "x": 47.533,
                "y": 55.867,
                "width": 16.867,
                "height": 4.067
              }
            },
            {
              "text": "\\frac{-11-10}{-2-5} = \\frac{21}{7}",
              "position": {
                "x": 19.8,
                "y": 67.2,
                "width": 20.867,
                "height": 4.067
              }
            },
            {
              "text": "=3",
              "position": {
                "x": 29.133,
                "y": 74.533,
                "width": 3.533,
                "height": 4.067
              }
            },
            {
              "text": "y = 3x+(",
              "position": {
                "x": 20.8,
                "y": 81.867,
                "width": 15.533,
                "height": 4.067
              }
            },
            {
              "text": "10=3(5)+k",
              "position": {
                "x": 20.8,
                "y": 89.2,
                "width": 17.533,
                "height": 4.067
              }
            },
            {
              "text": "-5=k",
              "position": {
                "x": 20.8,
                "y": 94.2,
                "width": 9.533,
                "height": 4.067
              }
            },
            {
              "text": "k= -5",
              "position": {
                "x": 72.8,
                "y": 91.867,
                "width": 8.867,
                "height": 4.067
              }
            }
          ],
          "hasStudentDrawing": true,
          "studentDrawingPosition": {
            "x": 58.0,
            "y": 15.0,
            "width": 20.0,
            "height": 20.0
          }
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q19 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "19",
          "text": "ABC and DAB are similar isosceles triangles.\nAB = AC\nAD = BD\nBC: CD=4:21\nFind the ratio AB: AD",
          "studentWorkLines": [
            {
              "text": "\\frac{AB}{4} = \\frac{21+4}{AB}",
              "position": {
                "x": 35.41,
                "y": 37.96,
                "width": 21.2,
                "height": 10.03
              }
            },
            {
              "text": "AB = 10",
              "position": {
                "x": 35.41,
                "y": 51.3,
                "width": 14.07,
                "height": 6.9
              }
            },
            {
              "text": "AB:Ab = 10:25",
              "position": {
                "x": 35.41,
                "y": 61.92,
                "width": 32.09,
                "height": 6.9
              }
            },
            {
              "text": "2:5",
              "position": {
                "x": 75.93,
                "y": 78.33,
                "width": 7.03,
                "height": 5.36
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q21 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "21",
          "text": "A solid cuboid has a volume of 300 cm¬≥\nThe cuboid has a total surface area of 370 cm¬≤\nThe length of the cuboid is 20 cm.\nThe width of the cuboid is greater than the height of the cuboid.\nWork out the height of the cuboid.\nYou must show all your working.",
          "hasStudentDrawing": false,
          "studentWorkLines": [
            {
              "text": "300 = 20xY",
              "position": {
                "x": 17.5,
                "y": 25.8,
                "width": 17.0,
                "height": 4.0
              }
            },
            {
              "text": "30 = 2004",
              "position": {
                "x": 17.5,
                "y": 31.5,
                "width": 15.0,
                "height": 4.0
              }
            },
            {
              "text": "15 = xY",
              "position": {
                "x": 17.5,
                "y": 37.2,
                "width": 12.0,
                "height": 4.0
              }
            },
            {
              "text": "\\\\frac{15}{4} = x",
              "position": {
                "x": 17.5,
                "y": 42.9,
                "width": 10.0,
                "height": 5.0
              }
            },
            {
              "text": "370 = 2xy + 2(20x) + 2(20y)",
              "position": {
                "x": 42.0,
                "y": 25.8,
                "width": 40.0,
                "height": 4.0
              }
            },
            {
              "text": "370 = 2x4 + 40x + 40y",
              "position": {
                "x": 42.0,
                "y": 31.5,
                "width": 35.0,
                "height": 4.0
              }
            },
            {
              "text": "370 = 30 + 40x + 40y",
              "position": {
                "x": 42.0,
                "y": 37.2,
                "width": 35.0,
                "height": 4.0
              }
            },
            {
              "text": "37 = 3 + 4x + 4y",
              "position": {
                "x": 42.0,
                "y": 42.9,
                "width": 28.0,
                "height": 4.0
              }
            },
            {
              "text": "37 = 3 + 4(\\\\frac{15}{y}) + 4y",
              "position": {
                "x": 42.0,
                "y": 48.6,
                "width": 30.0,
                "height": 4.0
              }
            },
            {
              "text": "37y = 3y + 60 + 4y^2",
              "position": {
                "x": 42.0,
                "y": 54.3,
                "width": 32.0,
                "height": 4.0
              }
            },
            {
              "text": "0 = 4y^2 - 34y + 60",
              "position": {
                "x": 42.0,
                "y": 60.0,
                "width": 30.0,
                "height": 4.0
              }
            },
            {
              "text": "0 = 2y^2 - 17y + 30",
              "position": {
                "x": 42.0,
                "y": 65.7,
                "width": 30.0,
                "height": 4.0
              }
            },
            {
              "text": "0 = (2y - 5)(y - 6)",
              "position": {
                "x": 42.0,
                "y": 71.4,
                "width": 30.0,
                "height": 4.0
              }
            },
            {
              "text": "y = \\\\frac{5}{2}  y = 6",
              "position": {
                "x": 42.0,
                "y": 77.1,
                "width": 20.0,
                "height": 4.0
              }
            },
            {
              "text": "\\\\frac{5}{2} = 2.5",
              "position": {
                "x": 17.5,
                "y": 86.0,
                "width": 15.0,
                "height": 5.0
              }
            },
            {
              "text": "\\\\frac{5}{2} 2.5",
              "position": {
                "x": 75.0,
                "y": 86.0,
                "width": 10.0,
                "height": 5.0
              }
            }
          ],
          "subQuestions": []
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q20 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "20",
          "text": "2^x = \\frac{2^n}{\\sqrt{2}} \n2^y = (\\sqrt{2})^5\nGiven that x + y = 8\nwork out the value of n.",
          "studentWorkLines": [
            {
              "text": "2^x = 2^n \\times 2^{(\\frac{1}{3})}",
              "position": {
                "x": 30.62,
                "y": 32.29,
                "width": 30.0,
                "height": 6.0
              }
            },
            {
              "text": "x = n-\\frac{1}{3}",
              "position": {
                "x": 30.62,
                "y": 41.25,
                "width": 18.0,
                "height": 5.0
              }
            },
            {
              "text": "y = \\frac{5}{2}",
              "position": {
                "x": 30.62,
                "y": 49.79,
                "width": 10.0,
                "height": 5.0
              }
            },
            {
              "text": "n = \\frac{35}{6}",
              "position": {
                "x": 30.62,
                "y": 58.33,
                "width": 10.0,
                "height": 5.0
              }
            },
            {
              "text": "\\frac{35}{6}",
              "position": {
                "x": 68.54,
                "y": 49.79,
                "width": 7.0,
                "height": 5.0
              }
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q12 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "12",
          "text": "Here are some graphs.",
          "subQuestions": [
            {
              "part": "i",
              "text": "Write down the letter of the graph that could have the equation\ny = x¬≤ - 4",
              "studentWorkLines": [
                {
                  "text": "H",
                  "position": {
                    "x": 72.0,
                    "y": 69.0,
                    "width": 4.0,
                    "height": 5.0
                  }
                }
              ]
            },
            {
              "part": "ii",
              "text": "y = -x¬≥",
              "studentWorkLines": [
                {
                  "text": "F",
                  "position": {
                    "x": 72.0,
                    "y": 77.0,
                    "width": 3.0,
                    "height": 5.0
                  }
                }
              ]
            },
            {
              "part": "iii",
              "text": "y = -\\frac{5}{x}",
              "studentWorkLines": [
                {
                  "text": "J",
                  "position": {
                    "x": 72.0,
                    "y": 85.0,
                    "width": 3.0,
                    "height": 5.0
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q14 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "14",
          "text": "Expand and simplify (3x-1)(2x + 3)(x - 5)",
          "studentWorkLines": [
            {
              "text": "=(6x¬≤+7x-3)(x-5)",
              "position": {
                "x": 20,
                "y": 170,
                "width": 300,
                "height": 30
              }
            },
            {
              "text": "=6x¬≥-30x¬≤+7x¬≤-35x-3x+15",
              "position": {
                "x": 20,
                "y": 210,
                "width": 400,
                "height": 30
              }
            },
            {
              "text": "=6x¬≥-23x¬≤-38x+15",
              "position": {
                "x": 20,
                "y": 250,
                "width": 300,
                "height": 30
              }
            }
          ],
          "subQuestions": []
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q13 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "13",
          "text": "The table gives information about the amount of time that each of 150 people were in a shop.",
          "hasStudentDrawing": true,
          "studentDrawingPosition": {
            "x": 14,
            "y": 33,
            "width": 64,
            "height": 43
          },
          "studentWorkLines": [],
          "subQuestions": [
            {
              "part": "a",
              "text": "On the grid, draw a histogram for this information.",
              "studentWorkLines": [],
              "hasStudentDrawing": true
            },
            {
              "part": "b",
              "text": "Work out an estimate for the fraction of these 150 people who were in the shop for between 20 minutes and 40 minutes.",
              "studentWorkLines": [
                {
                  "text": "\\frac{35+22+10}{150}",
                  "position": {
                    "x": 37,
                    "y": 80,
                    "width": 25,
                    "height": 8
                  }
                },
                {
                  "text": "\\frac{67}{150}",
                  "position": {
                    "x": 67,
                    "y": 86,
                    "width": 7,
                    "height": 5
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q15 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "15",
          "text": "OAB is a sector of a circle with centre O and radius 6cm.\nThe length of the arc AB is 5\\pi cm.\nWork out, in terms of \\pi, the area of the sector.\nGive your answer in its simplest form.",
          "studentWorkLines": [
            {
              "text": "5\\pi = 6x2x\\frac{\\theta}{360}",
              "position": {
                "x": 30.8,
                "y": 38.1,
                "width": 33.6,
                "height": 5.0
              }
            },
            {
              "text": "\\theta = 150^0",
              "position": {
                "x": 30.8,
                "y": 43.7,
                "width": 17.1,
                "height": 5.0
              }
            },
            {
              "text": "Area= \\pi x6^2 x\\frac{150}{360}",
              "position": {
                "x": 30.8,
                "y": 49.3,
                "width": 34.0,
                "height": 5.0
              }
            },
            {
              "text": "= 15\\pi",
              "position": {
                "x": 30.8,
                "y": 54.9,
                "width": 11.3,
                "height": 5.0
              }
            }
          ],
          "subQuestions": []
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q9 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "9",
          "text": "In a sale, the normal price of a coat is reduced by R% \nGiven that\nsale price = 0.7 \\times normal price\nfind the value of R.",
          "studentWorkLines": [
            {
              "text": "30",
              "position": {
                "x": 60.96,
                "y": 74.02,
                "width": 7.13,
                "height": 4.0
              }
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q8 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "8",
          "text": "Len has 8 parcels.\nThe mean weight of the 8 parcels is 2.5 kg.\nThe mean weight of 3 of the parcels is 2kg.\nWork out the mean weight of the other 5 parcels.",
          "studentWorkLines": [
            {
              "text": "\\frac{2x3+5w}{8} = 2.5",
              "position": {
                "x": 26.04,
                "y": 27.08,
                "width": 30.0,
                "height": 7.0
              }
            },
            {
              "text": "w=2.8",
              "position": {
                "x": 35.04,
                "y": 35.08,
                "width": 10.0,
                "height": 7.0
              }
            },
            {
              "text": "2.8",
              "position": {
                "x": 70.04,
                "y": 38.08,
                "width": 5.0,
                "height": 7.0
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q7 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "7",
          "text": "Kasim has some small jars, some medium jars and some large jars.\nHe has a total of 400 jars.\n\\frac{3}{8} of the 400 jars are empty.\nFor the empty jars,\nnumber of small jars : number of medium jars = 3:4\nnumber of medium jars: number of large jars = 1:2\nWork out the percentage of Kasim's jars that are empty small jars.",
          "studentWorkLines": [
            {
              "text": "400\\times\\frac{3}{8} = 150 empty",
              "position": {
                "x": 30.83,
                "y": 28.89,
                "width": 32.5,
                "height": 7.03
              }
            },
            {
              "text": "S: m: L",
              "position": {
                "x": 30.83,
                "y": 38.89,
                "width": 14.58,
                "height": 5.55
              }
            },
            {
              "text": "3:4",
              "position": {
                "x": 30.83,
                "y": 44.44,
                "width": 7.5,
                "height": 5.55
              }
            },
            {
              "text": "1:2",
              "position": {
                "x": 30.83,
                "y": 50.0,
                "width": 7.5,
                "height": 5.55
              }
            },
            {
              "text": "3:4:8 \\Rightarrow 19 \\frac{150}{19}=10",
              "position": {
                "x": 30.83,
                "y": 55.55,
                "width": 45.0,
                "height": 5.55
              }
            },
            {
              "text": "= 30:40:80",
              "position": {
                "x": 30.83,
                "y": 62.5,
                "width": 22.5,
                "height": 5.55
              }
            },
            {
              "text": "\\frac{30}{400}\\times100\\%",
              "position": {
                "x": 30.83,
                "y": 71.38,
                "width": 25.83,
                "height": 7.03
              }
            },
            {
              "text": "7.5",
              "position": {
                "x": 75.0,
                "y": 83.61,
                "width": 7.5,
                "height": 5.55
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q11 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "11",
          "text": "Triangle A is translated by the vector \\(\\begin{pmatrix} 6 \\\\ -4 \\end{pmatrix}\\) to give triangle B.\nTriangle B is rotated 90¬∞ clockwise about the point (1, 2) to give triangle C.\nDescribe fully the single transformation that maps triangle A onto triangle C.",
          "studentWorkLines": [
            {
              "text": "Rotated 90¬∞ clockwise about the point (-4,1).",
              "position": {
                "x": 79,
                "y": 650,
                "width": 500,
                "height": 30
              }
            }
          ],
          "hasStudentDrawing": true,
          "studentDrawingPosition": {
            "x": 120,
            "y": 100,
            "width": 500,
            "height": 400
          }
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q10 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "10",
          "text": "Solve the simultaneous equations\n5x - 2y = 23\n2x - 3y = 18",
          "hasStudentDrawing": false,
          "studentWorkLines": [
            {
              "text": "10X-4y=46",
              "position": {
                "x": 41.02,
                "y": 27.19,
                "width": 21.87,
                "height": 4.06
              }
            },
            {
              "text": "102-15y=18x9",
              "position": {
                "x": 41.02,
                "y": 31.25,
                "width": 25.0,
                "height": 4.06
              }
            },
            {
              "text": "11y=46-18x9",
              "position": {
                "x": 41.02,
                "y": 36.33,
                "width": 25.0,
                "height": 4.06
              }
            },
            {
              "text": "„ÇΩ=-4",
              "position": {
                "x": 41.02,
                "y": 40.39,
                "width": 10.93,
                "height": 4.06
              }
            },
            {
              "text": "x=3",
              "position": {
                "x": 41.02,
                "y": 44.45,
                "width": 7.81,
                "height": 4.06
              }
            },
            {
              "text": "x = 3",
              "position": {
                "x": 68.75,
                "y": 58.98,
                "width": 7.81,
                "height": 4.06
              }
            },
            {
              "text": "y = -4",
              "position": {
                "x": 68.75,
                "y": 63.04,
                "width": 7.81,
                "height": 4.06
              }
            }
          ],
          "subQuestions": []
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q4 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "4",
          "text": "Here is a Venn diagram.",
          "hasStudentDrawing": false,
          "studentWorkLines": [],
          "subQuestions": [
            {
              "part": "a",
              "text": "Write down the numbers that are in set P'",
              "studentWorkLines": [
                {
                  "text": "10,13,11,14,16,17",
                  "position": {
                    "x": 16.64,
                    "y": 27.96,
                    "width": 41.82,
                    "height": 6.06
                  }
                }
              ],
              "hasStudentDrawing": false
            },
            {
              "part": "b",
              "text": "A number is chosen at random from the universal set, &.\nFind the probability that this number is in the set P\\cup Q",
              "studentWorkLines": [
                {
                  "text": "\\frac{5}{9}",
                  "position": {
                    "x": 35.09,
                    "y": 47.03,
                    "width": 7.1,
                    "height": 10.0
                  }
                },
                {
                  "text": "5/9",
                  "position": {
                    "x": 72.06,
                    "y": 48.89,
                    "width": 6.03,
                    "height": 5.0
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q1 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "1",
          "text": "Here are the first four terms of an arithmetic sequence.\n1 5 9 13\nFind an expression, in terms of n, for the nth term of this sequence.",
          "studentWorkLines": [
            {
              "text": "4n-3",
              "position": {
                "x": 34.58,
                "y": 30.89,
                "width": 12.5,
                "height": 6.06
              }
            }
          ],
          "hasStudentDrawing": false
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q6 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "6",
          "text": "Here is a straight line L drawn on a grid.",
          "hasStudentDrawing": false,
          "studentWorkLines": [],
          "subQuestions": [
            {
              "part": "a",
              "text": "Find an equation for L.",
              "studentWorkLines": [
                {
                  "text": "y=\\frac{3}{2}x+3",
                  "position": {
                    "x": 24.58,
                    "y": 43.96,
                    "width": 22.5,
                    "height": 5.03
                  }
                }
              ],
              "hasStudentDrawing": false
            },
            {
              "part": "b",
              "text": "Write down the equation of a straight line parallel to M.",
              "studentWorkLines": [
                {
                  "text": "y=5x+1",
                  "position": {
                    "x": 54.58,
                    "y": 77.15,
                    "width": 14.58,
                    "height": 4.03
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q5 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "5",
          "text": "Sophie drives a distance of 513 kilometres on a motorway in France.\nShe pays 0.81 euros for every 10 kilometres she drives.",
          "studentWorkLines": [],
          "hasStudentDrawing": false,
          "subQuestions": [
            {
              "part": "a",
              "text": "Work out an estimate for the total amount that Sophie pays.",
              "studentWorkLines": [
                {
                  "text": "\\frac{513}{10} \\times 0.81 \\approx \\frac{500}{10} \\times \\frac{8}{10} = 40",
                  "position": {
                    "x": 21.02,
                    "y": 20.48,
                    "width": 58.98,
                    "height": 11.05
                  }
                },
                {
                  "text": "40",
                  "position": {
                    "x": 75.0,
                    "y": 34.52,
                    "width": 10.0,
                    "height": 8.0
                  }
                }
              ],
              "hasStudentDrawing": false
            },
            {
              "part": "b",
              "text": "Is your answer to part (a) an underestimate or an overestimate?\nGive a reason for your answer.",
              "studentWorkLines": [
                {
                  "text": "Underestimate, Cause I rounded down",
                  "position": {
                    "x": 11.86,
                    "y": 49.04,
                    "width": 50.0,
                    "height": 8.0
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q2 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "2",
          "subQuestions": [
            {
              "part": "a",
              "text": "Work out 3\\frac{4}{5} - 1\\frac{2}{3}",
              "studentWorkLines": [
                {
                  "text": "=\\frac{32}{15}",
                  "position": {
                    "x": 14.7,
                    "y": 17.1,
                    "width": 10.0,
                    "height": 6.0
                  }
                }
              ]
            },
            {
              "part": "b",
              "text": "Kevin was asked to work out 2\\frac{1}{3} x \\frac{5}{8}\nHere is his working and his answer.\n2\\frac{1}{3} x \\frac{5}{8} = \\frac{7}{3} x \\frac{5}{8}\n= \\frac{35}{24}\n= 1\\frac{9}{24}\nKevin's answer is wrong.\nWhat mistake has Kevin made?",
              "studentWorkLines": [
                {
                  "text": "\\frac{35}{24} = 1\\frac{11}{24} not 1\\frac{9}{24}",
                  "position": {
                    "x": 14.7,
                    "y": 77.0,
                    "width": 40.0,
                    "height": 5.0
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}

[36m[CLASSIFICATION DEBUG] Q3 Raw Response:[0m
{
  "pages": [
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "3",
          "text": "The diagram shows a plan of a floor.\n\nPetra is going to cover the floor with paint.\n\nPetra has 3 tins of paint.\nThere are 2.5 litres of paint in each tin.\n\nPetra thinks 1 litre of paint will cover 10m¬≤ of floor.",
          "studentWorkLines": [],
          "hasStudentDrawing": false,
          "subQuestions": [
            {
              "part": "a",
              "text": "Assuming Petra is correct, does she have enough paint to cover the floor?\nYou must show all your working.",
              "studentWorkLines": [
                {
                  "text": "Area = 8x6 + 5x4",
                  "position": {
                    "x": 14.7,
                    "y": 48.1,
                    "width": 30.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "= 68 m¬≤",
                  "position": {
                    "x": 14.7,
                    "y": 52.5,
                    "width": 16.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "Litle = 2.5x3",
                  "position": {
                    "x": 14.7,
                    "y": 58.8,
                    "width": 25.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "= 7.5",
                  "position": {
                    "x": 14.7,
                    "y": 63.2,
                    "width": 10.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "= 75 m¬≤ of floor",
                  "position": {
                    "x": 14.7,
                    "y": 69.5,
                    "width": 35.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "75>68, so yes",
                  "position": {
                    "x": 14.7,
                    "y": 75.8,
                    "width": 30.0,
                    "height": 4.0
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    },
    {
      "category": "questionAnswer",
      "rotation": 0,
      "questions": [
        {
          "questionNumber": "3",
          "text": "Actually, 1 litre of paint will cover 11 m¬≤ of floor.",
          "studentWorkLines": [],
          "hasStudentDrawing": false,
          "subQuestions": [
            {
              "part": "b",
              "text": "Does this affect your answer to part (a)?\nYou must give a reason for your answer.",
              "studentWorkLines": [
                {
                  "text": "No, 7.5 litre = 82.5 m¬≤ and 82.5 > 68, so he will",
                  "position": {
                    "x": 14.7,
                    "y": 40.8,
                    "width": 70.0,
                    "height": 4.0
                  }
                },
                {
                  "text": "still have enough",
                  "position": {
                    "x": 14.7,
                    "y": 45.2,
                    "width": 30.0,
                    "height": 4.0
                  }
                }
              ],
              "hasStudentDrawing": false
            }
          ]
        }
      ]
    }
  ]
}
[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m29.9s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
üöÄ [OVERRIDE] 90% Rule Triggered: 24/24 pages have student work. Overriding all questionOnly pages to questionAnswer for consistency.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîÄ [PERFECT SPLIT] Building standalone structures with re-indexing
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üéØ [MODE ROUTING] Pure marking mode

‚úÖ Perfect split complete - each mode has consecutive 0-based indices
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m29.9s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
üîç [MODE DETECTION] Analysis (AFTER overrides):
  - All question-only: false
  - Has mixed content: false
  - Has any student work: true
  - Selected mode: Marking Mode
[PIPELINE DEBUG] Page 1 OCR Data Check:
   - Total Blocks: 9
   - Sample HW Block Check: {"text":"2 \\sin x=-1","hasCoords":true,"coords":{"x":391,"y":944,"width":279,"height":83.25}}
[1m[32m‚úÖ [OCR PROCESSING][0m [1mCOMPLETED[0m in [1m8.1s[0m ([32m[1mMATHPIX[0m)
[DETECTION] Q1 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q2 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q3 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q4 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q5 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q6 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q7 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q8 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q9 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q10 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q11 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q12 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q13 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q14 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q15 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q16 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q17 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q18 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q19 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q20 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q21 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q22 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q23 -> Global search (Pool: 108 papers, 2709 candidates)
[31m[HINT] ‚ö†Ô∏è Hint Adherence Failed! Frankenstein result detected. Restarting...[0m
[DETECTION] Q1 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q2 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q3 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q4 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q5 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q6 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q7 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q8 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q9 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q10 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q11 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q12 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q13 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q14 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q15 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q16 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q17 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q18 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q19 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q20 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q21 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q22 -> Global search (Pool: 108 papers, 2709 candidates)
[DETECTION] Q23 -> Global search (Pool: 108 papers, 2709 candidates)
[32m[HINT] üèõÔ∏è Consensus Reached! Forcing to "Pearson Edexcel - 1MA1/1H - June 2024, Higher Tier"[0m
[DETECTION] Q1 -> Using paper hint: "Pearson Edexcel 1MA1/1H June 2024 Higher Tier" (Pool: 1 papers, 23 candidates)
   ‚îî‚îÄ Rescued Group Q1 -> Pearson Edexcel - 1MA1/1H - June 2024, Higher Tier
[DETECTION] Q3a -> Using paper hint: "Pearson Edexcel 1MA1/1H June 2024 Higher Tier" (Pool: 1 papers, 23 candidates)
   ‚îî‚îÄ Rescued Group Q3 -> Pearson Edexcel - 1MA1/1H - June 2024, Higher Tier
[DETECTION] Q4a -> Using paper hint: "Pearson Edexcel 1MA1/1H June 2024 Higher Tier" (Pool: 1 papers, 23 candidates)
   ‚îî‚îÄ Rescued Group Q4 -> Pearson Edexcel - 1MA1/1H - June 2024, Higher Tier
[DETECTION] Q5a -> Using paper hint: "Pearson Edexcel 1MA1/1H June 2024 Higher Tier" (Pool: 1 papers, 23 candidates)
   ‚îî‚îÄ Rescued Group Q5 -> Pearson Edexcel - 1MA1/1H - June 2024, Higher Tier
[DETECTION] Q6a -> Using paper hint: "Pearson Edexcel 1MA1/1H June 2024 Higher Tier" (Pool: 1 papers, 23 candidates)
   ‚îî‚îÄ Rescued Group Q6 -> Pearson Edexcel - 1MA1/1H - June 2024, Higher Tier
[DETECTION] Q12i -> Using paper hint: "Pearson Edexcel 1MA1/1H June 2024 Higher Tier" (Pool: 1 papers, 23 candidates)
   ‚îî‚îÄ Rescued Group Q12 -> Pearson Edexcel - 1MA1/1H - June 2024, Higher Tier
[DETECTION] Q13a -> Using paper hint: "Pearson Edexcel 1MA1/1H June 2024 Higher Tier" (Pool: 1 papers, 23 candidates)
   ‚îî‚îÄ Rescued Group Q13 -> Pearson Edexcel - 1MA1/1H - June 2024, Higher Tier
[DETECTION] Q18 -> Using paper hint: "Pearson Edexcel 1MA1/1H June 2024 Higher Tier" (Pool: 1 papers, 23 candidates)
   ‚îî‚îÄ Rescued Group Q18 -> Pearson Edexcel - 1MA1/1H - June 2024, Higher Tier
üìç [PIPELINE] Detected consensus paper: "Pearson Edexcel - 1MA1/1H - June 2024, Higher Tier". Will use as hint for question-only pages.
[1m[32m‚úÖ [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m13.2s[0m ([32m[1mQUESTION-DETECTION[0m)

üîç [DETECTION CONTEXT]
   Strategy: Pearson Edexcel 1MA1/1H June 2024 Higher Tier
   Pool Size: 1 papers, 23 total question candidates
------------------------------------------------------------------------------------------------------------------------------------

üìã [DETECTION AUDIT REPORT]
------------------------------------------------------------------------------------------------------------------------------------
| Q#   | Input Text (Fragment)                       | Match Result / Paper Title                         | Score | Status        |
------------------------------------------------------------------------------------------------------------------------------------
| 1    | Here are the first four terms of an arithm... | Edexcel GCSE 1MA1/1H June 2024 Q1                  | 0.950 | [32m‚úÖ SUCCESS[0m      |
| 2a   | Work out 3\frac{4}{5} - 1\frac{2}{3}          | Edexcel GCSE 1MA1/1H June 2024 Q2                  | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 2b   | Kevin was asked to work out 2\frac{1}{3} x... | Edexcel GCSE 1MA1/1H June 2024 Q2                  | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 3a   | Assuming Petra is correct, does she have e... | Edexcel GCSE 1MA1/1H June 2024 Q3                  | 0.474 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.474] 1MA1/1H Q3                     | Txt:0.39 Num:0.00 Str:1.00 Sem:PASS
| 3b   | Does this affect your answer to part (a)? ... | Edexcel GCSE 1MA1/1H June 2024 Q3                  | 0.474 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.474] 1MA1/1H Q3                     | Txt:0.39 Num:0.00 Str:1.00 Sem:PASS
| 4a   | Write down the numbers that are in set P'     | Edexcel GCSE 1MA1/1H June 2024 Q4                  | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/1H Q4                     | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 4b   | A number is chosen at random from the univ... | Edexcel GCSE 1MA1/1H June 2024 Q4                  | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/1H Q4                     | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 5a   | Work out an estimate for the total amount ... | Edexcel GCSE 1MA1/1H June 2024 Q5                  | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/1H Q5                     | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 5b   | Is your answer to part (a) an underestimat... | Edexcel GCSE 1MA1/1H June 2024 Q5                  | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/1H Q5                     | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 6a   | Find an equation for L.                       | Edexcel GCSE 1MA1/1H June 2024 Q6                  | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/1H Q6                     | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 6b   | Write down the equation of a straight line... | Edexcel GCSE 1MA1/1H June 2024 Q6                  | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/1H Q6                     | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 7    | Kasim has some small jars, some medium jar... | Edexcel GCSE 1MA1/1H June 2024 Q7                  | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 8    | Len has 8 parcels. The mean weight of the ... | Edexcel GCSE 1MA1/1H June 2024 Q8                  | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 9    | In a sale, the normal price of a coat is r... | Edexcel GCSE 1MA1/1H June 2024 Q9                  | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 10   | Solve the simultaneous equations 5x - 2y =... | Edexcel GCSE 1MA1/1H June 2024 Q10                 | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 11   | Triangle A is translated by the vector \(\... | Edexcel GCSE 1MA1/1H June 2024 Q11                 | 0.859 | [32m‚úÖ SUCCESS[0m      |
| 12i  | Write down the letter of the graph that co... | Edexcel GCSE 1MA1/1H June 2024 Q12                 | 0.684 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.684] 1MA1/1H Q12                    | Txt:0.80 Num:0.10 Str:1.00 Sem:PASS
| 12ii | y = -x¬≥                                       | Edexcel GCSE 1MA1/1H June 2024 Q12                 | 0.684 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.684] 1MA1/1H Q12                    | Txt:0.80 Num:0.10 Str:1.00 Sem:PASS
| 12iii | y = -\frac{5}{x}                              | Edexcel GCSE 1MA1/1H June 2024 Q12                 | 0.684 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.684] 1MA1/1H Q12                    | Txt:0.80 Num:0.10 Str:1.00 Sem:PASS
| 13a  | On the grid, draw a histogram for this inf... | Edexcel GCSE 1MA1/1H June 2024 Q13                 | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/1H Q13                    | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 13b  | Work out an estimate for the fraction of t... | Edexcel GCSE 1MA1/1H June 2024 Q13                 | 0.615 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.615] 1MA1/1H Q13                    | Txt:0.70 Num:0.00 Str:1.00 Sem:PASS
| 14   | Expand and simplify (3x-1)(2x + 3)(x - 5)     | Edexcel GCSE 1MA1/1H June 2024 Q14                 | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 15   | OAB is a sector of a circle with centre O ... | Edexcel GCSE 1MA1/1H June 2024 Q15                 | 0.910 | [32m‚úÖ SUCCESS[0m      |
| 16   | There are only n orange sweets and 1 white... | Edexcel GCSE 1MA1/1H June 2024 Q16                 | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 17a  | Rationalise the denominator of \frac{1}{\s... | Edexcel GCSE 1MA1/1H June 2024 Q17                 | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 17b  | Simplify fully \sqrt{80}-\sqrt{5}             | Edexcel GCSE 1MA1/1H June 2024 Q17                 | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 18   | Show that 0.15 + 0.227 can be written in t... | Edexcel GCSE 1MA1/1H June 2024 Q18                 | 0.713 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      [32m‚óã[0m [0.713] 1MA1/1H Q18                    | Txt:0.84 Num:0.14 Str:1.00 Sem:PASS
| 19   | ABC and DAB are similar isosceles triangle... | Edexcel GCSE 1MA1/1H June 2024 Q19                 | 1.000 | [32m‚úÖ SUCCESS[0m      |
| 20   | 2^x = \frac{2^n}{\sqrt{2}}  2^y = (\sqrt{2... | Edexcel GCSE 1MA1/1H June 2024 Q20                 | 0.927 | [32m‚úÖ SUCCESS[0m      |
| 21   | A solid cuboid has a volume of 300 cm¬≥ The... | Edexcel GCSE 1MA1/1H June 2024 Q21                 | 0.893 | [32m‚úÖ SUCCESS[0m      |
| 22a  | Sketch the graph of y = sinx¬∞ for 0 ‚â§ x ‚â§ 360 | Edexcel GCSE 1MA1/1H June 2024 Q22                 | 0.805 | [32m‚úÖ SUCCESS[0m      |
| 22b  | Solve the equation 2 sinx = -1 for 0 ‚â§ x ‚â§... | Edexcel GCSE 1MA1/1H June 2024 Q22                 | 0.805 | [32m‚úÖ SUCCESS[0m      |
| 23   | C is a circle with centre (0, 0) L is a st... | Edexcel GCSE 1MA1/1H June 2024 Q23                 | 1.000 | [32m‚úÖ SUCCESS[0m      |
------------------------------------------------------------------------------------------------------------------------------------


üìä [QUESTION DETECTION STATISTICS]
   Total questions: 33
   Detected: 19/33
   Not detected: 14
   [HINT] Hint Used: "Global Search"
   [HINT] Matched Papers: 108
[DRAWING] Q22: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q22: Will pass image to Marking AI
[DRAWING] Q23: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q23: Will pass image to Marking AI
[DRAWING] Q13: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q13: Will pass image to Marking AI
[DRAWING] Q11: Passing image to Marking AI (Drawing Classification returned 0 for this drawing question)
[DRAWING] Q11: Will pass image to Marking AI

üîç [EVIDENCE LOG] Q20 Classification Lines:
   [Line 0] Text: "2^x = 2^n \times 2^{..."
   [Line 0] POS: {"x":30.62,"y":32.29,"width":30,"height":6,"pageIndex":6} | COORDS: undefined
   [Line 1] Text: "x = n-\frac{1}{3}..."
   [Line 1] POS: {"x":30.62,"y":41.25,"width":18,"height":5,"pageIndex":6} | COORDS: undefined
   [Line 2] Text: "y = \frac{5}{2}..."
   [Line 2] POS: {"x":30.62,"y":49.79,"width":10,"height":5,"pageIndex":6} | COORDS: undefined
   [Line 3] Text: "n = \frac{35}{6}..."
   [Line 3] POS: {"x":30.62,"y":58.33,"width":10,"height":5,"pageIndex":6} | COORDS: undefined
   [Line 4] Text: "\frac{35}{6}..."
   [Line 4] POS: {"x":68.54,"y":49.79,"width":7,"height":5,"pageIndex":6} | COORDS: undefined
[SPATIAL SHIELD] Applying Hybrid Shield for Q1...
[SHIELD] üõ°Ô∏è Analyzing Q1. Next Header "Q2" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q1...
[SHIELD] üõ°Ô∏è Analyzing Q1. Next Header "Q2" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q2...
[SHIELD] üõ°Ô∏è Analyzing Q2. Next Header "Q3" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q2...
[SHIELD] üõ°Ô∏è Analyzing Q2. Next Header "Q3" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q3...
[SHIELD] üõ°Ô∏è Analyzing Q3. Next Header "Q4" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q3...
[SHIELD] üõ°Ô∏è Analyzing Q3. Next Header "Q4" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q4...
[SHIELD] üõ°Ô∏è Analyzing Q4. Next Header "Q5" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q4...
[SHIELD] üõ°Ô∏è Analyzing Q4. Next Header "Q5" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q5...
[SHIELD] üõ°Ô∏è Analyzing Q5. Next Header "Q6" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q5...
[SHIELD] üõ°Ô∏è Analyzing Q5. Next Header "Q6" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q6...
[SHIELD] üõ°Ô∏è Analyzing Q6. Next Header "Q7" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q6...
[SHIELD] üõ°Ô∏è Analyzing Q6. Next Header "Q7" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q7...
[SHIELD] üõ°Ô∏è Analyzing Q7. Next Header "Q8" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q7...
[SHIELD] üõ°Ô∏è Analyzing Q7. Next Header "Q8" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q8...
[SHIELD] üõ°Ô∏è Analyzing Q8. Next Header "Q9" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q8...
[SHIELD] üõ°Ô∏è Analyzing Q8. Next Header "Q9" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q9...
[SHIELD] üõ°Ô∏è Analyzing Q9. Next Header "Q10" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q9...
[SHIELD] üõ°Ô∏è Analyzing Q9. Next Header "Q10" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q10...
[SHIELD] üõ°Ô∏è Analyzing Q10. Next Header "Q11" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q10...
[SHIELD] üõ°Ô∏è Analyzing Q10. Next Header "Q11" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q11...
[SHIELD] üõ°Ô∏è Analyzing Q11. Next Header "Q12" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q11...
[SHIELD] üõ°Ô∏è Analyzing Q11. Next Header "Q12" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q12...
[SHIELD] üõ°Ô∏è Analyzing Q12. Next Header "Q13" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q12...
[SHIELD] üõ°Ô∏è Analyzing Q12. Next Header "Q13" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q13...
[SHIELD] üõ°Ô∏è Analyzing Q13. Next Header "Q14" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q13...
[SHIELD] üõ°Ô∏è Analyzing Q13. Next Header "Q14" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q14...
[SHIELD] üõ°Ô∏è Analyzing Q14. Next Header "Q15" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q14...
[SHIELD] üõ°Ô∏è Analyzing Q14. Next Header "Q15" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q15...
[SHIELD] üõ°Ô∏è Analyzing Q15. Next Header "Q16" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q15...
[SHIELD] üõ°Ô∏è Analyzing Q15. Next Header "Q16" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q16...
[SHIELD] üõ°Ô∏è Analyzing Q16. Next Header "Q17" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q16...
[SHIELD] üõ°Ô∏è Analyzing Q16. Next Header "Q17" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q17...
[SHIELD] üõ°Ô∏è Analyzing Q17. Next Header "Q18" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q17...
[SHIELD] üõ°Ô∏è Analyzing Q17. Next Header "Q18" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q18...
[SHIELD] üõ°Ô∏è Analyzing Q18. Next Header "Q19" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q18...
[SHIELD] üõ°Ô∏è Analyzing Q18. Next Header "Q19" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q19...
[SHIELD] üõ°Ô∏è Analyzing Q19. Next Header "Q20" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q19...
[SHIELD] üõ°Ô∏è Analyzing Q19. Next Header "Q20" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q20...
[SHIELD] üõ°Ô∏è Analyzing Q20. Next Header "Q21" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q20...
[SHIELD] üõ°Ô∏è Analyzing Q20. Next Header "Q21" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q21...
[SHIELD] üõ°Ô∏è Analyzing Q21. Next Header "Q22" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q21...
[SHIELD] üõ°Ô∏è Analyzing Q21. Next Header "Q22" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q22...
[SHIELD] üõ°Ô∏è Analyzing Q22. Next Header "Q23" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q22...
[SHIELD] üõ°Ô∏è Analyzing Q22. Next Header "Q23" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q23...
[SHIELD] üõ°Ô∏è Analyzing Q23. Next Header "Q24" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
[SPATIAL SHIELD] Applying Hybrid Shield for Q23...
[SHIELD] üõ°Ô∏è Analyzing Q23. Next Header "Q24" present in input? NO (Clean)
[SHIELD] ‚úÇÔ∏è Slicing: Keeping blocks from index 0 to End. (Dropped 0 blocks from start)
‚úÖ createMarkingTasksFromClassification completed, created 23 marking task(s)
[1m[32müîÑ [AI MARKING][0m [1mSTARTING...[0m
[MARKING DEBUG] Q1 has 8 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_69, block_0_1_836, block_0_2_358, block_0_3_115, block_0_4_245, block_0_5_280, block_0_6_290, block_0_7_456
[MARKING DEBUG] Q2 has 13 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_279, block_0_1_729, block_0_2_181, block_0_3_372, block_0_4_205, block_0_5_291, block_0_6_496, block_0_7_737, block_0_8_953, block_0_9_449, block_0_10_152, block_0_11_785, block_0_12_717
[MARKING DEBUG] Q3 has 21 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_509, block_0_1_626, block_0_2_142, block_0_3_882, block_0_4_251, block_0_5_469, block_0_6_803, block_0_7_35, block_0_8_487, block_0_9_722, block_0_10_191, block_0_11_609, block_0_12_577, block_0_13_165, block_0_14_845, block_0_0_274, block_0_1_882, block_0_2_548, block_0_3_895, block_0_4_29, block_0_5_486
[MARKING DEBUG] Q4 has 10 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_438, block_0_1_410, block_0_2_816, block_0_4_167, block_0_5_888, block_0_6_663, block_0_7_457, block_0_9_557, block_0_10_646, block_0_11_636
[MARKING DEBUG] Q5 has 12 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_69, block_0_1_962, block_0_2_107, block_0_3_912, block_0_5_56, block_0_6_553, block_0_7_872, block_0_8_4, block_0_9_590, block_0_11_153, block_0_14_346, block_0_15_244
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q2[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 2

## QUESTION TEXT
Work out $3\frac{4}{5}-1\frac{2}{3}$ Kevin was asked to work out $2\frac{1}{3}\times\frac{5}{8}$. Here is his working and his answer. $2\frac{1}{3}\times\frac{5}{8}=\frac{7}{3}\times\frac{5}{8} =\frac{35}{24} =1\frac{9}{24}$. Kevin's answer is wrong. What mistake has Kevin made?


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[2a]
- M1: for a method to subtract using a common denominator with at least one fraction correct (eg $(3 \frac{12}{15}) - (1 \frac{10}{15})$ or $\frac{57}{15} - \frac{25}{15}$)
- A1: for $2\frac{2}{15}$ oe eg $\frac{32}{15}$

[2b]
- C1: for explaining that Kevin did not convert to the correct mixed number



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] =\frac{32}{15} (ID: line_1)

[SUB-QUESTION B STUDENT WORK]
[Line 2] \frac{35}{24} = 1\frac{11}{24} not 1\frac{9}{24} (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_279]: "2 (a) Work out \( 3 \frac{4}{5}-1 \frac{2}{3} \)"
[block_0_1_729]: "=\frac{32}{19}"
[block_0_2_181]: "(2)"
[block_0_3_372]: "Kevin was asked to work out \( 2 \frac{1}{3} \times \frac{5}{8} \)"
[block_0_4_205]: "Here is his working and his answer."
[block_0_5_291]: "2 \frac{1}{3} \times \frac{5}{8}  =\frac{7}{3} \times \frac{5}{8}"
[block_0_6_496]: " =\frac{35}{24}"
[block_0_7_737]: " =1 \frac{9}{24}"
[block_0_8_953]: "Kevin's answer is wrong."
[block_0_9_449]: "(b) What mistake has Kevin made?"
[block_0_10_152]: "35 / 24=1 \frac{11}{24} \text { bot } 1 \frac{9}{24}"
[block_0_11_785]: "(1)"
[block_0_12_717]: "3"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q3[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 3

## QUESTION TEXT
The diagram shows a plan of a floor. [An L-shaped polygon is shown with right angles marked. The side lengths are given: top 10 m, left 8 m, bottom 6 m, and right (upper part) 5 m.] Petra is going to cover the floor with paint. Petra has 3 tins of paint. There are 2.5 litres of paint in each tin. Petra thinks 1 litre of paint will cover $10~m^{2}$ of floor. Assuming Petra is correct, does she have enough paint to cover the floor? You must show all your working. Actually, 1 litre of paint will cover $11~m^{2}$ of floor. Does this affect your answer to part (a)? You must give a reason for your answer.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[3a]
- P1: for a process to find the area of one shape (eg $10 \times 8 (= 80)$ or $10 \times 5 (= 50)$ or $8 \times 6 (= 48)$ or $(10 - 6) \times 5 (= 20)$ or $(10 - 6) \times (8 - 5) (= 12)$ or $6 \times (8 - 5) (= 18)$ or $5 \times 6 (= 30)$)
- P1: for a complete process to find the total area (eg $"80" - "12" (= 68)$ or $"50" + "18" (= 68)$ or $"48" + "20" (= 68)$)
- P1: for a complete process to find the area covered by 3 tins OR for a complete process to find the number of litres needed OR for a complete process to find the number of tins needed (eg $3 \times 2.5 \times 10 (= 75)$ OR eg $"68" \div 10 (= 6.8)$ OR eg $"68" \div 10 \div 2.5 (= 2.72)$)
- A1: for 'Yes' supported by correct figures (eg 68 ($m^2$) and 75 ($m^2$) or 6.8 (litres) and 7.5 (litres) or 68 ($m^2$) and 2.72 (tins needed))

[3b]
- C1: ft from (a) for "has no effect" with reason



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] Area = 8x6 + 5x4 (ID: line_1)
[Line 2] = 68 m¬≤ (ID: line_2)
[Line 3] Litle = 2.5x3 (ID: line_3)
[Line 4] = 7.5 (ID: line_4)
[Line 5] = 75 m¬≤ of floor (ID: line_5)
[Line 6] 75>68, so yes (ID: line_6)

[SUB-QUESTION B STUDENT WORK]
[Line 7] No, 7.5 litre = 82.5 m¬≤ and 82.5 > 68, so he will (ID: line_7)
[Line 8] still have enough (ID: line_8)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_509]: "3 The diagram shows a plan of a floor."
[block_0_1_626]: "Petra is going to cover the floor with paint."
[block_0_2_142]: "Petra has 3 tins of paint."
[block_0_3_882]: "There are 2.5 litres of paint in each tin."
[block_0_4_251]: "Petra thinks 1 litre of paint will cover \( 10 \mathrm{~m}^{2} \) of floor."
[block_0_5_469]: "(a) Assuming Petra is correct, does she have enough paint to cover the floor?"
[block_0_6_803]: "You must show all your working."
[block_0_7_35]: "\text { Area }= & 8 \times 6+9 \times 4"
[block_0_8_487]: "= & 68 \mathrm{~m}^{2}"
[block_0_9_722]: "\text { Lifre }= & 2.9 \times 3"
[block_0_10_191]: "= & 7.5"
[block_0_11_609]: "= & 75 \mathrm{n}^{2} \text { of flour }"
[block_0_12_577]: "& 75768,80 \text { yes }"
[block_0_13_165]: "(4)"
[block_0_14_845]: "4"
[block_0_0_274]: "Actually, 1 litre of paint will cover \( 11 \mathrm{~m}^{2} \) of floor."
[block_0_1_882]: "(b) Does this affect your answer to part (a)?"
[block_0_2_548]: "You must give a reason for your answer."
[block_0_3_895]: "No, 7.5 litre \( =82.5 \mathrm{~m}^{2} \) ond \( 87.5>68 \), so he will"
[block_0_4_29]: "Still hore enough"
[block_0_5_486]: "(1)"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q4[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 4

## QUESTION TEXT
Here is a Venn diagram. [A Venn diagram shows a universal set $\mathcal{E}$ containing two overlapping circles, P and Q. Circle P only contains 12 and 15. The intersection, $P \cap Q$, contains 18. Circle Q only contains 10 and 14. The area outside both circles contains 11, 13, 16, 17.] Write down the numbers that are in set P' A number is chosen at random from the universal set, $\mathcal{E}$. Find the probability that this number is in the set $P\cup Q$.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[4a]
- B1: cao

[4b]
- M1: for identification of 10, 12, 14, 15, 18 OR for $\frac{a}{9}$ where $1 \le a \le 8$, a an integer, OR for $\frac{5}{b}$ where $b > 5$, b an integer, OR for incorrect form, eg 5: 9
- A1: oe



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] 10,13,11,14,16,17 (ID: line_1)

[SUB-QUESTION B STUDENT WORK]
[Line 2] \frac{5}{9} (ID: line_2)
[Line 3] 5/9 (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_438]: "4 Here is a Venn diagram."
[block_0_1_410]: "(a) Write down the numbers that are in set \( P^{\prime} \)"
[block_0_2_816]: "10,13,11,14,16,17"
[block_0_4_167]: "(1)"
[block_0_5_888]: "A number is chosen at random from the universal set, \( \mathscr{E} \)"
[block_0_6_663]: "(b) Find the probability that this number is in the set \( P \cup Q \)"
[block_0_7_457]: "\frac{5}{9}"
[block_0_9_557]: "S"
[block_0_10_646]: "(2)"
[block_0_11_636]: "6"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=2

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q1[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 1

## QUESTION TEXT
Here are the first four terms of an arithmetic sequence. 1 5 9 13. Find an expression, in terms of n, for the nth term of this sequence.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 2]
- B2: for $4n - 3$ oe
- (B1: for $4n + k$ where $k \ne -3$ or is absent unambiguously shown)

FINAL ANSWER: $4n - 3$



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 4n-3 (ID: line_1)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_69]: "Answer ALL questions."
[block_0_1_836]: "Write your answers in the spaces provided."
[block_0_2_358]: "You must write down all the stages in your working."
[block_0_3_115]: "1 Here are the first four terms of an arithmetic sequence."
[block_0_4_245]: "\begin{array}{llll} 1 & 5 & 9 & 13 \end{array}"
[block_0_5_280]: "Find an expression, in terms of \( n \), for the \( n \)th term of this sequence."
[block_0_6_290]: "4 n-3"
[block_0_7_456]: "2"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q5[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 5

## QUESTION TEXT
Sophie drives a distance of 513 kilometres on a motorway in France. She pays 0.81 euros for every 10 kilometres she drives. Work out an estimate for the total amount that Sophie pays. Is your answer to part (a) an underestimate or an overestimate? Give a reason for your answer.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[5a]
- P1: for using a value rounded to 1sf in a calculation (eg $500 \div 10$ or $500 \times 0.8$ or $510 \times 0.8$ or $513 \times 0.8$ or $500 \times 0.81$)
- P1: for a full process to find the total amount (eg $500 \div 10 \times 0.8$ oe (40) or $510 \div 10 \times 0.8$ oe $(= 40.8)$ or $500 \div 10 \times 0.81 (= 40.5)$)
- A1: for a correct answer following through their correct rounded value(s)

[5b]
- C1: ft from (a) eg underestimate as numbers rounded down



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] \frac{513}{10} \times 0.81 \approx \frac{500}{10} \times \frac{8}{10} = 40 (ID: line_1)
[Line 2] 40 (ID: line_2)

[SUB-QUESTION B STUDENT WORK]
[Line 3] Underestimate, Cause I rounded down (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_69]: "5 Sophie drives a distance of 513 kilometres on a motorway in France."
[block_0_1_962]: "She pays 0.81 euros for every 10 kilometres she drives."
[block_0_2_107]: "(a) Work out an estimate for the total amount that Sophie pays."
[block_0_3_912]: "\frac{S_{13}}{10} \times 0.81 \approx \frac{500}{10} \times \frac{8}{10}=40"
[block_0_5_56]: "40"
[block_0_6_553]: "euros"
[block_0_7_872]: "(3)"
[block_0_8_4]: "(b) Is your answer to part (a) an underestimate or an overestimate?"
[block_0_9_590]: "Give a reason for your answer."
[block_0_11_153]: "Underestimate, casse I rounded doun"
[block_0_14_346]: "(1)"
[block_0_15_244]: "7"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q1] ü•á Trusting AI Total: 2 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ1[0m - Clean response received:
  - Annotations count: [35m1[0m
  - Student score: [32m2/2[0m
  - Usage tokens: [33m6065[0m
     [36mStudent wrote the expression '4n-3'.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_6_290][0m [B2] [34m"4 n-3"[0m
      ‚Ü≥ Reason: Correct expression for the nth term.
      ‚Ü≥ OCR Match: [35m"4 n-3"[0m
      ‚Ü≥ Classification: [35m"4n-3"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q1: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=2, ResultTotal=2
[MARKING DEBUG] Q6 has 9 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_691, block_0_1_468, block_0_2_816, block_0_3_19, block_0_4_332, block_0_5_537, block_0_7_414, block_0_8_831, block_0_9_109
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q6[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 6

## QUESTION TEXT
Here is a straight line L drawn on a grid. [A coordinate grid is shown with x-axis from -4 to 4 and y-axis from -3 to 7. A straight line L passes through (-2, 0) and (0, 3).] Find an equation for L. M is a different straight line with equation $y=5x$. Write down the equation of a straight line parallel to M.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[6a]
- M1: for a correct method to find the gradient of the line, OR identifies 3 as the intercept in words or in a partial equation OR for $y = [\frac{3}{2}]x + c$ OR for $y - b = [\frac{3}{2}](x - a)$ where $(a,b)$ is a correct coordinate (eg $\frac{6-3}{2-0} (=\frac{3}{2})$)
- M1: for $y = \frac{3}{2}x + 3$, oe or for $y = m x + 3, m \ne 0$
- A1: oe

[6b]
- B1: for $y = 5x + c, c \ne 0$ oe



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] y=\frac{3}{2}x+3 (ID: line_1)

[SUB-QUESTION B STUDENT WORK]
[Line 2] y=5x+1 (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_691]: "6 Here is a straight line \( \mathbf{L} \) drawn on a grid."
[block_0_1_468]: "(a) Find an equation for \( \mathbf{L} \)."
[block_0_2_816]: "y=3 / 2 x+3"
[block_0_3_19]: "(3)"
[block_0_4_332]: "\( \mathbf{M} \) is a different straight line with equation \( y=5 x \)"
[block_0_5_537]: "(b) Write down the equation of a straight line parallel to \( \mathbf{M} \)."
[block_0_7_414]: "y=9 x+1"
[block_0_8_831]: "(1)"
[block_0_9_109]: "8"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q2] ü•á Trusting AI Total: 2 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ2[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m2/2[0m
  - Usage tokens: [33m6759[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_1_729][0m [M1] [34m"= frac{32}{19}"[0m
      ‚Ü≥ Reason: Method to subtract using common denominator is implied.
      ‚Ü≥ OCR Match: [35m"= frac{32}{19}"[0m
      ‚Ü≥ Classification: [35m"=\frac{32}{15}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [31mcross[0m [34m[block_0_1_729][0m [A0] [34m"= frac{32}{19}"[0m
      ‚Ü≥ Reason: Incorrect final answer. Should be 32/15.
      ‚Ü≥ OCR Match: [35m"= frac{32}{19}"[0m
      ‚Ü≥ Classification: [35m"=\frac{32}{15}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_10_152][0m [C1] [34m"35 / 24 = 1 frac{11}{24} text { bot } 1 frac{9}{24}"[0m
      ‚Ü≥ Reason: Explains that Kevin did not convert to the correct mixed number.
      ‚Ü≥ OCR Match: [35m"35 / 24 = 1 frac{11}{24} text { bot } 1 frac{9}{24}"[0m
      ‚Ü≥ Classification: [35m"\frac{35}{24} = 1\frac{11}{24} not 1\frac{9}{24}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q2: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q7 has 16 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_292, block_0_1_683, block_0_2_485, block_0_3_482, block_0_4_293, block_0_5_820, block_0_6_28, block_0_7_201, block_0_8_320, block_0_9_146, block_0_10_440, block_0_11_360, block_0_12_498, block_0_13_208, block_0_14_72, block_0_15_725
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=11

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q7[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 7

## QUESTION TEXT
Kasim has some small jars, some medium jars and some large jars. He has a total of 400 jars. $\frac{3}{8}$ of the 400 jars are empty. For the empty jars, number of small jars: number of medium jars = 3:4 number of medium jars: number of large jars = 1:2 Work out the percentage of Kasim's jars that are empty small jars.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 5]
- P1: for process to find the number of empty jars (eg $3 \div 8 \times 400$ oe $(= 150)$)
- P1: for start of process to deal with ratios (eg 3:4 and 4:8 or 3:4:8 oe)
- P1: for process to find the number of empty small jars (eg $\frac{3}{3+4+8} \times "150"$ oe $(= 30)$ or 30:40:80)
- P1: for process to find percentage (eg $\frac{"30"}{400} \times 100$ oe)
- A1: for 7.5 or $7\frac{1}{2}$ oe
- OR: 
- P1: for start of process to deal with ratios (eg 3:4 and 4:8 or 3:4:8 oe)
- P1: for process to find the proportion of the empty jars that are small (eg $\frac{3}{3+4+8} (= \frac{1}{5})$)
- P1: for process to find the proportion of Kasim's jars that are empty small jars (eg $\frac{3}{8} \times "\frac{1}{5}" (= \frac{3}{40})$)
- P1: for process to find percentage (eg $"\frac{3}{40}" \times 100$ oe)
- A1: for 7.5 or $7\frac{1}{2}$ oe

FINAL ANSWER: 7.5



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 400\times\frac{3}{8} = 150 empty (ID: line_1)
[Line 2] S: m: L (ID: line_2)
[Line 3] 3:4 (ID: line_3)
[Line 4] 1:2 (ID: line_4)
[Line 5] 3:4:8 \Rightarrow 19 \frac{150}{19}=10 (ID: line_5)
[Line 6] = 30:40:80 (ID: line_6)
[Line 7] \frac{30}{400}\times100\% (ID: line_7)
[Line 8] 7.5 (ID: line_8)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_292]: "7 Kasim has some small jars, some medium jars and some large jars."
[block_0_1_683]: "He has a total of 400 jars."
[block_0_2_485]: "\( \frac{3}{8} \) of the 400 jars are empty."
[block_0_3_482]: "For the empty jars,"
[block_0_4_293]: "number of small jars : number of medium jars \( =3: 4 \)"
[block_0_5_820]: "number of medium jars: number of large jars \( =1: 2 \)"
[block_0_6_28]: "Work out the percentage of Kasim's jars that are empty small jars."
[block_0_7_201]: "400 \times \frac{3}{8}=190 \text { empty }"
[block_0_8_320]: "\text { Sim: } \mathrm{L}"
[block_0_9_146]: "3: 4"
[block_0_10_440]: "1: 2"
[block_0_11_360]: "3: 4: 8 \Rightarrow 19 \quad \frac{150}{19}=10"
[block_0_12_498]: "=30: 40: 80"
[block_0_13_208]: "\quad \frac{30}{400} \times 1000 \%"
[block_0_14_72]: "75 \%"
[block_0_15_725]: "9"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q4] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ4[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6591[0m
     [36mN/A[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_2_816][0m [B1] [34m"10,13,11,14,16,17"[0m
      ‚Ü≥ Reason: Correct numbers listed for set P'.
      ‚Ü≥ OCR Match: [35m"10,13,11,14,16,17"[0m
      ‚Ü≥ Classification: [35m"10,13,11,14,16,17"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_7_457][0m [M1 A1] [34m"frac{5}{9}"[0m
      ‚Ü≥ Reason: Correct identification of 5 elements in P union Q out of 9. | Correct probability fraction.
      ‚Ü≥ OCR Match: [35m"frac{5}{9}"[0m
      ‚Ü≥ Classification: [35m"\frac{5}{9}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q4: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q8 has 13 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_949, block_0_1_969, block_0_2_67, block_0_3_739, block_0_4_368, block_0_5_636, block_0_7_534, block_0_8_970, block_0_9_891, block_0_10_629, block_0_11_294, block_0_12_980, block_0_13_493
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q8[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 8

## QUESTION TEXT
Len has 8 parcels. The mean weight of the 8 parcels is 2.5 kg. The mean weight of 3 of the parcels is 2 kg. Work out the mean weight of the other 5 parcels.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- M1: for $8 \times 2.5 (= 20)$ or $3 \times 2 (= 6)$
- M1: for a complete method (eg $("20" - "6") \div 5$)
- A1: for 2.8 or $2\frac{4}{5}$ oe mixed number

FINAL ANSWER: 2.8



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] \frac{2x3+5w}{8} = 2.5 (ID: line_1)
[Line 2] w=2.8 (ID: line_2)
[Line 3] 2.8 (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_949]: "8 Len has 8 parcels."
[block_0_1_969]: "The mean weight of the 8 parcels is 2.5 kg ."
[block_0_2_67]: "The mean weight of 3 of the parcels is 2 kg ."
[block_0_3_739]: "Work out the mean weight of the other 5 parcels."
[block_0_4_368]: "\frac{2 \times 3+5 w}{8}  =2.9"
[block_0_5_636]: "w  =2.8"
[block_0_7_534]: "2.8"
[block_0_8_970]: "9 In a sale, the normal price of a coat is reduced by \( R \% \)"
[block_0_9_891]: "Given that"
[block_0_10_629]: "\text { sale price }=0.7 \times \text { normal price }"
[block_0_11_294]: "find the value of \( R \)."
[block_0_12_980]: "R=30"
[block_0_13_493]: "10"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q5] ü•á Trusting AI Total: 4 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ5[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m7070[0m
     [36mThe student provides calculations and a written explanation.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_3_912][0m [P1 P1 A1] [34m"frac{S_{13}}{10} times 0.81 approx frac{500}{10} times frac{8}{10} = 40"[0m
      ‚Ü≥ Reason: 513 is rounded to 500, which is 1sf. | Full process to find the total amount is shown. | Correct answer following through their correct rounded value(s).
      ‚Ü≥ OCR Match: [35m"frac{S_{13}}{10} times 0.81 approx frac{500}{10} times frac{8}{10} = 40"[0m
      ‚Ü≥ Classification: [35m"\frac{513}{10} \times 0.81 \approx \frac{500}{10} \times \frac{8}{10} = 40"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_11_153][0m [C1] [34m"Underestimate, casse I rounded doun"[0m
      ‚Ü≥ Reason: Underestimate as numbers rounded down.
      ‚Ü≥ OCR Match: [35m"Underestimate, casse I rounded doun"[0m
      ‚Ü≥ Classification: [35m"Underestimate, Cause I rounded down"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q5: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[MARKING DEBUG] Q9 has 13 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_949, block_0_1_969, block_0_2_67, block_0_3_739, block_0_4_368, block_0_5_636, block_0_7_534, block_0_8_970, block_0_9_891, block_0_10_629, block_0_11_294, block_0_12_980, block_0_13_493
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=1

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q9[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 9

## QUESTION TEXT
In a sale, the normal price of a coat is reduced by R%. Given that sale price $=0.7\times$ normal price find the value of R.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 1]
- B1: 30

FINAL ANSWER: 30



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 30 (ID: line_1)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_949]: "8 Len has 8 parcels."
[block_0_1_969]: "The mean weight of the 8 parcels is 2.5 kg ."
[block_0_2_67]: "The mean weight of 3 of the parcels is 2 kg ."
[block_0_3_739]: "Work out the mean weight of the other 5 parcels."
[block_0_4_368]: "\frac{2 \times 3+5 w}{8}  =2.9"
[block_0_5_636]: "w  =2.8"
[block_0_7_534]: "2.8"
[block_0_8_970]: "9 In a sale, the normal price of a coat is reduced by \( R \% \)"
[block_0_9_891]: "Given that"
[block_0_10_629]: "\text { sale price }=0.7 \times \text { normal price }"
[block_0_11_294]: "find the value of \( R \)."
[block_0_12_980]: "R=30"
[block_0_13_493]: "10"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q3] ü•á Trusting AI Total: 5 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ3[0m - Clean response received:
  - Annotations count: [35m5[0m
  - Student score: [32m5/5[0m
  - Usage tokens: [33m7696[0m
     [36mThe student calculates the area and compares it to the amount of paint available.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_7_35][0m [P1] [34m"Area = 8x6 + 5x4"[0m
      ‚Ü≥ Reason: Correct process to find the area of one shape.
      ‚Ü≥ OCR Match: [35m"Area = 8x6 + 5x4"[0m
      ‚Ü≥ Classification: [35m"Area = 8x6 + 5x4"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_8_487][0m [P1] [34m"= 68 m¬≤"[0m
      ‚Ü≥ Reason: Correct process to find the total area.
      ‚Ü≥ OCR Match: [35m"= 68 m¬≤"[0m
      ‚Ü≥ Classification: [35m"= & 68 \mathrm{~m}^{2}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_9_722][0m [P1] [34m"Lifre = 2.9 x 3"[0m
      ‚Ü≥ Reason: Correct process to find the area covered by 3 tins.
      ‚Ü≥ OCR Match: [35m"Lifre = 2.9 x 3"[0m
      ‚Ü≥ Classification: [35m"\text { Lifre }= & 2.9 \times 3"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_11_609][0m [A1] [34m"= 75 n¬≤ of flour }"[0m
      ‚Ü≥ Reason: Yes, supported by correct figures.
      ‚Ü≥ OCR Match: [35m"= 75 n¬≤ of flour }"[0m
      ‚Ü≥ Classification: [35m"= & 75 \mathrm{n}^{2} \text { of flour }"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    5. [32mtick[0m [34m[block_0_3_895][0m [C1] [34m"No, 7.5 litre ( = 82.5 m¬≤ ond ( 87.5>68 ), so he will"[0m
      ‚Ü≥ Reason: Has no effect with correct reason.
      ‚Ü≥ OCR Match: [35m"No, 7.5 litre ( = 82.5 m¬≤ ond ( 87.5>68 ), so he will"[0m
      ‚Ü≥ Classification: [35m"No, 7.5 litre \( =82.5 \mathrm{~m}^{2} \) ond \( 87.5>68 \), so he will"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q3: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=5, ResultTotal=5
[MARKING DEBUG] Q10 has 11 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_159, block_0_1_141, block_0_2_247, block_0_3_69, block_0_4_442, block_0_5_125, block_0_6_370, block_0_7_824, block_0_8_733, block_0_9_272, block_0_10_844
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q10[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 10

## QUESTION TEXT
Solve the simultaneous equations $5x-2y=23$ $2x-3y=18$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- M1: for a correct method to eliminate either variable or rearrangement of one equation leading to substitution (condone one arithmetic error)
- A1: for either $x = 3$ or $y = -4$
- M1: (dep M1) for a correct substitution of found value into one of the equations or a correct method leading to the second value (condone one arithmetic error)
- A1: for $x = 3$ and $y = -4$

FINAL ANSWER: $x = 3, y = -4$



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 10X-4y=46 (ID: line_1)
[Line 2] 102-15y=18x9 (ID: line_2)
[Line 3] 11y=46-18x9 (ID: line_3)
[Line 4] „ÇΩ=-4 (ID: line_4)
[Line 5] x=3 (ID: line_5)
[Line 6] x = 3 (ID: line_6)
[Line 7] y = -4 (ID: line_7)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_159]: "10 Solve the simultaneous equations"
[block_0_1_141]: "5 x-2 y  =23"
[block_0_2_247]: "2 x-3 y  =18"
[block_0_3_69]: "10 x-4 y  =46"
[block_0_4_442]: "10 x-15 y  =18 \times 9"
[block_0_5_125]: "11 y  =46-18 \times 9"
[block_0_6_370]: "y  =-4"
[block_0_7_824]: "x  =3"
[block_0_8_733]: "3"
[block_0_9_272]: "x=-4"
[block_0_10_844]: "11"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q6] ü•á Trusting AI Total: 4 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ6[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6715[0m
     [36mN/A[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_2_816][0m [M1 M1 A1] [34m"y = 3 / 2 x+3"[0m
      ‚Ü≥ Reason: Correct method to find the gradient of the line. | Correct equation for the line. | Correct equation.
      ‚Ü≥ OCR Match: [35m"y = 3 / 2 x+3"[0m
      ‚Ü≥ Classification: [35m"y=\frac{3}{2}x+3"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[line_2][0m [B1] [34m"y = 5x+1"[0m
      ‚Ü≥ Reason: Correct equation of a straight line parallel to M.
      ‚Ü≥ Transcription: [35m"y = 5x+1"[0m
      ‚Ü≥ Classification: [35m"y=5x+1"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 248px to 300px for Q6
[GUILLOTINE CHECK] Q6: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[MARKING DEBUG] Q11 has 6 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_513, block_0_1_710, block_0_2_148, block_0_3_602, block_0_4_575, block_0_5_240
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q11[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 11

## QUESTION TEXT
[A coordinate grid shows triangle A with vertices at (-3, 2), (-2, 2), and (-2, 4).] Triangle A is translated by the vector $\begin{pmatrix}6\\-4\end{pmatrix}$ to give triangle B. Triangle B is rotated $90^{\circ}$ clockwise about the point (1, 2) to give triangle C. Describe fully the single transformation that maps triangle A onto triangle C.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- M1: for triangle B drawn at (4, 0), (4, 2), (3, ‚Äì2) OR for triangle C drawn at (‚Äì3, 0), (‚Äì3, ‚Äì1), (‚Äì1, ‚Äì1) OR for rotating their B $90^{\circ}$ clockwise about (1, 2)
- A2: for rotation $90^{\circ}$ clockwise centre (‚Äì4, 1)
- (A1: for any 2 of the 3 aspects)

FINAL ANSWER: Rotation, $90^{\circ}$ clockwise, centre (‚Äì4, 1)



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] Rotated 90¬∞ clockwise about the point (-4,1). (ID: line_1)
[Line 2] [DRAWING] (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_513]: "11"
[block_0_1_710]: "Triangle \( \mathbf{A} \) is translated by the vector \( \binom{6}{-4} \) to give triangle \( \mathbf{B} \)."
[block_0_2_148]: "Triangle \( \mathbf{B} \) is rotated \( 90^{\circ} \) clockwise about the point \( (1,2) \) to give triangle \( \mathbf{C} \)."
[block_0_3_602]: "Describe fully the single transformation that maps triangle \( \mathbf{A} \) onto triangle \( \mathbf{C} \)."
[block_0_4_575]: "Rotated quo clockwise about the point \( (-4,1) \)"
[block_0_5_240]: "12"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q9] ü•á Trusting AI Total: 1 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ9[0m - Clean response received:
  - Annotations count: [35m1[0m
  - Student score: [32m1/1[0m
  - Usage tokens: [33m6135[0m
     [36mThe student wrote '30' as the answer.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_12_980][0m [B1] [34m"R = 30"[0m
      ‚Ü≥ Reason: Correct answer of 30.
      ‚Ü≥ OCR Match: [35m"R = 30"[0m
      ‚Ü≥ Classification: [35m"30"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q9: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=1, ResultTotal=1
[MARKING DEBUG] Q12 has 22 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_949, block_0_1_661, block_0_2_746, block_0_3_661, block_0_4_242, block_0_5_920, block_0_6_840, block_0_7_700, block_0_8_428, block_0_9_798, block_0_10_638, block_0_11_187, block_0_12_659, block_0_13_100, block_0_14_283, block_0_15_251, block_0_16_353, block_0_17_744, block_0_18_411, block_0_19_812, block_0_20_96, block_0_21_957
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q12[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 12

## QUESTION TEXT
Here are some graphs. [Nine graphs are shown, labeled A to J (missing I). A: downward parabola, vertex on positive y-axis. B: reciprocal graph in quadrants 1 and 3. C: cubic graph with two turning points. D: positive linear graph, positive y-intercept. E: cubic graph (like y=x^3). F: cubic graph (like y=-x^3). G: negative linear graph, passing through origin. H: upward parabola, vertex on negative y-axis. J: reciprocal graph in quadrants 2 and 4.] Write down the letter of the graph that could have the equation $y=x^{2}-4$ $y=-x^{3}$ $y=-\frac{5}{x}$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[12i]
- B1: cao

[12ii]
- B1: cao

[12iii]
- B1: cao



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION I STUDENT WORK]
[Line 1] H (ID: line_1)

[SUB-QUESTION II STUDENT WORK]
[Line 2] F (ID: line_2)

[SUB-QUESTION III STUDENT WORK]
[Line 3] J (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_949]: "12 Here are some graphs."
[block_0_1_661]: "A"
[block_0_2_746]: "B"
[block_0_3_661]: "C"
[block_0_4_242]: "D"
[block_0_5_920]: "E"
[block_0_6_840]: "F"
[block_0_7_700]: "H"
[block_0_8_428]: "J"
[block_0_9_798]: "Write down the letter of the graph that could have the equation"
[block_0_10_638]: "(i) \( y=x^{2}-4 \)"
[block_0_11_187]: "|-|"
[block_0_12_659]: "H"
[block_0_13_100]: "(1)"
[block_0_14_283]: "(ii) \( y=-x^{3} \)"
[block_0_15_251]: "E"
[block_0_16_353]: "F"
[block_0_17_744]: "(1)"
[block_0_18_411]: "(iii) \( y=-\frac{5}{x} \)"
[block_0_19_812]: "J"
[block_0_20_96]: "(1)"
[block_0_21_957]: "13"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q8] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ8[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6593[0m
     [36mThe student provides a final answer of 2.8.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_4_368][0m [M1 M1] [34m"frac{2 times 3+5 w}{8} = 2.9"[0m
      ‚Ü≥ Reason: Attempts to set up an equation relating the mean weight to the parcels. | Complete method to find the mean weight of the other 5 parcels.
      ‚Ü≥ OCR Match: [35m"frac{2 times 3+5 w}{8} = 2.9"[0m
      ‚Ü≥ Classification: [35m"\frac{2x3+5w}{8} = 2.5"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_7_534][0m [A1] [34m"2.8"[0m
      ‚Ü≥ Reason: Correct final answer of 2.8.
      ‚Ü≥ OCR Match: [35m"2.8"[0m
      ‚Ü≥ Classification: [35m"2.8"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q8: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q13 has 16 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_841, block_0_1_86, block_0_2_829, block_0_3_391, block_0_4_665, block_0_5_987, block_0_6_707, block_0_7_23, block_0_9_894, block_0_10_902, block_0_11_927, block_0_12_730, block_0_13_664, block_0_14_788, block_0_15_948, block_0_16_614
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q13[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 13

## QUESTION TEXT
The table gives information about the amount of time that each of 150 people were in a shop. [A table shows Time (t minutes) and Frequency: 0<t‚â§10 (20), 10<t‚â§30 (70), 30<t‚â§35 (22), 35<t‚â§50 (30), 50<t‚â§60 (8).] On the grid, draw a histogram for this information. [A blank grid is provided.] Work out an estimate for the fraction of these 150 people who were in the shop for between 20 minutes and 40 minutes.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[13a]
- B3: for fully correct histogram with axes scaled and labelled
- (B2: for 4 correct bars OR for frequency $\div$ class width for all 5 frequencies and 2 correct bars of different widths)
- (B1: for 2 correct bars of different widths OR for frequency $\div$ class width for at least 3 frequencies)

[13b]
- M1: for a method to find number of people in interval (eg $\frac{1}{2} \times 70 + 22 + \frac{1}{3} \times 30 (= 67)$)
- A1: for $\frac{67}{150}$ or ft their histogram



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] [DRAWING] (ID: line_1)

[SUB-QUESTION A STUDENT WORK]
[Line 2] [DRAWING] (ID: line_2)

[SUB-QUESTION B STUDENT WORK]
[Line 3] \frac{35+22+10}{150} (ID: line_3)
[Line 4] \frac{67}{150} (ID: line_4)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_841]: "13 The table gives information about the amount of time that each of 150 people"
[block_0_1_86]: "were in a shop."
[block_0_2_829]: "\begin{tabular}{|c|c|} \hline Time ( \( \boldsymbol{t} \) minutes) & Frequency"
[block_0_3_391]: "\hline \( 0<t \leqslant 10 \) & 20"
[block_0_4_665]: "\hline \( 10<t \leqslant 30 \) & 70"
[block_0_5_987]: "\hline \( 30<t \leqslant 35 \) & 22"
[block_0_6_707]: "\hline \( 35<t \leqslant 50 \) & 30"
[block_0_7_23]: "\hline \( 50<t \leqslant 60 \) & 8"
[block_0_9_894]: "(a) On the grid, draw a histogram for this information."
[block_0_10_902]: "(3)"
[block_0_11_927]: "(b) Work out an estimate for the fraction of these 150 people who were in the shop for"
[block_0_12_730]: "between 20 minutes and 40 minutes."
[block_0_13_664]: "\frac{35+22+10}{150}"
[block_0_14_788]: "\( \frac{67}{150} \)"
[block_0_15_948]: "(2)"
[block_0_16_614]: "14"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q7] ü•á Trusting AI Total: 5 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ7[0m - Clean response received:
  - Annotations count: [35m5[0m
  - Student score: [32m5/5[0m
  - Usage tokens: [33m7478[0m
     [36mThe student shows calculations to find the number of empty jars, ratios, and the final percentage.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_7_201][0m [P1] [34m"400 times frac{3}{8} = 190 empty"[0m
      ‚Ü≥ Reason: Calculates 400 * 3/8 to find the number of empty jars. The answer should be 150, but the method is correct.
      ‚Ü≥ OCR Match: [35m"400 times frac{3}{8} = 190 empty"[0m
      ‚Ü≥ Classification: [35m"400	imesrac{3}{8} = 150 empty"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_9_146][0m [P1] [34m"3: 4"[0m
      ‚Ü≥ Reason: Deals with ratios, showing 3:4.
      ‚Ü≥ OCR Match: [35m"3: 4"[0m
      ‚Ü≥ Classification: [35m"S: m: L
3:4"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_10_440][0m [P1] [34m"1: 2"[0m
      ‚Ü≥ Reason: Deals with ratios, showing 1:2.
      ‚Ü≥ OCR Match: [35m"1: 2"[0m
      ‚Ü≥ Classification: [35m"1:2"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_13_208][0m [P1] [34m"frac{30}{400} times 1000 %"[0m
      ‚Ü≥ Reason: Finds percentage by dividing 30 by 400 and multiplying by 100. The student wrote 1000 instead of 100.
      ‚Ü≥ OCR Match: [35m"frac{30}{400} times 1000 %"[0m
      ‚Ü≥ Classification: [35m"\frac{30}{400}	imes100%"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    5. [32mtick[0m [34m[block_0_14_72][0m [A1] [34m"75 %"[0m
      ‚Ü≥ Reason: Incorrect final answer. Should be 7.5, not 75.
      ‚Ü≥ OCR Match: [35m"75 %"[0m
      ‚Ü≥ Classification: [35m"7.5"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q7: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=5, ResultTotal=5
[BUDGET Q10] ü•á Trusting AI Total: 4 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ10[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6662[0m
     [36mThe student provides the correct answers for x and y.[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [M1] [34m"10X-4y = 46"[0m
      ‚Ü≥ Reason: Correct method to eliminate either variable, condoning one arithmetic error.
      ‚Ü≥ Transcription: [35m"10X-4y = 46"[0m
      ‚Ü≥ Classification: [35m"10X-4y=46"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[line_4][0m [A1 M1] [34m"„ÇΩ = -4"[0m
      ‚Ü≥ Reason: Correct value for y. | Correct substitution of found value into one of the equations.
      ‚Ü≥ Transcription: [35m"„ÇΩ = -4"[0m
      ‚Ü≥ Classification: [35m"„ÇΩ=-4"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_5][0m [A1] [34m"x = 3"[0m
      ‚Ü≥ Reason: Correct values for x and y.
      ‚Ü≥ Transcription: [35m"x = 3"[0m
      ‚Ü≥ Classification: [35m"x=3"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[MARKING DEBUG] Q14 has 5 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_352, block_0_1_723, block_0_2_578, block_0_3_172, block_0_4_557
[WIDTH FIX] Boosting tiny width 186px to 300px for Q10
[WIDTH FIX] Boosting tiny width 133px to 300px for Q10
[GUILLOTINE CHECK] Q10: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q14[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 14

## QUESTION TEXT
Expand and simplify $(3x-1)(2x+3)(x-5)$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- M1: for method to find the product of any two linear expressions (3 out of 4 terms correct or 4 correct terms ignoring signs) (eg $6x^2 + 9x - 2x - 3$ or $3x^2 - 15x - x + 5$)
- M1: for a complete method to obtain all terms, half of which are correct (ft their first product) (eg $6x^3 + 7x^2 - 30x^2 - 35x - 3x + 15$)
- A1: $6x^3 - 23x^2 - 38x + 15$

FINAL ANSWER: $6x^3 - 23x^2 - 38x + 15$



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] =(6x¬≤+7x-3)(x-5) (ID: line_1)
[Line 2] =6x¬≥-30x¬≤+7x¬≤-35x-3x+15 (ID: line_2)
[Line 3] =6x¬≥-23x¬≤-38x+15 (ID: line_3)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_352]: "14 Expand and simplify \( (3 x-1)(2 x+3)(x-5) \)"
[block_0_1_723]: "=\left(6 x^{2}+7 x-3\right)(x-5)"
[block_0_2_578]: "=6 x^{3}-30 x^{2}+7 x^{2}-39 x-3 x+19"
[block_0_3_172]: "=6 x^{3}-23 x^{2}-38 x+15"
[block_0_4_557]: "15"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[MARKING DEBUG] Q15 has 10 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_160, block_0_1_573, block_0_2_154, block_0_3_345, block_0_4_418, block_0_5_773, block_0_6_622, block_0_7_335, block_0_8_54, block_0_9_630
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=4

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q15[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 15

## QUESTION TEXT
OAB is a sector of a circle with centre O and radius 6 cm. [A diagram shows a sector of a circle with center O and points A and B on the circumference. The radii OA and OB are both labeled 6 cm.] The length of the arc AB is 5 cm. Work out, in terms of $\pi$, the area of the sector. Give your answer in its simplest form.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 4]
- P2: for process to find size of the angle OR for working with proportion (eg $\frac{5\pi \times 360}{2 \times \pi \times 6}$ oe $(= 150)$ OR eg $\frac{5\pi}{12\pi} (= \frac{5}{12})$)
- (P1: for a first step eg $\frac{x}{360} \times 2 \times \pi \times 6 = 5\pi)$
- P1: (dep on P2) for process to find the area (eg $\frac{"150"}{360} \times \pi \times 6^2$ or $\frac{5\pi}{12\pi} \times \pi \times 6^2$)
- A1: $15\pi$

FINAL ANSWER: $15\pi$



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 5\pi = 6x2x\frac{\theta}{360} (ID: line_1)
[Line 2] \theta = 150^0 (ID: line_2)
[Line 3] Area= \pi x6^2 x\frac{150}{360} (ID: line_3)
[Line 4] = 15\pi (ID: line_4)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_160]: "\( 15 O A B \) is a sector of a circle with centre \( O \) and radius 6 cm ."
[block_0_1_573]: "The length of the \( \operatorname{arc} A B \) is \( 5 \pi \mathrm{~cm} \)."
[block_0_2_154]: "Work out, in terms of \( \pi \), the area of the sector."
[block_0_3_345]: "Give your answer in its simplest form."
[block_0_4_418]: "S \pi  =6 \times 2 \times \frac{\theta}{360}"
[block_0_5_773]: "\theta  =150^{\circ}"
[block_0_6_622]: "\text { Area }  =\pi \times 6^{2} \times \frac{10}{360}"
[block_0_7_335]: " =15 \pi"
[block_0_8_54]: "\( \mathrm{cm}^{2} \)"
[block_0_9_630]: "16"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q11] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ11[0m - Clean response received:
  - Annotations count: [35m1[0m
  - Student score: [32m0/3[0m
  - Usage tokens: [33m6546[0m
     [36mThe student has drawn a coordinate grid with two triangles labeled A and C. Triangle A is in the second quadrant, and triangle C is in the third quadrant.[0m
  - Annotations:
    1. [31mcross[0m [34m[line_2][0m [M0] [34m"[DRAWING]"[0m
      ‚Ü≥ Reason: [DRAWING] Triangle B or C not drawn correctly.
      ‚Ü≥ Transcription: [35m"[DRAWING]"[0m
      ‚Ü≥ Classification: [35m"[DRAWING]"[0m
      ‚Ü≥ Status: [32m"VISUAL"[0m
[GUILLOTINE CHECK] Q11: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q16 has 15 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_257, block_0_1_868, block_0_2_371, block_0_3_333, block_0_4_217, block_0_5_976, block_0_6_658, block_0_7_391, block_0_8_810, block_0_9_935, block_0_10_684, block_0_11_258, block_0_12_444, block_0_13_579, block_0_14_349
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=2

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q16[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 16

## QUESTION TEXT
There are only n orange sweets and 1 white sweet in a bag. Saira takes at random a sweet from the bag and eats the sweet. She then takes at random another sweet from the bag and eats this sweet. Show that the probability that Saira eats two orange sweets is $\frac{n-1}{n+1}$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 2]
- M1: for $\frac{n}{n+1}$ or $\frac{n-1}{n}$
- A1: (dep) for $\frac{n}{n+1} \times \frac{n-1}{n}$ oe $= \frac{n-1}{n+1}$

FINAL ANSWER: Shown



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] \frac{n}{n+1} \times \frac{n-1}{n} = \frac{n-1}{n+1} (ID: line_1)
[Line 2] P ot taking 1 oronge = \frac{n}{n+1} (ID: line_2)
[Line 3] P ot toking orange again = \frac{n-1}{n} (ID: line_3)
[Line 4] \Rightarrow \frac{n}{n+1} \times \frac{n-1}{n} = \frac{n-1}{n+1} (ID: line_4)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_257]: "16 There are only \( n \) orange sweets and 1 white sweet in a bag."
[block_0_1_868]: "Saira takes at random a sweet from the bag and eats the sweet."
[block_0_2_371]: "She then takes at random another sweet from the bag and eats this sweet."
[block_0_3_333]: "Show that the probability that Saira eats two orange sweets is \( \frac{n-1}{n+1} \)"
[block_0_4_217]: "\frac{n}{n+1} \times \frac{n-1}{n}=\frac{n-1}{n+1}"
[block_0_5_976]: "\( P \) of taking I oronge \( =\frac{\eta}{n+1} \)"
[block_0_6_658]: "\( P \) of taking oronge again \( =\frac{n-1}{n} \)"
[block_0_7_391]: "\Rightarrow \frac{n}{n+1} \times \frac{n-1}{n}=\frac{n-1}{n+1}"
[block_0_8_810]: "17 (a) Rationalise the denominator of \( \frac{1}{\sqrt{7}} \)"
[block_0_9_935]: "\frac{\sqrt{7}}{7}"
[block_0_10_684]: "(1)"
[block_0_11_258]: "(b) Simplify fully \( \sqrt{80}-\sqrt{5} \)"
[block_0_12_444]: "3 \sqrt{5}"
[block_0_13_579]: "(2)"
[block_0_14_349]: "17"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q12] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ12[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6616[0m
  - Annotations:
    1. [32mtick[0m [34m[line_1][0m [B1] [34m"H"[0m
      ‚Ü≥ Reason: Correct answer.
      ‚Ü≥ Transcription: [35m"H"[0m
      ‚Ü≥ Classification: [35m"H"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[line_2][0m [B1] [34m"F"[0m
      ‚Ü≥ Reason: Correct answer.
      ‚Ü≥ Transcription: [35m"F"[0m
      ‚Ü≥ Classification: [35m"F"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    3. [32mtick[0m [34m[line_3][0m [B1] [34m"J"[0m
      ‚Ü≥ Reason: Correct answer.
      ‚Ü≥ Transcription: [35m"J"[0m
      ‚Ü≥ Classification: [35m"J"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 68px to 300px for Q12
[WIDTH FIX] Boosting tiny width 51px to 300px for Q12
[WIDTH FIX] Boosting tiny width 51px to 300px for Q12
[GUILLOTINE CHECK] Q12: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q17 has 15 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_257, block_0_1_868, block_0_2_371, block_0_3_333, block_0_4_217, block_0_5_976, block_0_6_658, block_0_7_391, block_0_8_810, block_0_9_935, block_0_10_684, block_0_11_258, block_0_12_444, block_0_13_579, block_0_14_349
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q17[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 17

## QUESTION TEXT
Rationalise the denominator of $\frac{1}{\sqrt{7}}$ Simplify fully $\sqrt{80}-\sqrt{5}$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[17a]
- B1: for $\frac{\sqrt{7}}{7}$ or $\frac{k\sqrt{7}}{7k}$ or $\frac{\sqrt{7k^2}}{7k}$ where k is an integer not equal to 0

[17b]
- M1: for writing $\sqrt{80}$ as $\sqrt{16 \times 5}$ or $\sqrt{16} \times \sqrt{5}$ or $4\sqrt{5}$
- A1: for $3\sqrt{5}$ or $\sqrt{45}$



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] \frac{\sqrt{7}}{7} (ID: line_1)

[SUB-QUESTION B STUDENT WORK]
[Line 2] 3\sqrt{5} (ID: line_2)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_257]: "16 There are only \( n \) orange sweets and 1 white sweet in a bag."
[block_0_1_868]: "Saira takes at random a sweet from the bag and eats the sweet."
[block_0_2_371]: "She then takes at random another sweet from the bag and eats this sweet."
[block_0_3_333]: "Show that the probability that Saira eats two orange sweets is \( \frac{n-1}{n+1} \)"
[block_0_4_217]: "\frac{n}{n+1} \times \frac{n-1}{n}=\frac{n-1}{n+1}"
[block_0_5_976]: "\( P \) of taking I oronge \( =\frac{\eta}{n+1} \)"
[block_0_6_658]: "\( P \) of taking oronge again \( =\frac{n-1}{n} \)"
[block_0_7_391]: "\Rightarrow \frac{n}{n+1} \times \frac{n-1}{n}=\frac{n-1}{n+1}"
[block_0_8_810]: "17 (a) Rationalise the denominator of \( \frac{1}{\sqrt{7}} \)"
[block_0_9_935]: "\frac{\sqrt{7}}{7}"
[block_0_10_684]: "(1)"
[block_0_11_258]: "(b) Simplify fully \( \sqrt{80}-\sqrt{5} \)"
[block_0_12_444]: "3 \sqrt{5}"
[block_0_13_579]: "(2)"
[block_0_14_349]: "17"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q13] ü•á Trusting AI Total: 5 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ13[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m2/5[0m
  - Usage tokens: [33m7146[0m
     [36mHistogram drawn on the grid.[0m
  - Annotations:
    1. [31mcross[0m [34m[line_2][0m [B0] [34m"[DRAWING]"[0m
      ‚Ü≥ Reason: [DRAWING] Histogram is not fully correct, axes are not scaled and labelled. | [DRAWING] Less than 4 bars are correct. | [DRAWING] Less than 2 bars are correct.
      ‚Ü≥ Transcription: [35m"[DRAWING]"[0m
      ‚Ü≥ Classification: [35m"[DRAWING]"[0m
      ‚Ü≥ Status: [32m"VISUAL"[0m
    2. [32mtick[0m [34m[block_0_13_664][0m [M1] [34m"frac{35+22+10}{150}"[0m
      ‚Ü≥ Reason: Correct method to find number of people in interval.
      ‚Ü≥ OCR Match: [35m"frac{35+22+10}{150}"[0m
      ‚Ü≥ Classification: [35m"\frac{35+22+10}{150}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_14_788][0m [A1] [34m"( frac{67}{150} )"[0m
      ‚Ü≥ Reason: Correct fraction.
      ‚Ü≥ OCR Match: [35m"( frac{67}{150} )"[0m
      ‚Ü≥ Classification: [35m"\( \frac{67}{150} \)"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q13: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=5, ResultTotal=5
[MARKING DEBUG] Q18 has 8 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_148, block_0_1_635, block_0_2_551, block_0_3_257, block_0_4_714, block_0_5_239, block_0_6_271, block_0_7_356
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=7

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q18[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 18

## QUESTION TEXT
Show that $0.\dot{1}\dot{5}+0.2\dot{2}\dot{7}$ can be written in the form $\frac{m}{66}$ where m is an integer.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- M1: for $0.1515... + 0.22727... (= 0.37878...$ or $0.3\dot{7}\dot{8})$
- M1: for finding two correct recurring decimals that when subtracted would result in a terminating decimal or integer (eg $(1000x - 10x =)$ $378.7878... - 3.7878... (= 375)$ or $\frac{375}{990}$)
- C1: for correct working leading to $\frac{25}{66}$
- OR: 
- M1: for start of a method to convert $0.1515...$ or $0.22727...$ to a fraction (eg $100x = 15.1515...$ or $\frac{15}{99}$ or $\frac{5}{33}$ oe or $10y = 2.2727...$ or $100y = 22.7272...$)
- M1: for a method to convert $0.1515...$ and $0.22727...$ to fractions (eg $\frac{15}{99}$ or $\frac{5}{33}$ oe AND eg $\frac{225}{990}$ or $\frac{22.5}{99}$ or $\frac{5}{22}$ oe)
- C1: for correct working leading to $\frac{25}{66}$

FINAL ANSWER: Shown



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 0.1\dot{5}+0.\dot{2}2\dot{7} (ID: line_1)
[Line 2] = 0.37\cancel{1}\cancel{2}8 (ID: line_2)
[Line 3] x= 0.378 (ID: line_3)
[Line 4] 100x-x = 037.878 -0.378 (ID: line_4)
[Line 5] 99x = 37.5 (ID: line_5)
[Line 6] x= \frac{25}{66} (ID: line_6)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_148]: "18 Show that \( 0 . \dot{1} \dot{5}+0.2 \dot{2} \dot{7} \) can be written in the form \( \frac{m}{66} \) where \( m \) is an integer."
[block_0_1_635]: "0.13+0.277"
[block_0_2_551]: "=0.3728"
[block_0_3_257]: "x=0.378"
[block_0_4_714]: "1000 x-x=0.37 .878-0.378"
[block_0_5_239]: "99 x=37.9"
[block_0_6_271]: "x=\frac{23}{66}"
[block_0_7_356]: "18"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m


üîç [RAW AI JSON] Q16:
{
  "meta": {
    "question_total_marks": 2,
    "raw_correct_steps_found": 2,
    "steps_dropped_to_fit_budget": 0,
    "isTotalEstimated": false
  },
  "visualObservation": "Student provides probabilities and shows the calculation to arrive at the final answer.",
  "annotations": [
    {
      "line_id": "block_0_5_976",
      "action": "tick",
      "text": "M1",
      "student_text": "P of taking I oronge = \\frac{\\eta}{n+1}",
      "classification_text": "P ot taking 1 oronge = \\frac{n}{n...

[BUDGET Q16] ü•á Trusting AI Total: 2 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ16[0m - Clean response received:
  - Annotations count: [35m2[0m
  - Student score: [32m2/2[0m
  - Usage tokens: [33m6693[0m
     [36mStudent provides probabilities and shows the calculation to arrive at the final answer.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_5_976][0m [M1] [34m"P of taking I oronge = rac{eta}{n+1}"[0m
      ‚Ü≥ Reason: Correct probability of taking one orange sweet, using OCR typo allowance (eta -> n).
      ‚Ü≥ OCR Match: [35m"P of taking I oronge = rac{eta}{n+1}"[0m
      ‚Ü≥ Classification: [35m"P ot taking 1 oronge = \rac{n}{n+1}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_6_658][0m [A1] [34m"( P ) of taking oronge again ( = rac{n-1}{n} )"[0m
      ‚Ü≥ Reason: Correct probability of taking another orange sweet and shows the final answer.
      ‚Ü≥ OCR Match: [35m"( P ) of taking oronge again ( = rac{n-1}{n} )"[0m
      ‚Ü≥ Classification: [35m"P ot toking orange again = \rac{n-1}{n}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q16: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=2, ResultTotal=2
[MARKING DEBUG] Q19 has 10 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_768, block_0_1_592, block_0_2_141, block_0_3_84, block_0_4_145, block_0_5_461, block_0_6_524, block_0_7_835, block_0_8_713, block_0_9_285
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q19[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 19

## QUESTION TEXT
[A diagram shows a triangle ABD, with a point C on the line segment BD. A line segment AC is drawn.] ABC and DAB are similar isosceles triangles. $AB=AC$ $AD=BD$ $BC:CD=4:21$ Find the ratio $AB:AD$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- P1: for using similar triangles to form an equation (eg $\frac{AB}{BC} = \frac{AD}{AB}$ oe or $\frac{AB}{4} = \frac{25}{AB}$ oe)
- P1: for process to find AB (eg $(AB = ) \sqrt{4 \times 25} (= 10)$ oe)
- A1: oe

FINAL ANSWER: 2:5



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] \frac{AB}{4} = \frac{21+4}{AB} (ID: line_1)
[Line 2] AB = 10 (ID: line_2)
[Line 3] AB:Ab = 10:25 (ID: line_3)
[Line 4] 2:5 (ID: line_4)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_768]: "19"
[block_0_1_592]: "\( A B C \) and \( D A B \) are similar isosceles triangles."
[block_0_2_141]: "A B=A C"
[block_0_3_84]: "A D=B D"
[block_0_4_145]: "\( B C: C D=4: 21 \)"
[block_0_5_461]: "Find the ratio \( A B: A D \)"
[block_0_6_524]: "\frac{A B}{4}=\frac{21+4}{A B}"
[block_0_7_835]: "A B=10"
[block_0_8_713]: "A B: A B=10: 2 A \cdot 5"
[block_0_9_285]: "19"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q14] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ14[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6552[0m
     [36mStudent expanded and simplified the expression.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_1_723][0m [M1] [34m"= (6x¬≤+7x-3)(x-5)"[0m
      ‚Ü≥ Reason: Correct product of first two linear expressions.
      ‚Ü≥ OCR Match: [35m"= (6x¬≤+7x-3)(x-5)"[0m
      ‚Ü≥ Classification: [35m"=(6x¬≤+7x-3)(x-5)"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_2_578][0m [M1] [34m"= 6 x^{3}-30 x^{2}+7 x^{2}-39 x-3 x+19"[0m
      ‚Ü≥ Reason: Complete method to obtain all terms, half of which are correct.
      ‚Ü≥ OCR Match: [35m"= 6 x^{3}-30 x^{2}+7 x^{2}-39 x-3 x+19"[0m
      ‚Ü≥ Classification: [35m"=6 x^{3}-30 x^{2}+7 x^{2}-39 x-3 x+19"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_3_172][0m [A1] [34m"= 6 x^{3}-23 x^{2}-38 x+15"[0m
      ‚Ü≥ Reason: Correct final answer.
      ‚Ü≥ OCR Match: [35m"= 6 x^{3}-23 x^{2}-38 x+15"[0m
      ‚Ü≥ Classification: [35m"=6 x^{3}-23 x^{2}-38 x+15"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q14: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q20 has 9 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_894, block_0_1_873, block_0_2_821, block_0_3_724, block_0_4_352, block_0_5_418, block_0_6_368, block_0_7_417, block_0_8_57
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=3

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q20[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 20

## QUESTION TEXT
$2^{x}=\frac{2^{n}}{\sqrt[3]{2}}$ $2^{y}=(\sqrt{2})^{5}$ Given that $x+y=8$ work out the value of n.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 3]
- P1: for $2^x = 2^{n-\frac{1}{3}}$ or $2^y = 2^{\frac{5}{2}}$ or $x = n - \frac{1}{3}$ oe or $y = \frac{5}{2}$ oe
- P1: for $2^{x+y} = 2^{n-\frac{1}{3} + \frac{5}{2}}$ or $x+y = n - \frac{1}{3} + \frac{5}{2}$ oe or $\frac{11}{2} = n - \frac{1}{3}$ oe
- A1: oe eg $\frac{35}{6}$

FINAL ANSWER: $5\frac{5}{6}$



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 2^x = 2^n \times 2^{(\frac{1}{3})} (ID: line_1)
[Line 2] x = n-\frac{1}{3} (ID: line_2)
[Line 3] y = \frac{5}{2} (ID: line_3)
[Line 4] n = \frac{35}{6} (ID: line_4)
[Line 5] \frac{35}{6} (ID: line_5)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_894]: "\( 20 \quad 2^{x}=\frac{2^{n}}{\sqrt[3]{2}} \quad 2^{y}=(\sqrt{2})^{5} \)"
[block_0_1_873]: "Given that \( x+y=8 \)"
[block_0_2_821]: "work out the value of \( n \)."
[block_0_3_724]: "2^{x}=2^{n} \times 2^{(1 / 3)}"
[block_0_4_352]: "x=n-1 / 3"
[block_0_5_418]: "y=3 / 2"
[block_0_6_368]: "n=35 / 6"
[block_0_7_417]: "n=39 / 6"
[block_0_8_57]: "20"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q15] ü•á Trusting AI Total: 4 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ15[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6902[0m
     [36mThe student provides calculations to find the area of the sector.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_4_418][0m [P1] [34m"5pi = 6x2xfrac{theta}{360}"[0m
      ‚Ü≥ Reason: Correct first step to find the angle.
      ‚Ü≥ OCR Match: [35m"5pi = 6x2xfrac{theta}{360}"[0m
      ‚Ü≥ Classification: [35m"5\pi = 6x2x\frac{\theta}{360}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_5_773][0m [P2] [34m"theta = 150^{circ}"[0m
      ‚Ü≥ Reason: Correct process to find the size of the angle.
      ‚Ü≥ OCR Match: [35m"theta = 150^{circ}"[0m
      ‚Ü≥ Classification: [35m"\theta  =150^{\circ}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_7_335][0m [A1] [34m"= 15pi"[0m
      ‚Ü≥ Reason: Correct final answer.
      ‚Ü≥ OCR Match: [35m"= 15pi"[0m
      ‚Ü≥ Classification: [35m" =15 \pi"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q15: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[MARKING DEBUG] Q21 has 25 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_3_531, block_0_4_947, block_0_1_960, block_0_5_578, block_0_0_211, block_0_6_152, block_0_7_545, block_0_8_543, block_0_9_76, block_0_12_560, block_0_10_594, block_0_13_855, block_0_11_204, block_0_14_739, block_0_2_929, block_0_15_87, block_0_16_859, block_0_17_705, block_0_18_80, block_0_19_606, block_0_20_169, block_0_21_899, block_0_22_977, block_0_23_795, block_0_24_650
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=5

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q21[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 21

## QUESTION TEXT
A solid cuboid has a volume of $300~cm^{3}$. The cuboid has a total surface area of $370~cm^{2}$. The length of the cuboid is 20 cm. The width of the cuboid is greater than the height of the cuboid. Work out the height of the cuboid. You must show all your working.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 5]
- P1: for forming an equation using the volume (eg $20wh = 300$ or $wh = 15$ oe)
- P1: for forming an equation using the surface area (eg $20w + 20w + 20h + 20h + hw + hw = 370$ oe or $20w + 20w + 20h + 20h + 30 = 370$ oe)
- P1: for eliminating one variable (eg $40h + \frac{600}{h} + 30 = 370$ or $40h^2 - 340h + 600 (= 0)$ or $2h^2 - 17h + 30 (= 0)$)
- P1: for process to solve quadratic equation (eg $(2h - 5)(h - 6) (= 0)$ or $\frac{17 \pm \sqrt{(-17)^2 - 4 \times 2 \times 30}}{2 \times 2}$)
- A1: for 2.5 oe

FINAL ANSWER: 2.5



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] 300 = 20xY (ID: line_1)
[Line 2] 30 = 2004 (ID: line_2)
[Line 3] 15 = xY (ID: line_3)
[Line 4] \\frac{15}{4} = x (ID: line_4)
[Line 5] 370 = 2xy + 2(20x) + 2(20y) (ID: line_5)
[Line 6] 370 = 2x4 + 40x + 40y (ID: line_6)
[Line 7] 370 = 30 + 40x + 40y (ID: line_7)
[Line 8] 37 = 3 + 4x + 4y (ID: line_8)
[Line 9] 37 = 3 + 4(\\frac{15}{y}) + 4y (ID: line_9)
[Line 10] 37y = 3y + 60 + 4y^2 (ID: line_10)
[Line 11] 0 = 4y^2 - 34y + 60 (ID: line_11)
[Line 12] 0 = 2y^2 - 17y + 30 (ID: line_12)
[Line 13] 0 = (2y - 5)(y - 6) (ID: line_13)
[Line 14] y = \\frac{5}{2}  y = 6 (ID: line_14)
[Line 15] \\frac{5}{2} = 2.5 (ID: line_15)
[Line 16] \\frac{5}{2} 2.5 (ID: line_16)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_3_531]: "21 A solid cuboid has a volume of \( 300 \mathrm{~cm}^{3} \)"
[block_0_4_947]: "The cuboid has a total surface area of \( 370 \mathrm{~cm}^{2} \)"
[block_0_1_960]: "DO NOTWEITEINTHIS AREA"
[block_0_5_578]: "The length of the cuboid is 20 cm ."
[block_0_0_211]: "The width of the cuboid is greater than the height of the cuboid."
[block_0_6_152]: "Work out the height of the cuboid."
[block_0_7_545]: "You must show all your working."
[block_0_8_543]: "300=20 x y"
[block_0_9_76]: "30=2 x y"
[block_0_12_560]: "0 x y & 370=2 x y+2(20 x)+2(20 y)"
[block_0_10_594]: "15=x y"
[block_0_13_855]: "370  =2 x y+40 x+40 y"
[block_0_11_204]: "\frac{15}{y}=x"
[block_0_14_739]: "370=30+40 x+40 y"
[block_0_2_929]: "10\% NOTWUITINTTISAREA"
[block_0_15_87]: "37=3+4 x+4 y"
[block_0_16_859]: "37=3+4\left(\frac{15}{y}\right)+4 y"
[block_0_17_705]: "37 y=3 y+60+4 y^{2}"
[block_0_18_80]: "0=4 y^{2}-34 y+60"
[block_0_19_606]: "0=2 y^{2}-11 y+30"
[block_0_20_169]: "0=(2 y-5)(y-6)"
[block_0_21_899]: "y_{i}=5 / 2 \quad y=6"
[block_0_22_977]: "y=2.5"
[block_0_23_795]: "\frac{5}{2}=2.5"
[block_0_24_650]: "21"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q17] ü•á Trusting AI Total: 2 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ17[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m2/2[0m
  - Usage tokens: [33m6815[0m
     [36mN/A[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_9_935][0m [B1] [34m"frac{sqrt{7}}{7}"[0m
      ‚Ü≥ Reason: Correct rationalization of the denominator.
      ‚Ü≥ OCR Match: [35m"frac{sqrt{7}}{7}"[0m
      ‚Ü≥ Classification: [35m"\frac{\sqrt{7}}{7}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [31mcross[0m [34m[block_0_9_935][0m [B0] [34m"frac{sqrt{7}}{7}"[0m
      ‚Ü≥ Reason: Already awarded B1.
      ‚Ü≥ OCR Match: [35m"frac{sqrt{7}}{7}"[0m
      ‚Ü≥ Classification: [35m"\frac{\sqrt{7}}{7}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_12_444][0m [A1] [34m"3 sqrt{5}"[0m
      ‚Ü≥ Reason: Correct simplification to 3sqrt(5).
      ‚Ü≥ OCR Match: [35m"3 sqrt{5}"[0m
      ‚Ü≥ Classification: [35m"3 \sqrt{5}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [31mcross[0m [34m[block_0_12_444][0m [M0] [34m"3 sqrt{5}"[0m
      ‚Ü≥ Reason: Already awarded A1.
      ‚Ü≥ OCR Match: [35m"3 sqrt{5}"[0m
      ‚Ü≥ Classification: [35m"3 \sqrt{5}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q17: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q22 has 9 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_718, block_0_1_85, block_0_2_225, block_0_3_814, block_0_4_80, block_0_5_192, block_0_6_67, block_0_7_484, block_0_8_910
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=0

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q22[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 22

## QUESTION TEXT
Sketch the graph of $y=\sin~x^{\circ}$ for $0\le x\le360$ [A blank set of axes is shown with x-axis labeled 90, 180, 270, 360.] Solve the equation $2~\sin~x^{\circ}=-1$ for $0\le x\le360$


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[22a]
- M1: for correct shape for $0 \le x \le 360$
- A1: for fully correct sketch with labels at 1 and -1

[22b]
- M1: for one correct solution
- A1: cao



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[SUB-QUESTION A STUDENT WORK]
[Line 1] -1 (ID: line_1)
[Line 2] 330 (ID: line_2)
[Line 3] [DRAWING] (ID: line_3)

[SUB-QUESTION B STUDENT WORK]
[Line 4] 2sinx=-1 (ID: line_4)
[Line 5] sinx=-\frac{1}{2} (ID: line_5)
[Line 6] x_{1}=330 (ID: line_6)
[Line 7] x_{2}=210 (ID: line_7)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_718]: "22 (a) Sketch the graph of \( y=\sin x^{\circ} \) for \( 0 \leqslant x \leqslant 360 \)"
[block_0_1_85]: "(2)"
[block_0_2_225]: "(b) Solve the equation \( 2 \sin x^{\circ}=-1 \) for \( 0 \leqslant x \leqslant 360 \)"
[block_0_3_814]: "2 \sin x=-1"
[block_0_4_80]: "\sin x=-\frac{1}{2}"
[block_0_5_192]: "x_{1}=330"
[block_0_6_67]: "x_{2}=210"
[block_0_7_484]: "(2)"
[block_0_8_910]: "22"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q18] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ18[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6880[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_2_551][0m [M1] [34m"= 0.3728"[0m
      ‚Ü≥ Reason: Sum of recurring decimals is calculated.
      ‚Ü≥ OCR Match: [35m"= 0.3728"[0m
      ‚Ü≥ Classification: [35m"0.  227"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_4_714][0m [M1] [34m"1000 x-x = 0.37 .878-0.378"[0m
      ‚Ü≥ Reason: Two correct recurring decimals subtracted.
      ‚Ü≥ OCR Match: [35m"1000 x-x = 0.37 .878-0.378"[0m
      ‚Ü≥ Classification: [35m"100x-x = 037.878 -0.378"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_6_271][0m [C1] [34m"x = frac{23}{66}"[0m
      ‚Ü≥ Reason: Correct working leads to the answer, but there is a calculation error.
      ‚Ü≥ OCR Match: [35m"x = frac{23}{66}"[0m
      ‚Ü≥ Classification: [35m"x= \frac{25}{66}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q18: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[MARKING DEBUG] Q23 has 21 OCR Blocks available.
[MARKING DEBUG] Block IDs: block_0_0_88, block_0_1_685, block_0_2_871, block_0_3_903, block_0_4_741, block_0_5_914, block_0_6_717, block_0_7_791, block_0_13_908, block_0_8_337, block_0_9_48, block_0_14_305, block_0_10_399, block_0_15_368, block_0_11_192, block_0_16_375, block_0_12_59, block_0_17_480, block_0_18_882, block_0_20_623, block_0_21_454
[DEBUG] formatMarkingSchemeForPrompt: isGeneric=false, Marks count=5

[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[34m[AI MARKING] Q23[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m
[1m[36m## SYSTEM PROMPT[0m
You are an AI assistant that marks student work. Your task is to generate a single, valid JSON object following all rules below. Your entire response MUST start with { and end with }, with no other text.

---

## 1. GOLDEN RULES (SAFETY Protocols)

1.  **TRUTH SOURCE:** Grade based **ONLY** on **STUDENT WORK**.
2.  **LINKING SOURCE:** Use **RAW OCR BLOCKS** to find the `line_id`.
3.  **"UNMATCHED" IS THE SAFEST STATE:** If you cannot find a High-Confidence match, you **MUST** return `ocr_match_status`: **"UNMATCHED"** and keep the placeholder ID.
    * *System will fallback to Classification Line Index*.
    * *CRITICAL FAILURE to be WRONG (System breaks if mapped to Page/Question Numbers)*.

---

## 2. JSON LOGIC CONSTRAINTS (CRITICAL VALIDATION)

* **JSON FORMAT:** You MUST return a single valid JSON object.
    * **NO RAW NEWLINES:** String values MUST NOT contain raw newline characters. Use `\n` for line breaks.
    * **LATEX ESCAPING:** All LaTeX backslashes MUST be double-escaped (e.g., `\\frac`, `\\times`).
* **CONSTRAINT A (The "ID Whitelist"):**
    * You **MUST NOT** generate a `line_id` that is not explicitly listed in the **RAW OCR BLOCKS** section.
    * *Verification:* If you choose `block_2_0`, check the text above. Does `[block_2_0]` exist? If no, change to **"UNMATCHED"**.

* **CONSTRAINT B (No Fake Matches):**
    * **IF** `ocr_match_status` is **"MATCHED"**, **THEN** `line_id` **MUST** start with **"block_"**.
    * *Violation:* `{"line_id": "line_2", "ocr_match_status": "MATCHED"}`.
    * *Fix:* Change status to **"UNMATCHED"**.

* **CONSTRAINT C (No Phantom Blocks):**
    * **IF** the only available blocks fail the Sanity Check (below), **THEN** you **MUST** set `ocr_match_status` to **"UNMATCHED"**.

* **CONSTRAINT D (Sub-Question Isolation):**
    * **NEVER** map an annotation for sub-question **"a"** to a `block_ID` that is listed under **[SUB-QUESTION B STUDENT WORK]**.
    * Keep marks within their respective structured work sections.

* **CONSTRAINT E (The "Nuclear" Matcher):**
    * **Objective:** Link [Student Line] to [OCR Block] if the **NUMBERS** match.
    * **IGNORE FORMATTING:** * `\frac{5}{\sqrt{3}}` == `5/sqrt(3)` == `5 / 3` (Partial).
        * `\sqrt{27}` == `sqrt(27)` == `27`.
    * **THE SUBSTRING RULE (MANDATORY):** * If the student line is `2sqrt(5)` and you see a block `Smallest \frac{2\sqrt{5}}{3}...`:
        * **DOES THE BLOCK CONTAIN '2sqrt(5)'?** -> **YES**.
        * **ACTION:** **MATCH IT**.
    * **NEVER** use "UNMATCHED" if the core numbers (e.g. 5, 3, 27) appear in the block.

* **CONSTRAINT F (Block Re-Use Strategy - CRITICAL):**
    * **Reality:** OCR often groups multiple lines of math into ONE single block.
    * **Rule:** You are EXPLICITLY ALLOWED to map multiple `line_id`s to the **SAME** `block_id`.
    * **Example:** If `block_A` contains both "Smallest" and the "Middle" answer, use `block_A` for BOTH annotations. Do not switch to "UNMATCHED" just because you used the ID once.

* **CONSTRAINT G (The "Real Data" Mandate):**
    * **PRIORITY:** You MUST prefer a **RAW OCR BLOCK ID** (`block_x_y`) over a placeholder (`line_x`) whenever possible.
    * **VIOLATION:** If you return `line_1` when a valid `block_` exists, you have FAILED.
    * **Reason:** We need to place ticks on the image. `line_1` has no coordinates. `block_...` does.

* **CONSTRAINT H (Strict Descriptor Matching):**
   * **DO NOT INFLATE MARKS:** You must match the *specific text* of the marking scheme.
   * **Example:** If the scheme says "M2 for correct equation", do **NOT** award M2 for just "defining variables" (e.g. `Let x = ...`).
   * **Validation:** Before awarding an `Mx` mark, ask: "Does this specific line of work *fully satisfy* the complexity described in the scheme?" If it is just a setup step, award `M0` or look for a lower value mark.


---

## 3. ID MAPPING HIERARCHY (STRICT)

You must determine the correct `line_id` for every annotation.

### üö´ FILTERING STRATEGY (Read Carefully)
Some blocks contain **mixed content** (Printed Text + Student Handwriting).
1.  **PURE NOISE (IGNORE):** If a block contains **ONLY** printed landmarks (e.g. "Total 3 marks", "Answer", "Page 2"), **DO NOT** use it.
2.  **MIXED CONTENT (PERMITTED):** If a block contains a landmark **BUT ALSO** contains valid student math (e.g. "Largest 2\sqrt{7}"), you **MUST** use it.
    * *Reason:* Mathpix often groups the printed label and the student answer into one block.
    * *Action:* Link to the `line_id`. In `student_text`, extract only the handwritten part if possible.

### ü•á PRIORITY 1: SMART MATCHING
**Goal:** Find a block that represents the **SAME VALUE**, even if the text format looks different.

**RULE A: The "Base Number" Override (CRITICAL)**
* Look at the **Coefficient / Main Number** only.
* **IF** the main number matches, you **MUST MATCH IT**, ignoring all exponents, powers, or units.
    * *Match:* Student `3.42` vs Block `3.42 	imes 10 ^ {- 6}` (Base `3.42` is identical).
    * *Match:* Student `5x` vs Block `5x ^ 2` (Base `5x` is identical).

**RULE B: The "OCR Typo" Allowance**
* Treat these characters as **IDENTICAL**:
    * `1` == `7` == ` / ` == ` | `
    * `5` == `S`
    * `0` == `O`
* *Match:* Student `0.000074` vs Block `0.000014` (Treat `7` as `1`).

**‚õî SANITY CHECK (The "Different Value" Rule)**
Before confirming any match above, ask: **"Are these effectively different numbers?"**
* **Student:** `0.4` vs **Block:** `0.33` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **Student:** `53000` vs **Block:** `3` -> **DIFFERENT VALUES** -> **REJECT (UNMATCHED)**.
* **EXCEPTION:** If **Rule A (Base Number)** is met, it is **NEVER** a contradiction. **Accept the match.**

### ü•à PRIORITY 2: FALLBACK (DEFAULT)
* If the block fails the Sanity Check (e.g., `0.4` vs `0.33`), use **UNMATCHED**.
* Keep the placeholder ID (e.g., `line_1`).

### ü•â PRIORITY 3: VISUAL (Drawing/Graph)
*   If a line starts with **[DRAWING]**, ALWAYS use the local `line_id` and set `ocr_match_status` to **"VISUAL"**.

---

## 4. MARKING LOGIC & FALLBACK

* Mark based strictly on the Marking Scheme applied to the **STUDENT WORK** text.
* **Smart Fallback:** Use OCR text **ONLY IF** Classification is missing/garbled **AND** the OCR detail (e.g., sign, keyword) is required by the marking scheme. Otherwise, stick to Classification.
* **Multi-Mark Rule:** All annotations for a single line of student work earned on a single line of work **MUST** share the same `line_id`.

---

## 5. VISUAL & INDEX PROTOCOL (CRITICAL FOR DRAWINGS)

* **Visual Analysis (MANDATORY):**
    1. **Populate `visualObservation`:** Provide a **concise, factual description** of the student's drawing or visual work (e.g. *"A rectangle 6cm wide by 4cm high."*).
    2. **STRICT PROHIBITION:** Do **NOT** include meta-commentary about page numbers, file locations, or your reasoning in this string. (e.g. DO NOT write *"Therefore, pageIndex = 4"*).
    3. **Internal Indexing:** Use your visual analysis to determine the correct `pageIndex` internally, but do not write this logic in the output string.
* **CRITICAL pageIndex:** The `pageIndex` field **MUST** match the **absolute page number** (0, 1, 2...) provided in the **(Page X)** labels in RAW OCR BLOCKS or STUDENT WORK.
* **Consistency:** If a block is labeled "(Page 6)", its `pageIndex` MUST be 6.
* **PAGE ASSIGNMENT CONSTRAINTS (HIGHEST PRIORITY):** You MUST respect the **PAGE ASSIGNMENT CONSTRAINTS** provided in the user prompt. For each sub-question or root question, only search for and assign annotations to the page specifically listed in that section. Do NOT search for work on other pages, even if you see a question header there.
* **Sub-Question Alignment:** For questions with sub-parts (e.g. 6a, 6b), the marking scheme uses headers like `[6a]` and `[6b]`. You **MUST** assign `pageIndex` based on which page the specific sub-question content appears. Do not group all annotations on the same page if they span multiple original pages.

---

## 6. ANNOTATION RULES

1. **Coverage:** Create an annotation for **EVERY** markable step in the structured student work. **DO NOT** mark question text or printed units/labels (enforced in Section 1).
2. **Action/Code:** Set **"action"** ("tick" or "cross") and the mark code **"text"** (e.g., "M1", "A0").
3. **One Mark Per Annotation (ABSOLUTE MANDATE):** You MUST generate a separate, distinct annotation object for **EACH** individual mark code in the scheme. **NEVER** consolidate multiple marks into one annotation (e.g., NEVER return "M1 A1" or "M1, A1"). Each object must have exactly one code in the "text" field.
4. **MARKING PRIORITY (CRITICAL):**
   * **ACCURACY IS KING:** If the student's final answer matches the `A` mark definition (e.g. "78"), you **MUST** award that mark.
   * **REVERSE ALLOCATION:** If the budget is tight (e.g. 4 marks), and you find 5 valid steps, you must DROP the **earliest/weakest Method (M)** marks to make room for the **Accuracy (A)** mark.
   * **NEVER** return a result where a correct final answer is marked as `UNMATCHED` or ignored because you spent the budget on intermediate steps.
5. **Mark Distribution & Quantity (CRITICAL):**
    * **MARK QUANTITY:** Do NOT exceed the total count of each mark code available in the marking scheme. (e.g., If the scheme has 3x "P1", you may award up to 3 "P1" marks).
    * **PROCESS CONSOLIDATION:** If a single line of student work represents multiple steps (e.g., one calculation covers 3 "P1" steps), generate a SEPARATE annotation for EACH mark earned. Use the same `line_id` for all annotations on that line.
    * **NO CONTRADICTION:** If a student achieves a correct result (A1) or a later process mark (P1), do NOT award "P0" or "M0" for intermediate steps that are implicitly correct or superseded by the better work.
5. **Text Fields:** Populate `student_text`, `classification_text`, `subQuestion`, and `line_index`.
    * **classification_text Alignment:** If you use a fallback ID (e.g. `line_1`), copy the verbatim text from the corresponding **[Line 1]** entry in the structured student work into this field.
    * **subQuestion Alignment:** Use the sub-question labels from the marking scheme headers (e.g., use '6a' if the marks were under the `[6a]` header).
6. **Reasoning (CRITICAL):** Provide reasoning in the **"reasoning"** field:
    * **CONCISENESS MANDATE:** All reasoning must be **concise and direct, not exceeding 20 words**. **DO NOT** use vertical bars (|) or list multiple criteria/answers. **DO NOT** include the mark code prefix (e.g. 'Correct...' NOT 'M1: Correct...').
    * **For Text/Calculation (A0, M0, etc.):** **MANDATORY**‚ÄîFocus **ONLY on the student's specific error.**
    * **For Drawings (Any Mark):** **MANDATORY**‚ÄîState the single key visual element observed and whether it met the criterion.
8. **MANDATORY ANNOTATIONS (The "Every Part Matters" Rule):** You MUST generate at least one annotation for every sub-question (e.g. 3a, 3b) or root question (e.g. Q5) provided in the marking scheme. 
    * **STRICT MODE RULE:** Do NOT skip a question because it is single-part or simple. If the student wrote nothing, provide a cross (A0/M0) on the empty answer line/grid and explain "No student work observed".

7. **Tolerance:** Be flexible with OCR/handwriting errors.

---

## 7. DRAWING & VISUAL MARKING

* **Drawing Reasoning Content:** For drawing annotations, the `reasoning` field **MUST** be concise (max 20 words) and state:
    1. **If Awarded (M1, A1, B1, etc.):** The key feature observed that **met** the criterion. (e.g., "Correct dimensions and vertices placed.")
    2. **If Lost (M0, A0, B0, etc.):** The specific criterion that was **missed** or the main error observed. (e.g., "Box plot missing upper quartile (47).")
* **Other Drawing Rules:** Scan the image for all student work. Use Systematic Evaluation (highest mark met). Accept coordinate tolerance (1-2 units). Use `visual_position` (PERCENTAGES 0-100).
* **FOR TEXT MARKS (Written Content):** Do **NOT** populate `visual_position`. Leave it null/undefined. The system will map using `line_index`.
* **FOR DRAWING MARKS (Visual Content):** If `ocr_match_status` is **"VISUAL"** or the annotation relates to a drawing/graph, you **MUST** populate `visual_position` with the percentage bounding box.
* **DRAWING KEYWORD:** For any "VISUAL" mark, you **MUST** prepend the keyword **[DRAWING]** to the `reasoning` field. (e.g., *"[DRAWING] Correct frequency polygon plotted."*). This is the ONLY way the system identifies a visual mark.

---

## 8. SCORING RULES

1. **Total Marks:** Use the provided **TOTAL MARKS** value.
2. **Max Score:** Total awarded marks must NOT exceed the sub-question's max score (enforced by Rule 4.3).
3. **Score Text:** Format as "awardedMarks/totalMarks".
4. **Multi-Value Marks:** If a single annotation has a code like "B2" or "M2", add its full numerical value (e.g. 2) to the 'awardedMarks' sum. Do NOT count it as just 1 mark.

---

## üíæ JSON OUTPUT STRUCTURE (MANDATORY)

```json
{
  "meta": {
    "question_total_marks": Integer,      // e.g. 3
    "raw_correct_steps_found": Integer,   // e.g. 7
    "steps_dropped_to_fit_budget": Integer, // e.g. 4
    "isTotalEstimated": Boolean          // true if budget was estimated/guessed
  },
  "visualObservation": "String [Analysis dictated by Section 5]",
  "annotations": [
    {
      "line_id": "String (block_X_Y if MATCHED, line_X if UNMATCHED)",
      "action": "tick|cross",
      "text": "String (e.g. 'M1' or 'A1')",
      "student_text": "String (CLEAN UP raw OCR/LaTeX)",
      "classification_text": "String",
      "ocr_match_status": "MATCHED|UNMATCHED|VISUAL",
      "reasoning": "String (max 20 words)",
      "subQuestion": "String",
      "pageIndex": Integer,
      "line_index": Integer,
      "visual_position": {
        "x": "Number (0-100)",
        "y": "Number (0-100)",
        "width": "Number (0-100)",
        "height": "Number (0-100)"
      }
    }
  ],
  "studentScore": {
    "totalMarks": Integer,
    "awardedMarks": Integer,
    "scoreText": "String"
  }
}
```

**CRITICAL REMINDER:** The "totalMarks" field in studentScore MUST equal the sum of all available marks from the provided marking scheme (e.g., if scheme is "M1, A1, B1, M1" = 1+1+2+2 = 6 total marks). NEVER leave it as 0 or a placeholder!
[1m[34m------------------------------------------------------------[0m

[1m[36m# MARKING TASK: Question 23

## QUESTION TEXT
C is a circle with centre (0, 0). L is a straight line. The circle C and the line L intersect at the points P and Q. The coordinates of P are (5, 10). The x coordinate of Q is -2. L has a positive gradient and crosses the y-axis at the point (0, k). Find the value of k.


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)
## GENERAL MARKING GUIDANCE
> [!IMPORTANT]
> **Precedence:** Specific notes for individual questions take precedence over this general guidance.

### General Principles
- All candidates must receive the same treatment (mark the last candidate the same way as the first).
- Mark schemes should be applied positively; all available marks are designed to be awarded.
- Examiners should be prepared to award zero marks if the response is not worthy of credit.
- Where judgement is required, mark schemes provide the principles for awards, and guidance/exemplification is not exhaustive.
- If you are in doubt about applying the mark scheme, send the response for review.

### Marking Procedure
- Always check the working in the body of the script (and on diagrams) and award appropriate marks, even if the answer line is wrong or blank.
- For questions *not* requiring working, the correct answer generally gains full marks.
- For questions *requiring* working, candidates who do not show working generally get no marks (check individual question details).
- Mark crossed-out work unless the candidate has clearly replaced it with an alternative response.
- If a choice of methods is shown, mark the method that leads to the answer on the answer line. If no answer appears on the answer line, mark all methods and award the lower number of marks.
- Award 0 marks if a 'correct' answer is clearly obtained from incorrect working (send to review).

### Follow Through Marks
- Single-stage calculations can be awarded follow-through (ft) marks without sighting working, provided the answer is unambiguous.
- Multi-stage calculations must show the relevant working to be awarded ft marks.

### Treatment of Answers
- **Ignoring Subsequent Work (ISW):** Ignore additional work that does not change the answer inappropriately (e.g., an incorrectly cancelled fraction). DO NOT ignore subsequent work that makes the answer essentially incorrect (e.g., incorrect algebraic simplification).
- **Probability:** Answers must be a fraction, percentage, or decimal. Decimals should be $\ge 2$ decimal places (unless tenths). Incorrect notation loses accuracy marks but may still get method marks.
- **Linear Equations:** Full marks can be given if the solution alone is on the answer line or unambiguously identified elsewhere. If the correct solution is only *substituted* but not identified, the accuracy mark is lost (embedded answers).
- **Ranges:** A given answer range (e.g., 3.5-4.2) is inclusive of the endpoints and all numbers in between.
- **Numbers in Brackets (e.g., $2\times6(=12)$):** The mark can be awarded for the correct method *or* the correct answer to the calculation.
- **Inverted Commas (e.g., $\text{"12"}\times50$):** The number in quotes must come from a correct method/process, but an arithmetic error in the candidate's working is allowed.
- **Square Brackets (e.g., $\text{[area]}$):** The value used does not need to come from a correct method but is the value the candidate believes is the area (check for constraints in the scheme).
- **Misreads:** Method/process marks may be awarded for a number misread from the question (e.g., 252 instead of 255), provided the question is not simplified. Misreads should be sent for review.

### Abbreviations
- **M**: Method mark (for a correct method or partial method)
- **P**: Process mark (for a correct process as part of a problem-solving question)
- **A**: Accuracy mark (awarded after a correct method/process; if no method is seen, full marks may be implied)
- **C**: Communication mark (for a fully correct statement(s) with no contradiction/ambiguity)
- **B**: Unconditional accuracy mark (no method needed)
- **oe**: Or equivalent
- **cao**: Correct answer only
- **ft**: Follow through
- **SC**: Special case
- **dep**: Dependent (on a previous mark)
- **indep**: Independent
- **awrt**: Answer which rounds to
- **isw**: Ignore subsequent working





## MARKING SCHEME

## MARKING SCHEME
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **MATCH**: Match the student's work strictly to the M1/A1/B1 definitions below.
> 2. **NO OVER-MARKING**:
>    - You have a specific list of marks. Do NOT invent new ones.
>    - If the student provides multiple valid methods, award marks for the BEST method only.
>    - **MAX LIMIT:** The total score cannot exceed the sum of marks listed below.

[OFFICIAL SCHEME]
[MAX SCORE: 5]
- P1: for $x^2 + y^2 = 125$ or $5^2 + 10^2 (= 125)$
- P1: for process to find y coordinate of Q (eg $(\pm)\sqrt{125 - (-2)^2}$)
- P1: for selecting $-\sqrt{125 - (-2)^2}$ (eg $y = -11$)
- P1: (dep P2) for process to find y intercept (eg $\frac{10 - [y]}{5 - -2} (= 3)$ and substitutes $x = 5, y = 10$ in $y = "3"x + k$)
- A1: ‚Äì5

FINAL ANSWER: ‚Äì5



> [!IMPORTANT]
> The number of annotations you generate MUST BE EXACTLY EQUAL to the number of marks available in the MARKING SCHEME.
> - If the marking scheme has 4 potential marks (e.g., M1, M1, A1, B1), you MUST return exactly 4 annotations.
> - Do NOT omit marks that were not awarded; return them as 0 (e.g., M0, A0) to ensure the count matches exactly.


## STUDENT WORK (STRUCTURED)
[MAIN QUESTION STUDENT WORK]
[Line 1] y=mx+c (ID: line_1)
[Line 2] \sqrt{5^2+10^2} = \sqrt{125} (ID: line_2)
[Line 3] (-2)^2+(\lambda)^2 = \sqrt{125}^2 (ID: line_3)
[Line 4] 4+\lambda^2=125 (ID: line_4)
[Line 5] \lambda^2=121 (ID: line_5)
[Line 6] \lambda = \pm 11 (ID: line_6)
[Line 7] \frac{-11-10}{-2-5} = \frac{21}{7} (ID: line_7)
[Line 8] =3 (ID: line_8)
[Line 9] y = 3x+( (ID: line_9)
[Line 10] 10=3(5)+k (ID: line_10)
[Line 11] -5=k (ID: line_11)
[Line 12] k= -5 (ID: line_12)
[Line 13] [DRAWING] (ID: line_13)

 
## RAW OCR BLOCKS (SPATIALLY FILTERED)
Use these IDs to map the student's work.

### üìù POTENTIAL STUDENT WORK (GRADING TARGETS)
// These blocks were found in the answer zone.
// NOTE: Mathpix "type" flags are ignored. Determine logic context yourself.
[block_0_0_88]: "\( 23 \mathbf{C} \) is a circle with centre \( (0,0) \)"
[block_0_1_685]: "\( \mathbf{L} \) is a straight line."
[block_0_2_871]: "The circle \( \mathbf{C} \) and the line \( \mathbf{L} \) intersect at the points \( P \) and \( Q \)."
[block_0_3_903]: "The coordinates of \( P \) are \( (5,10) \)"
[block_0_4_741]: "The \( x \) coordinate of \( Q \) is -2"
[block_0_5_914]: "\( \mathbf{L} \) has a positive gradient and crosses the \( y \)-axis at the point \( (0, k) \)"
[block_0_6_717]: "Find the value of \( k \)."
[block_0_7_791]: "y=m x+c"
[block_0_13_908]: "\sqrt{5^{2}+10^{2}}=\sqrt{125}"
[block_0_8_337]: "\frac{-11-10}{-2-5}=\frac{21}{7}"
[block_0_9_48]: "=3"
[block_0_14_305]: "\left.(-2)^{2}+1 \lambda\right)^{2}=\sqrt{-(\sqrt{125})^{2}}"
[block_0_10_399]: "y=3 x+c"
[block_0_15_368]: "4+\lambda^{2}=125"
[block_0_11_192]: "10=3(3)+k"
[block_0_16_375]: "\lambda^{2}=121"
[block_0_12_59]: "-5=k"
[block_0_17_480]: "\lambda= \pm 11"
[block_0_18_882]: "k=-5"
[block_0_20_623]: "TOTAL FOR PAPER IS 80 MARKS"
[block_0_21_454]: "23"[0m
[1m[34m‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ[0m

[BUDGET Q19] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ19[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6516[0m
     [36mThe student provides calculations to find the ratio AB:AD.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_6_524][0m [P1] [34m"frac{A B}{4} = frac{21+4}{A B}"[0m
      ‚Ü≥ Reason: Correct equation using similar triangles.
      ‚Ü≥ OCR Match: [35m"frac{A B}{4} = frac{21+4}{A B}"[0m
      ‚Ü≥ Classification: [35m"\frac{AB}{4}=\frac{21+4}{AB}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_7_835][0m [P1] [34m"A B = 10"[0m
      ‚Ü≥ Reason: Correct process to find AB.
      ‚Ü≥ OCR Match: [35m"A B = 10"[0m
      ‚Ü≥ Classification: [35m"AB = 10"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[line_4][0m [A1] [34m"2:5"[0m
      ‚Ü≥ Reason: Correct final answer.
      ‚Ü≥ Transcription: [35m"2:5"[0m
      ‚Ü≥ Classification: [35m"2:5"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
[WIDTH FIX] Boosting tiny width 120px to 300px for Q19
[GUILLOTINE CHECK] Q19: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[BUDGET Q20] ü•á Trusting AI Total: 3 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ20[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m3/3[0m
  - Usage tokens: [33m6764[0m
     [36mThe student provides calculations to find the value of n.[0m
  - Annotations:
    1. [31mcross[0m [34m[line_1][0m [P0] [34m"2^x = 2^n times 2^{(frac{1}{3})}"[0m
      ‚Ü≥ Reason: Incorrect manipulation of the fraction. Should be division, not multiplication.
      ‚Ü≥ Transcription: [35m"2^x = 2^n times 2^{(frac{1}{3})}"[0m
      ‚Ü≥ Classification: [35m"2^x = 2^n \times 2^{(\frac{1}{3})}"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    2. [32mtick[0m [34m[block_0_4_352][0m [P1] [34m"x = n-1 / 3"[0m
      ‚Ü≥ Reason: Correctly equates exponents for x.
      ‚Ü≥ OCR Match: [35m"x = n-1 / 3"[0m
      ‚Ü≥ Classification: [35m"x = n-\frac{1}{3}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[line_3][0m [P1] [34m"y = frac{5}{2}"[0m
      ‚Ü≥ Reason: Correctly equates exponents for y.
      ‚Ü≥ Transcription: [35m"y = frac{5}{2}"[0m
      ‚Ü≥ Classification: [35m"y = \frac{5}{2}"[0m
      ‚Ü≥ Status: [31m"UNMATCHED (Fallback to Classification)"[0m
    4. [32mtick[0m [34m[block_0_6_368][0m [A1] [34m"n = 35 / 6"[0m
      ‚Ü≥ Reason: Correct final answer.
      ‚Ü≥ OCR Match: [35m"n = 35 / 6"[0m
      ‚Ü≥ Classification: [35m"n = \frac{35}{6}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[WIDTH FIX] Boosting tiny width 170px to 300px for Q20
[GUILLOTINE CHECK] Q20: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=3, ResultTotal=3
[BUDGET Q22] ü•á Trusting AI Total: 4 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ22[0m - Clean response received:
  - Annotations count: [35m3[0m
  - Student score: [32m4/4[0m
  - Usage tokens: [33m6675[0m
     [36mSine curve sketched with key points marked. Solutions to the equation are provided.[0m
  - Annotations:
    1. [32mtick[0m [34m[line_3][0m [M1 A1] [34m"[DRAWING]"[0m
      ‚Ü≥ Reason: [DRAWING] Correct shape for sine curve between 0 and 360 degrees. | [DRAWING] Fully correct sketch with labels at 1 and -1.
      ‚Ü≥ Transcription: [35m"[DRAWING]"[0m
      ‚Ü≥ Classification: [35m"[DRAWING]"[0m
      ‚Ü≥ Status: [32m"VISUAL"[0m
    2. [32mtick[0m [34m[block_0_5_192][0m [M1] [34m"x_{1} = 330"[0m
      ‚Ü≥ Reason: One correct solution is provided.
      ‚Ü≥ OCR Match: [35m"x_{1} = 330"[0m
      ‚Ü≥ Classification: [35m"x_{1}=330"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_6_67][0m [A1] [34m"x_{2} = 210"[0m
      ‚Ü≥ Reason: Both solutions are correct.
      ‚Ü≥ OCR Match: [35m"x_{2} = 210"[0m
      ‚Ü≥ Classification: [35m"x_{2}=210"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q22: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=4, ResultTotal=4
[BUDGET Q21] ü•á Trusting AI Total: 5 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ21[0m - Clean response received:
  - Annotations count: [35m5[0m
  - Student score: [32m5/5[0m
  - Usage tokens: [33m7849[0m
     [36mThe student attempts to solve the cuboid problem, setting up equations for volume and surface area, then solving for the height.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_8_543][0m [P1] [34m"300 = 20 x y"[0m
      ‚Ü≥ Reason: Correct equation formed using the volume.
      ‚Ü≥ OCR Match: [35m"300 = 20 x y"[0m
      ‚Ü≥ Classification: [35m"300 = 20xY"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_13_855][0m [P1] [34m"370 = 2 x y+40 x+40 y"[0m
      ‚Ü≥ Reason: Correct equation formed using the surface area.
      ‚Ü≥ OCR Match: [35m"370 = 2 x y+40 x+40 y"[0m
      ‚Ü≥ Classification: [35m"370 = 2xy + 2(20x) + 2(20y)"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_18_80][0m [P1] [34m"0 = 4 y^{2}-34 y+60"[0m
      ‚Ü≥ Reason: Correctly eliminates one variable.
      ‚Ü≥ OCR Match: [35m"0 = 4 y^{2}-34 y+60"[0m
      ‚Ü≥ Classification: [35m"0 = 4y^2 - 34y + 60"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_20_169][0m [P1] [34m"0 = (2 y-5)(y-6)"[0m
      ‚Ü≥ Reason: Correct process to solve the quadratic equation.
      ‚Ü≥ OCR Match: [35m"0 = (2 y-5)(y-6)"[0m
      ‚Ü≥ Classification: [35m"0 = (2y - 5)(y - 6)"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    5. [32mtick[0m [34m[block_0_23_795][0m [A1] [34m"frac{5}{2} = 2.5"[0m
      ‚Ü≥ Reason: Correct final answer.
      ‚Ü≥ OCR Match: [35m"frac{5}{2} = 2.5"[0m
      ‚Ü≥ Classification: [35m"\frac{5}{2} = 2.5"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q21: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=5, ResultTotal=5
[BUDGET Q23] ü•á Trusting AI Total: 5 (Reason: Explicit Read)
ü§ñ [AI RESPONSE] [31mQ23[0m - Clean response received:
  - Annotations count: [35m4[0m
  - Student score: [32m5/5[0m
  - Usage tokens: [33m7422[0m
     [36mNo student work observed.[0m
  - Annotations:
    1. [32mtick[0m [34m[block_0_13_908][0m [P1] [34m"sqrt{5^{2}+10^{2}} = sqrt{125}"[0m
      ‚Ü≥ Reason: Correct calculation of 5^2 + 10^2 = 125.
      ‚Ü≥ OCR Match: [35m"sqrt{5^{2}+10^{2}} = sqrt{125}"[0m
      ‚Ü≥ Classification: [35m"\sqrt{5^2+10^2} = \sqrt{125}"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    2. [32mtick[0m [34m[block_0_17_480][0m [P1 P1] [34m"lambda = pm 11"[0m
      ‚Ü≥ Reason: Correct process to find y coordinate of Q. | Correct selection of -sqrt(125 - (-2)^2).
      ‚Ü≥ OCR Match: [35m"lambda = pm 11"[0m
      ‚Ü≥ Classification: [35m"\lambda = \pm 11"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    3. [32mtick[0m [34m[block_0_9_48][0m [P1] [34m"= 3"[0m
      ‚Ü≥ Reason: Correct process to find y intercept.
      ‚Ü≥ OCR Match: [35m"= 3"[0m
      ‚Ü≥ Classification: [35m"=3"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
    4. [32mtick[0m [34m[block_0_18_882][0m [A1] [34m"k = -5"[0m
      ‚Ü≥ Reason: Correct final answer.
      ‚Ü≥ OCR Match: [35m"k = -5"[0m
      ‚Ü≥ Classification: [35m"k= -5"[0m
      ‚Ü≥ Status: [32m"MATCHED"[0m
[GUILLOTINE CHECK] Q23: isGeneric=false, hasAnnotations=true, hasScore=true, SchemeTotal=5, ResultTotal=5
[1m[32m‚úÖ [AI MARKING][0m [1mCOMPLETED[0m in [1m22.0s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
[1m[32m‚úÖ [MARKING][0m [1mCOMPLETED[0m in [1m22.0s[0m ([32m[1mAI-MARKING[0m)

üîç [RESULT VERIFICATION] Checking what will be combined:
   üìä Marking Results: 23 questions
   üìù Question Results: NO
   ‚úÖ Both modes triggered: NO
[TOTAL TRAP] Q1: Scheme=2, AI=2, IsDefault=false -> FINAL=2
[TOTAL TRAP] Q2: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q3: Scheme=5, AI=5, IsDefault=false -> FINAL=5
[TOTAL TRAP] Q4: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q5: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Q6: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Q7: Scheme=5, AI=5, IsDefault=false -> FINAL=5
[TOTAL TRAP] Q8: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q9: Scheme=1, AI=1, IsDefault=false -> FINAL=1
[TOTAL TRAP] Q10: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Q11: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q12: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q13: Scheme=5, AI=5, IsDefault=false -> FINAL=5
[TOTAL TRAP] Q14: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q15: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Q16: Scheme=2, AI=2, IsDefault=false -> FINAL=2
[TOTAL TRAP] Q17: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q18: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q19: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q20: Scheme=3, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q21: Scheme=5, AI=5, IsDefault=false -> FINAL=5
[TOTAL TRAP] Q22: Scheme=4, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Q23: Scheme=5, AI=5, IsDefault=false -> FINAL=5
[TOTAL TRAP] Grand Total Possible Score: 80
[32müîÑ [LOGICAL RE-INDEXING] Aligning logical indices with sorted physical order...[0m
[32m‚úÖ [LOGICAL RE-INDEXING] Re-indexed 23 questions and 23 pages.[0m
[32m‚úÖ [1m[FINAL PAGE ORDER][0m [32m[1] Page 1 ([37mFRONT PAGE[32m) -> [2] Page 2 ([37mQ1[32m) -> [3] Page 5 ([37mQ3b[32m) -> [4] Page 3 ([37mQ2a[32m) -> [5] Page 4 ([37mQ3a[32m) -> [6] Page 6 ([37mQ4a[32m) -> [7] Page 7 ([37mQ5a[32m) -> [8] Page 8 ([37mQ6a[32m) -> [9] Page 9 ([37mQ7[32m) -> [10] Page 10 ([37mQ8, Q9[32m) -> [11] Page 11 ([37mQ10[32m) -> [12] Page 12 ([37mQ11[32m) -> [13] Page 13 ([37mQ12i[32m) -> [14] Page 14 ([37mQ13a[32m) -> [15] Page 15 ([37mQ14[32m) -> [16] Page 16 ([37mQ15[32m) -> [17] Page 17 ([37mQ16, Q17a[32m) -> [18] Page 23 ([37mQ18[32m) -> [19] Page 18 ([37mQ19[32m) -> [20] Page 19 ([37mQ20[32m) -> [21] Page 20 ([37mQ21[32m) -> [22] Page 21 ([37mQ22a[32m) -> [23] Page 22 ([37mQ23[32m)[0m
[1m[32m‚úÖ [OUTPUT GENERATION][0m [1mCOMPLETED[0m in [1m4.1s[0m ([32m[1mOUTPUT-GENERATION[0m)
[SYNC FIX] üîÑ Synchronizing UI Structure (Schema Defaults) with Engine Results (Actuals)...
[SYNC FIX] ‚úÖ Q1: Updated Total Available Marks from undefined (Schema) -> 2 (Engine)
[SYNC FIX] ‚úÖ Q2: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q3: Updated Total Available Marks from undefined (Schema) -> 5 (Engine)
[SYNC FIX] ‚úÖ Q4: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q5: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] ‚úÖ Q6: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] ‚úÖ Q7: Updated Total Available Marks from undefined (Schema) -> 5 (Engine)
[SYNC FIX] ‚úÖ Q8: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q9: Updated Total Available Marks from undefined (Schema) -> 1 (Engine)
[SYNC FIX] ‚úÖ Q10: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] ‚úÖ Q11: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q12: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q13: Updated Total Available Marks from undefined (Schema) -> 5 (Engine)
[SYNC FIX] ‚úÖ Q14: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q15: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] ‚úÖ Q16: Updated Total Available Marks from undefined (Schema) -> 2 (Engine)
[SYNC FIX] ‚úÖ Q17: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q18: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q19: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q20: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q21: Updated Total Available Marks from undefined (Schema) -> 5 (Engine)
[SYNC FIX] ‚úÖ Q22: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] ‚úÖ Q23: Updated Total Available Marks from undefined (Schema) -> 5 (Engine)
[SYNC FIX] üèÅ Updated Grand Total from 80 -> 80
[1m[32m‚úÖ [PERFORMANCE SUMMARY AI][0m [1mCOMPLETED[0m in [1m0.9s[0m ([32m[1mGEMINI-2.0-FLASH[0m)

üìä [ANNOTATION SUMMARY]
----------------------------------------------------------------------
| Q#       | Score | Marks Awarded           | Match Status              |
|----------|-------|-------------------------|---------------------------|
| [32m1       [0m | 2/2   | B2                      | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m2       [0m | 2/3   | M1, A0, C1              | M:0 V:0 U:0 S:3           |
| [90m  a     [0m | 1     | M1, A0                  | M:0 V:0 U:0 S:2           |
| [90m  b     [0m | 1     | C1                      | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m3       [0m | 5/5   | C1, P1, P1, P1, A1      | M:0 V:0 U:0 S:5           |
| [90m  a     [0m | 4     | P1, P1, P1, A1          | M:0 V:0 U:0 S:4           |
| [90m  b     [0m | 1     | C1                      | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m4       [0m | 3/3   | B1, M1 A1               | M:0 V:0 U:0 S:2           |
| [90m  a     [0m | 1     | B1                      | M:0 V:0 U:0 S:1           |
| [90m  b     [0m | 1     | M1 A1                   | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m5       [0m | 4/4   | P1 P1 A1, C1            | M:0 V:0 U:0 S:2           |
| [90m  a     [0m | 1     | P1 P1 A1                | M:0 V:0 U:0 S:1           |
| [90m  b     [0m | 1     | C1                      | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m6       [0m | 4/4   | M1 M1 A1, B1            | M:0 V:0 U:1 S:1           |
| [90m  a     [0m | 1     | M1 M1 A1                | M:0 V:0 U:0 S:1           |
| [90m  b     [0m | 1     | B1                      | M:0 V:0 U:1 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m7       [0m | 5/5   | P1, P1, P1, P1, A1      | M:0 V:0 U:0 S:5           |
|----------|-------|-------------------------|---------------------------|
| [32m8       [0m | 3/3   | M1 M1, A1               | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m9       [0m | 1/1   | B1                      | M:0 V:0 U:0 S:1           |
|----------|-------|-------------------------|---------------------------|
| [32m10      [0m | 4/4   | M1, A1 M1, A1           | M:0 V:0 U:3 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m11      [0m | 0/3   | M0                      | M:0 V:1 U:0 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m12      [0m | 3/3   | B1, B1, B1              | M:0 V:0 U:3 S:0           |
| [90m  i     [0m | 1     | B1                      | M:0 V:0 U:1 S:0           |
| [90m  ii    [0m | 1     | B1                      | M:0 V:0 U:1 S:0           |
| [90m  iii   [0m | 1     | B1                      | M:0 V:0 U:1 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m13      [0m | 2/5   | M1, A1, B0              | M:0 V:1 U:0 S:2           |
| [90m  a     [0m | 0     | B0                      | M:0 V:1 U:0 S:0           |
| [90m  b     [0m | 2     | M1, A1                  | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m14      [0m | 3/3   | M1, M1, A1              | M:0 V:0 U:0 S:3           |
|----------|-------|-------------------------|---------------------------|
| [32m15      [0m | 4/4   | P1, P2, A1              | M:0 V:0 U:0 S:3           |
|----------|-------|-------------------------|---------------------------|
| [32m16      [0m | 2/2   | M1, A1                  | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m17      [0m | 2/3   | B1, B0, A1, M0          | M:0 V:0 U:0 S:4           |
| [90m  a     [0m | 1     | B1, B0                  | M:0 V:0 U:0 S:2           |
| [90m  b     [0m | 1     | A1, M0                  | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m18      [0m | 3/3   | M1, M1, C1              | M:0 V:0 U:0 S:3           |
|----------|-------|-------------------------|---------------------------|
| [32m19      [0m | 3/3   | P1, P1, A1              | M:0 V:0 U:1 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m20      [0m | 3/3   | P1, A1, P0, P1          | M:0 V:0 U:2 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m21      [0m | 5/5   | P1, P1, P1, P1, A1      | M:0 V:0 U:0 S:5           |
|----------|-------|-------------------------|---------------------------|
| [32m22      [0m | 4/4   | M1, A1, M1 A1           | M:0 V:1 U:0 S:2           |
| [90m  a     [0m | 1     | M1 A1                   | M:0 V:1 U:0 S:0           |
| [90m  b     [0m | 2     | M1, A1                  | M:0 V:0 U:0 S:2           |
|----------|-------|-------------------------|---------------------------|
| [32m23      [0m | 5/5   | P1, P1, P1 P1, A1       | M:0 V:0 U:0 S:4           |
|----------|-------|-------------------------|---------------------------|

=== PERFORMANCE SUMMARY ===
Total Processing Time: 82.6s
Model Used: gemini-2.0-flash
----------------------------
classification                      29.9s (36%)
marking                             22.0s (27%)
question_detection                  13.2s (16%)
ocr_processing                      8.1s (10%)
output_generation                   4.1s (5%)
preprocessing                       3.0s (4%)
performance_summary                 0.9s (1%)
database_persistence                0.4s (0%)
============================


üìä [UsageTracker] Summary:
   Model: gemini-2.0-flash
   API Requests: 25 total
   Total Tokens: 164,288 (150,953 in + 13,335 out)
   Total Cost: $0.111426
   Mathpix OCR: 23 pages ‚Üí $0.092000

   Breakdown by Phase:
   ‚Ä¢ Mapper (Map Pass): 7,652 tokens (1 requests) ‚Üí $0.001004
   ‚Ä¢ Classification (Marking Pass): 154,175 tokens (23 requests) ‚Üí $0.019159
   ‚Ä¢ Performance Summary: 2,461 tokens (1 requests) ‚Üí $0.000266


üèÅ ========== UNIFIED PIPELINE END ==========
üèÅ ==========================================

‚úÖ [CONTROLLER] Pipeline completed, result exists: true, sessionId: sub-1768663877392
üí≥ [CREDIT DEDUCT] Starting deduction for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, sessionId: sub-1768663877392
üí≥ [CREDIT DEDUCT] Incremental cost from tracker: 0.1114256
üîç [SUBJECT EXTRACTION] examPapers[0].subject = "Mathematics"
üí≥ Deducted 11.14 credits from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2 (session: sub-1768663877392), remaining: 566.92
üí≥ Deducted 0.1114 credits (session: sub-1768663877392) from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2
‚úÖ [SUBJECT MARKING RESULT] Persisted marking result for subject: Mathematics, session: sub-1768663877392
