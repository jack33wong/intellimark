
> ai-marking-backend@1.0.0 dev
> cross-env NODE_OPTIONS=--no-deprecation nodemon --exec tsx --tsconfig tsconfig.dev.json server.ts

‚úÖ Permissions configuration loaded from .env.local:
   - Analysis Plans: pro, ultra
   - Model Selection Plans: pro, ultra
‚úÖ Credit configuration loaded from .env.local (FAIL-FAST mode):
   - Conversion Rate: $0.01 per credit
   - Free Plan: 10 credits/month
   - Pro Plan: 200 credits/month
   - Ultra Plan: 600 credits/month
üí≥ Stripe initialized in TEST mode
üìö Swagger UI available at /api-docs
üë§ [PLAN CHECK] User 9mBfvniXTuMtQU8f0OnLhUK6aOv2 is on plan: ultra
üì° [MARKING] Processing POST /api/marking/process (hasRawBody: false)
üöÄ [MARKING] Controller started - Files: 12, Body Keys: model, aiMessageId
üîç [CREDIT DEBUG] userId: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, isAuthenticated: true
üí≥ [CREDIT CHECK] Starting credit check for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2
üí≥ [CREDIT CHECK] Estimated cost: 0.4458642, files: 12, bytes: 3858642
üí≥ [CREDIT CHECK] Result: {"canProceed":true,"remaining":363.1}

üîÑ ========== UNIFIED PIPELINE START ==========
üîÑ ============================================

[1m[32m‚úÖ [INPUT VALIDATION][0m [1mCOMPLETED[0m in [1m0.0s[0m ([32m[1mVALIDATION[0m)
[INPUT TYPE] Detected: Multiple Images (12 files)
[1m[32m‚úÖ [PREPROCESSING][0m [1mCOMPLETED[0m in [1m1.5s[0m ([32m[1mIMAGE-PROCESSING[0m)
[MAPPER] Using model: gemini-2.0-flash
[MAPPER] Starting Map Pass for 12 pages...
   üì¶ [MAPPER-BUCKET] Processing pages 0 to 9...

üîç [MAPPER AUDIT] Batch of 10 images:
   ‚úÖ Mapped Local[0] -> Global[0] | Content: Empty/Meta
   ‚úÖ Mapped Local[1] -> Global[1] | Content: 1
   ‚úÖ Mapped Local[2] -> Global[2] | Content: 2a, 2b
   ‚úÖ Mapped Local[3] -> Global[3] | Content: 3
   ‚úÖ Mapped Local[4] -> Global[4] | Content: 4
   ‚úÖ Mapped Local[5] -> Global[5] | Content: 5a, 5b, 5c
   ‚úÖ Mapped Local[6] -> Global[6] | Content: 6
   ‚úÖ Mapped Local[7] -> Global[7] | Content: 7
   ‚úÖ Mapped Local[8] -> Global[8] | Content: 8
   ‚úÖ Mapped Local[9] -> Global[9] | Content: 9a, 9b
   üì¶ [MAPPER-BUCKET] Processing pages 8 to 11...

üîç [MAPPER AUDIT] Batch of 4 images:
   ‚úÖ Mapped Local[0] -> Global[8] | Content: 8
   ‚úÖ Mapped Local[1] -> Global[9] | Content: 9a, 9b
   ‚úÖ Mapped Local[2] -> Global[10] | Content: 10
   ‚úÖ Mapped Local[3] -> Global[11] | Content: 11a, 11b
‚úÖ [MAPPER] Map Pass complete in 7.54s. Mapped 12 pages.
[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m19.4s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
üöÄ [OVERRIDE] 90% Rule Triggered: 11/11 pages have student work. Overriding all questionOnly pages to questionAnswer for consistency.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîÄ [PERFECT SPLIT] Building standalone structures with re-indexing
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üéØ [MODE ROUTING] Pure marking mode

‚úÖ Perfect split complete - each mode has consecutive 0-based indices
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m19.4s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
üîç [MODE DETECTION] Analysis (AFTER overrides):
  - All question-only: false
  - Has mixed content: false
  - Has any student work: true
  - Selected mode: Marking Mode
[1m[32m‚úÖ [OCR PROCESSING][0m [1mCOMPLETED[0m in [1m7.2s[0m ([32m[1mMATHPIX[0m)

üîç [DETECTION CONTEXT]
   Strategy: Pearson Edexcel 1MA1/2H June 2024 Higher Tier
   Pool Size: 1 papers, 22 total question candidates
------------------------------------------------------------------------------------------------------------------------------------

üìã [DETECTION AUDIT REPORT]
------------------------------------------------------------------------------------------------------------------------------------
| Q#   | Input Text (Fragment)                       | Match Result / Paper Title                         | Score | Status        |
------------------------------------------------------------------------------------------------------------------------------------
| 1    | ABC is a right-angled triangle. Work out t... | Edexcel GCSE 1MA1/2H June 2024 Q1                  | 0.679 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.679] 1MA1/2H Q1                     | Txt:0.90 Num:0.43 Str:0.50 Sem:PASS
      ‚óã [0.481] 1MA1/2H Q12                    | Txt:0.43 Num:0.57 Str:0.50 Sem:PASS
      ‚óã [0.424] 1MA1/2H Q10                    | Txt:0.45 Num:0.25 Str:0.50 Sem:PASS
| 2a   | Write 90 as a product of its prime factors... | Edexcel GCSE 1MA1/2H June 2024 Q2                  | 0.828 | [32m‚úÖ SUCCESS[0m      |
| 2b   | Write down the lowest common multiple (LCM... | Edexcel GCSE 1MA1/2H June 2024 Q2                  | 0.828 | [32m‚úÖ SUCCESS[0m      |
| 3    | The number of hours, H, that some machines... | Edexcel GCSE 1MA1/2H June 2024 Q3                  | 0.972 | [32m‚úÖ SUCCESS[0m      |
| 4    | There are only red discs, blue discs and y... | Edexcel GCSE 1MA1/2H June 2024 Q4                  | 0.887 | [32m‚úÖ SUCCESS[0m      |
| 5    | Complete the table of values for y = x¬≤-x ... | Edexcel GCSE 1MA1/2H June 2024 Q5                  | 0.816 | [32m‚úÖ SUCCESS[0m      |
| 5a   | Complete the table of values for y = x¬≤-x ... | Edexcel GCSE 1MA1/2H June 2024 Q5                  | 0.816 | [32m‚úÖ SUCCESS[0m      |
| 5b   | Complete the table of values for y = x¬≤-x ... | Edexcel GCSE 1MA1/2H June 2024 Q5                  | 0.816 | [32m‚úÖ SUCCESS[0m      |
| 5c   | Complete the table of values for y = x¬≤-x ... | Edexcel GCSE 1MA1/2H June 2024 Q5                  | 0.816 | [32m‚úÖ SUCCESS[0m      |
| 6    | Andy, Luke and Tina share some sweets in t... | Edexcel GCSE 1MA1/2H June 2024 Q6                  | 0.891 | [32m‚úÖ SUCCESS[0m      |
| 7    | ABCD is a quadrilateral. All angles are me... | Edexcel GCSE 1MA1/2H June 2024 Q7                  | 0.846 | [32m‚úÖ SUCCESS[0m      |
| 8    | A playground is in the shape of a right-an... | Edexcel GCSE 1MA1/2H June 2024 Q8                  | 0.912 | [32m‚úÖ SUCCESS[0m      |
| 9    | A number N is rounded to 2 significant fig... | Edexcel GCSE 1MA1/2H June 2024 Q9                  | 0.862 | [32m‚úÖ SUCCESS[0m      |
| 9a   | A number N is rounded to 2 significant fig... | Edexcel GCSE 1MA1/2H June 2024 Q9                  | 0.862 | [32m‚úÖ SUCCESS[0m      |
| 9b   | A number N is rounded to 2 significant fig... | Edexcel GCSE 1MA1/2H June 2024 Q9                  | 0.862 | [32m‚úÖ SUCCESS[0m      |
| 10   | The diagram shows two right-angled triangl... | Edexcel GCSE 1MA1/2H June 2024 Q10                 | 0.811 | [32m‚úÖ SUCCESS[0m      |
| 11   | The frequency table gives information abou... | Edexcel GCSE 1MA1/2H June 2024 Q11                 | 0.726 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      [32m‚óã[0m [0.726] 1MA1/2H Q11                    | Txt:0.85 Num:0.05 Str:1.00 Sem:PASS
| 11a  | The frequency table gives information abou... | Edexcel GCSE 1MA1/2H June 2024 Q11                 | 0.726 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      [32m‚óã[0m [0.726] 1MA1/2H Q11                    | Txt:0.85 Num:0.05 Str:1.00 Sem:PASS
| 11b  | The frequency table gives information abou... | Edexcel GCSE 1MA1/2H June 2024 Q11                 | 0.726 | [33m‚ö†Ô∏è  RESCUED[0m    |
   ‚îî‚îÄ Runners Up (Audit Trail):
      [32m‚óã[0m [0.726] 1MA1/2H Q11                    | Txt:0.85 Num:0.05 Str:1.00 Sem:PASS
------------------------------------------------------------------------------------------------------------------------------------


üìä [QUESTION DETECTION STATISTICS]
   Total questions: 19
   Detected: 11/19
   Not detected: 8
   [HINT] Hint Used: "Global Search"
   [HINT] Matched Papers: 108
[1m[32m‚úÖ [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m4.8s[0m ([32m[1mQUESTION-DETECTION[0m)

üîÑ [RE-INDEXING] üõ°Ô∏è Aligning physical pages using Database Verified Truth...
üîç [RE-INDEX DEBUG] Sorting Decision Matrix:
-----------------------------------------------------------------------------------------
| OrigIdx | Filename             | IsMeta | MinQ   | Detected Qs                        |
-----------------------------------------------------------------------------------------
| 0       | new doc 2025-11-23 1 | true   | 999999 |                                    |
| 1       | new doc 2025-11-23 1 | false  | 1      | 1                                  |
| 2       | new doc 2025-11-23 1 | false  | 2      | 2                                  |
| 3       | new doc 2025-11-23 1 | false  | 3      | 3                                  |
| 4       | new doc 2025-11-23 1 | false  | 4      | 4                                  |
| 5       | new doc 2025-11-23 1 | false  | 5      | 5                                  |
| 6       | new doc 2025-11-23 1 | false  | 6      | 6                                  |
| 7       | new doc 2025-11-23 1 | false  | 7      | 7                                  |
| 8       | new doc 2025-11-23 1 | false  | 8      | 8                                  |
| 9       | new doc 2025-11-23 1 | false  | 9      | 9                                  |
| 10      | new doc 2025-11-23 1 | false  | 10     | 10                                 |
| 11      | new doc 2025-11-23 1 | false  | 11     | 11                                 |
-----------------------------------------------------------------------------------------
‚úÖ [RE-INDEXING] Completed. Physical Page Index 0 is now: new doc 2025-11-23 11.51.11_1.jpg
‚úÖ [RE-INDEXING] Deep Pointer Update Complete. Lines now point to new physical pages.

üîÑ [OCR RE-ID] Regenerating Global Block IDs to match new Page Indices...
‚úÖ [OCR RE-ID] Completed. Blocks are now synchronized with physical pages.
‚úÖ [DIMENSIONS REBUILD] Map refreshed for 12 re-indexed pages.
[1m[32m‚úÖ [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m4.8s[0m ([32m[1mQUESTION-DETECTION[0m)
[1m[32m‚úÖ [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m4.8s[0m ([32m[1mQUESTION-DETECTION[0m)
üîç [DIMENSIONS DEBUG] Pages: 12
üîç [DIMENSIONS DEBUG] Map Size: 12
[ZONE-TRUTH] Q1 Classifier Target: Page 1
[ZONE-TRUTH] Q2 Classifier Target: Page 2
[ZONE-TRUTH] Q3 Classifier Target: Page 3
[ZONE-TRUTH] Q4 Classifier Target: Page 4
[ZONE-TRUTH] Q5 Classifier Target: Page 5
[ZONE-TRUTH] Q6 Classifier Target: Page 6
[ZONE-TRUTH] Q7 Classifier Target: Page 7
[ZONE-TRUTH] Q8 Classifier Target: Page 8
[ZONE-TRUTH] Q9 Classifier Target: Page 9
[ZONE-TRUTH] Q10 Classifier Target: Page 10
[ZONE-TRUTH] Q11 Classifier Target: Page 11
[UPSTREAM-SORT] üèÜ Fed 202 blocks in order: 0 -> 1 -> 2 -> 3 -> 4 -> 5 -> 6 -> 7 -> 8 -> 9 -> 10 -> 11
[ZONE-DETECTOR] Deterministic Sort Order: 1 -> 2 -> 2a -> 2b -> 3 -> 4 -> 5 -> 5a -> 5b -> 5c -> 6 -> 7 -> 8 -> 9 -> 9a -> 9b -> 10 -> 11 -> 11a -> 11b
[ZONE-SORT] üèÜ Physical Page Order: 0 -> 1 -> 2 -> 3 -> 4 -> 5 -> 6 -> 7 -> 8 -> 9 -> 10 -> 11
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "1" at P1. Terminating search before P2.
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "2" at P2. Terminating search before P3.
[ZONE-MISS] ‚ö†Ô∏è Question 2a could not be anchored. Exhausted search from P2@1042
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "2b" at P2. Terminating search before P3.
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "3" at P3. Terminating search before P4.
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "4" at P4. Terminating search before P5.
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "5" at P5. Terminating search before P6.
[ZONE-MISS] ‚ö†Ô∏è Question 5a could not be anchored. Exhausted search from P5@1631
[ZONE-MISS] ‚ö†Ô∏è Question 5b could not be anchored. Exhausted search from P5@1631
[ZONE-MISS] ‚ö†Ô∏è Question 5c could not be anchored. Exhausted search from P5@1631
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "6" at P6. Terminating search before P7.
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "7" at P7. Terminating search before P8.
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "8" at P8. Terminating search before P9.
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "9" at P9. Terminating search before P10.
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "9a" at P9. Terminating search before P10.
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "9b" at P9. Terminating search before P10.
[ZONE-SEQUENTIAL] üõ°Ô∏è Found early match for "10" at P10. Terminating search before P11.
[ZONE-ABSORB] Q9a absorbing Main Q9 on P9
[ZONE-ABSORB] Q11a absorbing Main Q11 on P11
[ZONE-TVC] Deterministic Order (Post-Absorb): 1(P1@866) -> 2(P2@1032) -> 2b(P2@1221) -> 3(P3@448) -> 4(P4@424) -> 5(P5@1621) -> 6(P6@563) -> 7(P7@740) -> 8(P8@832) -> 9a(P9@279) -> 9b(P9@724) -> 10(P10@734) -> 11a(P11@687) -> 11b(P11@1253)
[ZONE-TVC] First on P1: Snapping 1 start to 0
[ZONE-TVC] First on P2: Snapping 2 start to 0
[ZONE-TVC] First on P3: Snapping 3 start to 0
[ZONE-TVC] First on P4: Snapping 4 start to 0
[ZONE-TVC] First on P5: Snapping 5 start to 0
[ZONE-TVC] First on P6: Snapping 6 start to 0
[ZONE-TVC] First on P7: Snapping 7 start to 0
[ZONE-TVC] First on P8: Snapping 8 start to 0
[ZONE-TVC] First on P9: Snapping 9a start to 0
[ZONE-TVC] First on P10: Snapping 10 start to 0
[ZONE-TVC] First on P11: Snapping 11a start to 0
[1m[32müîÑ [AI MARKING][0m [1mSTARTING...[0m
 üåê [ZONE-ARCHITECT] Using Global Pre-calculated Zones (Count: 14)

üîç [EXECUTOR PROBE] Q1
   - Task Page Index: 1
   - Visible Blocks Sample: p1_q1_line_2, p1_q1_line_1, p1_ocr_6
[33m[POS-DEBUG] ‚ö†Ô∏è Missing Position for Q1 -> (0,0).[0m
[33m   - ClassBlocks: 0[0m
[33m   - QuestionDetection: true[0m
 üåê [ZONE-ARCHITECT] Using Global Pre-calculated Zones (Count: 14)

üîç [EXECUTOR PROBE] Q2
   - Task Page Index: 2
   - Visible Blocks Sample: p2_q2_line_1, p2_q2_line_2, p2_ocr_1
[33m[POS-DEBUG] ‚ö†Ô∏è Missing Position for Q2 -> (0,0).[0m
[33m   - ClassBlocks: 0[0m
[33m   - QuestionDetection: true[0m
 üåê [ZONE-ARCHITECT] Using Global Pre-calculated Zones (Count: 14)

üîç [EXECUTOR PROBE] Q3
   - Task Page Index: 3
   - Visible Blocks Sample: p3_q3_line_2, p3_q3_line_1, p3_ocr_6
[33m[POS-DEBUG] ‚ö†Ô∏è Missing Position for Q3 -> (0,0).[0m
[33m   - ClassBlocks: 0[0m
[33m   - QuestionDetection: true[0m
 üåê [ZONE-ARCHITECT] Using Global Pre-calculated Zones (Count: 14)

üîç [EXECUTOR PROBE] Q4
   - Task Page Index: 4
   - Visible Blocks Sample: p4_q4_line_7, p4_q4_line_6, p4_q4_line_5
[33m[POS-DEBUG] ‚ö†Ô∏è Missing Position for Q4 -> (0,0).[0m
[33m   - ClassBlocks: 0[0m
[33m   - QuestionDetection: true[0m
 üåê [ZONE-ARCHITECT] Using Global Pre-calculated Zones (Count: 14)

üîç [EXECUTOR PROBE] Q5
   - Task Page Index: 5
   - Visible Blocks Sample: drawing_5_2, p5_q5_line_2, p5_q5_line_3
[33m[POS-DEBUG] ‚ö†Ô∏è Missing Position for Q5 -> (0,0).[0m
[33m   - ClassBlocks: 0[0m
[33m   - QuestionDetection: true[0m
 ‚úÖ [ZONE-OK] Q3: Footprint at Y=25.8% (Range 22.4-29.2%) is safe within 0.0-97.9%
 ‚úÖ [ZONE-OK] Q3: Footprint at Y=47.1% (Range 45.4-48.8%) is safe within 0.0-97.9%
 üíé [BUDGET-CHECK] Q3: Max Marks = 2. Items to Process: 2
 ‚úÖ [ZONE-FIDELITY] Q3: Reusing Upstream Zone from Detection Stage.
 üåê [ZONE-ARCHITECT] Using Global Pre-calculated Zones (Count: 14)

üîç [EXECUTOR PROBE] Q6
   - Task Page Index: 6
   - Visible Blocks Sample: p6_q6_line_9, p6_q6_line_8, p6_q6_line_7
[33m[POS-DEBUG] ‚ö†Ô∏è Missing Position for Q6 -> (0,0).[0m
[33m   - ClassBlocks: 0[0m
[33m   - QuestionDetection: true[0m
 üõ°Ô∏è [SEMANTIC-VETO] 1: Block p1_ocr_11 ("2") rejected.
 üìç [PATH 3] Q1: Line "p1_q1_line_2" is UNMATCHED. Recovering position.
 ‚úÖ [ZONE-OK] Q1: Footprint at Y=38.7% (Range 36.0-41.4%) is safe within 0.0-97.9%
 ‚úÖ [ZONE-OK] Q1: Footprint at Y=58.0% (Range 55.5-60.5%) is safe within 0.0-97.9%
 üíé [BUDGET-CHECK] Q1: Max Marks = 2. Items to Process: 2
 ‚úÖ [ZONE-FIDELITY] Q1: Reusing Upstream Zone from Detection Stage.
 üåê [ZONE-ARCHITECT] Using Global Pre-calculated Zones (Count: 14)

üîç [EXECUTOR PROBE] Q7
   - Task Page Index: 7
   - Visible Blocks Sample: p7_q7_line_9, p7_q7_line_8, p7_q7_line_7
[33m[POS-DEBUG] ‚ö†Ô∏è Missing Position for Q7 -> (0,0).[0m
[33m   - ClassBlocks: 0[0m
[33m   - QuestionDetection: true[0m
 ‚úÖ [ZONE-OK] Q2b: Footprint at Y=60.1% (Range 58.4-61.9%) is safe within 51.6-97.9%
 üíé [BUDGET-CHECK] Q2a: Max Marks = 99. Items to Process: 2
 üíé [BUDGET-CHECK] Q2b: Max Marks = 99. Items to Process: 1
 ‚úÖ [ZONE-FIDELITY] Q2: Reusing Upstream Zone from Detection Stage.
 üåê [ZONE-ARCHITECT] Using Global Pre-calculated Zones (Count: 14)

üîç [EXECUTOR PROBE] Q8
   - Task Page Index: 8
   - Visible Blocks Sample: p8_q8_line_5, p8_q8_line_4, p8_q8_line_3
[33m[POS-DEBUG] ‚ö†Ô∏è Missing Position for Q8 -> (0,0).[0m
[33m   - ClassBlocks: 0[0m
[33m   - QuestionDetection: true[0m
 ‚úÖ [ZONE-OK] Q4: Footprint at Y=26.3% (Range 23.3-29.4%) is safe within 0.0-97.8%
 ‚úÖ [ZONE-OK] Q4: Footprint at Y=32.5% (Range 29.4-35.6%) is safe within 0.0-97.8%
 ‚úÖ [ZONE-OK] Q4: Footprint at Y=44.9% (Range 41.8-48.0%) is safe within 0.0-97.8%
 ‚úÖ [ZONE-OK] Q4: Footprint at Y=58.7% (Range 57.0-60.5%) is safe within 0.0-97.8%
 üíé [BUDGET-CHECK] Q4: Max Marks = 4. Items to Process: 4
 ‚úÖ [ZONE-FIDELITY] Q4: Reusing Upstream Zone from Detection Stage.
 üåê [ZONE-ARCHITECT] Using Global Pre-calculated Zones (Count: 14)

üîç [EXECUTOR PROBE] Q9
   - Task Page Index: 9
   - Visible Blocks Sample: p9_q9_line_1, p9_q9_line_2, p9_q9_line_3
[33m[POS-DEBUG] ‚ö†Ô∏è Missing Position for Q9 -> (0,0).[0m
[33m   - ClassBlocks: 0[0m
[33m   - QuestionDetection: true[0m
 üíé [BUDGET-CHECK] Q5c: Max Marks = 99. Items to Process: 2
 üíé [BUDGET-CHECK] Q5a: Max Marks = 99. Items to Process: 1
 üíé [BUDGET-CHECK] Q5b: Max Marks = 99. Items to Process: 1
 ‚úÖ [ZONE-FIDELITY] Q5: Reusing Upstream Zone from Detection Stage.
 üåê [ZONE-ARCHITECT] Using Global Pre-calculated Zones (Count: 14)

üîç [EXECUTOR PROBE] Q10
   - Task Page Index: 10
   - Visible Blocks Sample: p10_q10_line_7, p10_q10_line_6, p10_q10_line_5
[33m[POS-DEBUG] ‚ö†Ô∏è Missing Position for Q10 -> (0,0).[0m
[33m   - ClassBlocks: 0[0m
[33m   - QuestionDetection: true[0m
 ‚úÖ [ZONE-OK] Q8: Footprint at Y=51.0% (Range 48.7-53.4%) is safe within 0.0-97.9%
 ‚úÖ [ZONE-OK] Q8: Footprint at Y=51.0% (Range 48.7-53.4%) is safe within 0.0-97.9%
 ‚úÖ [ZONE-OK] Q8: Footprint at Y=61.6% (Range 59.5-63.6%) is safe within 0.0-97.9%
 üíé [BUDGET-CHECK] Q8: Max Marks = 3. Items to Process: 3
 ‚úÖ [ZONE-FIDELITY] Q8: Reusing Upstream Zone from Detection Stage.
 üåê [ZONE-ARCHITECT] Using Global Pre-calculated Zones (Count: 14)

üîç [EXECUTOR PROBE] Q11
   - Task Page Index: 11
   - Visible Blocks Sample: p11_q11_line_1, p11_q11_line_2, p11_q11_line_3
[33m[POS-DEBUG] ‚ö†Ô∏è Missing Position for Q11 -> (0,0).[0m
[33m   - ClassBlocks: 0[0m
[33m   - QuestionDetection: true[0m
 ‚úÖ [ZONE-OK] Q6: Footprint at Y=37.0% (Range 35.0-39.0%) is safe within 0.0-98.0%
 ‚úÖ [ZONE-OK] Q6: Footprint at Y=40.9% (Range 39.0-42.9%) is safe within 0.0-98.0%
 ‚úÖ [ZONE-OK] Q6: Footprint at Y=48.8% (Range 46.8-50.8%) is safe within 0.0-98.0%
 ‚úÖ [ZONE-OK] Q6: Footprint at Y=58.1% (Range 55.9-60.3%) is safe within 0.0-98.0%
 üíé [BUDGET-CHECK] Q6: Max Marks = 4. Items to Process: 4
 ‚úÖ [ZONE-FIDELITY] Q6: Reusing Upstream Zone from Detection Stage.
‚úÖ [IRON-DOME] Snapped mark to: p9_q9_line_1 (P9)
   üîì [ZONE-SKIP] Skipping clamping for Qa. Anno P9 != Zone P11
‚úÖ [IRON-DOME] Snapped mark to: p9_q9_line_2 (P9)
   üîì [ZONE-SKIP] Skipping clamping for Qb. Anno P9 != Zone P11
 üíé [BUDGET-CHECK] Qa: Max Marks = 99. Items to Process: 1
 üíé [BUDGET-CHECK] Qb: Max Marks = 99. Items to Process: 1
 ‚úÖ [ZONE-OK] Q7: Footprint at Y=33.7% (Range 31.5-36.0%) is safe within 0.0-98.0%
 ‚úÖ [ZONE-OK] Q7: Footprint at Y=38.2% (Range 36.0-40.4%) is safe within 0.0-98.0%
 ‚úÖ [ZONE-OK] Q7: Footprint at Y=42.6% (Range 40.4-44.8%) is safe within 0.0-98.0%
 ‚úÖ [ZONE-OK] Q7: Footprint at Y=64.7% (Range 62.5-66.9%) is safe within 0.0-98.0%
 üíé [BUDGET-CHECK] Q7: Max Marks = 4. Items to Process: 4
 ‚úÖ [ZONE-FIDELITY] Q7: Reusing Upstream Zone from Detection Stage.
 üö´ [VETO-REJECT] Candidate "All lengths are measured in centimetres." matches Veto "the diagram shows two rightangled triangles all lengths are measured in centimetres given that sina tan b work out the value of x"
 üö´ [VETO-REJECT] Candidate "Given that" matches Veto "the diagram shows two rightangled triangles all lengths are measured in centimetres given that sina tan b work out the value of x"
 üö´ [VETO-REJECT] Candidate "work out the value of \( x \)." matches Veto "the diagram shows two rightangled triangles all lengths are measured in centimetres given that sina tan b work out the value of x"
 üö´ [VETO-REJECT] Candidate "\hline" matches Veto "the diagram shows two rightangled triangles all lengths are measured in centimetres given that sina tan b work out the value of x"
 üß≤ [LINKER-RESCUE] 10: Snapped UNMATCHED "Sina= \\frac{7-2x}{9}" to Block p10_ocr_5
 ‚úÖ [ZONE-OK] Q10: Footprint at Y=35.0% (Range 33.1-36.9%) is safe within 0.0-97.8%
 ‚úÖ [ZONE-OK] Q10: Footprint at Y=38.7% (Range 36.9-40.6%) is safe within 0.0-97.8%
 ‚úÖ [ZONE-OK] Q10: Footprint at Y=42.5% (Range 40.6-44.4%) is safe within 0.0-97.8%
 ‚úÖ [ZONE-OK] Q10: Footprint at Y=50.0% (Range 48.1-51.8%) is safe within 0.0-97.8%
 üíé [BUDGET-CHECK] Q10: Max Marks = 3. Items to Process: 4
 ‚úÖ [ZONE-FIDELITY] Q10: Reusing Upstream Zone from Detection Stage.
[GUILLOTINE] Q10 GLOBAL exceeded budget! Total 3. Executing final cut...
 üõ°Ô∏è [VETO-HIT] Block "60" matched Veto Item "the frequency table gives information about the weights of 60 parcels"
 üõ°Ô∏è [SEMANTIC-VETO] 11a: Block p11_ocr_27 ("60") rejected.
 üìç [PATH 3] Q11a: Line "p11_q11_line_5" is UNMATCHED. Recovering position.
 ‚úÖ [ZONE-OK] Q11a: Footprint at Y=39.2% (Range 38.1-40.3%) is safe within 0.0-58.4%
 ‚úÖ [ZONE-OK] Q11a: Footprint at Y=42.5% (Range 41.2-43.8%) is safe within 0.0-58.4%
 ‚úÖ [ZONE-OK] Q11a: Footprint at Y=45.6% (Range 44.1-47.0%) is safe within 0.0-58.4%
 ‚úÖ [ZONE-OK] Q11a: Footprint at Y=48.7% (Range 47.4-50.0%) is safe within 0.0-58.4%
 ‚úÖ [ZONE-OK] Q11a: Footprint at Y=42.1% (Range 40.6-43.6%) is safe within 0.0-58.4%
 üõ°Ô∏è [ZONE-PROTECT] Q11b: Footprint breach at Y=58.4% (Bottom=63.4%). Clamping back 10% to 68.4%
 ‚úÖ [ZONE-OK] Q11b: Footprint at Y=68.9% (Range 63.9-73.9%) is safe within 58.4-97.7%
 üíé [BUDGET-CHECK] Q11a: Max Marks = 99. Items to Process: 5
 üíé [BUDGET-CHECK] Q11c: Max Marks = 99. Items to Process: 2
 üíé [BUDGET-CHECK] Q11d: Max Marks = 99. Items to Process: 2
 üíé [BUDGET-CHECK] Q11b: Max Marks = 99. Items to Process: 2
[GUILLOTINE] Q11a exceeded budget! Kept 1/5, Budget 1.
[1m[32m‚úÖ [AI MARKING][0m [1mCOMPLETED[0m in [1m17.9s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
[1m[32m‚úÖ [MARKING][0m [1mCOMPLETED[0m in [1m17.9s[0m ([32m[1mAI-MARKING[0m)

üîç [RESULT VERIFICATION] Checking what will be combined:
   üìä Marking Results: 11 questions
   üìù Question Results: NO
   ‚úÖ Both modes triggered: NO

üé® [RENDERER AUDIT] Page 1 (Physical Index) - 1 Questions:
   ‚úÖ Q1: ZONE FOUND [x:40, y:0, w:1624, h:2382]

üé® [RENDERER AUDIT] Page 2 (Physical Index) - 1 Questions:
   ‚úÖ Q2: ZONE FOUND [x:40, y:0, w:1616, h:1221]

üé® [RENDERER AUDIT] Page 3 (Physical Index) - 1 Questions:
   ‚úÖ Q3: ZONE FOUND [x:40, y:0, w:1552, h:2298]

üé® [RENDERER AUDIT] Page 4 (Physical Index) - 1 Questions:
   ‚úÖ Q4: ZONE FOUND [x:40, y:0, w:1552, h:2250]

üé® [RENDERER AUDIT] Page 5 (Physical Index) - 1 Questions:
   ‚úÖ Q5: ZONE FOUND [x:40, y:0, w:1564, h:2342]

üé® [RENDERER AUDIT] Page 6 (Physical Index) - 1 Questions:
   ‚úÖ Q6: ZONE FOUND [x:40, y:0, w:1676, h:2442]

üé® [RENDERER AUDIT] Page 7 (Physical Index) - 1 Questions:
   ‚úÖ Q7: ZONE FOUND [x:40, y:0, w:1744, h:2490]

üé® [RENDERER AUDIT] Page 8 (Physical Index) - 1 Questions:
   ‚úÖ Q8: ZONE FOUND [x:40, y:0, w:1636, h:2370]

üé® [RENDERER AUDIT] Page 9 (Physical Index) - 1 Questions:
   ‚úÖ Q9: ZONE FOUND [x:40, y:40, w:1584, h:2272]

üé® [RENDERER AUDIT] Page 10 (Physical Index) - 1 Questions:
   ‚úÖ Q10: ZONE FOUND [x:40, y:0, w:1536, h:2198]

üé® [RENDERER AUDIT] Page 11 (Physical Index) - 1 Questions:
   ‚úÖ Q11: ZONE FOUND [x:40, y:40, w:1436, h:2064]

‚úÖ [OUTPUT SERVICE] Final Page Order (Verified Content):
---------------------------------------------------------------------------------
| Seq | Index | Original Filename      | Content (Questions)                  |
---------------------------------------------------------------------------------
| [0] |  0    | new doc 2025-11-23 11. | METADATA / FRONT PAGE                |
| [1] |  1    | new doc 2025-11-23 11. | 1                                    |
| [2] |  2    | new doc 2025-11-23 11. | 2                                    |
| [3] |  3    | new doc 2025-11-23 11. | 3                                    |
| [4] |  4    | new doc 2025-11-23 11. | 4                                    |
| [5] |  5    | new doc 2025-11-23 11. | 5                                    |
| [6] |  6    | new doc 2025-11-23 11. | 6                                    |
| [7] |  7    | new doc 2025-11-23 11. | 7                                    |
| [8] |  8    | new doc 2025-11-23 11. | 8                                    |
| [9] |  9    | new doc 2025-11-23 11. | 9                                    |
| [10] |  10   | new doc 2025-11-23 11. | 10                                   |
| [11] |  11   | new doc 2025-11-23 11. | 11                                   |
---------------------------------------------------------------------------------

[1m[32m‚úÖ [OUTPUT GENERATION][0m [1mCOMPLETED[0m in [1m3.2s[0m ([32m[1mOUTPUT-GENERATION[0m)
[V2 CLEAN FIX] üèóÔ∏è Building UI Structure directly from 11 Engine Results...
[V2 CLEAN FIX] ‚úÖ UI Structure ready (Strings preserved)
[1m[32m‚úÖ [PERFORMANCE SUMMARY AI][0m [1mCOMPLETED[0m in [1m1.4s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
[V2 CLEAN FIX] üèóÔ∏è Building UI Structure directly from 11 Engine Results...
[V2 CLEAN FIX] ‚úÖ UI Structure ready (Strings preserved)

üìä [ANNOTATION SUMMARY]
-----------------------------------------------------------------------------------------
| Q#       | Score | Marks Awarded           | Match Status (AI -> Final)             |
|----------|-------|-------------------------|----------------------------------------|
| [32m1       [0m | 2/2   | A1, M1                  | AI:2/2 ‚Üí M:1 U:1                       |
|----------|-------|-------------------------|----------------------------------------|
| [32m2       [0m | 3/3   | A1, M1, B1              | AI:3/3 ‚Üí M:3 U:0                       |
| [90m  a     [0m | 2     | A1, M1                  | AI:2/2 ‚Üí M:2 U:0                       |
| [90m  b     [0m | 1     | B1                      | AI:1/1 ‚Üí M:1 U:0                       |
|----------|-------|-------------------------|----------------------------------------|
| [32m3       [0m | 2/2   | A1, M1                  | AI:2/2 ‚Üí M:2 U:0                       |
|----------|-------|-------------------------|----------------------------------------|
| [32m4       [0m | 4/4   | A1, P1, P1, P1          | AI:4/4 ‚Üí M:4 U:0                       |
|----------|-------|-------------------------|----------------------------------------|
| [32m5       [0m | 6/6   | A1, M1, B2, B2          | AI:1/4 ‚Üí M:1 U:0                       |
| [90m  a     [0m | 2     | B2                      | AI:0/1 ‚Üí M:0 U:0                       |
| [90m  b     [0m | 2     | B2                      | AI:0/1 ‚Üí M:0 U:0                       |
| [90m  c     [0m | 2     | A1, M1                  | AI:1/2 ‚Üí M:1 U:0                       |
|----------|-------|-------------------------|----------------------------------------|
| [32m6       [0m | 4/4   | P1, P1, P1, C1          | AI:4/4 ‚Üí M:4 U:0                       |
|----------|-------|-------------------------|----------------------------------------|
| [32m7       [0m | 4/4   | A1, M1, M1, C1          | AI:4/4 ‚Üí M:4 U:0                       |
|----------|-------|-------------------------|----------------------------------------|
| [32m8       [0m | 3/3   | A1, P1, P1              | AI:3/3 ‚Üí M:3 U:0                       |
|----------|-------|-------------------------|----------------------------------------|
| [32m9       [0m | 2/2   | B1, C1                  | AI:2/2 ‚Üí M:2 U:0                       |
| [90m  a     [0m | 1     | B1                      | AI:1/1 ‚Üí M:1 U:0                       |
| [90m  b     [0m | 1     | C1                      | AI:1/1 ‚Üí M:1 U:0                       |
|----------|-------|-------------------------|----------------------------------------|
| [32m10      [0m | 4/3   | A1, B0, B1, P1          | AI:3/4 ‚Üí M:4 U:0                       |
|----------|-------|-------------------------|----------------------------------------|
| [32m11      [0m | 1/7   | B1, A0, M0, A0, M0, A0, M0 | AI:1/7 ‚Üí M:1 U:0                       |
| [90m  a     [0m | 1     | B1                      | AI:1/1 ‚Üí M:1 U:0                       |
| [90m  b     [0m | 0     | A0, M0                  | AI:0/2 ‚Üí M:0 U:0                       |
| [90m  c     [0m | 0     | A0, M0                  | AI:0/2 ‚Üí M:0 U:0                       |
| [90m  d     [0m | 0     | A0, M0                  | AI:0/2 ‚Üí M:0 U:0                       |
|----------|-------|-------------------------|----------------------------------------|

=== PERFORMANCE SUMMARY ===
Total Processing Time: 56.6s
Model Used: gemini-2.0-flash
----------------------------
classification                      19.4s (34%)
marking                             17.9s (32%)
ocr_processing                      7.2s (13%)
question_detection                  4.8s (8%)
output_generation                   3.2s (6%)
preprocessing                       1.5s (3%)
performance_summary                 1.4s (3%)
database_persistence                0.2s (0%)
============================


üìä [UsageTracker] Summary:
   Model: gemini-2.0-flash
   API Requests: 25 total
   Total Tokens: 157,359 (142,992 in + 14,367 out)
   Total Cost: $0.067229
   Mathpix OCR: 12 pages ‚Üí $0.048000

   Breakdown by Phase:
   ‚Ä¢ Mapper (Map Pass): 6,191 tokens (2 requests) ‚Üí $0.000817
   ‚Ä¢ Classification (Marking Pass): 72,334 tokens (11 requests) ‚Üí $0.009117
   ‚Ä¢ Marking: 77,094 tokens (11 requests) ‚Üí $0.009916
   ‚Ä¢ Performance Summary: 1,740 tokens (1 requests) ‚Üí $0.000197


üèÅ ========== UNIFIED PIPELINE END ==========
üèÅ ==========================================

‚úÖ [CONTROLLER] Pipeline completed, result exists: true, sessionId: sub-1770018853654
üí≥ [CREDIT DEDUCT] Starting deduction for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, sessionId: sub-1770018853654
üí≥ [CREDIT DEDUCT] Incremental cost from tracker: 0.0672292
üîç [SUBJECT EXTRACTION] examPapers[0].subject = "Mathematics"
üí≥ Deducted 6.72 credits from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2 (session: sub-1770018853654), remaining: 356.38
üí≥ Deducted 0.0672 credits (session: sub-1770018853654) from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2
‚úÖ [SUBJECT MARKING RESULT] Persisted marking result for subject: Mathematics, session: sub-1770018853654
‚úÖ Permissions configuration loaded from .env.local:
   - Analysis Plans: pro, ultra
   - Model Selection Plans: pro, ultra
‚úÖ Credit configuration loaded from .env.local (FAIL-FAST mode):
   - Conversion Rate: $0.01 per credit
   - Free Plan: 10 credits/month
   - Pro Plan: 200 credits/month
   - Ultra Plan: 600 credits/month
üí≥ Stripe initialized in TEST mode
üìö Swagger UI available at /api-docs
‚úÖ Permissions configuration loaded from .env.local:
   - Analysis Plans: pro, ultra
   - Model Selection Plans: pro, ultra
‚úÖ Credit configuration loaded from .env.local (FAIL-FAST mode):
   - Conversion Rate: $0.01 per credit
   - Free Plan: 10 credits/month
   - Pro Plan: 200 credits/month
   - Ultra Plan: 600 credits/month
üí≥ Stripe initialized in TEST mode
üìö Swagger UI available at /api-docs
‚úÖ Permissions configuration loaded from .env.local:
   - Analysis Plans: pro, ultra
   - Model Selection Plans: pro, ultra
‚úÖ Credit configuration loaded from .env.local (FAIL-FAST mode):
   - Conversion Rate: $0.01 per credit
   - Free Plan: 10 credits/month
   - Pro Plan: 200 credits/month
   - Ultra Plan: 600 credits/month
üí≥ Stripe initialized in TEST mode
üìö Swagger UI available at /api-docs
