
> ai-marking-backend@1.0.0 dev
> cross-env NODE_OPTIONS=--no-deprecation nodemon --exec tsx --tsconfig tsconfig.dev.json server.ts

‚úÖ Permissions configuration loaded from .env.local:
   - Analysis Plans: pro, ultra
   - Model Selection Plans: pro, ultra
‚úÖ Credit configuration loaded from .env.local (FAIL-FAST mode):
   - Conversion Rate: $0.01 per credit
   - Free Plan: 10 credits/month
   - Pro Plan: 200 credits/month
   - Ultra Plan: 600 credits/month
üí≥ Stripe initialized in TEST mode
üìö Swagger UI available at /api-docs
üë§ [PLAN CHECK] User 9mBfvniXTuMtQU8f0OnLhUK6aOv2 is on plan: ultra
üì° [MARKING] Processing POST /api/marking/process (hasRawBody: false)
üöÄ [MARKING] Controller started - Files: 1, Body Keys: model, aiMessageId
üîç [CREDIT DEBUG] userId: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, isAuthenticated: true
üí≥ [CREDIT CHECK] Starting credit check for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2
üí≥ [CREDIT CHECK] Estimated cost: 0.0158132, files: 1, bytes: 108132
üí≥ [CREDIT CHECK] Result: {"canProceed":true,"remaining":352.61}

üîÑ ========== UNIFIED PIPELINE START ==========
üîÑ ============================================

[1m[32m‚úÖ [INPUT VALIDATION][0m [1mCOMPLETED[0m in [1m0.0s[0m ([32m[1mVALIDATION[0m)
[INPUT TYPE] Detected: Single Image (1 files)
[1m[32m‚úÖ [PREPROCESSING][0m [1mCOMPLETED[0m in [1m0.1s[0m ([32m[1mIMAGE-PROCESSING[0m)
[MAPPER] Using model: gemini-2.0-flash
[MAPPER] Starting Map Pass for 1 pages...
‚úÖ [MAPPER] Map Pass complete in 1.57s. Mapped 1 pages.
[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m8.8s[0m ([32m[1mGEMINI-2.0-FLASH[0m)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîÄ [PERFECT SPLIT] Building standalone structures with re-indexing
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üéØ [MODE ROUTING] Pure marking mode

‚úÖ Perfect split complete - each mode has consecutive 0-based indices
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

[1m[32m‚úÖ [CLASSIFICATION][0m [1mCOMPLETED[0m in [1m8.8s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
üîç [MODE DETECTION] Analysis (AFTER overrides):
  - All question-only: false
  - Has mixed content: false
  - Has any student work: true
  - Selected mode: Marking Mode
[1m[32m‚úÖ [OCR PROCESSING][0m [1mCOMPLETED[0m in [1m1.5s[0m ([32m[1mMATHPIX[0m)
[SIMILARITY OVERRIDE] 85% because MatchRate=0.60
[31m[HINT] ‚ö†Ô∏è Hint Adherence Failed! Poor match density. Restarting...[0m
[SIMILARITY OVERRIDE] 85% because MatchRate=0.60
[1m[32m‚úÖ [QUESTION DETECTION][0m [1mCOMPLETED[0m in [1m0.4s[0m ([32m[1mQUESTION-DETECTION[0m)

üîç [DETECTION CONTEXT]
   Strategy: Global Search
   Pool Size: 108 papers, 2709 total question candidates
------------------------------------------------------------------------------------------------------------------------------------

üìã [DETECTION AUDIT REPORT]
------------------------------------------------------------------------------------------------------------------------------------
| Q#   | Input Text (Fragment)                       | Match Result / Paper Title                         | Score | Status        |
------------------------------------------------------------------------------------------------------------------------------------
| 12   | Put these in order starting with the small... | Unknown General Generic Question N/A Q12           | 0.000 | [33m‚ö†Ô∏è  WEAK MATCH[0m |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.682] 1MA1/1H Q12                    | Txt:0.85 Num:0.00 Str:1.00 Sem:PASS
      ‚óã [0.558] 8300/1F Q12                    | Txt:0.25 Num:0.59 Str:1.00 Sem:PASS
      ‚óã [0.556] 1MA1/2H Q12                    | Txt:0.19 Num:0.69 Str:1.00 Sem:PASS
| 13   | Work out the value of \frac{5}{\sqrt{3}} -... | Unknown General Generic Question N/A Q13           | 0.000 | [33m‚ö†Ô∏è  WEAK MATCH[0m |
   ‚îî‚îÄ Runners Up (Audit Trail):
      ‚óã [0.539] 8300/1H Q13                    | Txt:0.19 Num:0.62 Str:1.00 Sem:PASS
      ‚óã [0.534] J560/04 Q13                    | Txt:0.13 Num:0.71 Str:1.00 Sem:PASS
      ‚óã [0.528] J560/02 Q13                    | Txt:0.18 Num:0.59 Str:1.00 Sem:PASS
------------------------------------------------------------------------------------------------------------------------------------


üìä [QUESTION DETECTION STATISTICS]
   Total questions: 2
   Detected: 0/2
   Not detected: 2
   [HINT] Hint Used: "Global Search"
   [HINT] Matched Papers: 108
üîç [MERGE-DEBUG] attempting to merge classification results into 1 pages
   ‚úÖ [MERGE-DEBUG] Page 0 merged with 2 results (Total Qs: 2)
üÜî [GLOBAL-ID] Assigning stable IDs to all OCR blocks before task creation...
‚úÖ createMarkingTasksFromClassification completed, created 2 marking task(s)
[1m[32müîÑ [AI MARKING][0m [1mSTARTING...[0m

üîç [MAPPING DEBUG] Available Classification Targets for Q12:
   [0] ID: p0_q12_line_1 | Text: "\frac{2}{3} x \sqrt{18}" | Handwriting: true | Box: [11,19,8,3]
   [1] ID: p0_q12_line_2 | Text: "\frac{156}{\sqrt{2}}" | Handwriting: true | Box: [27,12,4,3]
   [2] ID: p0_q12_line_3 | Text: "\frac{10}{\sqrt{5}}" | Handwriting: true | Box: [44,12,2,2]
   [3] ID: p0_q12_line_4 | Text: "\sqrt{28}" | Handwriting: true | Box: [61,9,2,2]
   [4] ID: p0_q12_line_5 | Text: "You must show your working." | Handwriting: true | Box: [11,26,15,2]
   [5] ID: p0_q12_line_6 | Text: "\sqrt{8}" | Handwriting: true | Box: [11,31,4,3]
   [6] ID: p0_q12_line_7 | Text: "\frac{2}{3} \sqrt{18}" | Handwriting: true | Box: [14,32,4,2]
   [7] ID: p0_q12_line_8 | Text: "\frac{10}{\sqrt{5}} x \frac{\sqrt{5}}{\sqrt{5}}" | Handwriting: true | Box: [44,19,8,3]
   [8] ID: p0_q12_line_9 | Text: "10 \sqrt{5}" | Handwriting: true | Box: [52,22,4,2]
   [9] ID: p0_q12_line_10 | Text: "\sqrt{28}" | Handwriting: true | Box: [27,35,4,3]
   [10] ID: p0_q12_line_11 | Text: "2\sqrt{7}" | Handwriting: true | Box: [36,35,4,3]
   [11] ID: p0_q12_line_12 | Text: "2\sqrt{5}" | Handwriting: true | Box: [44,35,4,3]
   [12] ID: p0_q12_line_13 | Text: "Smallest 2\sqrt{5}" | Handwriting: true | Box: [36,53,11,3]
   [13] ID: p0_q12_line_14 | Text: "2\sqrt{6}" | Handwriting: true | Box: [36,57,4,3]
   [14] ID: p0_q12_line_15 | Text: "Largest 2\sqrt{7}" | Handwriting: true | Box: [36,62,11,3]
üîç [ZONE SCAN] Scanning blocks for landmarks...
   üìç Found Landmark: "q" at Page 0, Y=56
   üìç Found Landmark: "q" at Page 0, Y=579

üîç [ZONE DEBUG] Detected Semantic Zones: q

üîç [ID-VERIFICATION] Checking Target IDs for Prompt Generation:
   üëâ Question: Q12 (Page 0)
   ‚úÖ Structured Targets (First 3 of 17):
      [0] ID: "p0_q12_line_1" | Text: "\frac{2}{3} x \sqrt{..."
      [1] ID: "p0_q12_line_2" | Text: "\frac{156}{\sqrt{2}}..."
      [2] ID: "p0_q12_line_3" | Text: "\frac{10}{\sqrt{5}}..."
   ‚úÖ Rescue Layer Targets (First 3 of 14):
      [0] ID: "p0_ocr_0" | Text: "Q12...."
      [1] ID: "p0_ocr_1" | Text: "Put these in order s..."
      [2] ID: "p0_ocr_2" | Text: "\( 2 \sqrt{3} \times..."
------------------------------------------------------------------


üîç [COORD-DEBUG] Inspecting Potential Offset Sources...
   üëâ QuestionDetection Box: undefined
   ‚ö†Ô∏è ClassificationBlocks array is empty.

üîç [COORD-DEBUG] Inspecting Potential Offset Sources...
   üëâ QuestionDetection Box: undefined
   üîç [COORD-DEBUG] Using Sub-Question Anchor [p0_ocr_0] "Q12...." for Offset: x=100, y=56

üîç [MAPPING DEBUG] Available Classification Targets for Q13:
   [0] ID: p0_q13_line_1 | Text: "\frac{5}{\sqrt{3}} \frac{\sqrt{3}}{\sqrt{3}} = \frac{5\sqrt{3}}{3} - \frac{\sqrt{27}}{4} \frac{\sqrt{27}}{2}" | Handwriting: true | Box: [26,58,31,4]
   [1] ID: p0_q13_line_2 | Text: "\frac{5\sqrt{3}}{3} - \frac{\sqrt{27}}{2} = \frac{10\sqrt{3}}{6} - \frac{9\sqrt{3}}{6} = \frac{1}{6}\sqrt{3}" | Handwriting: true | Box: [26,68,38,4]
   [2] ID: p0_q13_line_3 | Text: "\frac{1}{6}\sqrt{3}" | Handwriting: true | Box: [37,85,8,4]
üîç [ZONE SCAN] Scanning blocks for landmarks...
   üìç Found Landmark: "q" at Page 0, Y=56
   üìç Found Landmark: "q" at Page 0, Y=579

üîç [ZONE DEBUG] Detected Semantic Zones: q

üîç [ID-VERIFICATION] Checking Target IDs for Prompt Generation:
   üëâ Question: Q13 (Page 0)
   ‚úÖ Structured Targets (First 3 of 5):
      [0] ID: "p0_q13_line_1" | Text: "\frac{5}{\sqrt{3}} \..."
      [1] ID: "p0_q13_line_2" | Text: "\frac{5\sqrt{3}}{3} ..."
      [2] ID: "p0_q13_line_3" | Text: "\frac{1}{6}\sqrt{3}..."
   ‚úÖ Rescue Layer Targets (First 3 of 14):
      [0] ID: "p0_ocr_0" | Text: "Q12...."
      [1] ID: "p0_ocr_1" | Text: "Put these in order s..."
      [2] ID: "p0_ocr_2" | Text: "\( 2 \sqrt{3} \times..."
------------------------------------------------------------------


üîç [COORD-DEBUG] Inspecting Potential Offset Sources...
   üëâ QuestionDetection Box: undefined
   ‚ö†Ô∏è ClassificationBlocks array is empty.

üîç [COORD-DEBUG] Inspecting Potential Offset Sources...
   üëâ QuestionDetection Box: undefined
   üîç [COORD-DEBUG] Using Sub-Question Anchor [p0_ocr_5] "Q13...." for Offset: x=116, y=579

üöÄ [PROMPT-ALIGNMENT] FINAL AI PROMPT SENT TO MODEL:
==================================================================
SYSTEM PROMPT: [REDACTED FOR BREVITY - See MarkingInstructionService.ts if needed]
------------------------------------------------------------------
USER PROMPT:
 
# MARKING TASK: Question 12

## QUESTION TEXT
Put these in order starting with the smallest. \( 2 \sqrt{3} \times \sqrt{2} \) \text { Smallest } 
\frac{2 \sqrt{3}}{2 \sqrt{6}} & \hline \text { Largest } \frac{2 \sqrt{7}}{} & \text { (Total 3 marks) } Work out the value of \( \frac{5}{\sqrt{3}}-\sqrt{6 \frac{3}{4}} \frac{5}{\sqrt{3}} \sqrt{\frac{3}{7}} \frac{\sqrt{7}}{3}-\sqrt{\frac{67}{6}} \frac{\sqrt{27}}{7}


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)

‚ö†Ô∏è NO OFFICIAL MARKING SCHEME AVAILABLE (GENERIC MODE).
1. You are the CHIEF EXAMINER. Determine the marking criteria based on the question text.
2. GRADING STRATEGY:
   - Use M1, M2, M3... for sequential Method steps (correct approach).
   - Use A1, A2, A3... for sequential Accuracy steps (correct values).
   - Use B1, B2, B3... for Independent statements/reasons.
   - Use M0/A0/B0 ONLY to explicitly flag incorrect steps.
3. SCORING LIMITS:
   - If a specific max mark is detected (e.g. [3]), try to align with it.
   - HOWEVER, if the student shows valid work exceeding that limit, AWARD THE MARKS.
   - Do not cap the score artificially. Prioritize correct mathematics.




## MARKING SCHEME


[GENERIC_GCSE_LOGIC]
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **GET BUDGET**: Search for "(Total X marks)".
> 2. **SOLVE & MARK**: Award marks for valid steps.
> 3. **CUT (Guillotine)**: Do not exceed the budget.



> [!IMPORTANT]
> This is a GENERIC marking pool. 
> - Discover the actual total marks from the student paper (e.g. "Total 4 marks").
> - ONLY return annotations for the marks actually identified/needed.
> - Do NOT generate filler annotations to "coverage" the entire M1-M8 pool.


## STUDENT WORK (STRUCTURED)
1. \frac{2}{3} x \sqrt{18}
2. \frac{156}{\sqrt{2}}
3. \frac{10}{\sqrt{5}}
4. \sqrt{28}
5. You must show your working.
6. \sqrt{8}
7. \frac{2}{3} \sqrt{18}
8. \frac{10}{\sqrt{5}} x \frac{\sqrt{5}}{\sqrt{5}}
9. 10 \sqrt{5}
10. \sqrt{28}
11. 2\sqrt{7}
12. 2\sqrt{5}
13. Smallest 2\sqrt{5}
14. 2\sqrt{6}
15. Largest 2\sqrt{7}


 
## RAW OCR BLOCKS
Use these IDs to map the student's work. Match them yourself based on the content.

[p0_ocr_0]: "Q12."
[p0_ocr_1]: "Put these in order starting with the smallest."
[p0_ocr_2]: "\( 2 \sqrt{3} \times \sqrt{2} \)"
[p0_ocr_3]: "\text { Smallest }  \frac{2 \sqrt{3}}{2 \sqrt{6}} &"
[p0_ocr_4]: "\hline \text { Largest } \frac{2 \sqrt{7}}{} & \text { (Total 3 marks) }"
[p0_ocr_6]: "Work out the value of \( \frac{5}{\sqrt{3}}-\sqrt{6 \frac{3}{4}} \frac{5}{\sqrt{3}} \sqrt{\frac{3}{7}} \frac{\sqrt{7}}{3}-\sqrt{\frac{67}{6}} \frac{\sqrt{27}}{7} [PRINTED_INSTRUCTION]"
[p0_ocr_7]: "\frac{5 \sqrt{3}}{3}-\frac{\sqrt{72}}{2}=\frac{3 \sqrt{7}}{6} \frac{10 \sqrt{3}}{6} \frac{4 \sqrt{3}}{6} \sqrt{3} \)"
[p0_ocr_8]: "Answer"
[p0_ocr_9]: "\( \frac{1}{6} \sqrt{7} \)"
[p0_ocr_10]: "(Total 4 marks)"
[p0_ocr_11]: "Page 7 of 8"
[p0_ocr_12]: "AQA GCSE Maths - Surds (H)"
[p0_ocr_13]: "PhysicsAndMathsTutor.com"
[p0_q12_line_1]: "\frac{2}{3} x \sqrt{18}"
[p0_q12_line_2]: "\frac{156}{\sqrt{2}}"
[p0_q12_line_3]: "\frac{10}{\sqrt{5}}"
[p0_q12_line_4]: "\sqrt{28}"
[p0_q12_line_5]: "You must show your working."
[p0_q12_line_6]: "\sqrt{8}"
[p0_q12_line_7]: "\frac{2}{3} \sqrt{18}"
[p0_q12_line_8]: "\frac{10}{\sqrt{5}} x \frac{\sqrt{5}}{\sqrt{5}}"
[p0_q12_line_9]: "10 \sqrt{5}"
[p0_q12_line_10]: "\sqrt{28}"
[p0_q12_line_11]: "2\sqrt{7}"
[p0_q12_line_12]: "2\sqrt{5}"
[p0_q12_line_13]: "Smallest 2\sqrt{5}"
[p0_q12_line_14]: "2\sqrt{6}"
[p0_q12_line_15]: "Largest 2\sqrt{7}"

==================================================================


üöÄ [PROMPT-ALIGNMENT] FINAL AI PROMPT SENT TO MODEL:
==================================================================
SYSTEM PROMPT: [REDACTED FOR BREVITY - See MarkingInstructionService.ts if needed]
------------------------------------------------------------------
USER PROMPT:
 
# MARKING TASK: Question 13

## QUESTION TEXT
Work out the value of \( \frac{5}{\sqrt{3}}-\sqrt{6 \frac{3}{4}} \frac{5}{\sqrt{3}} \sqrt{\frac{3}{7}} \frac{\sqrt{7}}{3}-\sqrt{\frac{67}{6}} \frac{\sqrt{27}}{7}


## GENERAL MARKING GUIDANCE (CHIEF EXAMINER INSTRUCTION)

‚ö†Ô∏è NO OFFICIAL MARKING SCHEME AVAILABLE (GENERIC MODE).
1. You are the CHIEF EXAMINER. Determine the marking criteria based on the question text.
2. GRADING STRATEGY:
   - Use M1, M2, M3... for sequential Method steps (correct approach).
   - Use A1, A2, A3... for sequential Accuracy steps (correct values).
   - Use B1, B2, B3... for Independent statements/reasons.
   - Use M0/A0/B0 ONLY to explicitly flag incorrect steps.
3. SCORING LIMITS:
   - If a specific max mark is detected (e.g. [3]), try to align with it.
   - HOWEVER, if the student shows valid work exceeding that limit, AWARD THE MARKS.
   - Do not cap the score artificially. Prioritize correct mathematics.




## MARKING SCHEME


[GENERIC_GCSE_LOGIC]
> [INSTRUCTION]: You are the CHIEF EXAMINER.
> 1. **GET BUDGET**: Search for "(Total X marks)".
> 2. **SOLVE & MARK**: Award marks for valid steps.
> 3. **CUT (Guillotine)**: Do not exceed the budget.



> [!IMPORTANT]
> This is a GENERIC marking pool. 
> - Discover the actual total marks from the student paper (e.g. "Total 4 marks").
> - ONLY return annotations for the marks actually identified/needed.
> - Do NOT generate filler annotations to "coverage" the entire M1-M8 pool.


## STUDENT WORK (STRUCTURED)
1. \frac{5}{\sqrt{3}} \frac{\sqrt{3}}{\sqrt{3}} = \frac{5\sqrt{3}}{3} - \frac{\sqrt{27}}{4} \frac{\sqrt{27}}{2}
2. \frac{5\sqrt{3}}{3} - \frac{\sqrt{27}}{2} = \frac{10\sqrt{3}}{6} - \frac{9\sqrt{3}}{6} = \frac{1}{6}\sqrt{3}
3. \frac{1}{6}\sqrt{3}


 
## RAW OCR BLOCKS
Use these IDs to map the student's work. Match them yourself based on the content.

[p0_ocr_1]: "Put these in order starting with the smallest."
[p0_ocr_2]: "\( 2 \sqrt{3} \times \sqrt{2} \)"
[p0_ocr_3]: "\text { Smallest }  \frac{2 \sqrt{3}}{2 \sqrt{6}} &"
[p0_ocr_4]: "\hline \text { Largest } \frac{2 \sqrt{7}}{} & \text { (Total 3 marks) }"
[p0_ocr_5]: "Q13."
[p0_ocr_6]: "Work out the value of \( \frac{5}{\sqrt{3}}-\sqrt{6 \frac{3}{4}} \frac{5}{\sqrt{3}} \sqrt{\frac{3}{7}} \frac{\sqrt{7}}{3}-\sqrt{\frac{67}{6}} \frac{\sqrt{27}}{7} [PRINTED_INSTRUCTION]"
[p0_ocr_7]: "\frac{5 \sqrt{3}}{3}-\frac{\sqrt{72}}{2}=\frac{3 \sqrt{7}}{6} \frac{10 \sqrt{3}}{6} \frac{4 \sqrt{3}}{6} \sqrt{3} \)"
[p0_ocr_8]: "Answer"
[p0_ocr_9]: "\( \frac{1}{6} \sqrt{7} \)"
[p0_ocr_10]: "(Total 4 marks)"
[p0_ocr_11]: "Page 7 of 8"
[p0_ocr_12]: "AQA GCSE Maths - Surds (H)"
[p0_ocr_13]: "PhysicsAndMathsTutor.com"
[p0_q13_line_1]: "\frac{5}{\sqrt{3}} \frac{\sqrt{3}}{\sqrt{3}} = \frac{5\sqrt{3}}{3} - \frac{\sqrt{27}}{4} \frac{\sqrt{27}}{2}"
[p0_q13_line_2]: "\frac{5\sqrt{3}}{3} - \frac{\sqrt{27}}{2} = \frac{10\sqrt{3}}{6} - \frac{9\sqrt{3}}{6} = \frac{1}{6}\sqrt{3}"
[p0_q13_line_3]: "\frac{1}{6}\sqrt{3}"

==================================================================


========================================
[LOG-DEBUG] Raw AI MARKING JSON Response
----------------------------------------
```json
{
  "meta": {
    "question_total_marks": 3,
    "raw_correct_steps_found": 3,
    "steps_dropped_to_fit_budget": 0,
    "isTotalEstimated": false
  },
  "visualObservation": "Student correctly identifies the smallest, middle, and largest values in the list.",
  "annotations": [
    {
      "line_id": "p0_q12_line_13",
      "action": "tick",
      "text": "B1",
      "student_text": "Smallest 2\\sqrt{5}",
      "classification_text": "Smallest 2\\sqrt{5}",
      "ocr_match_status": "MATCHED",
      "reasoning": "Correctly identifies the smallest value as 2sqrt(5).",
      "subQuestion": "a",
      "pageIndex": 0,
      "line_index": 12,
      "visual_position": {
        "x": 0,
        "y": 0,
        "width": 0,
        "height": 0
      }
    },
    {
      "line_id": "p0_q12_line_14",
      "action": "tick",
      "text": "B1",
      "student_text": "2\\sqrt{6}",
      "classification_text": "2\\sqrt{6}",
      "ocr_match_status": "MATCHED",
      "reasoning": "Correctly identifies the middle value as 2sqrt(6).",
      "subQuestion": "a",
      "pageIndex": 0,
      "line_index": 13,
      "visual_position": {
        "x": 0,
        "y": 0,
        "width": 0,
        "height": 0
      }
    },
    {
      "line_id": "p0_q12_line_15",
      "action": "tick",
      "text": "B1",
      "student_text": "Largest 2\\sqrt{7}",
      "classification_text": "Largest 2\\sqrt{7}",
      "ocr_match_status": "MATCHED",
      "reasoning": "Correctly identifies the largest value as 2sqrt(7).",
      "subQuestion": "a",
      "pageIndex": 0,
      "line_index": 14,
      "visual_position": {
        "x": 0,
        "y": 0,
        "width": 0,
        "height": 0
      }
    }
  ],
  "studentScore": {
    "totalMarks": 3,
    "awardedMarks": 3,
    "scoreText": "3/3"
  }
}
```
========================================


üîç [ANNOTATION-AUDIT] Phase 1: ID Correction for Q12

üîç [ENRICH-START] Processing Q12 | 3 annotations
   ‚öì [GLOBAL-OFFSET] Applying offsets: x=100, y=56

üëâ [ANNO 0] "B1" (ID: p0_q12_line_13) | Status In: MATCHED
   ‚ö†Ô∏è [SCALING-CORRECTION] "Matched" coords are suspicious (36,53). Treating as PERCENTAGE.
   üèÅ [FINAL] ID: p0_q12_line_13 | Status: MATCHED | Method: PX_PRECOMPUTED_SCALED

üëâ [ANNO 1] "B1" (ID: p0_q12_line_14) | Status In: MATCHED
   ‚ö†Ô∏è [SCALING-CORRECTION] "Matched" coords are suspicious (36,57). Treating as PERCENTAGE.
   üèÅ [FINAL] ID: p0_q12_line_14 | Status: MATCHED | Method: PX_PRECOMPUTED_SCALED

üëâ [ANNO 2] "B1" (ID: p0_q12_line_15) | Status In: MATCHED
   ‚ö†Ô∏è [SCALING-CORRECTION] "Matched" coords are suspicious (36,62). Treating as PERCENTAGE.
   üèÅ [FINAL] ID: p0_q12_line_15 | Status: MATCHED | Method: PX_PRECOMPUTED_SCALED

üîç [ANNOTATION-AUDIT] Phase 3: Spatial Sanitization for Q12
‚úÖ [ANNOTATION-AUDIT] Complete

[SCORE DEBUG] Q12: rawScore={"totalMarks":3,"awardedMarks":3,"scoreText":"3/3"}, parsedAwarded=3, parsedTotal=3, schemeTotal=0
[GUILLOTINE CHECK] Q12: isGeneric=true, hasAnnotations=true, hasScore=true, SchemeTotal=0, ResultTotal=3

========================================
[LOG-DEBUG] Raw AI MARKING JSON Response
----------------------------------------
```json
{
  "meta": {
    "question_total_marks": 4,
    "raw_correct_steps_found": 3,
    "steps_dropped_to_fit_budget": 0,
    "isTotalEstimated": false
  },
  "visualObservation": "Student attempts to simplify the surd expression. There are 3 lines of working shown, leading to the final answer.",
  "annotations": [
    {
      "line_id": "p0_q13_line_1",
      "action": "tick",
      "text": "M1",
      "student_text": "\\frac{5}{\\sqrt{3}} \\frac{\\sqrt{3}}{\\sqrt{3}} = \\frac{5\\sqrt{3}}{3} - \\frac{\\sqrt{27}}{4} \\frac{\\sqrt{27}}{2}",
      "classification_text": "\\frac{5}{\\sqrt{3}} \\frac{\\sqrt{3}}{\\sqrt{3}} = \\frac{5\\sqrt{3}}{3} - \\frac{\\sqrt{27}}{4} \\frac{\\sqrt{27}}{2}",
      "ocr_match_status": "MATCHED",
      "reasoning": "Correctly rationalizes the first term and expresses the second term with square roots.",
      "subQuestion": "a",
      "pageIndex": 0,
      "line_index": 0,
      "visual_position": {
        "x": 0,
        "y": 0,
        "width": 0,
        "height": 0
      }
    },
    {
      "line_id": "p0_q13_line_2",
      "action": "tick",
      "text": "M2",
      "student_text": "\\frac{5\\sqrt{3}}{3} - \\frac{\\sqrt{27}}{2} = \\frac{10\\sqrt{3}}{6} - \\frac{9\\sqrt{3}}{6} = \\frac{1}{6}\\sqrt{3}",
      "classification_text": "\\frac{5\\sqrt{3}}{3} - \\frac{\\sqrt{27}}{2} = \\frac{10\\sqrt{3}}{6} - \\frac{9\\sqrt{3}}{6} = \\frac{1}{6}\\sqrt{3}",
      "ocr_match_status": "MATCHED",
      "reasoning": "Combines the terms with a common denominator and simplifies.",
      "subQuestion": "a",
      "pageIndex": 0,
      "line_index": 1,
      "visual_position": {
        "x": 0,
        "y": 0,
        "width": 0,
        "height": 0
      }
    },
    {
      "line_id": "p0_q13_line_3",
      "action": "tick",
      "text": "A1",
      "student_text": "\\frac{1}{6}\\sqrt{3}",
      "classification_text": "\\frac{1}{6}\\sqrt{3}",
      "ocr_match_status": "MATCHED",
      "reasoning": "Correct final answer.",
      "subQuestion": "a",
      "pageIndex": 0,
      "line_index": 2,
      "visual_position": {
        "x": 0,
        "y": 0,
        "width": 0,
        "height": 0
      }
    }
  ],
  "studentScore": {
    "totalMarks": 4,
    "awardedMarks": 3,
    "scoreText": "3/4"
  }
}
```
========================================


üîç [ANNOTATION-AUDIT] Phase 1: ID Correction for Q13

üîç [ENRICH-START] Processing Q13 | 3 annotations
   ‚öì [GLOBAL-OFFSET] Applying offsets: x=116, y=579

üëâ [ANNO 0] "M1" (ID: p0_q13_line_1) | Status In: MATCHED
   ‚ö†Ô∏è [SCALING-CORRECTION] "Matched" coords are suspicious (26,58). Treating as PERCENTAGE.
   üèÅ [FINAL] ID: p0_q13_line_1 | Status: MATCHED | Method: PX_PRECOMPUTED_SCALED

üëâ [ANNO 1] "M2" (ID: p0_q13_line_2) | Status In: MATCHED
   ‚ö†Ô∏è [SCALING-CORRECTION] "Matched" coords are suspicious (26,68). Treating as PERCENTAGE.
   üèÅ [FINAL] ID: p0_q13_line_2 | Status: MATCHED | Method: PX_PRECOMPUTED_SCALED

üëâ [ANNO 2] "A1" (ID: p0_q13_line_3) | Status In: MATCHED
   ‚ö†Ô∏è [SCALING-CORRECTION] "Matched" coords are suspicious (37,85). Treating as PERCENTAGE.
   üèÅ [FINAL] ID: p0_q13_line_3 | Status: MATCHED | Method: PX_PRECOMPUTED_SCALED

üîç [ANNOTATION-AUDIT] Phase 3: Spatial Sanitization for Q13
‚úÖ [ANNOTATION-AUDIT] Complete

[SCORE DEBUG] Q13: rawScore={"totalMarks":4,"awardedMarks":4,"scoreText":"4/4"}, parsedAwarded=4, parsedTotal=4, schemeTotal=0
[GUILLOTINE CHECK] Q13: isGeneric=true, hasAnnotations=true, hasScore=true, SchemeTotal=0, ResultTotal=4
[1m[32m‚úÖ [AI MARKING][0m [1mCOMPLETED[0m in [1m6.8s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
[1m[32m‚úÖ [MARKING][0m [1mCOMPLETED[0m in [1m6.8s[0m ([32m[1mAI-MARKING[0m)

üîç [RESULT VERIFICATION] Checking what will be combined:
   üìä Marking Results: 2 questions
   üìù Question Results: NO
   ‚úÖ Both modes triggered: NO
[TOTAL TRAP] Q12: Scheme=0, AI=3, IsDefault=false -> FINAL=3
[TOTAL TRAP] Q13: Scheme=0, AI=4, IsDefault=false -> FINAL=4
[TOTAL TRAP] Grand Total Possible Score: 7
[32müîÑ [LOGICAL RE-INDEXING] Aligning logical indices with sorted physical order...[0m
[32m‚úÖ [LOGICAL RE-INDEXING] Re-indexed 2 questions and 1 pages.[0m
[32m‚úÖ [1m[FINAL PAGE ORDER][0m [32m[1] Page null ([37mQ12, Q13[32m)[0m
[1m[32m‚úÖ [OUTPUT GENERATION][0m [1mCOMPLETED[0m in [1m1.1s[0m ([32m[1mOUTPUT-GENERATION[0m)
[SYNC FIX] üîÑ Synchronizing UI Structure (Schema Defaults) with Engine Results (Actuals)...
[SYNC FIX] ‚úÖ Q12: Updated Total Available Marks from undefined (Schema) -> 3 (Engine)
[SYNC FIX] ‚úÖ Q13: Updated Total Available Marks from undefined (Schema) -> 4 (Engine)
[SYNC FIX] üèÅ Updated Grand Total from 0 -> 7
[1m[32m‚úÖ [PERFORMANCE SUMMARY AI][0m [1mCOMPLETED[0m in [1m0.8s[0m ([32m[1mGEMINI-2.0-FLASH[0m)
üîç [LOG-DEBUG] Found classificationResult for page 0 with 2 questions
üîç [LOG-DEBUG] Total transparency blocks gathered: 32
üîç [LOG-DEBUG] Block IDs: p0_ocr_0, p0_ocr_1, p0_ocr_2, p0_ocr_3, p0_ocr_4, p0_ocr_5, p0_ocr_6, p0_ocr_7, p0_ocr_8, p0_ocr_9, p0_ocr_10, p0_ocr_11, p0_ocr_12, p0_ocr_13, p0_q13_line_1, p0_q13_line_2, p0_q13_line_3, p0_q12_line_1, p0_q12_line_2, p0_q12_line_3, p0_q12_line_4, p0_q12_line_5, p0_q12_line_6, p0_q12_line_7, p0_q12_line_8, p0_q12_line_9, p0_q12_line_10, p0_q12_line_11, p0_q12_line_12, p0_q12_line_13, p0_q12_line_14, p0_q12_line_15

üìä [RAW AI MARKING TRANSPARENCY REPORT]
------------------------------------------------------------------------------------------------------------------------------------------------------
| Q#   | Student Work (AI View)                                         | Mark | Status     | OCR Text (Cited Block)                                 |
------------------------------------------------------------------------------------------------------------------------------------------------------
| [Q12]  | Smallest 2sqrt{5}                                            | B1   | [32mMATCHED     [0m | Smallest 2\sqrt{5}                                           |
| [Q12]  | 2sqrt{6}                                                     | B1   | [32mMATCHED     [0m | 2\sqrt{6}                                                    |
| [Q12]  | Largest 2sqrt{7}                                             | B1   | [32mMATCHED     [0m | Largest 2\sqrt{7}                                            |
| [Q13]  | frac{5}{sqrt{3}} frac{sqrt{3}}{sqrt{3}} = frac{5sqrt{3}}{3}  | M1   | [32mMATCHED     [0m | \frac{5}{\sqrt{3}} \frac{\sqrt{3}}{\sqrt{3}} = \frac{5\sqrt{ |
| [Q13]  | frac{5sqrt{3}}{3} - frac{sqrt{27}}{2} = frac{10sqrt{3}}{6} - | M2   | [32mMATCHED     [0m | \frac{5\sqrt{3}}{3} - \frac{\sqrt{27}}{2} = \frac{10\sqrt{3} |
| [Q13]  | frac{1}{6}sqrt{3}                                            | A1   | [32mMATCHED     [0m | \frac{1}{6}\sqrt{3}                                          |
------------------------------------------------------------------------------------------------------------------------------------------------------


üìä [ANNOTATION SUMMARY]
----------------------------------------------------------------------
| Q#       | Score | Marks Awarded           | Match Status              |
|----------|-------|-------------------------|---------------------------|
| [32m12      [0m | 3/3   | B1, B1, B1              | M:3 V:0 U:0 S:0           |
| [90m  a     [0m | 3     | B1, B1, B1              | M:3 V:0 U:0 S:0           |
|----------|-------|-------------------------|---------------------------|
| [32m13      [0m | 4/4   | M1, M2, A1              | M:3 V:0 U:0 S:0           |
| [90m  a     [0m | 4     | M1, M2, A1              | M:3 V:0 U:0 S:0           |
|----------|-------|-------------------------|---------------------------|

=== PERFORMANCE SUMMARY ===
Total Processing Time: 20.3s
Model Used: gemini-2.0-flash
----------------------------
classification                      8.8s (43%)
marking                             6.8s (33%)
ocr_processing                      1.5s (8%)
output_generation                   1.1s (5%)
performance_summary                 0.8s (4%)
question_detection                  0.4s (2%)
database_persistence                0.3s (1%)
preprocessing                       0.1s (0%)
============================


üìä [UsageTracker] Summary:
   Model: gemini-2.0-flash
   API Requests: 6 total
   Total Tokens: 25,928 (22,682 in + 3,246 out)
   Total Cost: $0.007291
   Mathpix OCR: 1 pages ‚Üí $0.004000

   Breakdown by Phase:
   ‚Ä¢ Mapper (Map Pass): 2,608 tokens (1 requests) ‚Üí $0.000275
   ‚Ä¢ Classification (Marking Pass): 11,079 tokens (2 requests) ‚Üí $0.001592
   ‚Ä¢ Marking: 11,794 tokens (2 requests) ‚Üí $0.001644
   ‚Ä¢ Performance Summary: 447 tokens (1 requests) ‚Üí $0.000055


üèÅ ========== UNIFIED PIPELINE END ==========
üèÅ ==========================================

‚úÖ [CONTROLLER] Pipeline completed, result exists: true, sessionId: sub-1769070829128
üí≥ [CREDIT DEDUCT] Starting deduction for user: 9mBfvniXTuMtQU8f0OnLhUK6aOv2, sessionId: sub-1769070829128
üí≥ [CREDIT DEDUCT] Incremental cost from tracker: 0.0072914
üîç [SUBJECT EXTRACTION] examPapers[0].subject = "General"
üí≥ Deducted 0.73 credits from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2 (session: sub-1769070829128), remaining: 351.88
üí≥ Deducted 0.0073 credits (session: sub-1769070829128) from user 9mBfvniXTuMtQU8f0OnLhUK6aOv2
‚úÖ [SUBJECT MARKING RESULT] Persisted marking result for subject: General, session: sub-1769070829128
