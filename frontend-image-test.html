<!DOCTYPE html>
<html>
<head>
    <title>Firebase Storage Image Test</title>
</head>
<body>
    <h1>Firebase Storage Image Test</h1>
    <div id="test-results"></div>
    
    <script>
        async function testImageLoading() {
            const results = document.getElementById('test-results');
            
            try {
                // Get session data from backend
                const response = await fetch('http://localhost:5001/api/messages/session/session-1757848855390-dy6xdnwd4');
                const data = await response.json();
                
                if (data.success && data.session && data.session.messages) {
                    results.innerHTML += '<h2>✅ Session data loaded successfully</h2>';
                    
                    data.session.messages.forEach((message, index) => {
                        if (message.type === 'marking_annotated') {
                            results.innerHTML += `<h3>Testing Annotated Image ${index + 1}:</h3>`;
                            
                            // Test imageLink
                            if (message.imageLink) {
                                results.innerHTML += `<p>Image Link: ${message.imageLink.substring(0, 50)}...</p>`;
                                const img1 = document.createElement('img');
                                img1.src = message.imageLink;
                                img1.style.maxWidth = '300px';
                                img1.onload = () => results.innerHTML += '<p>✅ Image Link loaded successfully</p>';
                                img1.onerror = () => results.innerHTML += '<p>❌ Image Link failed to load</p>';
                                results.appendChild(img1);
                            }
                            
                            // Test markingData.annotatedImageUrl
                            if (message.markingData && message.markingData.annotatedImageUrl) {
                                results.innerHTML += `<p>Annotated Image URL: ${message.markingData.annotatedImageUrl.substring(0, 50)}...</p>`;
                                const img2 = document.createElement('img');
                                img2.src = message.markingData.annotatedImageUrl;
                                img2.style.maxWidth = '300px';
                                img2.onload = () => results.innerHTML += '<p>✅ Annotated Image URL loaded successfully</p>';
                                img2.onerror = () => results.innerHTML += '<p>❌ Annotated Image URL failed to load</p>';
                                results.appendChild(img2);
                            }
                        }
                    });
                } else {
                    results.innerHTML += '<h2>❌ Failed to load session data</h2>';
                }
            } catch (error) {
                results.innerHTML += `<h2>❌ Error: ${error.message}</h2>`;
            }
        }
        
        // Run test when page loads
        window.onload = testImageLoading;
    </script>
</body>
</html>
